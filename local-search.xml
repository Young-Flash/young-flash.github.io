<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Rust Analyzer çš„ IDE åŠŸèƒ½å®ç° Series 1 â€”â€” LSP</title>
    <link href="/2024/01/02/Rust%20Analyzer%20%E7%9A%84%20IDE%20%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0%20Series%201%20%E2%80%94%E2%80%94%20LSP/"/>
    <url>/2024/01/02/Rust%20Analyzer%20%E7%9A%84%20IDE%20%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0%20Series%201%20%E2%80%94%E2%80%94%20LSP/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h2><p>æœ€è¿‘ç»™ Rust Analyzer(RA) è´¡çŒ®äº†<a href="https://github.com/rust-lang/rust-analyzer/pulls?q=is%3Apr+author%3AYoung-Flash+is%3Aclosed">ä¸€äº› PR</a>ï¼Œåœ¨è¿™è¿‡ç¨‹ä¸­å¯¹äºå®ƒçš„ IDE åŠŸèƒ½å®ç°æŒºæ„Ÿå…´è¶£çš„ï¼Œäºæ˜¯æœ‰äº†æ–°å¹´çš„è¿™ç¬¬ä¸€ç¯‡åšå®¢ï¼Œè®°å½•ä¸€ä¸‹æˆ‘åœ¨æ¢ç´¢ Rust Analyzer çš„ IDE åŠŸèƒ½å®ç°çš„è¿‡ç¨‹ã€‚é¦–å…ˆæƒ³å…ˆä» LSP(Language Server Protocol) åœ¨ Rust Analyzer ä¸­çš„å®ç°å¼€å§‹ï¼Œåé¢å¯èƒ½ä¼šä»‹ç»ä¸€äº›å…¶ä»–å†…å®¹ï¼Œæ¯”å¦‚ RA æœåŠ¡ç«¯çš„ AST è§£æã€æ™ºèƒ½ assist å’Œ diagnostic quickfix å®ç°ã€HIR lowering â€¦ ï¼ˆæœ‰å¯èƒ½ä¼šé¸½å“ˆå“ˆå“ˆå“ˆï¼‰</p><h2 id="rust-analyzer-ä»‹ç»"><a class="markdownIt-Anchor" href="#rust-analyzer-ä»‹ç»"></a> Rust Analyzer ä»‹ç»</h2><p><a href="https://github.com/rust-lang/rust-analyzer">Rust Analyzer</a> æ˜¯ç”± Rust ç¤¾åŒºç»´æŠ¤çš„ Rust è¯­è¨€ IDE åŠŸèƒ½å®ç°ï¼ŒRust Analyzer æ’ä»¶æ­é… VSCode å¯ä»¥å¾—åˆ°ä¸€ä¸ªç°ä»£åŒ–çš„æ™ºèƒ½ Rust IDEï¼Œè¿™æˆ–è®¸æ˜¯ç›®å‰æœ€æµè¡Œçš„ Rust å¼€å‘ç¯å¢ƒã€‚æˆ‘è§‰å¾—å¯¹äºä¸€é—¨æ–°çš„ç¼–ç¨‹è¯­è¨€ï¼Œåœ¨ VSCode çš„å¼ºå¤§çš„ç¼–è¾‘å™¨åŠŸèƒ½ä¸Šæ„å»º language-specific çš„ IDE åŠŸèƒ½æ˜¯å…¼é¡¾å¼€å‘æˆæœ¬å’Œç”¨æˆ·ä½“éªŒçš„æœ€ä½³é€‰æ‹©ï¼Œæ¯•ç«Ÿä»é›¶å¼€å‘ä¸€ä¸ª IDE æ‰€éœ€çš„æˆæœ¬å¯æƒ³è€ŒçŸ¥ï¼Œè€Œä¸”å°±ç®—å¼€å‘å‡ºæ¥äº†çŸ­æ—¶é—´å†…ç”¨æˆ·ä½“éªŒä¹Ÿæ¯”ä¸ä¸Šç»è¿‡åƒé”¤ç™¾ç‚¼çš„ VSCodeã€‚</p><p>ä»ç”¨æˆ·çš„è§’åº¦è€Œè¨€ï¼ŒRust Analyzer åªæ˜¯ VSCode æ’ä»¶å¸‚åœºä¸Šçš„ä¸€ä¸ªæ’ä»¶ï¼Œå®‰è£…å®Œ Rust å·¥å…·é“¾ä¹‹åå†å®‰è£…è¿™ä¸ªæ’ä»¶å°±èƒ½å¾—åˆ°å¼€ç®±å³ç”¨çš„ IDE åŠŸèƒ½ã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼ŒRA èƒŒååšäº†ä¸å°‘å·¥ä½œã€‚åœ¨å®ƒçš„ GitHub ä¸»é¡µ ä¸Šçš„ About ä»‹ç»ä¸Šæ˜¯è¿™ä¹ˆå†™çš„ï¼š<strong>A Rust compiler front-end for IDEs</strong>ï¼›æ˜¯çš„ï¼ŒRA é¦–å…ˆæ˜¯ä¸€ä¸ªç¼–è¯‘å™¨å‰ç«¯ï¼Œå‡†ç¡®çš„è¯´ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ—¨åœ¨å®ç° IDE åŠŸèƒ½çš„ç¼–è¯‘å™¨å‰ç«¯ã€‚</p><p>è¿™ç¯‡æ–‡ç« ä¸»è¦ä¼šèšç„¦åœ¨Rust Analyzer çš„ IDE åŠŸèƒ½å®ç°ä¸­çš„ LSP éƒ¨åˆ†ï¼ŒLSP ç”±å¾®è½¯ä¸»å¯¼ï¼Œå°†è¯­è¨€æœåŠ¡å™¨ï¼ˆä¸€ä¸ªä»£ç åˆ†æå·¥å…·ï¼‰å’Œè¯­è¨€å®¢æˆ·ç«¯ï¼ˆVSCodeã€Sublime Textâ€¦ï¼‰ä¹‹é—´çš„é€šä¿¡è¿›è¡Œäº†æ ‡å‡†åŒ–ï¼Œè¿™æ ·ä¸€æ¥æ’ä»¶å¼€å‘è€…å°±å¯ä»¥åªå†™ä¸€æ¬¡ä»£ç åˆ†æç¨‹åºï¼Œç„¶ååœ¨å¤šä¸ªç¼–è¾‘å™¨ä¸­é‡ç”¨ã€‚å…³äº LSP çš„æ›´å¤šå†…å®¹å¯ä»¥æŸ¥çœ‹<a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/">å¾®è½¯çš„å®˜æ–¹ä¸»é¡µ</a>ã€‚</p><p>Rust Analyzer çš„å®¢æˆ·ç«¯ï¼ˆVSCode æ’ä»¶ï¼‰ä»£ç å’Œè¯­è¨€æœåŠ¡å™¨ä»£ç éƒ½åœ¨åŒä¸€ä¸ªä»“åº“ä¸­ï¼Œeditors/code ç›®å½•ä¸‹æ˜¯ VSCode å®¢æˆ·ç«¯æ’ä»¶ä»£ç ï¼Œå…¶ä½™å‡ä¸ºæœåŠ¡ç«¯ä»£ç ï¼›æœ¬æ–‡å†™ä½œæ—¶å‚è€ƒçš„ Rust Analyzer ä»£ç ç‰ˆæœ¬ä¸º <a href="https://github.com/rust-lang/rust-analyzer/tree/e1e4626f">e1e4626f</a>ã€‚</p><h2 id="client-å’Œ-server-çš„åä½œæ–¹å¼"><a class="markdownIt-Anchor" href="#client-å’Œ-server-çš„åä½œæ–¹å¼"></a> Client å’Œ Server çš„åä½œæ–¹å¼</h2><p>Rust Analyzer å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åœ¨åŒä¸€å°æœºå™¨çš„ä¸åŒè¿›ç¨‹ä¸­è¿è¡Œã€‚å®¢æˆ·ç«¯æ’ä»¶æ¿€æ´»åä¼š <a href="https://github.com/microsoft/vscode-languageserver-node/blob/3f725d8368ec0c75f390a37e4e159d78bc1527ac/client/src/node/main.ts#L353">spawn ä¸€ä¸ªè¿›ç¨‹è¿è¡ŒæœåŠ¡ç«¯</a>ã€‚RA æ˜¯ C/S å·¥ä½œæ¨¡å¼ï¼Œä¸è¿‡å´æ˜¯ä¸€ä¸ª Server æœåŠ¡ä¸€ä¸ª Clientï¼Œè¿™ä¹Ÿæ˜¯æˆ‘çœ‹äº†ä»£ç ä¹‹åæ‰çŸ¥é“ã€‚äºæ˜¯æƒ³ç€éªŒè¯ä¸€ä¸‹ï¼Œæˆ‘åœ¨ VSCode ä¸­æ‰“å¼€ä¸€ä¸ªæ–°çš„ Rust Workspaceï¼Œç”¨ ps å‘½ä»¤æŸ¥çœ‹æ´»åŠ¨è¿›ç¨‹åä¼šå‘ç°å¤šå‡ºä¸€ä¸ªæ–°çš„åä¸º rust-analyzer çš„è¿›ç¨‹ã€‚è¿™ç‚¹å€’æ˜¯å‡ºä¹æˆ‘çš„æ„æ–™ï¼Œæˆ‘è¿˜ä»¥ä¸ºä»¥ä¸ºæ˜¯ä¸€å¯¹å¤šå‘¢ğŸ¤”ã€‚ä¸è¿‡ä¸€å¯¹ä¸€ä¹Ÿåˆç†ï¼Œè¿™æ ·å…¶ä¸­ä¸€ä¸ª crash äº†ä¹Ÿä¸ä¼šå½±å“åˆ°å…¶ä»– Client Workspaceã€‚</p><p>Client å’Œ Server è¿™ä¸¤ä¸ªè¿›ç¨‹ä½¿ç”¨ stdio è¿›è¡Œé€šä¿¡ï¼Œå®¢æˆ·ç«¯è¿›ç¨‹å‘è‡ªå·±çš„ stdout å‘å‡ºçš„è¯·æ±‚æœåŠ¡ç«¯ä¼šåœ¨è‡ªå·±çš„ stdin æ¥æ”¶åˆ°ï¼ŒæœåŠ¡ç«¯è¿›ç¨‹å‘è‡ªå·±çš„ stdout è¿”å›å“åº”åˆ™ä¼šè¢«å®¢æˆ·ç«¯è¿›ç¨‹ä» stdin æ¥æ”¶ã€‚å½“ç„¶ï¼ŒRA æœåŠ¡ç«¯è¿˜å®ç°äº†åŸºäº socket çš„ TCP é€šä¿¡æ–¹å¼ï¼Œæœªæ¥ä¸æ’é™¤æœ‰æœ¬åœ° client è¿æ¥è¿œç¨‹ server çš„å¯èƒ½ã€‚<br /><img src="/img/blog_pic/2024/conn.png" alt="" /></p><h2 id="rust-analyzer-client"><a class="markdownIt-Anchor" href="#rust-analyzer-client"></a> Rust Analyzer Client</h2><p>é¦–å…ˆç›´è§‚åœ°å¯¹æ¯”ä¸€ä¸‹ Rust Analyzer å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„ä»£ç é‡ï¼Œå®¢æˆ·ç«¯ TypeScript ä»£ç ä¸è¿‡ 5k è¡Œï¼Œè€ŒæœåŠ¡ç«¯ Rust ä»£ç è¾¾åˆ°äº† 36w è¡Œã€‚<br /><img src="/img/blog_pic/2024/RA-client-code.png" alt="" /> <img src="/img/blog_pic/2024/RA-server-code.png" alt="" /></p><p>å®¢æˆ·ç«¯ä»£ç é‡èƒ½åšåˆ°è¿™ä¹ˆå°‘ï¼Œæ˜¯å› ä¸º Rust Analyzer åœ¨å®¢æˆ·ç«¯ä½¿ç”¨äº† <a href="https://github.com/microsoft/vscode-languageserver-node/tree/main/client">vscode-languageclient</a> è¿™ä¸ªåº“ã€‚<code>vscode-languageclient</code> æ˜¯ä¸€ä¸ª Node.js åº“ï¼Œå®ƒæä¾›äº†ä¸€ç§åœ¨ VSCode æ’ä»¶ä¸­å®ç° LSP å®¢æˆ·ç«¯çš„æ–¹å¼ã€‚è¿™ä¸ªåº“æä¾›äº†ä¸€äº›é«˜çº§çš„æŠ½è±¡ï¼Œä½¿å¾—æ’ä»¶å¯ä»¥ååˆ†å®¹æ˜“åœ°ä¸ LSP æœåŠ¡å™¨è¿›è¡Œäº¤äº’ã€‚å®¢æˆ·ç«¯ä»£ç ä¸­åªè¦æ³¨å†ŒæŸäº›å¤„ç†ç‰¹å®š LSP äº‹ä»¶å›è°ƒå‡½æ•°ï¼Œ<code>vscode-languageclient</code> ä¼šè‡ªåŠ¨åœ¨ç‰¹å®šçš„äº‹ä»¶å‘ç”Ÿåå‘å‡ºå¯¹åº”çš„ LSP è¯·æ±‚å¹¶ä¸”è°ƒç”¨å¯¹åº”çš„å›è°ƒå‡½æ•°å¤„ç†æ¥è‡ªæœåŠ¡ç«¯çš„å“åº”ã€‚</p><p>æ¯”å¦‚ï¼Œå½“ç”¨æˆ·åœ¨ VS Code ä¸­æ‰“å¼€ä¸€ä¸ª .rs æ–‡ä»¶æ—¶ï¼Œè¿™ä¸ªæ“ä½œå¯¹åº”ä¸€ä¸ªæ–‡ä»¶æ‰“å¼€äº‹ä»¶ï¼Œ<code>vscode-languageclient</code> åˆ™ä¼šè‡ªåŠ¨å‘é€ LSP ä¸­çš„ <a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#textDocument_didOpen">textDocument/didOpen</a> è¯·æ±‚åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°ä¼šåˆ†ææ‰“å¼€çš„è¿™ä¸ªæ–‡ä»¶ï¼Œç„¶åé€šè¿‡ä¸€ä¸ª <a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#textDocument_publishDiagnostics">textDocument.publishDiagnostics</a> å“åº”å‘é€ç»™å®¢æˆ·ç«¯è¿™ä¸ªæ–‡ä»¶ä¸Šçš„ä»£ç è¯Šæ–­ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°è¿™ä¸ªå“åº”å <code>vscode-languageclient</code> ä¼šä½¿ç”¨é»˜è®¤çš„å¤„ç†é€»è¾‘å¤„ç†è¿™ä¸ªå“åº”ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥ override ä¸ºå…¶ä»–é€»è¾‘ï¼‰ï¼Œä¹Ÿå°±æ˜¯æŠŠè¿™äº›ä»£ç è¯Šæ–­åœ¨ç¼–è¾‘å™¨ä¸­æºä»£ç å¯¹åº”çš„ä½ç½®å±•ç¤ºå‡ºæ¥æç¤ºç”¨æˆ·ï¼›æœ€ç»ˆç”¨æˆ·ä¼šçœ‹åˆ°è¿™æ ·çš„æ•ˆæœï¼š<br /><img src="/img/blog_pic/2024/unused_diag.png" alt="" /></p><p>å¯è§†åŒ–å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„é€šä¿¡è¿‡ç¨‹ï¼Œå¤§æ¦‚æ˜¯è¿™æ ·çš„æ•ˆæœï¼š</p><center><img src="/img/blog_pic/2024/client-server.png" width="70%"></center><p>å¯¹äº LSP è§„èŒƒä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œ<code>vscode-languageclient</code> ä¼šè‡ªåŠ¨å‘é€è¯·æ±‚å’Œå¤„ç†å“åº”ã€‚å¯¹äº LSP è§„èŒƒä¸­æ²¡æœ‰å®šä¹‰çš„æ–¹æ³•ï¼Œæ’ä»¶éœ€è¦ä½¿ç”¨ <code>LanguageClient.sendRequest</code> å‡½æ•°æ¥æ˜¾å¼åœ°å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ã€‚æ¯”å¦‚ï¼ŒRust Analyzer å®šä¹‰äº†ä¸€äº›<a href="https://github.com/Young-Flash/rust-analyzer/blob/master/docs/dev/lsp-extensions.md">æ‰©å±•æ–¹æ³•</a>(<code>Show Syntax Tree</code> æŸ¥çœ‹å½“å‰æ–‡ä»¶çš„æŠ½è±¡è¯­æ³•æ ‘ï¼Œ<code>Expand macro</code> æŸ¥çœ‹å®å±•å¼€åçš„ä»£ç )æ¥æä¾›ä¸€äº› LSP è§„èŒƒä¸­æ²¡æœ‰çš„åŠŸèƒ½ã€‚<br /><img src="/img/blog_pic/2024/ext.png" alt="" /></p><h2 id="rust-analyzer-server"><a class="markdownIt-Anchor" href="#rust-analyzer-server"></a> Rust Analyzer Server</h2><p>Rust Analyzer çš„æ‰€æœ‰è¯­è¨€æœåŠ¡åŠŸèƒ½éƒ½æ˜¯åœ¨æœåŠ¡ç«¯ä¸­å®ç°çš„ï¼Œä¸ºäº†æ”¯æŒè¯¸å¦‚è·³è½¬åˆ°å®šä¹‰ã€å¼•ç”¨æŸ¥æ‰¾ã€ä»£ç è¯Šæ–­ç­‰ IDE åŠŸèƒ½å®ƒå®ç°äº†ä¸€ä¸ªå›Šæ‹¬äº† <strong>lexering</strong>ã€<strong>parsing</strong>ã€<strong>IR lowering</strong>ã€<strong>type inferencing</strong> ç­‰é˜¶æ®µçš„å®Œæ•´çš„ç¼–è¯‘å™¨å‰ç«¯ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ RA æœåŠ¡ç«¯ä»£ç é‡è¾¾åˆ° 36w è¡Œçš„åŸå› ã€‚</p><p>æœåŠ¡ç«¯çš„å…¥å£ç‚¹åœ¨ <a href="https://github.com/rust-lang/rust-analyzer/blob/cf52c4b2b3367ae7355ef23393e2eae1d37de723/crates/rust-analyzer/src/bin/main.rs#L170">run_server</a>ï¼Œåœ¨è¿™é‡Œåˆ›å»ºä¸€å¯¹ crossbeam_channel çš„ Sender å’Œ Receiver ç”¨äºæ”¶å‘æ¶ˆæ¯ï¼Œspawn å‡ºä¸¤ä¸ªçº¿ç¨‹åˆ†åˆ«ç›‘å¬ stdin å’Œ stdoutï¼Œæ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚ä¼šé€šè¿‡ stdin ä¼ è¾¾åˆ° Receiver ä¸­ï¼ŒæœåŠ¡ç«¯å¤„ç†å®Œè¯·æ±‚åä¼šå°†å“åº”é€šè¿‡ Sender è¾“å‡ºåˆ° stdout ä»è€Œè¢«å®¢æˆ·ç«¯æ¥æ¥æ”¶ã€‚</p><p>å®Œæˆæ”¶å‘æ¶ˆæ¯çš„å‡†å¤‡å·¥ä½œåè¿™ä¸€å¯¹ crossbeam_channel ä¼šè¢«ä¼ é€’åˆ° <a href="https://github.com/rust-lang/rust-analyzer/blob/cf52c4b2b3367ae7355ef23393e2eae1d37de723/crates/rust-analyzer/src/main_loop.rs#L31">main_loop</a> ä¸­ï¼Œè¿™ä¹Ÿæ˜¯æ•´ä¸ªæœåŠ¡ç«¯çš„æ ¸å¿ƒã€‚LSP è¯·æ±‚åˆ°è¾¾ stdin åï¼Œæ§åˆ¶æµä¼šæ¥åˆ° main_loop ä¸­ï¼Œæ ¹æ®ä¸åŒçš„è¯·æ±‚ç±»å‹ï¼ˆæ¯”å¦‚è¦æ±‚è·³è½¬åˆ°å®šä¹‰ã€æä¾› inlay hint ç­‰ï¼‰åˆ†æ´¾åˆ°ä¸åŒçš„å¤„ç†é€»è¾‘ä¸­ã€‚</p><h2 id="ä¸€ä¸ªå…·ä½“çš„ä¾‹å­"><a class="markdownIt-Anchor" href="#ä¸€ä¸ªå…·ä½“çš„ä¾‹å­"></a> ä¸€ä¸ªå…·ä½“çš„ä¾‹å­</h2><p>ä»¥è¯·æ±‚å½“å‰å…‰æ ‡æ‰€åœ¨æºä»£ç ä½ç½®çš„å¯ç”¨ CodeAction ä¸ºä¾‹ï¼Œå‡è®¾å½“å‰å…‰æ ‡æ‰€åœ¨ä½ç½®å¦‚ä¸‹ï¼ˆ<code>|</code> æ‰€åœ¨ä½ç½®ï¼‰ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">test</span>() &#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">var</span> = <span class="hljs-title function_ invoke__">Some</span>(<span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">if</span> var.<span class="hljs-title function_ invoke__">is_some</span>()| &#123;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ­¤æ—¶å®¢æˆ·ç«¯ä¼šå‘é€ä¸€ä¸ª <a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#textDocument_codeAction">textDocument/codeAction</a> ç±»å‹çš„ LSP è¯·æ±‚ï¼Œæºå¸¦äº†å½“å‰æ–‡ä»¶ä»¥åŠå…‰æ ‡æ‰€åœ¨å…·ä½“ä½ç½®ç­‰ä¿¡æ¯ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;textDocument&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;uri&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;file:///home/flash/projects/ra/src/temp.rs&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;range&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;start&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;line&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;character&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;end&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;line&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;character&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  ...<br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>æœåŠ¡ç«¯æ”¶åˆ°åè¯·æ±‚å¹¶å°†å…¶åºåˆ—åŒ–ä¸ºä¸€ä¸ªå†…éƒ¨è¡¨ç¤ºçš„ lsp_types::CodeActionParams å¯¹è±¡ï¼Œæ¥ç€å°†è¿™ä¸ªå¯¹è±¡ä»£è¡¨çš„è¯·æ±‚åˆ†æ´¾åˆ° <a href="https://github.com/rust-lang/rust-analyzer/blob/cf52c4b2b3367ae7355ef23393e2eae1d37de723/crates/rust-analyzer/src/handlers/request.rs#L1117">handle_code_action</a> ä¸­è¿›è¡Œå¤„ç†ï¼Œå¤„ç†è¿‡ç¨‹ä¸­å‘ç°æœ‰ä¸¤ä¸ª CodeAction é€‚ç”¨äºå…‰æ ‡æ‰€åœ¨çš„ä¸Šä¸‹æ–‡ï¼ˆä¸ºå‡å°‘ç¯‡å¹…è¿™é‡Œæˆ‘ä»¬å‡è®¾åªæœ‰ä¸¤ä¸ªï¼‰ï¼Œä¸€ä¸ªæ˜¯å°† <code>is_some</code> å†™æ³•æ”¹ä¸º <code>if let Some</code>ï¼Œå¦ä¸€ä¸ªæ˜¯å°† <code>if</code> å†™æ³•æ”¹ä¸º <code>match</code> çš„å½¢å¼ã€‚è¿™ä¸¤é¡¹ CodeAction åˆ†åˆ«æ˜¯åœ¨ <a href="https://github.com/rust-lang/rust-analyzer/tree/cf52c4b2b3367ae7355ef23393e2eae1d37de723/crates/ide-assists/src/handlers">crates/ide-assists/src/handlers</a> ç›®å½•ä¸‹çš„ <a href="https://github.com/rust-lang/rust-analyzer/blob/cf52c4b2b3367ae7355ef23393e2eae1d37de723/crates/ide-assists/src/handlers/replace_is_method_with_if_let_method.rs#L4">replace_is_method_with_if_let_method.rs</a>ï¼ˆè¿™æ˜¯æˆ‘ç»™ RA æçš„<a href="https://github.com/rust-lang/rust-analyzer/pull/15743">ç¬¬ä¸€ä¸ª PR</a>ï¼‰ å’Œ <a href="https://github.com/rust-lang/rust-analyzer/blob/cf52c4b2b3367ae7355ef23393e2eae1d37de723/crates/ide-assists/src/handlers/replace_if_let_with_match.rs">replace_if_let_with_match.rs</a> ä¸­åŸºäº AST è¿›è¡Œåˆ†æå¾—åˆ°çš„ï¼Œè¿™ä¸ªç›®å½•ä¸‹è¿˜æœ‰è®¸å¤šç±»ä¼¼çš„ .rs æ–‡ä»¶ï¼Œæ¯ä¸€ä¸ªéƒ½ä»£è¡¨äº†ä¸€ä¸ªç‰¹å®šä¸Šä¸‹æ–‡ä¸­å¯ç”¨çš„ CodeAction çš„åˆ†æè¿‡ç¨‹ï¼Œåœ¨å¤„ç†ä¸€ä¸ª CodeAction è¯·æ±‚æ—¶ï¼Œå…¶ä¸­çš„æ¯ä¸€ä¸ªæ–‡ä»¶ä¸­çš„é€»è¾‘éƒ½ä¼šè¢«æ‰§è¡Œï¼Œå¦‚æœè¿™ä¸ª CodeAction é€‚ç”¨äºå½“å‰ä¸Šä¸‹æ–‡åˆ™ä¼šè¿”å› Some å¦åˆ™åˆ™æ˜¯ Noneã€‚</p><p><img src="/img/blog_pic/2024/demo.gif" alt="" />  å¯¹äºå‰é¢ä¸¾çš„ä¾‹å­ä¸­çš„ä¸¤ä¸ªå¯ç”¨ CodeActionï¼ŒæœåŠ¡ç«¯ä¼šè¿”å›è¿™æ ·çš„å“åº”ï¼Œå…¶ä¸­çš„ <code>title</code> å­—æ®µä¹Ÿå°±æ˜¯æˆ‘ä»¬ç‚¹å‡»äº†ğŸ’¡åæ‰€çœ‹åˆ°çš„å†…å®¹ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">[</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Replace `is_some` with `if let Some`&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;kind&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;refactor.rewrite&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;codeActionParams&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;textDocument&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;uri&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;file:///home/flash/projects/ra/src/temp.rs&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;range&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;start&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;line&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;character&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10</span><br>          <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;end&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;line&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;character&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10</span><br>          <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        ...<br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;replace_is_some_with_if_let_some:RefactorRewrite:2&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Replace if with match&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;kind&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;refactor.rewrite&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;codeActionParams&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;textDocument&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;uri&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;file:///home/flash/projects/ra/src/temp.rs&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;range&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;start&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;line&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;character&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10</span><br>          <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;end&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;line&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;character&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10</span><br>          <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        ...<br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;replace_if_let_with_match:RefactorRewrite:4&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">]</span><br></code></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬å†³å®šåº”ç”¨å…¶ä¸­ä¸€é¡¹æ—¶ï¼ˆå‡è®¾æ˜¯ Replace <code>is_some</code> with <code>if let Some</code>ï¼‰ï¼Œç‚¹å‡»å¯¹åº”çš„æ–‡å­—ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯ä¼šå‘å‡ºä¸€ä¸ª <a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#codeAction_resolve">codeAction/resolve</a> è¯·æ±‚ï¼Œå‘æœåŠ¡ç«¯è¯·æ±‚åº”ç”¨è¿™ä¸ª CodeAction åæºä»£ç ä¼šå¦‚ä½•è¢«æ”¹å†™ï¼Œ</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Replace `is_some` with `if let Some`&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;kind&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;refactor.rewrite&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;codeActionParams&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;textDocument&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;uri&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;file:///home/flash/projects/ra/src/temp.rs&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;range&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;start&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;line&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;character&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;end&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;line&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;character&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10</span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;context&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;diagnostics&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;triggerKind&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;replace_is_some_with_if_let_some:RefactorRewrite:2&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>æœåŠ¡ç«¯æ ¹æ®è¯·æ±‚ä¸­çš„ä¿¡æ¯è¿›è¡Œè®¡ç®—åˆ†æåï¼Œè¿”å›ç»™å®¢æˆ·ç«¯å…·ä½“çš„å“åº”ï¼Œå…¶ä¸­çš„ <code>newText</code> å’Œ <code>range</code> å­—æ®µå‘Šè¯‰å®¢æˆ·ç«¯æŠŠ <code>range</code> èŒƒå›´ä¸­çš„æ—§ä»£ç æ›¿æ¢ä¸º <code>newText</code> è¡¨ç¤ºçš„å†…å®¹ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Replace `is_some` with `if let Some`&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;kind&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;refactor.rewrite&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;edit&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;documentChanges&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>      <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;textDocument&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;uri&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;file:///home/flash/projects/ra/src/temp.rs&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">63</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;edits&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>          <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;range&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>              <span class="hljs-attr">&quot;start&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;line&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;character&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">7</span><br>              <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>              <span class="hljs-attr">&quot;end&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;line&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;character&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">18</span><br>              <span class="hljs-punctuation">&#125;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;newText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;let Some($&#123;0:a&#125;) = a&quot;</span><br>          <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    ...<br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>ä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚å“åº”è¿‡ç¨‹è‡³æ­¤ç»“æŸï¼Œç±»ä¼¼çš„è¿‡ç¨‹åœ¨ç”¨æˆ·åœ¨ç¼–è¾‘å™¨ä¸­å†™ä»£ç ï¼Œç§»åŠ¨é¼ æ ‡æ‚¬æµ®ï¼Œå„ç§ç‚¹å‡»æŸ¥çœ‹ç­‰çš„è¿‡ç¨‹ä¸­æ—¶åˆ»å‘ç”Ÿç€ã€‚</p><h1 id="å‚è€ƒ"><a class="markdownIt-Anchor" href="#å‚è€ƒ"></a> å‚è€ƒ</h1><ul><li><a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/">Language Server Protocol Specification - 3.17</a></li><li><a href="https://liiked.github.io/VS-Code-Extension-Doc-ZH/#/language-extensions/programmatic-language-features">VSCode æ’ä»¶ä¸­æ–‡æ–‡æ¡£</a></li><li><a href="https://www.youtube.com/watch?v=I3RXottNwk0&amp;list=PLhb66M_x9UmrqXhQuIpWC5VgTdrGxMx3y&amp;ab_channel=AlekseyKladov">Explaining Rust Analyzer</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>å¼€æº</category>
      
      <category>Rust Analyzer</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>æ’æŸ¥ä¸€ä¸ª Rust Analyzer å‘ç‰ˆåå‡ºç°çš„ bug</title>
    <link href="/2023/11/27/%E6%8E%92%E6%9F%A5%E4%B8%80%E4%B8%AA%20Rust%20Analyzer%20%E5%8F%91%E7%89%88%E5%90%8E%E5%87%BA%E7%8E%B0%E7%9A%84%20bug/"/>
    <url>/2023/11/27/%E6%8E%92%E6%9F%A5%E4%B8%80%E4%B8%AA%20Rust%20Analyzer%20%E5%8F%91%E7%89%88%E5%90%8E%E5%87%BA%E7%8E%B0%E7%9A%84%20bug/</url>
    
    <content type="html"><![CDATA[<h2 id="å‘ç°é—®é¢˜"><a class="markdownIt-Anchor" href="#å‘ç°é—®é¢˜"></a> å‘ç°é—®é¢˜</h2><p>å‰äº›å¤©æœ‰ç”¨æˆ·åé¦ˆäº†ä¸€ä¸ª Rust Analyzer çš„ <a href="https://github.com/rust-lang/rust-analyzer/issues/15909">issue</a>ï¼Œè¯´çš„æ˜¯åœ¨å‡çº§åˆ°æœ€æ–°ç‰ˆçš„ RA åå‡ºç°äº†ä¹‹å‰æ²¡å‡ºç°çš„ bugï¼šå½“ä¸€ä¸ª trait çš„ associate item æä¾›äº†é»˜è®¤å®ç°æ—¶ï¼Œstruct impl è¿™ä¸ª trait æ—¶å¦‚æœä¸æä¾›å®ç°åˆ™ RA ä¼šæŠ¥é”™å¦‚ä¸‹ï¼Œè€Œå®é™…ä¸Šè¿™åœ¨ Rust ä¸­æ˜¯åˆæ³•çš„ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">trait</span> <span class="hljs-title class_">Marker</span> &#123;<br><span class="hljs-keyword">const</span> FLAG: <span class="hljs-type">bool</span> = <span class="hljs-literal">false</span>;<br>&#125;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Foo</span>;<br><span class="hljs-keyword">impl</span> <span class="hljs-title class_">Marker</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">Foo</span> &#123;&#125;  <span class="hljs-comment">// &lt;--- error: not all trait items implemented, missing: `const FLAG`</span><br></code></pre></td></tr></table></figure><h2 id="å®šä½é—®é¢˜"><a class="markdownIt-Anchor" href="#å®šä½é—®é¢˜"></a> å®šä½é—®é¢˜</h2><p>è¿™æ˜¯ä¸€ä¸ªåœ¨æœ€æ–°ç‰ˆä¸­æ‰å‡ºç°çš„é”™è¯¯ï¼Œè¯´æ˜æ˜¯åœ¨è¿™ä¸€ç‰ˆä¸­æ‰å¼•å…¥çš„è€Œä¸æ˜¯é™ˆå¹´è€ bugã€‚äºæ˜¯æˆ‘åœ¨ GitHub ä¸Š compare è¿™ä¸€ç‰ˆçš„ commit å’Œä¸Šä¸€ç‰ˆæœ¬çš„ commitï¼Œè¿™ä¸­é—´æœ‰ <a href="https://github.com/rust-lang/rust-analyzer/compare/416e9c856a792ce2214c449677ca0a1f38965248...58de0b130a763f3a2d373f508ac0c18a8e7d0acd?diff=unified">84 ä¸ª Files changed</a>, ä¸ç®—å¤šã€‚<br /><img src="/img/blog_pic/2023/diff.png" alt="" /><br />ä¸€ç•ªæµè§ˆä¸‹æ¥ï¼Œå‘ç°äº†è¿™ä¸ªæ–°å¢çš„ crates/ide-diagnostics/src/handlers/trait_impl_missing_assoc_item.rsï¼Œä»åå­—ä¸Šçœ‹å°±å¾ˆå¯ç–‘ï¼Œç„¶åä»”ç»†æµè§ˆè¿™ä¸ªæ–‡ä»¶ï¼Œå‘ç°æ­£æ˜¯ä»–çš„é—®é¢˜ã€‚è¿™ä¸ªæ–‡ä»¶æ‰€åœ¨çš„ <a href="https://github.com/rust-lang/rust-analyzer/pull/15895">PR</a> å¢åŠ äº†ä¸€ä¸ªæ–°çš„ diagnosticï¼Œä½¿å¾— RA å¯ä»¥æ£€æµ‹å‡ºç”¨æˆ·åœ¨ä¸º struct impl trait çš„æ—¶å€™å“ªäº› associate item æ²¡æœ‰å®ç°ã€‚<br /><img src="/img/blog_pic/2023/missing_assoc_item.png" alt="" /></p><h2 id="è§£å†³é—®é¢˜"><a class="markdownIt-Anchor" href="#è§£å†³é—®é¢˜"></a> è§£å†³é—®é¢˜</h2><p>è¿™ä¸ª PR æ˜¯è¿™æ ·<a href="https://github.com/rust-lang/rust-analyzer/pull/15895/files#diff-9ded74602cbdce03cc0b20f094e733658a7b43d14ffe0f9167bc79a0851e7e53R665-R704">æ£€æµ‹æœªåœ¨ impl ä½“ä¸­å®ç°çš„ associate item çš„</a>ï¼Œå¯¹äº <code>AssocItemId::ConstId(_) =&gt; true,</code> çš„å¤„ç†æ˜¯ç›´æ¥è¿”å› trueï¼Œä¹Ÿå°±æ˜¯é»˜è®¤ä¸ºå¿…é¡»åœ¨ impl ä½“ä¸­å®ç°è€Œæ¼æ‰äº†åœ¨ trait çš„å®šä¹‰ä¸­å¯èƒ½æœ‰ä¸ºè¿™ä¸ª const item è®¾ç½®é»˜è®¤å€¼çš„æƒ…å†µã€‚çŸ¥é“äº†é—®é¢˜æ‰€åœ¨ï¼Œå‰©ä¸‹çš„å°±æ¯”è¾ƒå¥½è§£å†³äº†ï¼Œå°†é’ˆå¯¹ const item çš„å¤„ç†ä¿®æ”¹ä¸º <code>Const::from(id).value(db).is_none()</code>ï¼Œä¹Ÿå°±æ˜¯åˆ¤æ–­è¿™ä¸€é¡¹æœ‰æ²¡æœ‰è®¾ç½®äº†é»˜è®¤å€¼ï¼Œå¦‚æœæœ‰çš„è¯å°±ä¸å¿…ä½œä¸º required_items ä»è€Œå¼•å‘é”™è¯¯çš„ diagnostic</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">let</span> <span class="hljs-variable">required_items</span> = items.<span class="hljs-title function_ invoke__">iter</span>().<span class="hljs-title function_ invoke__">filter</span>(|&amp;(_, assoc)| <span class="hljs-keyword">match</span> *assoc &#123;<br>    AssocItemId::<span class="hljs-title function_ invoke__">FunctionId</span>(it) =&gt; !db.<span class="hljs-title function_ invoke__">function_data</span>(it).<span class="hljs-title function_ invoke__">has_body</span>(),<br>    AssocItemId::<span class="hljs-title function_ invoke__">ConstId</span>(_) =&gt; <span class="hljs-literal">true</span>,<br>    AssocItemId::<span class="hljs-title function_ invoke__">TypeAliasId</span>(it) =&gt; db.<span class="hljs-title function_ invoke__">type_alias_data</span>(it).type_ref.<span class="hljs-title function_ invoke__">is_none</span>(),<br>&#125;);<br></code></pre></td></tr></table></figure><p>æ¥ç€å†ä¸ºè¿™ä¸ªå° fix å¢åŠ ä¸€ä¸ªéªŒè¯çš„ testï¼Œè·‘ä¸€é cargo test ç¡®ä¿æ‰€æœ‰æµ‹è¯•éƒ½æ²¡é—®é¢˜ä¹‹åå°±å¯ä»¥æ <a href="https://github.com/rust-lang/rust-analyzer/pull/15911">PR</a> ä¿®å¤äº†</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs rust">    <span class="hljs-meta">#[test]</span><br><span class="hljs-keyword">fn</span> <span class="hljs-title function_">trait_with_default_value</span>() &#123;<br>    <span class="hljs-title function_ invoke__">check_diagnostics</span>(<br>        <span class="hljs-string">r#&quot;</span><br><span class="hljs-string">trait Marker &#123;</span><br><span class="hljs-string">    const FLAG: bool = false;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">struct Foo;</span><br><span class="hljs-string">impl Marker for Foo &#123;&#125;</span><br><span class="hljs-string">        &quot;#</span>,<br>    )<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æœ€å"><a class="markdownIt-Anchor" href="#æœ€å"></a> æœ€å</h2><p>Rust Analyzer ä¼šè‡ªåŠ¨å‘ nightly releasesï¼Œè¿™æ ·çœ‹æ¥é¢‘ç¹å‘ç‰ˆè¿˜æ˜¯æœ‰å¥½å¤„çš„ï¼Œç›¸é‚»ç‰ˆæœ¬ä¹‹é—´çš„ diff ä¸ä¼šå¤ªå¤§ï¼Œå‘ç‰ˆåå¼•å‘çš„ bug æ‰æ¯”è¾ƒå¥½å®šä½ï¼Œè¦æ˜¯ç‰ˆæœ¬ä¹‹é—´çš„ diff ä¸Šåƒä¸ªæ–‡ä»¶æˆ‘å¯èƒ½å°±ä¸ä¼šä¸€ä¸ªä¸ªå»çœ‹äº†å“ˆå“ˆå“ˆ</p><h2 id="å‚è€ƒ"><a class="markdownIt-Anchor" href="#å‚è€ƒ"></a> å‚è€ƒ</h2><ul><li>åŸ issue <a href="https://github.com/rust-lang/rust-analyzer/issues/15909">RA reports missing trait item implementation for associated constant with default value: possibly a regression</a></li><li>å¼•å…¥ bug çš„ PR <a href="(https://github.com/rust-lang/rust-analyzer/pull/15895)">feat: Diagnose missing assoc items in trait impls</a></li><li>ä¿®å¤ PR <a href="https://github.com/rust-lang/rust-analyzer/pull/15911">fix: handle default constant values in trait_impl_missing_assoc_item diagnostic</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>å¼€æº</category>
      
      <category>Rust Analyzer</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>OSPP 2023 ç»“é¡¹</title>
    <link href="/2023/11/20/OSPP%202023%20%E7%BB%93%E9%A1%B9/"/>
    <url>/2023/11/20/OSPP%202023%20%E7%BB%93%E9%A1%B9/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æ„Ÿè§‰è‡ªå·±å˜å¾—è€æ²¹æ¡äº†ï¼ŒOSPP 2023 çš„ç”³è¯·æŠ¥å‘Šå’Œç»“é¡¹æŠ¥å‘Šéƒ½å†™å¾—å¾ˆç®€çŸ­ hhh</p></blockquote><h2 id="ç›¸å…³ä¿¡æ¯"><a class="markdownIt-Anchor" href="#ç›¸å…³ä¿¡æ¯"></a> ç›¸å…³ä¿¡æ¯</h2><ul><li>é¡¹ç›®åç§°ï¼šImplementing a Webdav Compatibility Layer for Oay</li><li>é¡¹ç›®ç¼–å·ï¼š231110459</li><li>é¡¹ç›®å¯¼å¸ˆï¼šPsiACE</li></ul><h2 id="å¼€å‘è§„åˆ’"><a class="markdownIt-Anchor" href="#å¼€å‘è§„åˆ’"></a> å¼€å‘è§„åˆ’</h2><ul><li>ç¬¬ä¸€é˜¶æ®µï¼šç†Ÿæ‚‰é¡¹ç›®ï¼Œç†è§£é¡¹ç›®ç›®æ ‡ï¼Œä¸ç¤¾åŒºå’Œå¯¼å¸ˆæ²Ÿé€šï¼Œç¡®å®šæŠ€æœ¯/å¼€å‘è·¯çº¿ï¼Œåšå¥½å®é™…å¼€å‘ä¹‹å‰çš„è®¾è®¡å·¥ä½œ</li><li>ç¬¬äºŒé˜¶æ®µï¼šå®é™…å¼€å‘ç¼–ç </li><li>ç¬¬ä¸‰é˜¶æ®µï¼šç¼–å†™æµ‹è¯•ã€é¡¹ç›®æ–‡æ¡£ã€å‡†å¤‡é¡¹ç›®éªŒæ”¶ææ–™</li></ul><h2 id="é¡¹ç›®äº¤æµ"><a class="markdownIt-Anchor" href="#é¡¹ç›®äº¤æµ"></a> é¡¹ç›®äº¤æµ</h2><ul><li><a href="https://discord.com/channels/1081052318650339399/1109814626046197770">Discordï¼šå¥—ç£äº¤æµ</a></li><li><a href="https://discord.com/channels/1081052318650339399/1122784753393881179">Discordï¼šå¼€å‘äº¤æµ</a></li><li><a href="https://github.com/apache/incubator-opendal/issues/2586">GitHub Issueï¼šå¼€å‘è¿‡ç¨‹è¿½è¸ª</a></li></ul><h2 id="å®Œæˆæƒ…å†µ"><a class="markdownIt-Anchor" href="#å®Œæˆæƒ…å†µ"></a> å®Œæˆæƒ…å†µ</h2><ul><li><p>åœ¨ Oay <code>frontends-webdav</code> feature ä¸‹å¢åŠ ä¸€ä¸ªç»“æ„ä½“ <code>WebDAVFs</code>ï¼Œå®ç° dav-server-rs ä¸­çš„ <code>fs::DavDirEntry</code>ã€<code>fs::DavFile</code>ã€<code>fs::DavFileSystem</code>ã€<code>fs::DavMetaData</code> ç­‰ traitï¼›åˆ©ç”¨ OpenDAL operator ä¸­çš„å„ç§æ•°æ®æ“ä½œç®—å­ï¼ˆ<code>read</code>ã€<code>write</code>ã€<code>create_dir</code>ã€<code>stat</code> ç­‰ï¼‰å®ç°è¿™äº› trait ä¸­çš„å„ä¸ªæ¥å£</p></li><li><p>OpenDAL Oay WebDAV æœåŠ¡é€šè¿‡ <a href="http://www.webdav.org/neon/litmus/">litmus</a>ï¼ˆWebDAV æœåŠ¡å™¨åè®®éµä»æ€§æµ‹è¯•å¥—ä»¶ï¼‰è¡Œä¸ºæµ‹è¯•</p>  <figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs txt">-&gt; running `http&#x27;:<br>0. init.................. pass<br>1. begin................. pass<br>2. expect100............. pass<br>3. finish................ pass<br>&lt;- summary for `http&#x27;: of 4 tests run: 4 passed, 0 failed. 100.0%<br>-&gt; running `basic&#x27;:<br>0. init.................. pass<br>1. begin................. pass<br>2. options............... pass<br>3. put_get............... pass<br>4. put_get_utf8_segment.. pass<br>5. put_no_parent......... pass<br>6. mkcol_over_plain...... pass<br>7. delete................ pass<br>8. delete_null........... pass<br>9. delete_fragment....... WARNING: DELETE removed collection resource with Request-URI including fragment; unsafe<br>    ...................... pass (with 1 warning)<br>10. mkcol................. pass<br>11. mkcol_again........... pass<br>12. delete_coll........... pass<br>13. mkcol_no_parent....... pass<br>14. mkcol_with_body....... pass<br>15. finish................ pass<br>&lt;- summary for `basic&#x27;: of 16 tests run: 16 passed, 0 failed. 100.0%<br>-&gt; running `copymove&#x27;:<br>0. init.................. pass<br>1. begin................. pass<br>2. copy_init............. pass<br>3. copy_simple........... pass<br>4. copy_overwrite........ pass<br>5. copy_nodestcoll....... pass<br>6. copy_cleanup.......... pass<br>7. copy_coll............. pass<br>8. copy_shallow.......... pass<br>9. move.................. pass<br>10. move_coll............. pass<br>11. move_cleanup.......... pass<br>12. finish................ pass<br>&lt;- summary for `copymove&#x27;: of 13 tests run: 13 passed, 0 failed. 100.0%<br></code></pre></td></tr></table></figure></li><li><p>PR åˆ—è¡¨</p><ul><li><a href="https://github.com/apache/incubator-opendal/pull/2658">#2658 feat(oay): Add webdav basic read impl</a></li><li><a href="https://github.com/apache/incubator-opendal/pull/2736">#2736 feat(oay): Add read_dir</a></li><li><a href="https://github.com/apache/incubator-opendal/pull/2769">#2769 feat(oay): add write for oay webdav</a></li><li><a href="https://github.com/apache/incubator-opendal/pull/2832">#2832 feat: Add create_dir, remove, copy and rename API for oay-webdav</a></li><li><a href="https://github.com/apache/incubator-opendal/pull/2857">#2857 feat(oay): impl some method for WebdavMetaData</a></li><li><a href="https://github.com/apache/incubator-opendal/pull/2879">#2879 fix(oay): add some error handle</a></li><li><a href="https://github.com/apache/incubator-opendal/pull/2944">#2944 fix(oay): pass litmus copymove test</a></li><li><a href="https://github.com/apache/incubator-opendal/pull/2957">#2957 CI(oay): add CI for oay-webdav</a></li><li><a href="https://github.com/apache/incubator-opendal/pull/2971">#2971 CI(oay): Polish oay webdav test</a></li></ul></li></ul><h2 id="è‡´è°¢"><a class="markdownIt-Anchor" href="#è‡´è°¢"></a> è‡´è°¢</h2><p>ç¬¬äºŒæ¬¡å‚åŠ  OSPPï¼Œæ—¢å¶ç„¶ï¼Œä¹Ÿå¹¸è¿ã€‚æ„Ÿè°¢ OSPP ä¸»åŠæ–¹æä¾›çš„æ´»åŠ¨å¹³å°ï¼Œä»¥åŠæ„Ÿè°¢ OpenDAL ç¤¾åŒºåœ¨æ­¤æœŸé—´çš„å¸®åŠ©ï¼Œæœ€åè¿˜è¦æ„Ÿè°¢æˆ‘çš„å¯¼å¸ˆ @PsiACE ä»¥åŠ @xuanwo äºˆä»¥æˆ‘çš„æŒ‡å¯¼ä»¥åŠå¿«é€Ÿä¸”è€å¿ƒçš„ code reviewï¼Œè°¢è°¢ä½ ä»¬ ğŸ’–</p>]]></content>
    
    
    <categories>
      
      <category>å¼€æº</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>åˆæ¬¡å‘ Rust Analyzer è´¡çŒ®</title>
    <link href="/2023/10/21/My%20first%20contribution%20to%20Rust%20Analyzer/"/>
    <url>/2023/10/21/My%20first%20contribution%20to%20Rust%20Analyzer/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h2><p>æˆ‘å†™ Rust ç”¨çš„ IDE æ˜¯ VSCode æ­é… Rust Analyzer æ’ä»¶ï¼ŒäºŒè€…æ­é…èµ·æ¥ä½¿ç”¨ä½“éªŒè¿˜æ˜¯ç›¸å½“ä¸é”™çš„ã€‚Rust Analyzer è™½ç„¶åªæ˜¯ VSCode ç”Ÿæ€ä¸‹çš„ä¸€ä¸ªæ’ä»¶ï¼Œä½†å®é™…ä¸Šå¯ä»¥çœ‹æˆ Rust è¯­è¨€çš„ä¸€ä¸ª LSP(Language Server Protocol) å®Œæ•´å®ç°ï¼Œæä¾›äº†è¯¸å¦‚è¡¥å…¨æç¤ºã€ä»£ç è¯Šæ–­ã€å¼•ç”¨æŸ¥æ‰¾ã€è·³è½¬åˆ°å®šä¹‰ç­‰ IDE å¸¸ç”¨åŠŸèƒ½ã€‚Rust Analyzer æ’ä»¶å¯ä»¥åˆ†ä¸ºå‰ç«¯å’Œåç«¯ï¼Œå‰ç«¯æ˜¯<a href="https://github.com/rust-lang/rust-analyzer">ä»£ç ä»“åº“</a>ä¸­ editors/code è·¯å¾„ä¸‹çš„ TypeScript é¡¹ç›®ï¼Œå…¶ä½™éƒ¨åˆ†å±äºåç«¯æœåŠ¡å®ç°ä»£ç ï¼Œæˆ‘åœ¨è¿™æ¬¡è´¡çŒ®ä¸­æ¶‰åŠçš„æ˜¯åç«¯æœåŠ¡éƒ¨åˆ†ï¼Œä¸‹æ–‡ä¸­å¦‚æ— è¯´æ˜é»˜è®¤è®¨è®ºçš„æ˜¯ Rust Analyzer åç«¯æœåŠ¡ã€‚</p><p>LSP åªæ˜¯ä¸€ä¸ªåè®®ï¼Œå¹¶æ²¡æœ‰è§„å®šå®ç°çš„å½¢å¼ã€‚Rust Analyzer ç”± Rust è¯­è¨€å¼€å‘ï¼Œå¼€å‘å›¢é˜Ÿä¸ºæ­¤åšäº†è®¸å¤šå·¥ä½œï¼Œæ¯”å¦‚ç”¨ Rust å®ç°äº† Parserã€<a href="https://docs.rs/lsp-server/0.7.4/lsp_server/">lsp_server</a> ç­‰å·¥å…·ã€‚æ­¤å¤–ï¼ŒRust Analyzer è¿˜æœ‰è¯¦ç»†çš„<a href="https://github.com/rust-lang/rust-analyzer/tree/master/docs/dev">å¼€å‘æ–‡æ¡£</a>ï¼Œä¸º new contributor æä¾›äº†è®¸å¤šæŒ‡å¼•è¯´æ˜ï¼Œï¼Œæ˜¯æˆ‘è§è¿‡çš„å¼€æºé¡¹ç›®ä¸­å¼€å‘æ–‡æ¡£æœ€è¯¦ç»†çš„é¡¹ç›®ä¹‹ä¸€ï¼Œç”šè‡³è¿˜æœ‰ä¸€ä¸ª Rust Analyzer æ ¸å¿ƒå¼€å‘è€…ä¸»è®²çš„<a href="https://www.youtube.com/playlist?list=PLhb66M_x9UmrqXhQuIpWC5VgTdrGxMx3y">ç³»åˆ—è§†é¢‘</a>ï¼ˆè™½ç„¶æˆ‘çœ‹ä¸å¤ªæ‡‚å¬ä¸å¤ªæ‡‚ ğŸ™ƒï¼‰ä»‹ç» Rust Analyzer çš„å·¥ä½œæµç¨‹ã€‚å¦‚æœæ²¡æœ‰è¿™äº›èµ„æ–™ï¼Œä»ä¸Šæ‰‹ç†è§£è¿™ä¹ˆä¸€ä¸ªåºå¤§çš„é¡¹ç›®åˆ°èƒ½æ PR è§£å†³æŸä¸ªå°é—®é¢˜å¯¹æˆ‘æ¥è¯´åº”è¯¥è¦èŠ±è´¹æ›´å¤šçš„æ—¶é—´ç²¾åŠ›ï¼Œå†æ¬¡æ„Ÿæ…¨è¯¦ç»†çš„å¼€å‘æ–‡æ¡£å¯¹äº new contributor åŠ å…¥ç¤¾åŒºçš„é‡è¦æ€§ã€‚</p><h2 id="å…¥å‘"><a class="markdownIt-Anchor" href="#å…¥å‘"></a> å…¥å‘</h2><p>æ¯å¤©éƒ½åœ¨ä½¿ç”¨ IDEï¼Œæˆ‘å¯¹äº IDE æ˜¯å¦‚ä½•å®ç°è¿™äº›åŠŸèƒ½æ˜¯æ¯”è¾ƒå¥½å¥‡çš„ï¼ŒæŸå¤©å¿ƒè¡€æ¥æ½®å» Rust Analyzer çš„é¡¹ç›®ä»“åº“é€›é€›ï¼Œæµè§ˆäº†ä¸€é issueï¼Œå‘ç° <a href="https://github.com/rust-lang/rust-analyzer/issues/12977">Feature request: if x.is_some() -&gt; if let Some(_tmp) = x</a> è¿™ä¸ªæˆ‘èƒ½çœ‹æ‡‚çš„ issueï¼Œäºæ˜¯æ‰“ç®—ä»è¿™ä¸ª issue å…¥æ‰‹ï¼Œé€šè¿‡ learning by doing çš„æ–¹å¼å»å­¦ä¹ ä¸€ä¸‹å¦‚ä½•å¼€å‘ Rust Analyzerã€‚è¿™ä¸ª issue æè¿°çš„æ˜¯å¸Œæœ›åœ¨ Rust Analyzer ä¸­å¢åŠ ä¸€ä¸ª featureï¼Œä½¿å¾— IDE èƒ½å¤Ÿæ™ºèƒ½æ„ŸçŸ¥å¹¶ä¸º <code>Option</code> ä»¥åŠ <code>Result</code> ç±»å‹çš„æŸäº›æ–¹æ³•æä¾›è‡ªåŠ¨æ”¹å†™åŠŸèƒ½ï¼Œå¦‚ä»¥ä¸‹ä»£ç æ‰€ç¤ºã€‚å…¶ä¸­ â”ƒ è¡¨ç¤ºå…‰æ ‡çš„ä½ç½®ï¼Œæ„æ€æ˜¯å½“å…‰æ ‡åœç•™åœ¨æŸä¸ªç‰¹å®šçš„ context ä½ç½®çš„æ—¶å€™ IDE èƒ½æä¾›ä¸€ä¸ªè‡ªåŠ¨æ”¹å†™åŠŸèƒ½ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-comment">// before</span><br><span class="hljs-keyword">if</span> x.is_â”ƒ<span class="hljs-title function_ invoke__">some</span>() &#123;<br>    ...<br>&#125;<br><br><span class="hljs-comment">// after</span><br><span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-variable">Some</span>(â”ƒ_tmp) = x &#123;<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹"></a> è¿‡ç¨‹</h2><p>æˆ‘ç¬¬ä¸€ç‰ˆå®ç°çš„æ•ˆæœæ˜¯ä¸‹é¢è¿™æ ·ï¼Œå½“å…‰æ ‡åœç•™åœ¨ <code>Option</code> æˆ–è€… <code>Result</code> å¯¹è±¡çš„ is_some æˆ–è€… is_ok æ–¹æ³•çš„æ—¶å€™ï¼Œé€šè¿‡ç‚¹å‡»å°ç¯æ³¡ğŸ’¡å±•ç¤ºå½“ä¸‹å¯é€‰çš„åŠŸèƒ½ï¼Œç”¨æˆ·å•å‡»é€‰æ‹©æŸä¸ªé€‰é¡¹å³å¯åº”ç”¨æŸé¡¹åŠŸèƒ½ï¼ˆåœ¨ Rust Analyzer ä¸­è¿™äº›ç‚¹å‡»ğŸ’¡åå±•ç¤ºçš„åŠŸèƒ½ç§°ä¸º <code>assist</code>ï¼‰ã€‚<br /><img src="/img/blog_pic/2023/if_is_some_assist.gif" alt="" /></p><p><img src="/img/blog_pic/2023/if_is_ok_assist.gif" alt="" /></p><p>ä¸€å¼€å§‹æˆ‘å®Œå…¨ä¸çŸ¥é“ä»å“ªé‡Œå…¥æ‰‹ï¼Œç²—ç•¥è¿‡äº†ä¸€éæ–‡æ¡£ä¹‹åä¹Ÿæ²¡æœ‰ä»€ä¹ˆå¤´ç»ªã€‚<strong>äºæ˜¯æˆ‘è½¬å˜äº†æ€è·¯ï¼Œåœ¨å·²ç»åˆå¹¶çš„ PR é‡Œé¢æ‰¾æ˜¯å¦æœ‰å®Œæˆäº†ç±»ä¼¼çš„äº‹æƒ…çš„ PR</strong>ï¼Œç»ˆäºæ‰¾åˆ°äº† <a href="https://github.com/rust-lang/rust-analyzer/pull/13825">feat: Add unqualify_method_call assist</a> è¿™ä¸ª PRï¼Œå®ƒåŒæ ·æ˜¯æä¾›äº†å½“å…‰æ ‡åœ¨ç‰¹å®š context ä½ç½®æ—¶çš„ä¸€é¡¹å¯é€‰çš„ <code>assist</code>ã€‚<code>assist</code> æ˜¯ Rust Analyzer çš„åç«¯æœåŠ¡é€šè¿‡åˆ†æå½“å‰å…‰æ ‡æ‰€å¤„çš„ context ä½ç½®æ‰€æä¾›çš„ä¸€äº›â€œæ™ºèƒ½â€åŠŸèƒ½ï¼Œå…³äºå°ç¯æ³¡ğŸ’¡<code>assist</code> Rust Analyzer çš„å®˜æ–¹åšå®¢ä¸­æœ‰<a href="https://rust-analyzer.github.io/blog/2020/09/28/how-to-make-a-light-bulb.html">ä¸€ç¯‡æ–‡ç« </a>åšäº†ä»‹ç»ï¼Œæˆ‘ä¹Ÿæ˜¯åœ¨çœ‹äº†è¿™ç¯‡åšå®¢ä¹‹åæ‰æ‚Ÿåˆ°åŸæ¥è¿™äº› <code>assist</code> æ˜¯ç”±æœåŠ¡ç«¯æä¾›çš„è€Œä¸æ˜¯é¢„å…ˆå®šä¹‰åœ¨å®¢æˆ·ç«¯ä¸­çš„ã€‚</p><p>ä»è¿™ä¸ªå‚è€ƒ PR ä¸­çš„ Files changed ä¸­æˆ‘çŸ¥é“äº†è¦å¢åŠ ä¸€é¡¹ <code>assist</code> éœ€è¦åœ¨ <code>crates/ide-assists/src/handlers</code> ä¸‹å¢åŠ ä¸€ä¸ªå¯¹åº”çš„å¤„ç†æ–¹æ³•ï¼Œç„¶åæ³¨å†Œåˆ° <code>/crates/ide-assists/src/lib.rs</code> ä¸­çš„ <code>pub(crate) fn all() -&gt; &amp;'static [Handler]</code> æ–¹æ³•ï¼Œè°ƒç”¨é“¾å¦‚ä¸‹ã€‚å½“å…‰æ ‡åœç•™çš„æ—¶å€™ï¼ŒRust Analyzer ä¼šæ£€æŸ¥æ‰€æœ‰åœ¨ <code>all()</code> ä¸­æ³¨å†Œçš„ <code>assist</code> æ˜¯å¦å¯ç”¨äºå½“å‰çš„ contextï¼Œå¦‚æœå¯ä»¥åˆ™ä¼šå°†è¿™é¡¹ <code>assist</code> è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå¯¹åº”çš„å°±æ˜¯æˆ‘ä»¬ç‚¹å‡»ğŸ’¡æ—¶çœ‹åˆ°çš„é‚£äº›é€‰é¡¹ã€‚<br /><img src="/img/blog_pic/2023/call_stack.png" alt="" /></p><h2 id="å®ç°"><a class="markdownIt-Anchor" href="#å®ç°"></a> å®ç°</h2><p>Rust Analyzer å®ç°äº†ä¸€ç³»åˆ—æ•°æ®ç»“æ„ç”¨äºæ˜ å°„ç”¨æˆ·åœ¨ VSCode ä¸­å†™çš„ä»£ç ï¼Œå‚è€ƒå…¶ä»–çš„ä¸€äº› <code>assist</code>ï¼Œæˆ‘åœ¨å®ç° <code>replace_is_method_with_if_let_method</code> è¿™ä¸ª <code>assist</code> çš„æ€è·¯å¦‚ä¸‹ï¼š</p><ol><li>é¦–å…ˆæ£€æŸ¥å…‰æ ‡å½“å‰æ‰€å¤„çš„ context ä½ç½®æ˜¯å¦æ˜¯ä¸€ä¸ª if è¡¨è¾¾å¼ï¼Œå› ä¸ºæˆ‘è¦å®ç°çš„ <code>assist</code> æ˜¯æ”¹å†™ <code>if x.is_some() &#123;&#125;</code>ï¼Œæ‰€ä»¥è¦ç¡®ä¿å…‰æ ‡æ‰€å¤„çš„ä½ç½®æ˜¯ä¸€ä¸ª if è¡¨è¾¾å¼ï¼Œè¿™æ ·æ‰æœ‰å¿…è¦è¿›è¡Œåç»­çš„æ“ä½œï¼›</li><li>è¯»å– if è¡¨è¾¾å¼ä¸­çš„ condition éƒ¨åˆ†ï¼Œæ£€æŸ¥è¯¥ condition æ˜¯å¦æ˜¯ä¸€ä¸ªæ–¹æ³•è°ƒç”¨ï¼ˆ<code>x.is_some()</code>ï¼‰ï¼Œå¦‚æœä¸æ˜¯é‚£è¿™å°±ä¸æ˜¯æˆ‘è¦çš„æ“ä½œç›®æ ‡ï¼Œç›´æ¥ return å³å¯ï¼›</li><li>å¦‚æœæ˜¯ä¸€ä¸ªæ–¹æ³•è°ƒç”¨çš„è¯ï¼Œè¿™ä¸ªæ–¹æ³•è°ƒç”¨çš„åå­—æ˜¯å¦æ˜¯ <code>is_some</code> æˆ–è€… <code>is_ok</code>ï¼Œè‹¥ä¸æ˜¯åˆ™ç›´æ¥ returnï¼›</li><li>ç¡®ä¿å…‰æ ‡ä½ç½®çš„ context æ˜¯æˆ‘è¦æ“ä½œçš„ç›®æ ‡ä»£ç åï¼Œæ„é€ å‡ºæ›¿ä»£åçš„ä»£ç è¯­å¥å®ç°ä»£ç æ›¿æ¢ã€‚</li></ol><p>å¾—ç›Šäº Rust Analyzer æ‰€åšçš„ä¸€äº›æŠ½è±¡ï¼Œåªç”¨ 30 å¤šè¡Œä»£ç æˆ‘å°±å®Œæˆäº† replace_is_method_with_if_let_method è¿™é¡¹ <code>assist</code>ã€‚æ€è·¯å…¶å®å¾ˆç®€å•ï¼Œè€Œä¸” Rust Analyzer ä¹Ÿæœ‰è®¸å¤š api ç”¨äºä»£ç  context æ£€æŸ¥ä»¥åŠä¿¡æ¯æå–ï¼ˆæ¯”å¦‚è¯»å–æŸä¸ªæ–¹æ³•è°ƒç”¨çš„å‘èµ·å¯¹è±¡åä»¥åŠæ–¹æ³•åç­‰ï¼‰ï¼Œå®Œæˆçš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-title function_ invoke__">pub</span>(<span class="hljs-keyword">crate</span>) <span class="hljs-keyword">fn</span> <span class="hljs-title function_">replace_is_method_with_if_let_method</span>(<br>    acc: &amp;<span class="hljs-keyword">mut</span> Assists,<br>    ctx: &amp;AssistContext&lt;<span class="hljs-symbol">&#x27;_</span>&gt;,<br>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Option</span>&lt;()&gt; &#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">if_expr</span> = ctx.find_node_at_offset::&lt;ast::IfExpr&gt;()?;<br><br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">cond</span> = if_expr.<span class="hljs-title function_ invoke__">condition</span>()?;<br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">call_expr</span> = <span class="hljs-keyword">match</span> cond &#123;<br>        ast::Expr::<span class="hljs-title function_ invoke__">MethodCallExpr</span>(call) =&gt; call,<br>        _ =&gt; <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>,<br>    &#125;;<br><br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">name_ref</span> = call_expr.<span class="hljs-title function_ invoke__">name_ref</span>()?;<br>    <span class="hljs-keyword">match</span> name_ref.<span class="hljs-title function_ invoke__">text</span>().<span class="hljs-title function_ invoke__">as_str</span>() &#123;<br>        <span class="hljs-string">&quot;is_some&quot;</span> | <span class="hljs-string">&quot;is_ok&quot;</span> =&gt; &#123;<br>            <span class="hljs-keyword">let</span> <span class="hljs-variable">receiver</span> = call_expr.<span class="hljs-title function_ invoke__">receiver</span>()?;<br>            <span class="hljs-keyword">let</span> <span class="hljs-variable">target</span> = call_expr.<span class="hljs-title function_ invoke__">syntax</span>().<span class="hljs-title function_ invoke__">text_range</span>();<br><br>            <span class="hljs-keyword">let</span> (assist_id, message, text) = <span class="hljs-keyword">if</span> name_ref.<span class="hljs-title function_ invoke__">text</span>() == <span class="hljs-string">&quot;is_some&quot;</span> &#123;<br>                (<span class="hljs-string">&quot;replace_is_some_with_if_let_some&quot;</span>, <span class="hljs-string">&quot;Replace `is_some` with `if let Some`&quot;</span>, <span class="hljs-string">&quot;Some&quot;</span>)<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                (<span class="hljs-string">&quot;replace_is_ok_with_if_let_ok&quot;</span>, <span class="hljs-string">&quot;Replace `is_ok` with `if let Ok`&quot;</span>, <span class="hljs-string">&quot;Ok&quot;</span>)<br>            &#125;;<br><br>            acc.<span class="hljs-title function_ invoke__">add</span>(<span class="hljs-title function_ invoke__">AssistId</span>(assist_id, AssistKind::RefactorRewrite), message, target, |edit| &#123;<br>                <span class="hljs-keyword">let</span> <span class="hljs-variable">replacement</span> = <span class="hljs-built_in">format!</span>(<span class="hljs-string">&quot;let &#123;&#125;(&#123;&#125;) = &#123;&#125;&quot;</span>, text, <span class="hljs-string">&quot;$&#123;0:_tmp&#125;&quot;</span>, receiver);<br>                edit.<span class="hljs-title function_ invoke__">replace</span>(target, replacement);<br>            &#125;)<br>        &#125;<br>        _ =&gt; <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>,<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘è®¤ä¸ºè¿™æ¬¡çš„éš¾ç‚¹ä¸åœ¨äºå®ç°æ€è·¯ï¼Œè€Œæ˜¯åœ¨äºç†è§£é¡¹ç›®ï¼ŒçŸ¥é“è¦åœ¨å“ªé‡Œåšå‡ºä»€ä¹ˆæ ·çš„ä¿®æ”¹ï¼Œç†è§£ Rust Analyzer çš„å“ªäº›æ•°æ®ç»“æ„å¯¹åº”äº†ç”¨æˆ·ä¾§å†™çš„ä»£ç ã€‚å…³äºè¿™ä¸€ç‚¹å¯ä»¥å‚è€ƒ Rust Analyzer çš„ Syntax tree ç»“æ„ï¼Œåœ¨ VSCode ä¸­å†™ä¸‹ rust ä»£ç ï¼ŒæŒ‰ä¸‹ ctrl + shift + p ä¹‹ååœ¨æœç´¢æ ä¸­è¾“å…¥ Syntax treeï¼ŒæŒ‰ä¸‹å›è½¦ä¹‹åå°±èƒ½åœ¨ç¼–è¾‘å™¨å³ä¾§å¾—åˆ°ä»£ç çš„è¯­æ³•æ ‘ç»“æ„ã€‚æ¯”å¦‚ <code>let x: i32 = 1;</code> è¿™è¡Œä»£ç å¯¹åº”çš„è¯­æ³•æ ‘ç»“æœæ˜¯ä¸‹é¢è¿™æ ·çš„ã€‚å…¶ä¸­ <code>PATH_TYPE</code>ã€<code>PATH_SEGMENT</code>ã€<code>NAME_REF</code> è¿™äº›å…³é”®å­—å¯¹åº”äº† <code>crates/syntax/src/ast/generated/nodes.rs</code> ä¸­å¯¹åº”çš„ <code>struct</code>ã€‚</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs text">LET_STMT@621..636<br>  LET_KW@621..624 &quot;let&quot;<br>  WHITESPACE@624..625 &quot; &quot;<br>  IDENT_PAT@625..626<br>    NAME@625..626<br>      IDENT@625..626 &quot;x&quot;<br>  COLON@626..627 &quot;:&quot;<br>  WHITESPACE@627..628 &quot; &quot;<br>  PATH_TYPE@628..631<br>    PATH@628..631<br>      PATH_SEGMENT@628..631<br>        NAME_REF@628..631<br>          IDENT@628..631 &quot;i32&quot;<br>  WHITESPACE@631..632 &quot; &quot;<br>  EQ@632..633 &quot;=&quot;<br>  WHITESPACE@633..634 &quot; &quot;<br>  LITERAL@634..635<br>    INT_NUMBER@634..635 &quot;1&quot;<br>  SEMICOLON@635..636 &quot;;&quot;<br></code></pre></td></tr></table></figure><h2 id="ç»†èŠ‚"><a class="markdownIt-Anchor" href="#ç»†èŠ‚"></a> ç»†èŠ‚</h2><p>åœ¨ replace_is_method_with_if_let_method çš„åˆç‰ˆå®ç°ä¸­ï¼Œå®Œæˆä»£ç æ”¹å†™åå…‰æ ‡å¹¶ä¸ä¼šè‡ªåŠ¨é€‰ä¸­ <code>_tmp</code> å˜é‡ã€‚æˆ‘å¸Œæœ›å®ƒå¯ä»¥ï¼Œè¿™æ ·ç”¨æˆ·åœ¨é€‰æ‹©åº”ç”¨è¿™é¡¹ <code>assist</code> ä¹‹åä¸éœ€è¦ä»»ä½•é¼ æ ‡å’Œé”®ç›˜çš„æ“ä½œå°±å¯ä»¥ç›´æ¥ç¼–è¾‘è¿™ä¸ªå˜é‡åã€‚åŒæ ·çš„ï¼Œä¸€å¼€å§‹æˆ‘ä¸çŸ¥é“å¦‚ä½•å®ç°ï¼Œç¿»çœ‹äº†å…¶ä»– <code>assist</code> çš„å®ç°ä¼¼ä¹ä¹Ÿæ²¡æ‰¾åˆ°è¿™æ ·çš„åŠŸèƒ½ï¼Œäºæ˜¯é—®äº† ChatGPTï¼Œå¾—åˆ°äº†ä¸€ä¸ªèƒ½ work çš„æ–¹æ³•ï¼Œåˆ©ç”¨ VSCode ä¸­çš„ <code>$&#123;0:_tmp&#125;</code> è¡¨è¾¾å¼å®ç°è‡ªåŠ¨èŒƒå›´é€‰æ‹©ã€‚ä¸è¿‡æˆ‘è¿™é‡Œçš„å®ç°æ˜¯ç”¨ç²—ç³™çš„æ‰‹åŠ¨æ„é€ æ–¹å¼ï¼Œæˆ–è€… Rust Analyzer é‡Œæœ‰å°è£…å¥½æŸä¸ªå¯¹åº”çš„ api è€Œæˆ‘è¿˜æ²¡æ‰¾åˆ°â€¦<br /><img src="/img/blog_pic/2023/ask_gpt.png" alt="" /></p><p><img src="/img/blog_pic/2023/cursor_selection.gif" alt="" /></p><h2 id="å‚è€ƒ"><a class="markdownIt-Anchor" href="#å‚è€ƒ"></a> å‚è€ƒ</h2><ul><li><a href="https://github.com/rust-lang/rust-analyzer/pull/15743">feat: add replace_is_some_with_if_let_some assist</a></li><li><a href="https://github.com/rust-lang/rust-analyzer/pull/15752">feat: add replace_is_ok_with_if_let_ok assist</a></li><li><a href="https://github.com/rust-lang/rust-analyzer/pull/15755">fix: make cursor select at _tmp</a></li><li><a href="https://rust-analyzer.github.io/blog/2020/09/28/how-to-make-a-light-bulb.html">How to Make a ğŸ’¡</a></li><li><a href="https://www.youtube.com/playlist?list=PLhb66M_x9UmrqXhQuIpWC5VgTdrGxMx3y">Explaining Rust Analyzer</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>å¼€æº</category>
      
      <category>Rust Analyzer</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>æˆä¸º Apache Committer</title>
    <link href="/2023/09/09/%E6%88%90%E4%B8%BA%20Apache%20Committer/"/>
    <url>/2023/09/09/%E6%88%90%E4%B8%BA%20Apache%20Committer/</url>
    
    <content type="html"><![CDATA[<p>8 æœˆ 30 å·æ™šä¸Šï¼Œçªç„¶æ”¶åˆ°ä¸€å°æ¥è‡ª <a href="https://github.com/apache/incubator-opendal">OpenDAL</a> PPMC çš„ Committer é‚€è¯·é‚®ä»¶ï¼Œè¿™å¯¹äºæˆ‘æ¥è¯´å®Œå…¨æ˜¯æ„å¤–ä¹‹å–œã€‚åœ¨æˆ‘çœ¼ä¸­ Apache æ˜¯ä¸€ä¸ªå¾ˆé«˜å¤§ä¸Šçš„ç»„ç»‡ï¼ŒApache Committer æ˜¯ä¸€ä¸ªå¾ˆå‰å®³çš„ç¨‹åºå‘˜ç¾¤ä½“ï¼Œæ²¡æƒ³åˆ°æœ‰ä¸€å¤©æˆ‘ä¹Ÿèƒ½åŠ å…¥å…¶ä¸­ï¼›ä»¥è‡³äºæˆ‘åœ¨æ”¶åˆ°é‚€è¯·æ—¶å…´å¥‹åœ°æ‰‹èˆè¶³è¹ˆï¼Œå½“æ—¶æœ¬æ¥è¿˜æ‰“ç®—è‡ªå·±åšé¥­åƒçš„æˆ‘å½“å³å«äº†ä¸ªå¤–å–çŠ’åŠ³ä¸€ä¸‹è‡ªå·±å“ˆå“ˆå“ˆå“ˆå“ˆã€‚</p><p><img src="/img/blog_pic/2023/opendal_welcome.png" alt="" /></p><p>ä»Šå¤©è®¾ç½®å¥½äº†æˆ‘çš„ Apache è´¦å·ï¼Œlink äº†æˆ‘çš„ GitHub è´¦å·ï¼Œæ­£å¼åŠ å…¥äº† ASF orgï¼Œè¿˜é€šè¿‡ Apache é‚®ç®±è·å–åˆ°äº† JetBrains å…¨å®¶æ¡¶çš„ licenseï¼Œæ­£å¥½ç»­ä¸Šäº†æˆ‘æ¯•ä¸šå³åˆ°æœŸçš„å­¦ç”ŸåŒ… license ğŸ˜„<br /><img src="/img/blog_pic/2023/ASF_invitation.png" alt="" /><br /><img src="/img/blog_pic/2023/jetbrains_all_products_pack.png" alt="" /></p><p>æˆ‘åœ¨ <a href="https://young-flash.github.io/2023/05/03/OpenDAL%20%E7%A4%BE%E5%8C%BA%E5%8F%82%E4%B8%8E%E8%AE%B0%E5%BD%95/">OpenDAL ç¤¾åŒºå‚ä¸è®°å½•</a> ä¸­æåˆ°æˆ‘ç»™ OpenDAL è´¡çŒ®çš„åˆè¡·æ˜¯ä¸ºäº†åœ¨å®é™…é¡¹ç›®ä¸­å­¦ä¹  Rustï¼Œå½“æ—¶å¯¹äºå¼€æºçš„çœ‹æ³•æ˜¯â€œç”¨çˆ±å‘ç”µï¼Œå°±å›¾ä¸€ä¹â€ï¼Œä¹Ÿæ²¡æƒ³ç€èƒ½æœ‰æˆä¸º Apache Committer ä¹‹ç±»çš„æ”¶è·ã€‚é‚£æ—¶å€™ OpenDAL è¿˜åªæœ‰ 500+ starï¼Œä¹Ÿè¿˜æ²¡æ­£å¼è¿›å…¥ Apache å­µåŒ–å™¨ï¼Œåæ¥åœ¨ OpenDAL å„ä½è´¡çŒ®è€…çš„åŠªåŠ›ä¸‹å®ƒè¿›å…¥äº† Apache å­µåŒ–å™¨ã€‚</p><p>æ¥ç€â€œ<strong>å‘½è¿çš„é½¿è½®å¼€å§‹æ‚„ç„¶è½¬åŠ¨</strong>â€ï¼Œæˆ‘é€šè¿‡ @xuanwo çš„æ¨ç‰¹å¾—çŸ¥ OpenDAL åœ¨ OSPP 2023 ä¸­æœ‰ä¸¤ä¸ª slotï¼Œæˆ‘ä¹‹å‰å‚åŠ è¿‡ OSPP 2021ï¼Œæ‰€ä»¥å¾—çŸ¥è¿™ä¸ªæ¶ˆæ¯çš„æ—¶å€™è§‰å¾—æŒºå·§åˆçš„ï¼Œåé¢å°±å¼€å§‹å…³æ³¨è¿™ä¸¤ä¸ª slot ä¼šæ˜¯ä»€ä¹ˆæ ·çš„é¡¹ç›®ï¼›å½“æ—¶å¿ƒé‡Œæƒ³çš„æ˜¯åˆšå¥½æˆ‘å¯¹äº OpenDAL æœ‰ä¸€äº›äº†è§£ï¼Œå¦‚æœå®ƒå‘å¸ƒåˆ° OSPP 2023 ä¸Šçš„é¡¹ç›®æ¯”è¾ƒåˆé€‚çš„è¯é‚£ä¹ˆæˆ‘å°±ç”³è¯·ï¼Œè¦æ˜¯ä¸åˆé€‚çš„è¯å°±ä¸æ‰“ç®—å‚ä¸äº†ï¼Œæ¯•ç«Ÿå½“æ—¶ä¸´è¿‘æ¯•ä¸šï¼Œåœ¨æ¯•ä¸šè®ºæ–‡çš„å‹åŠ›æˆ‘ä¹Ÿä¸æƒ³èŠ±è´¹å¾ˆå¤šæ—¶é—´ç²¾åŠ›å»ä»é›¶äº†è§£é™Œç”Ÿçš„ç¤¾åŒºå’Œæ–°çš„é¡¹ç›®ï¼Œåœ¨<a href="https://mp.weixin.qq.com/s/o5w03sM22pX9_Lo0JUOf-Q">å¼€æºä¹‹å¤çš„ä¸“è®¿</a>ä¸­æˆ‘æåˆ°å‚ä¸ OSPP 2023 æœ‰äº›å¶ç„¶å°±æ˜¯è¿™ä¸ªåŸå› ã€‚ç»“æœæ˜¯æˆ‘å¾ˆå¹¸è¿åœ°ä¸­é€‰äº† OpenDAL çš„ Implementing a Webdav Compatibility Layer for Oay è¿™ä¸ªé¡¹ç›®ï¼Œå®ç°äº†ç¡•å£«ä¸‰å¹´ OSPP 2021 &amp; GSoC 2022 &amp; OSPP 2023 çš„â€œå¤§æ»¡è´¯â€ ğŸ˜„</p><p>å‚ä¸ OSPP 2021 çš„æ—¶å€™æˆ‘è¿åœ¨ GitHub ä¸Šæ PR çš„æµç¨‹éƒ½ä¸æ¸…æ¥šï¼Œå¦‚ä»Šä¸¤å¹´è¿‡å»äº†ï¼Œæˆ‘å·²ç»èƒ½å¤Ÿåœ¨å¼€æºç¤¾åŒºé‡Œç†Ÿç»ƒåœ°å’Œå…¶ä»–å¼€å‘è€…åä½œï¼Œè¿™äº›ç»å†è®©æˆ‘æé«˜äº†ä»£ç èƒ½åŠ›ä¹Ÿè®¤è¯†äº†ä¸€äº›å¾ˆä¼˜ç§€çš„ç¨‹åºå‘˜ï¼ŒçŸ¥é“äº†è¿™ä¸ªä¸–ç•Œä¸Šæœ‰ä¸€äº›å¾ˆ cool çš„äº‹æƒ…æ­£åœ¨å‘ç”Ÿç€ï¼Œæ›´ cool çš„æ˜¯æˆ‘ä¹Ÿå‚ä¸åˆ°äº†è¿™äº›äº‹æƒ…ä¸­ã€‚æˆä¸º Apache Committer å¯¹æˆ‘æ¥è¯´æ˜¯ä¸€ä»½è£èª‰ï¼Œæ˜¯å¯¹æˆ‘å‚ä¸å¼€æºè¿™ä»¶äº‹æƒ…çš„è‚¯å®šï¼Œå¦‚æœå¾ˆå¤šå¹´åæˆ‘è¿˜èƒ½å¤Ÿç»§ç»­è¡Œèµ°åœ¨å¼€æºçš„é“è·¯ä¸Šçš„è¯ï¼Œä¸€å®šæ˜¯è¿™äº›è‚¯å®šç»™æˆ‘çš„åŠ¨åŠ›ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>å¼€æº</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>OSPP 2021 &amp; GSoC 2022 å‚ä¸ç»å†</title>
    <link href="/2023/06/29/OSPP%202021%20&amp;%20GSoC%202022%20%E5%8F%82%E4%B8%8E%E7%BB%8F%E5%8E%86/"/>
    <url>/2023/06/29/OSPP%202021%20&amp;%20GSoC%202022%20%E5%8F%82%E4%B8%8E%E7%BB%8F%E5%8E%86/</url>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h1><p>åœ¨å‚ä¸åˆ° GSoC-like è¿™ç±»æ´»åŠ¨ä¹‹å‰ï¼Œæˆ‘å¯¹å¼€æºçš„çœ‹æ³•ç®€å•ç›´æ¥ä¸”ç°å®ã€‚å½“æ—¶çš„æˆ‘åªæ˜¯å¼€æºçš„ç´¢å–è€…ï¼Œå¼€æºå¯¹æˆ‘æ¥è¯´å°±æ˜¯å…è´¹è·å–ï¼ˆé«˜è´¨é‡ã€å®‰å…¨ï¼‰åº”ç”¨ç¨‹åºå’Œæºä»£ç çš„ä¸€ç§æ–¹å¼ã€‚ä½†æ˜¯å½“æˆ‘å‚ä¸åˆ°å¼€æºåï¼Œåœ¨ç´¢å–è€…è¿™ä¸ªèº«ä»½ä¹‹å¤–æˆ‘è¿˜æ˜¯ä¸€ä¸ªè´¡çŒ®è€…ï¼Œæˆ‘å‚ä¸äº†é¡¹ç›®çš„å¼€å‘ï¼Œç¤¾åŒºçš„æ´»åŠ¨ä»¥åŠå’Œå…¶ä»–äººçš„äº¤æµï¼Œè¿™ä¸ä»…å¼€é˜”äº†æˆ‘çš„æŠ€æœ¯è§†é‡ä¹Ÿå¼€é˜”äº†æˆ‘çš„è®¤çŸ¥è§†é‡ï¼ŒåŸæ¥ä¸–ç•Œä¸Šè¿˜æœ‰è¿™äº›è¿™ä¹ˆé…·çš„äº‹æƒ…æ­£åœ¨å‘ç”Ÿç€ã€‚</p><p>ç†æ‰€å½“ç„¶åœ°ï¼Œæˆ‘æŠŠæˆ‘å‚ä¸çš„ OSPP å’Œ GSoC çš„é¡¹ç›®å†™åˆ°äº†ç®€å†é‡Œï¼Œåœ¨æ‰¾å®ä¹ å’Œç§‹æ‹›çš„æ—¶å€™éƒ½æ”¶åˆ°äº†ä¸€äº›å¤§å‚çš„ offerã€‚è¿™äº›é¡¹ç›®ç»å†æ˜¯ä¸æ˜¯å¸®åŠ©æˆ‘è·å¾—äº†é¢è¯•å®˜çš„é’çè¿™ä¸€ç‚¹æ— æ³•è€ƒç©¶ï¼Œä¸è¿‡æˆ‘è§‰å¾—ä¹Ÿä¸é‡è¦äº†ã€‚è¿™äº›ç»å†è®©æˆ‘å¯¹äºå¼€æºæœ‰äº†æ–°çš„çœ‹æ³•ï¼Œæˆ‘ç›¸ä¿¡å®ƒå¸¦ç»™æˆ‘çš„æŸäº›ä¸œè¥¿èƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šå½±å“æˆ‘çš„èŒä¸šç”Ÿæ¶¯ã€‚æˆ‘èµåŒ wjsvec æ‰€è¨€ï¼š</p><blockquote><p>å‚åŠ å¼€æºä¹‹å¤å¯¹å¾ˆå¤šåŒå­¦åªæ˜¯æ‰“å¼€äº†ä¸€æ‰‡å¼€æºçš„å¤§é—¨ï¼Œè€Œè¿™æ‰‡å¤§é—¨èƒŒåï¼Œæ˜¯ç»šä¸½å¤šå½©çš„å®è—ã€‚</p></blockquote><h1 id="ospp-2021"><a class="markdownIt-Anchor" href="#ospp-2021"></a> OSPP 2021</h1><h2 id="ç¼˜èµ·"><a class="markdownIt-Anchor" href="#ç¼˜èµ·"></a> ç¼˜èµ·</h2><p>åˆæ¬¡å‚ä¸å¼€æºä¹‹å¤æ˜¯åœ¨æˆ‘ç ”ä¸€çš„æ—¶å€™ï¼Œå½“æ—¶æ˜¯æˆ‘å®éªŒå®¤çš„åŒå­¦ï¼ˆæˆ‘ç§°ä»–ä¸º k è€å¸ˆï¼‰å‘Šè¯‰æˆ‘çš„ã€‚æœ€åˆçš„æƒ³æ³•æ˜¯è¿™é‡Œçš„é¡¹ç›®æˆ‘éƒ½çœ‹ä¸æ‡‚ï¼Œè‚¯å®šå¾ˆéš¾ç”³è¯·ä¸Šå§ï¼Ÿåœ¨ k è€å¸ˆçš„é¼“åŠ±å’Œæˆ‘çš„ä¸€ç•ªæ€æƒ³æ–—äº‰ä¸‹æˆ‘è½¬å˜äº†æƒ³æ³•â€”â€”é‚£å°±è¯•è¯•å‘—ï¼Œç”³è¯·ä¸€ä¸‹åˆä¸äºï¼Œä¸‡ä¸€è®©æˆ‘æˆåŠŸäº†ï¼Œèƒ½æ‹¿é’±è¿˜èƒ½æ”¾ä¸Šç®€å†ï¼Œä½•ä¹è€Œä¸ä¸ºå‘¢ï¼Ÿ</p><h2 id="è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹"></a> è¿‡ç¨‹</h2><p>æˆ‘ç”³è¯·çš„æ˜¯ Nebula Graph ç¤¾åŒºçš„ä¸€ä¸ª Java é¡¹ç›®ï¼šä¸ºå›¾æ•°æ®åº“ Nebula Graph å®ç° JDBC åè®®ã€‚å½“æ—¶ç¡®å®šé€‰è¿™ä¸ªé¡¹ç›®æ˜¯å› ä¸ºæˆ‘åœ¨å®éªŒå®¤ä¹Ÿå†™ä¸€äº› Javaï¼Œå¹¶ä¸”è¿™ä¸ªé¡¹ç›®çš„æè¿°é‡Œé¢çš„ä¸€äº›åè¯ç›¸æ¯”å…¶ä»–é¡¹ç›®æ¥è¯´æˆ‘æ›´åŠ èƒ½â€œçœ‹æ‡‚â€ã€‚å½“æ—¶æˆ‘çš„ç”³è¯·ç­–ç•¥æ˜¯é”å®šä¸€ä¸ªé¡¹ç›®ä¹‹åå°± all in è¿›å»ï¼Œåæ¥æˆ‘åœ¨ç”³è¯· GSoC 2022 çš„é¡¹ç›®æ—¶ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p><h3 id="ä¸ç¤¾åŒºè·å¾—è”ç³»"><a class="markdownIt-Anchor" href="#ä¸ç¤¾åŒºè·å¾—è”ç³»"></a> ä¸ç¤¾åŒºè·å¾—è”ç³»</h3><p>æˆ‘é¦–å…ˆåšçš„æ˜¯å»äº†è§£ Nebula Graph è¿™ä¸ªå›¾æ•°æ®åº“ï¼Œæœ‰äº›ç£•ç£•ç»Šç»Šåœ°åœ¨æˆ‘çš„ Windows æœºå™¨ä¸Šå®‰è£… Nebula Graphï¼Œæˆ‘å‘ç°å®˜æ–¹çš„è®ºå›é‡Œå¥½åƒæ²¡æœ‰å…³äº Windows ä¸‹çš„å®‰è£…æ•™ç¨‹è´´ï¼Œäºæ˜¯æˆ‘å°±å†™äº†<a href="https://discuss.nebula-graph.com.cn/t/topic/4382">ä¸€ç¯‡æ–‡ç« </a>å‘è¡¨åœ¨äº†è®ºå›ï¼Œéšåç¤¾åŒºè¿è¥æ¸…è’¸æ‰¾åˆ°äº†æˆ‘ï¼Œè¿˜é€äº†æˆ‘ç¤¾åŒºçš„çºªå¿µå“ä½œä¸ºæˆ‘åœ¨è®ºå›å‘è¡¨æ–‡ç« çš„é¼“åŠ±ã€‚æˆ‘ä»¬äº¤æµäº†å…³äºå¼€æºä¹‹å¤çš„ä¸€äº›é—®é¢˜ï¼Œè·Ÿæˆ‘ä»‹ç»äº†æˆ‘çš„é¡¹ç›®å¯¼å¸ˆç­‰ç­‰ã€‚</p><p>å’Œç¤¾åŒºå¥—ç£æ˜¯ç”³è¯·è¿‡ç¨‹ä¸­å¾ˆé‡è¦çš„ä¸€æ­¥ï¼Œä»¥ä¸Šæ˜¯æˆ‘å’Œç¤¾åŒºå–å¾—è”ç³»çš„ç»å†ã€‚é  PR ä»£ç å’Œå¯¼å¸ˆæ­ä¸Šçº¿å½“ç„¶æ˜¯ä¸€ç§ç›´æ¥æœ‰æ•ˆçš„æ–¹å¼ï¼Œä½†ä¸ä¸€å®šé€‚ç”¨äºæ‰€æœ‰ç¤¾åŒºæ‰€æœ‰é¡¹ç›®ï¼Œæ¯”å¦‚è¯´æœ‰äº›é¡¹ç›®çš„æè¿°ä¸æ˜¯å¾ˆæ¸…æ™°æˆ–è€…è‡ªå·±ç†è§£ä¸æ˜¯å¾ˆåˆ°ä½ï¼Œæ²¡æœ‰å’Œå¯¼å¸ˆå……åˆ†åœ°æ²Ÿé€šå°±å†™ä»£ç æ˜¯å¾ˆå›°éš¾çš„ã€‚æ‰€ä»¥æˆ‘ä¸ªäººè§‰å¾—è¿™ä¸ªè¿‡ç¨‹ä¸ä¸€å®šæ˜¯è¦éå¾—é ä»£ç ï¼Œä¹Ÿä¸ä¸€å®šæ˜¯éå¾—ç›´æ¥å’Œé¡¹ç›®å¯¼å¸ˆæ­ä¸Šçº¿ï¼Œå¦‚æœç¤¾åŒºæœ‰åƒæ¸…è’¸è¿™ä¹ˆé è°±ä¸”æœ‰è¶£çš„è¿è¥ï¼Œé¦–å…ˆå’Œå¥¹ä»¬å–å¾—è”ç³»ä¹Ÿæ˜¯ä¸é”™çš„é€‰æ‹©å“ˆå“ˆå“ˆğŸ˜„</p><p>ä¹‹åæˆ‘ä¾¿å°è¯•å°±é¡¹ç›®æœ¬èº«å’Œå¯¼å¸ˆè¿›è¡Œæ²Ÿé€šã€‚æˆ‘åœ¨ Nebula Studio ä¸­å‘ç°äº† Nebula Graph çš„ Server ç«¯æœ‰æš´éœ² HTTP æ¥å£ï¼Œäºæ˜¯æˆ‘ä¾¿æƒ³å€ŸåŠ© OkHttp æ¡†æ¶åœ¨ Java ä¸­å®ç°ä¸æœ¬åœ° Nebula Graph çš„é€šä¿¡ï¼Œåœ¨è·‘é€šäº†åŸºæœ¬çš„ CRUD æµç¨‹åæˆ‘ä¾¿å’Œå¯¼å¸ˆè¯´äº†æˆ‘çš„æƒ³æ³•ï¼Œåæ¥å¯¼å¸ˆå‘Šè¯‰æˆ‘å¯ä»¥ç”¨åŸºäºç°æœ‰çš„ nebula-java å»å°è£…å‡º JDBC çš„æ¥å£ã€‚æ˜¯çš„ï¼Œæˆ‘çš„æƒ³æ³•æ²¡æœ‰å¾—åˆ°è®¤å¯ï¼Œä½†æ˜¯æˆ‘ä¸€ç‚¹éƒ½ä¸è§‰å¾—é—æ†¾æˆ–è€…éš¾è¿‡ï¼Œåè€Œæœ‰äº›åº†å¹¸æˆ‘è·Ÿå¯¼å¸ˆæ²Ÿé€šäº†ï¼Œè¦æ˜¯æ²¡æ²Ÿé€šå¥½è‡ªå·±å°±å¼€å§‹é—·å¤´åšçš„è¯é‚£å°±ç™½è´¹äº†æ›´å¤šåŠŸå¤«äº†ã€‚æˆ‘åœ¨ä»Šå¹´çš„ OSPP 2023 ç”³è¯·çš„è¿‡ç¨‹ä¸­åŒæ ·æ²¡æœ‰å‡†ç¡®åœ°æŠŠæ¡æŠ€æœ¯è·¯çº¿ï¼Œè¿˜å¥½åœ¨ Discord ä¸­å’Œç¤¾åŒºæ²Ÿé€šè¿‡ååœ¨ proposal ä¸­ä¿®æ­£äº†è¿‡æ¥ã€‚</p><p>å……åˆ†çš„æ²Ÿé€šå¾ˆé‡è¦ï¼Œå®ƒå¯ä»¥ç¡®ä¿ä½ å§‹ç»ˆæŠŠåŠŸå¤«èŠ±åœ¨æ­£ç¡®çš„åœ°æ–¹ï¼›åŒæ—¶è¿™ä¹Ÿæ˜¯å’Œå¯¼å¸ˆäº’ç›¸äº†è§£çš„ä¸€ä¸ªè¿‡ç¨‹ï¼Œå¦‚æœå‘ç°å’Œå¯¼å¸ˆæ²Ÿé€šæ— æ³•å–å¾—ä¸€ç›´æˆ–è€…å¯¼å¸ˆæœ¬èº«å¯¹äºé¡¹ç›®çš„æŒ‡å¯¼ä¸å¤ªä¸Šå¿ƒï¼ˆæ˜¯çš„ï¼Œå¯èƒ½æœ‰äº›äººä½œä¸ºé¡¹ç›®å¯¼å¸ˆçº¯ç²¹æ˜¯å› ä¸ºå…¬å¸çš„å®‰æ’ï¼Œæœ¬èº«æ„æ„¿å°±ä¸é«˜ï¼›ä½†æˆ‘ç›¸ä¿¡å¤§éƒ¨åˆ†å¯¼å¸ˆéƒ½æ˜¯å¾ˆè®¤çœŸè´Ÿè´£çš„ï¼‰ï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥åŠæ—¶æ­¢æŸï¼Œå¯»æ‰¾å…¶ä»–é¡¹ç›®æˆ–è€…å…¶ä»–ç¤¾åŒºçš„æœºä¼šã€‚æˆ–è®¸å¼€æºä¹‹å¤è¿™ä¸ªæ´»åŠ¨ä»¥åŠæŸäº›ç¤¾åŒºæŸäº›äººå¹¶ä¸æ˜¯ç™¾åˆ†ç™¾ç¾å¥½ï¼Œä½†åªè¦ç”¨å¿ƒæŒ–æ˜æ€»è¿˜æ˜¯æœ‰æœºä¼šçš„ã€‚</p><h3 id="coding"><a class="markdownIt-Anchor" href="#coding"></a> coding</h3><p>æˆ‘çš„ nebula-jdbc é¡¹ç›®åœ¨ç”³è¯·æ—¶è¢«æ ‡æ³¨ä¸ºä¸€ä¸ªä¸­ç­‰éš¾åº¦çš„é¡¹ç›®ï¼Œæœ¬èº«å¹¶ä¸éš¾ï¼Œç‰¹åˆ«åœ¨æ˜¯å¯¼å¸ˆè¯´å¯ä»¥åŸºäºç°æœ‰çš„ nebula-java å°è£…ä¹‹åã€‚æ¥ä¸‹æ¥æˆ‘æ‰¾åˆ°äº† JDBC Specificationï¼Œä»”ç»†è¯»äº†ä¸€éå°½é‡ä¸è®©è‡ªå·±çš„ç†è§£å‡ºé”™ï¼›è€Œåå°±æ˜¯åœ¨ JDBC çš„å„ä¸ªæ¥å£ä¸­è°ƒç”¨ nebula-java çš„ API å»å®ç°å¯¹åº”çš„åŠŸèƒ½äº†ï¼Œè¿™ä¸€éƒ¨åˆ†æœ‰<a href="https://mp.weixin.qq.com/s/u1iTb_K0EoMboxTrvb3P3Q">ä¸€ç¯‡å½“æ—¶å‘è¡¨åœ¨ OSPP å…¬ä¼—å·çš„æ–‡ç« </a>ã€‚</p><p>æ—¶éš”ä¸¤å¹´ä¹‹åå›æœ›å½“æ—¶åšé¡¹ç›®å†™ä»£ç çš„è¿‡ç¨‹ï¼Œå¾ˆå¤šç»†èŠ‚éƒ½å·²ç»æ¨¡ç³Šäº†ã€‚ä½†æˆ‘è¿˜æ¸…æ™°åœ°è®°å¾—é‚£ä¸ªæš‘å‡é‡Œå’Œ k è€å¸ˆï¼ˆä»–ä¹Ÿå‚åŠ äº† OSPP çš„æ´»åŠ¨ï¼‰åœ¨å®éªŒå®¤äº’ç›¸è®¨è®ºï¼Œå½¼æ­¤é¼“åŠ±ï¼ˆ<s>å•†ä¸šäº’å¹</s>ï¼‰ï¼Œä¸€èµ·åƒé¥­æ¸¸æ³³çš„æ—¥å­ã€‚</p><h2 id="åæ¥"><a class="markdownIt-Anchor" href="#åæ¥"></a> åæ¥</h2><p>åœ¨å¯¼å¸ˆçš„æŒ‡å¯¼ä¸‹æˆ‘çš„é¡¹ç›®é¡ºåˆ©ç»“é¡¹äº†ï¼Œä¸ä»…æ”¶è·äº†æ¥è‡ªæ¸…è’¸çš„ä¸€ç³»åˆ—çš„ç¤¾åŒºå‘¨è¾¹ï¼Œåé¢å¯¼å¸ˆè¿˜é€äº†æˆ‘ä¸€ä¸ªé”®ç›˜ä½œä¸ºç¤¼ç‰©å“ˆå“ˆå“ˆå“ˆã€‚æ­¤ååœ¨æ¸…è’¸çš„é‚€è¯·ï¼ˆ<s>å‘è’™æ‹éª—</s>ï¼‰ä¸‹åœ¨ç¤¾åŒºå‡ºäº†<a href="https://discuss.nebula-graph.com.cn/t/topic/5656">ä¸€æœŸè®¿é—®</a>ï¼Œè¿˜åœ¨ Nebula Graph æ¯å…¬å¸çš„é‚€è¯·ä¸‹å»åˆ°æ­å·å‚åŠ ç¤¾åŒºä¸¾åŠçš„å¼€æºä¹‹å¤çº¿ä¸‹æ€»ç»“ä¼šï¼Œè®¤è¯†äº†å…¶ä»–å‚åŠ  Nebula ç¤¾åŒºé¡¹ç›®çš„åŒå­¦ï¼Œä¹Ÿæ˜¯å€Ÿæ­¤æœºä¼šå’Œ Wey ä»–ä»¬ä¸€èµ·åƒäº†ä¸ªé¥­ğŸ˜„<br /><img src="/img/blog_pic/2023/meeting.jpg" alt="" /><br /><img src="/img/blog_pic/2023/gift_from_mentor.jpg" alt="" /></p><h1 id="gsoc-2022"><a class="markdownIt-Anchor" href="#gsoc-2022"></a> GSoC 2022</h1><h2 id="ç¼˜èµ·-2"><a class="markdownIt-Anchor" href="#ç¼˜èµ·-2"></a> ç¼˜èµ·</h2><p>æˆ‘æ˜¯åœ¨å‚ä¸ OSPP ä¹‹åæ‰çŸ¥é“çš„ GSoCâ€”â€”æ¯”èµ· OSPP å†å²æ›´æ‚ ä¹…é¢å‘èŒƒå›´æ›´å¹¿æ³›ã€‚åœ¨æˆ‘å¾—çŸ¥è¦ç”³è¯·ä¸Šé¢çš„é¡¹ç›®æ˜¯è¦å’Œå…¨çƒèŒƒå›´å†…çš„å¼€å‘è€…ç«äº‰æ—¶æˆ‘å†…å¿ƒåˆæ˜¯æ‰“èµ·äº†é€€å ‚é¼“çš„ã€‚å’Œä¹‹å‰å‚åŠ  OSPP ä¸ä¸€æ ·çš„æ˜¯å½“æ—¶çš„æˆ‘å·²ç»ä¸æ˜¯ä¸€ä¸ªçº¯å°ç™½äº†ï¼Œæ€ä¹ˆè¯´ä¹Ÿæ˜¯æœ‰è¿‡ OSPP ç»éªŒçš„ï¼Œè¿™ç»™äº†æˆ‘å¾ˆå¤§çš„ä¿¡å¿ƒï¼Œæ‰€ä»¥è¿˜æ˜¯è¯•è¯•å‘—ï¼Œç”³è¯·ä¸€ä¸‹åˆä¸äºå“ˆå“ˆå“ˆã€‚</p><p>GSoC çš„é¡¹ç›®çœŸæ˜¯åˆå¤šåˆæ‚å•Šï¼Œç”šè‡³è¿˜æœ‰ä¿æŠ¤é²¸é±¼çš„ç»„ç»‡å’Œé¡¹ç›®ï¼Œè¿™å°±æ˜¯ diversity å—å“ˆå“ˆå“ˆã€‚ä¸€å¼€å§‹å¹¶æ²¡æœ‰æƒ³å¥½å°è¯•å“ªä¸ªé¡¹ç›®ï¼Œæƒ³ç€ä»è‡ªå·±çš„æŠ€æœ¯æ ˆå‡ºå‘æ‰¾ä¸€äº›é¡¹ç›®çœ‹çœ‹ï¼Œæˆ‘å¯¹ Linux C++ æ¯”è¾ƒæœ‰å…´è¶£æ‰€ä»¥æƒ³æ‰¾ä¸€äº›è¿™æ–¹é¢çš„é¡¹ç›®ï¼Œä¸€ç•ªæµè§ˆä¸‹æ¥å‘ç°äº† <a href="https://wiki.videolan.org/SoC_2022/">Develop a MPD server inside VLC</a>ã€<a href="https://github.com/casbin/SummerOfCode2022#casbin-for-cc">Casbin for C/C++</a>ã€HAIKU ä»¥åŠ <a href="https://ccextractor.org/public/gsoc/rtorrent-modern-rpc/">Introduce WebSockets into rTorrent</a>ï¼Œå…¶ä¸­ VLC å’Œ HAIKU åˆçœ‹ä¸Šå»ä¸å¤ªå¥‘åˆæˆ‘ï¼ŒCasbin çš„æœ‰å°è¯•è¿‡è·‘ä¸€ä¸‹é¡¹ç›®ä¸è¿‡ä¹Ÿæ²¡å•¥æ€è·¯ï¼Œæœ€åå‘ç°äº† rTorrent çš„è¿™ä¸ªé¡¹ç›®ï¼Œä¸»è¦æ˜¯ä¸º rTorrent å¼•å…¥ Websockets åè®®ï¼Œæ¶‰åŠåˆ°ç½‘ç»œç¼–ç¨‹å’Œ Modern C++ï¼ŒäºŒè€…æˆ‘éƒ½æœ‰ä¸€ç‚¹åŸºç¡€å¹¶ä¸”ä¹Ÿéƒ½æŒºæ„Ÿå…´è¶£çš„æ‰€ä»¥å°±é”å®šè¿™ä¸ªé¡¹ç›®äº†ã€‚å¹¶æ²¡æœ‰æƒ³è¿‡åŒæ—¶å°è¯•å¤šä¸ªé¡¹ç›®ï¼Œå› ä¸ºä¸æƒ³èŠ±å¾ˆå¤šæ—¶é—´ç²¾åŠ›å»å¤šçº¿ç¨‹ï¼Œè®¤å®šå¥½ä¸€ä¸ªç„¶å all in å°±å¥½äº†ï¼Œå°½äººäº‹å¬å¤©å‘½ï¼Œè¿™æ˜¯æˆ‘åœ¨å‚åŠ è¿™ç±»æ´»åŠ¨çš„ä¸€è´¯åšæ³•ã€‚</p><h2 id="å¥—ç£"><a class="markdownIt-Anchor" href="#å¥—ç£"></a> å¥—ç£</h2><p>é¡¹ç›®äº†è§£çš„å·®ä¸å¤šäº†å°±åœ¨ slack ä¸Šè”ç³»å¯¼å¸ˆï¼Œé¦–å…ˆä»‹ç»äº†è‡ªå·±çš„åŸºæœ¬æƒ…å†µã€ä¸ªäººæŠ€æœ¯æ ˆä»¥åŠå»å¹´å¼€æºä¹‹å¤çš„ç»å†ä¹‹ç±»çš„èƒŒæ™¯ç­‰ã€‚ç¬¬äºŒå¤© mentor å°±å›å¤æˆ‘äº†ï¼Œè¯´æˆ‘çš„ profile looks greatï¼Œå’Œæˆ‘è®²äº†ä¸€ä¸‹é¡¹ç›®çš„ç›®æ ‡ï¼Œä»¥åŠæ¥ä¸‹æ¥ä¼šå‘å¸ƒ qualification tasks to identify the best candidateã€‚æ¥ä¸‹æ¥æˆ‘è®¤çœŸåœ°å®Œæˆäº† mentor å‘å¸ƒçš„ qualification tasksï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¹Ÿè®©æˆ‘å¯¹å®Œæˆé¡¹ç›®æœ‰äº†æ›´å¤§çš„æŠŠæ¡ï¼›äºæ˜¯ä¾¿ç€æ‰‹å†™ proposalï¼Œå‚è€ƒäº†è¿™ä¸ª <a href="https://github.com/saketkc/fos-proposals">repo</a>ï¼Œåæ¥æˆ‘åœ¨é¡¹ç›®é¡ºåˆ©ç»“é¡¹ä¹‹åä¹ŸæŠŠæˆ‘è‡ªå·±çš„ proposal é€šè¿‡ <a href="https://github.com/saketkc/fos-proposals/pull/25">PR</a> å›é¦ˆç»™äº†è¿™ä¸ª repoã€‚</p><p>æˆ‘å¯¹è‡ªå·±çš„å‰æœŸå·¥ä½œä»¥åŠå’Œ mentor çš„äº¤æµè¿‡ç¨‹æ„Ÿè§‰è¿˜æ˜¯æŒºä¸é”™çš„ï¼Œæ‰€ä»¥è®¤ä¸ºè‡ªå·±ä¸­é€‰çš„æ¦‚ç‡è¿˜æ˜¯æ¯”è¾ƒå¤§çš„ã€‚GSoC ä»æˆªæ­¢æäº¤ proposal åˆ°å…¬å¸ƒä¸­é€‰ä¸­é—´éš”äº†ä¸€ä¸ªæœˆï¼Œè¿˜æ˜¯è®©äººç­‰å¾—å¤Ÿä¹…çš„ï¼Œä¸­é—´æˆ‘ç»™ rTorrent æäº¤äº†ä¸¤ä¸ª commitï¼Œåˆæ­¥å¼•å…¥äº† websocketï¼Œç»™ mentor çœ‹åä»–è¯´ looks good at the first glanceã€‚è‡³æ­¤æˆ‘å°±è§‰å¾—ä¸­é€‰åº”è¯¥æ²¡é—®é¢˜äº†ï¼Œæ„æ–™ä¹‹å†…åœ°æ”¶åˆ°äº†ä¸­é€‰é‚®ä»¶å“ˆå“ˆå“ˆå“ˆã€‚</p><p><img src="/img/blog_pic/2023/accept_letter.png" alt="" /></p><h2 id="è¿‡ç¨‹-2"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹-2"></a> è¿‡ç¨‹</h2><p>å°è±¡æ·±åˆ»çš„æ˜¯å…³äº websocket åº“çš„é€‰æ‹©ï¼Œæˆ‘ä»¬å¸Œæœ›æœ‰ä¸€ä¸ªæ”¯æŒåœ¨ unix domain socket ä¸Šè¿è¡Œ websocket æœåŠ¡çš„ libã€‚ä¸€å¼€å§‹æˆ‘çš„è®¡åˆ’æ˜¯ä½¿ç”¨ <a href="https://github.com/uNetworking/uWebSockets">uWebsockets</a>ï¼Œè¿™æ˜¯ä¸€ä¸ª C++ å®ç°çš„ websocket åº“ï¼Œåº•å±‚ä¾èµ– <a href="https://github.com/uNetworking/uSockets">uSockets</a> è¿›è¡Œç½‘ç»œé€šä¿¡ï¼Œæ€§èƒ½ä¼˜è¶Šï¼ŒAPI å¾ˆç®€æ´ä¼˜é›…ï¼Œgithub ä¸Šæœ‰ 15 k+ starsï¼Œä½†é—æ†¾çš„æ˜¯å½“æ—¶çš„å®ƒå¹¶ä¸æ”¯æŒ unix domain socketï¼›å¦ä¸€ä¸ªé€‰æ‹©æ˜¯ libwebsocketï¼Œæœ‰ unix domain socket æ”¯æŒï¼Œä¸è¿‡æ˜¯ C å†™çš„ï¼Œæ¥å£æ¯”è¾ƒ old-style æˆ‘å¾ˆéš¾çœ‹æ‡‚ã€‚</p><p>åœ¨ mentor çš„å»ºè®®ä¸‹æˆ‘å°è¯•ç»™ uWebsockets åŠ ä¸Š unix domain socket æ”¯æŒã€‚ä¸€å¼€å§‹æ²¡æœ‰ä»»ä½•å¤´ç»ªï¼Œåœ¨ uWebsockets å’Œ uSockets ä¸­ç¿»éäº†æ‰€æœ‰è·Ÿ unix domain socket æœ‰å…³çš„ issueï¼Œä¸€ç•ªäº†è§£ä¸‹æ¥çŸ¥é“äº†å¯ä»¥ä» uSockets çš„ bsd.c è¿™ä¸ªæ–‡ä»¶ä¸­çš„åˆ›å»º socket éƒ¨åˆ†å…¥æ‰‹ï¼Œæ¥ç€è¿˜åœ¨ uWebsockets ä¸­æäº†ä¸€ä¸ª <a href="https://github.com/uNetworking/uWebSockets/discussions/1438">discussion</a>ï¼Œ@ äº†å¥½å¤šäººéƒ½æ²¡äººç†æˆ‘ã€‚ã€‚ã€‚å®é™…åŠ¨æ‰‹æ“ä½œåç«Ÿç„¶çœŸçš„è®©æˆ‘åšå‡ºæ¥äº†ï¼Œæ¯”æƒ³è±¡ä¸­çš„ç®€å•è®¸å¤šï¼Œè¿™ä¹Ÿå¾—ç›Šäºè¿™ä¸ªåº“æœ¬èº«çš„è®¾è®¡å’Œç¼–ç éƒ½å¾ˆä¼˜ç§€ã€‚åœ¨ uSockets ä¸­æäº† <a href="https://github.com/uNetworking/uSockets/pull/178">PR</a> å›é¦ˆç»™ç¤¾åŒºï¼Œç»å†äº†å¤§åŠå¹´å PR ç»ˆäº merged äº†ï¼Œå½“æ—¶æˆ‘æ˜¯å¾ˆæ¿€åŠ¨çš„ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªæˆ‘ä»å®é™…éœ€æ±‚å‡ºå‘æ‰€åšçš„å¹¶ä¸”è¿˜è¢«ä½œè€…è®¤å¯çš„ä¸€é¡¹å·¥ä½œï¼Œç»™ä¸€ä¸ªä¸€ä¸‡å¤š stars çš„ repo æäº†ä¸€ä¸ªå®é™…çš„ PR æ˜¯ä¸€ä»¶å¾ˆè®©æˆ‘è‡ªè±ªçš„äº‹æƒ…ã€‚ï¼ˆåœ¨ OSPP 2021 ä¸­é™¤äº†é¡¹ç›®å¤–æˆ‘å‡ ä¹æ²¡ä»€ä¹ˆè´¡çŒ®äº†ï¼Œä½†åœ¨ GSoC 2022 ä¸­é™¤äº†é¡¹ç›®æœ¬èº«å¤–æˆ‘è¿˜å›é¦ˆäº†ä¸€ç¯‡ proposal å’Œç»™å…¶ä»–ç¤¾åŒºçš„ PRï¼Œæˆ‘è§‰å¾—è¿™æ˜¯æˆ‘çš„è¿›æ­¥ï¼‰</p><p>å…³äºæˆ‘åœ¨ GSoC 2022 ä¸­çš„è¯¦ç»†ç»å†æˆ‘å†™åœ¨äº†æˆ‘çš„<a href="https://young-flash.github.io/2022/05/21/GSoC%202022%20Series%201/">åšå®¢</a>ä¸­ï¼Œå°±ä¸åœ¨æ­¤èµ˜è¿°äº†ã€‚</p><h1 id="æœ€å"><a class="markdownIt-Anchor" href="#æœ€å"></a> æœ€å</h1><p>æœ€åæˆ‘æƒ³ä»¥æˆ‘åœ¨ GSoC 2022 çš„ <a href="https://github.com/saketkc/fos-proposals/blob/master/GSoC-2022/Accepted/CCExtractor-DongyangZheng-Introduce-WebSocket-into-rTorrent/DongyangZheng-Introduce%20WebSocket%20into%20rTorrent.md">proposal</a> ä¸­çš„ä¸€å¥è¯ä½œä¸ºç»“å°¾ï¼š</p><blockquote><p>Although GSoC 2022 may be over, my enthusiasm for open source isnâ€™t.</p></blockquote><h1 id="å‚è€ƒ"><a class="markdownIt-Anchor" href="#å‚è€ƒ"></a> å‚è€ƒ</h1><ul><li><a href="https://github.com/nebula-contrib/nebula-jdbc">nebula-jdbc</a></li><li><a href="https://discord.com/channels/1081052318650339399/1109814626046197770">åœ¨ Discord ä¸­å’Œç¤¾åŒºæ²Ÿé€šé¡¹ç›®</a></li><li><a href="https://blog.aflybird.cn/2023/06/please-stop-fucking-open-source-activities-in-china/">è¯·è¿˜å›½å†…å¼€æºæ´»åŠ¨ä¸€ç‰‡å‡€åœŸ</a></li><li><a href="https://young-flash.github.io/2022/05/21/GSoC%202022%20Series%201/">æˆ‘çš„ GSoC 2022 ç³»åˆ— Blog</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>å¼€æº</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¼€æºä¹‹å¤</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>OpenDAL ç¤¾åŒºå‚ä¸è®°å½•</title>
    <link href="/2023/05/03/OpenDAL%20%E7%A4%BE%E5%8C%BA%E5%8F%82%E4%B8%8E%E8%AE%B0%E5%BD%95/"/>
    <url>/2023/05/03/OpenDAL%20%E7%A4%BE%E5%8C%BA%E5%8F%82%E4%B8%8E%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<!-- æˆ‘ç¬¬ä¸€æ¬¡å­¦ä¹  Rust æ˜¯å»å¹´åœ¨å¾®è½¯å®ä¹ æœŸé—´ã€‚å½“æ—¶æˆ‘çš„åŒäº‹æŠŠä»–æ²¡æœ‰çœ‹çš„ã€ŠRust ç¼–ç¨‹ä¹‹é“ã€‹é€ç»™äº†æˆ‘ï¼Œä½†ç”±äºå‡†å¤‡ç§‹æ‹›ï¼Œæˆ‘å¹¶æ²¡æœ‰èŠ±å¤ªå¤šæ—¶é—´å­¦ä¹ å®ƒã€‚å®ä¹ ç»“æŸåå›åˆ°å­¦æ ¡ç»§ç»­å‡†å¤‡ç§‹æ‹›ï¼Œä¹Ÿå°±å¿˜è®°äº†è¿™ä»¶äº‹æƒ…ã€‚åæ¥å†æ¬¡æ¡èµ·æ¥çš„æ—¶å€™ï¼Œæˆ‘è§‰å¾—é€šè¿‡å®è·µå­¦ä¹ å¯èƒ½æ›´å¥½ä¸€äº›ã€‚å› æ­¤ï¼Œæˆ‘æƒ³å°è¯•æ‰¾ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œå¹¶ä¸ºå…¶åšå‡ºè´¡çŒ®ã€‚æ°å·§ï¼Œåœ¨æ¨ç‰¹ä¸Šçœ‹åˆ° Xuanwo å¤©å¤©åœ¨å†å– OpenDAL é¡¹ç›®ï¼Œäºæ˜¯ä¾¿å¼€å§‹å‚ä¸å…¶ä¸­äº†ã€‚ --><h1 id="ç¼˜èµ·"><a class="markdownIt-Anchor" href="#ç¼˜èµ·"></a> ç¼˜èµ·</h1><p>ç¬¬ä¸€æ¬¡å…¥é—¨å­¦ Rust è¿˜æ˜¯å»å¹´åœ¨å¾®è½¯å®ä¹ é‚£ä¼šå„¿ï¼ŒåŒäº‹æŠŠä»–ä¸çœ‹çš„ã€ŠRust ç¼–ç¨‹ä¹‹é“ã€‹é€ç»™æˆ‘äº†ï¼Œå½“æ—¶åœ¨å‡†å¤‡ç§‹æ‹›ä¹Ÿå°±æ²¡å¤šèŠ±å¿ƒæ€å­¦ï¼Œå®ä¹ ç»“æŸåå›å­¦æ ¡å‡†å¤‡ç§‹æ‹›äº†ä¹Ÿå°±ä¸äº†äº†ä¹‹ã€‚åæ¥å†æ¬¡æ¡èµ·æ¥çš„æ—¶å€™è§‰å¾—è¿˜æ˜¯ learning by doing çš„æ–¹å¼æ¯”è¾ƒå¥½ï¼Œæƒ³ç€èƒ½ä¸èƒ½æ‰¾ä¸ªå¼€æºé¡¹ç›®è´¡çŒ®ä»£ç è¯•è¯•ï¼Œæ­£å¥½åœ¨æ¨ç‰¹ä¸Šçœ‹åˆ° <a href="https://twitter.com/OnlyXuanwo">Xuanwo</a> å¤©å¤©åœ¨å†å– <a href="https://github.com/apache/incubator-opendal">OpenDAL</a>ï¼Œäºæ˜¯â€œå°±å†³å®šæ˜¯ä½ äº†â€ã€‚<br /><img src="/img/blog_pic/2023/%E7%9A%AE%E5%8D%A1%E4%B8%98.jpg" alt="" /><br />æˆ‘ç›¸ä¿¡è‚¯å®šè¿˜æœ‰å…¶ä»– contributor æ˜¯é€šè¿‡ Xuanwo çš„æ¨ç‰¹æ‰è®¤è¯† OpenDAL è¿›è€Œå‚ä¸å…¶ä¸­çš„ï¼Œè¿™å¯¹äºå¼€æºç¤¾åŒºå¸å¼•æ–° contributor æ¥è¯´ä¹Ÿæ˜¯ä¸€ç§æˆåŠŸã€‚</p><h1 id="åˆè¯•"><a class="markdownIt-Anchor" href="#åˆè¯•"></a> åˆè¯•</h1><p>æŠŠé¡¹ç›® clone ä¸‹æ¥åç¬¬ä¸€æƒ³æ³•æ˜¯è¯•ç€ç”¨èµ·æ¥ï¼Œä¹Ÿæ˜¯é€‰æ‹©äº†å…¶ä¸­çš„ WebDAV Serviceï¼Œåœ¨æ‰“ç®—è¿æ¥åšæœäº‘ WebDAV æ—¶å‘ç° OpenDAL å¹¶æ²¡æœ‰æä¾› username &amp; password éªŒè¯çš„æ–¹å¼ï¼Œè§‰å¾—å¾ˆå¥‡æ€ªæ‰€ä»¥åœ¨ <a href="https://github.com/apache/incubator-opendal/issues/1319">issue</a> ä¸­é—®äº†é—®ï¼Œå‘ç°è¿™æ˜¯ OpenDAL WebDAV Service è¿˜æ²¡å®Œå–„çš„åœ°æ–¹ï¼ŒXuanwo é¡ºåŠ¿é—®æˆ‘è¦ä¸è¦å°è¯•ç»™å®ƒåŠ ä¸Šï¼Œæˆ‘æƒ³æœºä¼šè¿™ä¸å°±æ¥äº†å˜›ï¼Œäºæ˜¯ä¾¿æ¥äº†ä¸‹æ¥ï¼Œåœ¨ <a href="https://github.com/apache/incubator-opendal/pull/1323">feat: Add username and password support for WebDAV</a> è¿™ä¸ª PR ä¸­å®Œæˆäº† WebDAV username &amp; password éªŒè¯ã€‚å®Œæˆè¿™é¡¹æ”¯æŒåå‘ç°è¿˜æœ‰ä¸ªå·®ä¸å¤šçš„æ´»å„¿ï¼Œç»™ <code>HttpBackend</code> åŠ ä¸Š Basic å’Œ Bearer çš„æˆæƒæ–¹å¼ã€‚æ•´ä½“ä¸Šæ¥è¯´å¾ˆç®€å•ï¼Œä»£ç ç†è§£èµ·æ¥ä¹Ÿå¹¶ä¸å¤æ‚ã€‚</p><h1 id="åæ¥"><a class="markdownIt-Anchor" href="#åæ¥"></a> åæ¥</h1><p>æœ‰äº†å‰é¢çš„ä¸¤ä¸ª PRï¼Œæˆ‘æƒ³èƒ½ä¸èƒ½ä¸º OpenDAL åšæ›´å¤šçš„äº‹æƒ…ï¼Œäºæ˜¯ç¿»äº†ç¿» issueï¼Œçœ‹åˆ° <a href="https://github.com/apache/incubator-opendal/issues/5">Tracking issue of services support</a> ä¸­åˆ—å‡ºäº†ä¸€ç³»åˆ—è¿˜ä¸æ”¯æŒçš„å­˜å‚¨æœåŠ¡ï¼Œè§‰å¾—è¿™åº”è¯¥æ˜¯ä¸€ä¸ªä¸é”™çš„æ–¹å‘ã€‚ä¸åŒäºå‰é¢åªæ˜¯åœ¨å·²ç»å®ç°çš„ service ä¸­åšç¼ç¼è¡¥è¡¥çš„å·¥ä½œï¼Œæ–°å¢ä¸€ä¸ª service æ¶‰åŠçš„å·¥ä½œé‡ä¼šæ›´å¤šä¸€äº›ï¼Œä¹Ÿèƒ½ä»ä¸­å­¦ä¹ åˆ° OpenDAL ä¸ºäº†æ”¯æŒä¸åŒå­˜å‚¨æœåŠ¡æ‰€åšçš„ä¸€äº›æŠ½è±¡ã€‚äºæ˜¯æˆ‘ä¾¿ç›¯ä¸Šäº† Google Driveï¼Œæ°å¥½å·²ç»æœ‰ä¸€ä¸ª <a href="https://github.com/apache/incubator-opendal/issues/654">issue</a> ä¸ä¹‹å¯¹åº”ï¼Œæ¥ç€ä¾¿å¼€å§‹åŠ¨æ‰‹ã€‚</p><p>ç¬¬ä¸€æƒ³æ³•æ˜¯å…ˆæ‰¾æ‰¾æœ‰æ²¡æœ‰ç°æˆçš„ Google Drive Rust client å¯ä»¥é›†æˆåˆ° OpenDAL ä¸­ï¼Œæˆ‘æ‰¾åˆ°äº† <a href="https://crates.io/crates/google-drive3">google-drive3</a>ï¼Œè·‘é€šäº† oauth authorization å’Œ <code>file_path -&gt; id</code> ä¹‹ååœ¨ issue ä¸­è¯´æˆ‘æ‰“ç®—å¼•å…¥è¿™ä¸ªä¾èµ–ä»è€Œå®ç° Google Drive Service for OpenDALã€‚æ„å¤–çš„æ˜¯è¿™ä¸ªæ€è·¯å¹¶æ²¡æœ‰å¾—åˆ°æ”¯æŒï¼Œå¯¹æ­¤ï¼ŒXuanwo çš„è§‚ç‚¹çš„è¿™æ ·çš„ï¼šå¸Œæœ›ç”¨åŸç”Ÿçš„ HTTP è¯·æ±‚å®ç° OpenDAL çš„å„ç§æ“ä½œè€Œä¸æ˜¯å¼•å…¥æ–°çš„ SDKï¼Œä¸€æ–¹é¢æ˜¯ä¸Šæ‰‹æ–° SDK çš„æˆæœ¬å¹¶ä¸æ¯”æ‰‹å†™ HTTP è¯·æ±‚ä½å¤šå°‘ï¼Œå¦ä¸€æ–¹é¢æ˜¯é¿å…å¼•å…¥æ–°ä¾èµ–åçš„ license å’Œç‰ˆæœ¬ç®¡ç†é—®é¢˜ã€‚å—¯ï¼Œmake sense.<br /><img src="/img/blog_pic/2023/xuanwo.png" alt="" /></p><p>æ¥ç€æˆ‘å¹¶æ²¡æœ‰é©¬ä¸ŠåŠ¨æ‰‹åšä¸‹å»ï¼Œå› ä¸ºå½“æ—¶æ¯•ä¸šè®ºæ–‡è¿˜æ²¡å†™å®Œï¼Œå°±æƒ³ç€åé¢å†è¯´å§ã€‚ç›´åˆ°å‰äº›å¤© <a href="https://github.com/imWildCat">imWildCat</a> é—®æˆ‘åšå¾—æ€ä¹ˆæ ·äº†æˆ‘æ‰æƒ³èµ·æ¥è¿™å›äº‹ï¼Œè¿™æ—¶å€™æ¯•ä¸šè®ºæ–‡åˆšæäº¤é€å®¡ï¼Œæ‰‹ä¸Šä¹Ÿæ²¡å…¶ä»–äº‹æƒ…ï¼Œç»ˆäºæœ‰å¿ƒæ€æ¥åšè¿™é¡¹å·¥ä½œäº†ã€‚è¶ç€äº”ä¸€å‡æœŸï¼Œåœ¨ <a href="https://github.com/apache/incubator-opendal/pull/2184">feat(services/gdrive): Add read &amp; write &amp; delete support for GoogleDrive</a> è¿™ä¸ª PR ä¸­åˆæ­¥å®ç°äº† Google Drive Service for OpenDALã€‚æ¥ä¸‹æ¥è¿˜æœ‰ä¸€äº›å·¥ä½œè¦åšï¼Œæ¯”å¦‚å…¶ä»– op çš„æ”¯æŒã€<code>file_path -&gt; id</code> çš„å†…éƒ¨ç¼“å­˜ç­‰ç­‰ã€‚</p><p>æš‚æ—¶å…ˆåˆ°è¿™é‡Œï¼Œåé¢æœ‰æ–°è¿›å±•å†æ¥ç€æ›´æ–°å§~~~</p>]]></content>
    
    
    <categories>
      
      <category>Rust</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¼€æº</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ·±å…¥æµ…å‡º Rustç¬”è®° Series 4</title>
    <link href="/2023/03/09/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%20Rust%E7%AC%94%E8%AE%B0%20Series%204/"/>
    <url>/2023/03/09/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%20Rust%E7%AC%94%E8%AE%B0%20Series%204/</url>
    
    <content type="html"><![CDATA[<h1 id="ç³»åˆ—å¯¼èˆª"><a class="markdownIt-Anchor" href="#ç³»åˆ—å¯¼èˆª"></a> ç³»åˆ—å¯¼èˆª</h1><ul><li><a href="https://young-flash.github.io/2023/01/30/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%20Rust%E7%AC%94%E8%AE%B0%20Series%201/">æ·±å…¥æµ…å‡º Rustç¬”è®° Series 1</a></li><li><a href="https://young-flash.github.io/2023/02/06/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%20Rust%E7%AC%94%E8%AE%B0%20Series%202/">æ·±å…¥æµ…å‡º Rustç¬”è®° Series 2</a></li><li><a href="https://young-flash.github.io/2023/03/09/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%20Rust%E7%AC%94%E8%AE%B0%20Series%203/">æ·±å…¥æµ…å‡º Rustç¬”è®° Series 3</a></li><li><a href="https://young-flash.github.io/2023/03/09/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%20Rust%E7%AC%94%E8%AE%B0%20Series%204/">æ·±å…¥æµ…å‡º Rustç¬”è®° Series 4</a></li></ul><p>è¿™æ˜¯æˆ‘åœ¨é˜…è¯»èŒƒé•¿æ˜¥çš„ã€Šæ·±å…¥æµ…å‡º Rustã€‹æ—¶åšçš„ç¬”è®°ï¼Œç»å¤§éƒ¨åˆ†å†…å®¹æºè‡ªæ­¤ä¹¦ï¼Œå¦æœ‰å°éƒ¨åˆ†å†…å®¹æºè‡ª <a href="https://course.rs/about-book.html">Rust åœ£ç»</a>ã€‚è¿™ä¸¤ä»½èµ„æ–™æ˜¯æˆ‘å…¥é—¨ Rust çš„ä¸»è¦ææ–™ã€‚</p><h1 id="ç¬¬å››éƒ¨åˆ†-çº¿ç¨‹å®‰å…¨"><a class="markdownIt-Anchor" href="#ç¬¬å››éƒ¨åˆ†-çº¿ç¨‹å®‰å…¨"></a> ç¬¬å››éƒ¨åˆ† çº¿ç¨‹å®‰å…¨</h1><h2 id="chap-27-çº¿ç¨‹å®‰å…¨"><a class="markdownIt-Anchor" href="#chap-27-çº¿ç¨‹å®‰å…¨"></a> chap 27 çº¿ç¨‹å®‰å…¨</h2><ul><li><p>std::thread API</p><ul><li><p>åˆ›å»ºçº¿ç¨‹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ–°åˆ›å»ºçš„å­çº¿ç¨‹ä¸åŸæ¥çš„çˆ¶çº¿ç¨‹æ˜¯åˆ†ç¦»çš„å…³ç³»ã€‚å­çº¿ç¨‹å¯ä»¥åœ¨çˆ¶çº¿ç¨‹ç»“æŸåç»§ç»­å­˜åœ¨ï¼Œé™¤éçˆ¶çº¿ç¨‹æ˜¯ä¸»çº¿ç¨‹ã€‚å¦‚æœä¸€ä¸ªè¿›ç¨‹çš„ä¸»çº¿ç¨‹ä¹Ÿé€€å‡ºäº†ï¼Œè¿™ä¸ªè¿›ç¨‹å°±ä¼šç»ˆæ­¢ï¼Œå…¶ä»–æ‰€æœ‰çš„çº¿ç¨‹ä¹Ÿä¼šéšä¹‹ç»“æŸã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-comment">// child çš„ç±»å‹æ˜¯ JoinHandle&lt;T&gt;ï¼Œè¿™ä¸ª T æ˜¯é—­åŒ…çš„è¿”å›ç±»å‹</span><br><span class="hljs-keyword">let</span> <span class="hljs-variable">child</span> = thread::<span class="hljs-title function_ invoke__">spawn</span>(<span class="hljs-keyword">move</span> || &#123;<br>    <span class="hljs-comment">// è¿™é‡Œæ˜¯æ–°å»ºçº¿ç¨‹çš„æ‰§è¡Œé€»è¾‘</span><br>&#125;);<br></code></pre></td></tr></table></figure></li><li><p>ç­‰å¾…å­çº¿ç¨‹æ‰§è¡Œç»“æŸ <code>.join()</code>â€‹â€‹â€‹â€‹</p></li><li><p>Builder æ¨¡å¼å¯ä¸ºå­çº¿ç¨‹æŒ‡å®šæ›´å¤šçš„å‚æ•°ä¿¡æ¯</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs rust">thread::Builder::<span class="hljs-title function_ invoke__">new</span>().<span class="hljs-title function_ invoke__">name</span>(<span class="hljs-string">&quot;child1&quot;</span>.<span class="hljs-title function_ invoke__">to_string</span>()).<span class="hljs-title function_ invoke__">spawn</span>(<span class="hljs-keyword">move</span> || &#123;<br>    <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;Hello, world!&quot;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure></li><li><p>â€‹<code>thread::sleep(dur: Duration)</code>â€‹â€‹ä½¿å¾—å½“å‰çº¿ç¨‹ç­‰å¾…ä¸€æ®µæ—¶é—´ç»§ç»­æ‰§è¡Œã€‚åœ¨ç­‰å¾…çš„æ—¶é—´å†…ï¼Œçº¿ç¨‹è°ƒåº¦å™¨ä¼šè°ƒåº¦å…¶ä»–çš„çº¿ç¨‹æ¥æ‰§è¡Œã€‚</p></li><li><p>â€‹<code>thread::current()</code>â€‹â€‹ è·å¾—å½“å‰çš„çº¿ç¨‹ã€‚</p></li><li><p>â€‹<code>thread::yield_now()</code>â€‹â€‹ æ”¾å¼ƒå½“å‰çº¿ç¨‹çš„æ‰§è¡Œï¼Œè¦æ±‚çº¿ç¨‹è°ƒåº¦å™¨æ‰§è¡Œçº¿ç¨‹åˆ‡æ¢ã€‚</p></li><li><p>â€‹<code>thread::park()</code>â€‹ æš‚åœå½“å‰çº¿ç¨‹ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚å½“ <code>thread::Thread::unpark(&amp;self:: Thread</code>â€‹ æ–¹æ³•è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œè¿™ä¸ªçº¿ç¨‹å¯ä»¥è¢«æ¢å¤æ‰§è¡Œã€‚</p></li><li><p>â€‹<code>thread::Thread::unpark(&amp;self::Thread)</code>â€‹ æ¢å¤ä¸€ä¸ªçº¿ç¨‹çš„æ‰§è¡Œ</p></li></ul></li><li><p>Rust è§„å®šä¸èƒ½åœ¨å¤šçº¿ç¨‹ä¸­ç›´æ¥è¯»å†™æ™®é€šçš„å…±äº«å˜é‡ï¼Œé™¤éä½¿ç”¨ Rust æä¾›çš„çº¿ç¨‹å®‰å…¨ç›¸å…³çš„è®¾æ–½ã€‚</p></li><li><p>â€œdata raceâ€å³æ•°æ®ç«äº‰ï¼Œæ„æ€æ˜¯åœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­ï¼Œä¸åŒçº¿ç¨‹åœ¨æ²¡æœ‰ä½¿ç”¨åŒæ­¥çš„æ¡ä»¶ä¸‹å¹¶è¡Œè®¿é—®åŒä¸€å—æ•°æ®ï¼Œä¸”å…¶ä¸­è‡³å°‘æœ‰ä¸€ä¸ªæ˜¯å†™æ“ä½œçš„æƒ…å†µã€‚</p><ul><li><p>æ•°æ®ç«äº‰çš„å‘ç”Ÿéœ€è¦ä¸‰ä¸ªæ¡ä»¶ï¼šæ•°æ®å…±äº«â€”â€”æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä¸€ä»½æ•°æ®ï¼›æ•°æ®ä¿®æ”¹â€”â€”è‡³å°‘å­˜åœ¨ä¸€ä¸ªçº¿ç¨‹å¯¹æ•°æ®åšä¿®æ”¹ï¼›æ²¡æœ‰åŒæ­¥â€”â€”è‡³å°‘å­˜åœ¨ä¸€ä¸ªçº¿ç¨‹å¯¹æ•°æ®çš„è®¿é—®æ²¡æœ‰ä½¿ç”¨åŒæ­¥æªæ–½ã€‚</p></li><li><p>åªè¦è®©è¿™ä¸‰ä¸ªæ¡ä»¶æ— æ³•åŒæ—¶å‘ç”Ÿå³å¯é¿å…ç«æ€æ¡ä»¶</p><ul><li>å¯ä»¥ç¦æ­¢æ•°æ®å…±äº«ï¼Œæ¯”å¦‚ actor-based concurrencyï¼Œå¤šçº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ä»…é å‘é€æ¶ˆæ¯æ¥å®ç°ï¼Œè€Œä¸æ˜¯é€šè¿‡å…±äº«æ•°æ®æ¥å®ç°ï¼›</li><li>å¯ä»¥ç¦æ­¢æ•°æ®ä¿®æ”¹ï¼Œæ¯”å¦‚ functional programmingï¼Œè®¸å¤šå‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ä¸¥æ ¼é™åˆ¶äº†æ•°æ®çš„å¯å˜æ€§ï¼Œè€Œå¯¹å…±äº«æ€§æ²¡æœ‰é™åˆ¶ã€‚</li></ul></li><li><p>Rust å…è®¸å­˜åœ¨å¯å˜å˜é‡ï¼Œå…è®¸å­˜åœ¨çŠ¶æ€å…±äº«ï¼ŒåŒæ—¶ä¹Ÿåšåˆ°äº†å®Œæ•´æ— é—æ¼çš„çº¿ç¨‹å®‰å…¨æ£€æŸ¥ã€‚å› ä¸º Rust è®¾è®¡çš„ä¸€ä¸ªæ ¸å¿ƒæ€æƒ³å°±æ˜¯â€œ<strong>å…±äº«ä¸å¯å˜ï¼Œå¯å˜ä¸å…±äº«</strong>â€ï¼Œç„¶åå†åŠ ä¸Šç±»å‹ç³»ç»Ÿå’Œåˆç†çš„ API è®¾è®¡ï¼Œå°±å¯ä»¥ä¿è¯å…±äº«æ•°æ®åœ¨è®¿é—®æ—¶ä¸€å®šä½¿ç”¨äº†åŒæ­¥æªæ–½ã€‚Rust æ—¢å¯ä»¥æ”¯æŒå¤šçº¿ç¨‹æ•°æ®å…±äº«çš„é£æ ¼ï¼Œä¹Ÿå¯ä»¥æ”¯æŒæ¶ˆæ¯é€šä¿¡çš„é£æ ¼ã€‚æ— è®ºé€‰æ‹©å“ªç§æ–¹æ¡ˆï¼Œç¼–è¯‘å™¨éƒ½èƒ½ä¿è¯æ²¡æœ‰æ•°æ®ç«äº‰ã€‚</p></li></ul></li><li><p>Rust çº¿ç¨‹å®‰å…¨èƒŒåçš„åŠŸè‡£æ˜¯ä¸¤ä¸ªç‰¹æ®Šçš„ traitï¼š<code>std::marker::Sync</code>â€‹ï¼ˆå¦‚æœç±»å‹ T å®ç°äº† Sync ç±»å‹ï¼Œé‚£è¯´æ˜åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­ä½¿ç”¨&amp;T è®¿é—®åŒä¸€ä¸ªå˜é‡æ˜¯å®‰å…¨çš„ï¼‰ï¼›<code>std::marker::Send</code>â€‹ï¼ˆå¦‚æœç±»å‹ T å®ç°äº† Send ç±»å‹ï¼Œé‚£è¯´æ˜è¿™ä¸ªç±»å‹çš„å˜é‡åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­ä¼ é€’æ‰€æœ‰æƒæ˜¯å®‰å…¨çš„ï¼‰ã€‚<strong>Rust ä¸­æ‰€æœ‰è·Ÿå¤šçº¿ç¨‹æœ‰å…³çš„ APIï¼Œä¼šæ ¹æ®æƒ…å†µï¼Œè¦æ±‚ç±»å‹å¿…é¡»æ»¡è¶³ Sync æˆ–è€… Send çš„çº¦æŸã€‚</strong></p></li></ul><h2 id="chap-28-è¯¦è§£-send-å’Œ-sync"><a class="markdownIt-Anchor" href="#chap-28-è¯¦è§£-send-å’Œ-sync"></a> chap 28 è¯¦è§£ Send å’Œ Sync</h2><h2 id="chap-29-çŠ¶æ€å…±äº«"><a class="markdownIt-Anchor" href="#chap-29-çŠ¶æ€å…±äº«"></a> chap 29 çŠ¶æ€å…±äº«</h2><h2 id="chap-30-ç®¡é“"><a class="markdownIt-Anchor" href="#chap-30-ç®¡é“"></a> chap 30 ç®¡é“</h2><ul><li><p>å¼‚æ­¥ç®¡é“ <code>std::sync::mpsc::channel</code>â€‹ï¼šå‘é€ç«¯å’Œæ¥æ”¶ç«¯ä¹‹é—´å­˜åœ¨ä¸€ä¸ªç¼“å†²åŒºï¼ˆä¸é™é•¿åº¦çš„ç¼“å†²åŒºï¼Œå¯ä»¥ä¸€ç›´å¾€é‡Œé¢å¡«å……æ•°æ®ï¼Œç›´è‡³å†…å­˜èµ„æºè€—å°½ã€‚ï¼‰ï¼Œå‘é€ç«¯å‘é€æ•°æ®çš„æ—¶å€™ï¼Œæ˜¯å…ˆå°†è¿™ä¸ªæ•°æ®æ‰”åˆ°ç¼“å†²åŒºï¼Œå†ç”±æ¥æ”¶ç«¯è‡ªå·±å»å–ã€‚å› æ­¤ï¼Œæ¯æ¬¡å‘é€ï¼Œç«‹é©¬å°±è¿”å›äº†ï¼Œå‘é€ç«¯ä¸ç”¨ç®¡æ•°æ®ä»€ä¹ˆæ—¶å€™è¢«æ¥æ”¶ç«¯å¤„ç†ã€‚æ¥å£ï¼š<code>pub fn channel&lt;T&gt;() -&gt; (Sender&lt;T&gt;, Receiver&lt;T&gt;)</code>â€‹</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">use</span> std::sync::mpsc::channel;<br><span class="hljs-keyword">use</span> std::thread;<br><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() &#123;<br>    <span class="hljs-keyword">let</span> (tx, rx) = <span class="hljs-title function_ invoke__">channel</span>();<br>    <span class="hljs-keyword">for</span> <span class="hljs-variable">i</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0</span>..<span class="hljs-number">10</span> &#123;<br>        <span class="hljs-keyword">let</span> <span class="hljs-variable">tx</span> = tx.<span class="hljs-title function_ invoke__">clone</span>(); <span class="hljs-comment">// å¤åˆ¶ä¸€ä¸ªæ–°çš„ tx,å°†è¿™ä¸ªå¤åˆ¶çš„å˜é‡ move è¿›å…¥å­çº¿ç¨‹</span><br>        thread::<span class="hljs-title function_ invoke__">spawn</span>(<span class="hljs-keyword">move</span> || &#123;<br>            tx.<span class="hljs-title function_ invoke__">send</span>(i).<span class="hljs-title function_ invoke__">unwrap</span>();<br>        &#125;);<br>    &#125;<br>    <span class="hljs-title function_ invoke__">drop</span>(tx);<br>    <span class="hljs-keyword">while</span> <span class="hljs-keyword">let</span> <span class="hljs-variable">Ok</span>(r) = rx.<span class="hljs-title function_ invoke__">recv</span>() &#123;<br>        <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;received &#123;&#125;&quot;</span>, r);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><p>Sender å’Œ Receiver çš„æ³›å‹å‚æ•°å¿…é¡»æ»¡è¶³ T: Send çº¦æŸã€‚è¿™ä¸ªæ¡ä»¶æ˜¯æ˜¾è€Œæ˜“è§çš„ï¼šè¢«å‘é€çš„æ¶ˆæ¯ä¼šä»ä¸€ä¸ªçº¿ç¨‹è½¬ç§»åˆ°å¦å¤–ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™ä¸ªçº¦æŸæ˜¯ä¸ºäº†æ»¡è¶³çº¿ç¨‹å®‰å…¨ã€‚å¦‚æœç”¨æˆ·æŒ‡å®šçš„æ³›å‹å‚æ•°æ²¡æœ‰æ»¡è¶³æ¡ä»¶ï¼Œåœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šå‘ç”Ÿé”™è¯¯ã€‚</p></li><li><p>å‘é€è€…è°ƒç”¨ send æ–¹æ³•ï¼Œæ¥æ”¶è€…è°ƒç”¨ recv æ–¹æ³•ï¼Œè¿”å›ç±»å‹éƒ½æ˜¯ Result ç±»å‹ï¼Œç”¨äºé”™è¯¯å¤„ç†ï¼Œå› ä¸ºå®ƒä»¬éƒ½æœ‰å¯èƒ½è°ƒç”¨å¤±è´¥ã€‚<strong>å½“å‘é€è€…å·²ç»è¢«é”€æ¯çš„æ—¶å€™ï¼Œæ¥æ”¶è€…è°ƒç”¨ recv åˆ™ä¼šè¿”å›é”™è¯¯ï¼›åŒæ ·ï¼Œå½“æ¥æ”¶è€…å·²ç»é”€æ¯çš„æ—¶å€™ï¼Œå‘é€è€…è°ƒç”¨ send ä¹Ÿä¼šè¿”å›é”™è¯¯ã€‚</strong></p></li><li><p>ç®¡é“è¿˜å¯ä»¥æ˜¯å¤šå‘é€ç«¯å•æ¥æ”¶ç«¯ã€‚åšæ³•å¾ˆç®€å•ï¼Œåªéœ€å°†å‘é€ç«¯ Sender å¤åˆ¶å¤šä»½å³å¯ã€‚å¤åˆ¶æ–¹å¼æ˜¯è°ƒç”¨ Sender ç±»å‹çš„ clone() æ–¹æ³•ã€‚è¿™ä¸ªåº“ä¸æ”¯æŒå¤šæ¥æ”¶ç«¯çš„è®¾è®¡ï¼Œå› æ­¤ Receiver ç±»å‹æ²¡æœ‰ clone() æ–¹æ³•ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">use</span> std::thread;<br><span class="hljs-keyword">use</span> std::sync::mpsc::channel;<br><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() &#123;<br>    <span class="hljs-keyword">let</span> (tx, rx) = <span class="hljs-title function_ invoke__">channel</span>();<br>    <span class="hljs-keyword">for</span> <span class="hljs-variable">i</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0</span>..<span class="hljs-number">10</span> &#123;<br>        <span class="hljs-comment">// å¤åˆ¶ä¸€ä¸ªæ–°çš„ tx,å°†è¿™ä¸ªå¤åˆ¶çš„å˜é‡ move è¿›å…¥å­çº¿ç¨‹</span><br>        <span class="hljs-keyword">let</span> <span class="hljs-variable">tx</span> = tx.<span class="hljs-title function_ invoke__">clone</span>();<br>        thread::<span class="hljs-title function_ invoke__">spawn</span>(<span class="hljs-keyword">move</span>|| &#123;<br>            tx.<span class="hljs-title function_ invoke__">send</span>(i).<span class="hljs-title function_ invoke__">unwrap</span>();<br>        &#125;);<br>    &#125;<br>    <span class="hljs-comment">// å¦‚æœæ²¡æœ‰æ‰‹åŠ¨ drop æ‰ sender åˆ™ç¨‹åºæ°¸è¿œä¸ä¼šåœæ­¢</span><br>    <span class="hljs-title function_ invoke__">drop</span>(tx);<br>    <span class="hljs-keyword">while</span> <span class="hljs-keyword">let</span> <span class="hljs-variable">Ok</span>(r) = rx.<span class="hljs-title function_ invoke__">recv</span>() &#123;<br>        <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;received &#123;&#125;&quot;</span>, r);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul></li><li><p>åŒæ­¥ç®¡é“ <code>std::sync::mpsc::sync_channel</code>â€‹ï¼šå…¶å†…éƒ¨æœ‰ä¸€ä¸ªå›ºå®šå¤§å°çš„ç¼“å†²åŒºï¼Œç”¨æ¥ç¼“å­˜æ¶ˆæ¯ã€‚å¦‚æœç¼“å†²åŒºè¢«å¡«æ»¡äº†ï¼Œç»§ç»­è°ƒç”¨ send æ–¹æ³•çš„æ—¶å€™ä¼šå‘ç”Ÿé˜»å¡ï¼Œç­‰å¾…æ¥æ”¶ç«¯æŠŠç¼“å†²åŒºå†…çš„æ¶ˆæ¯æ‹¿èµ°æ‰èƒ½ç»§ç»­å‘é€ã€‚ç¼“å†²åŒºçš„é•¿åº¦å¯ä»¥åœ¨å»ºç«‹ç®¡é“çš„æ—¶å€™è®¾ç½®ï¼Œè€Œä¸” 0 æ˜¯æœ‰æ•ˆæ•°å€¼ã€‚å¦‚æœç¼“å†²åŒºçš„é•¿åº¦è®¾ç½®ä¸º 0ï¼Œé‚£å°±æ„å‘³ç€æ¯æ¬¡çš„å‘é€æ“ä½œéƒ½ä¼šè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°è¿™ä¸ªæ¶ˆæ¯è¢«æ¥æ”¶ç«¯å–èµ°æ‰èƒ½è¿”å›ã€‚</p></li></ul><p>â€</p>]]></content>
    
    
    <categories>
      
      <category>Rust</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>æ·±å…¥æµ…å‡º Rustç¬”è®° Series 3</title>
    <link href="/2023/03/09/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%20Rust%E7%AC%94%E8%AE%B0%20Series%203/"/>
    <url>/2023/03/09/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%20Rust%E7%AC%94%E8%AE%B0%20Series%203/</url>
    
    <content type="html"><![CDATA[<h1 id="ç³»åˆ—å¯¼èˆª"><a class="markdownIt-Anchor" href="#ç³»åˆ—å¯¼èˆª"></a> ç³»åˆ—å¯¼èˆª</h1><ul><li><a href="https://young-flash.github.io/2023/01/30/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%20Rust%E7%AC%94%E8%AE%B0%20Series%201/">æ·±å…¥æµ…å‡º Rustç¬”è®° Series 1</a></li><li><a href="https://young-flash.github.io/2023/02/06/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%20Rust%E7%AC%94%E8%AE%B0%20Series%202/">æ·±å…¥æµ…å‡º Rustç¬”è®° Series 2</a></li><li><a href="https://young-flash.github.io/2023/03/09/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%20Rust%E7%AC%94%E8%AE%B0%20Series%203/">æ·±å…¥æµ…å‡º Rustç¬”è®° Series 3</a></li><li><a href="https://young-flash.github.io/2023/03/09/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%20Rust%E7%AC%94%E8%AE%B0%20Series%204/">æ·±å…¥æµ…å‡º Rustç¬”è®° Series 4</a></li></ul><p>è¿™æ˜¯æˆ‘åœ¨é˜…è¯»èŒƒé•¿æ˜¥çš„ã€Šæ·±å…¥æµ…å‡º Rustã€‹æ—¶åšçš„ç¬”è®°ï¼Œç»å¤§éƒ¨åˆ†å†…å®¹æºè‡ªæ­¤ä¹¦ï¼Œå¦æœ‰å°éƒ¨åˆ†å†…å®¹æºè‡ª <a href="https://course.rs/about-book.html">Rust åœ£ç»</a>ã€‚è¿™ä¸¤ä»½èµ„æ–™æ˜¯æˆ‘å…¥é—¨ Rust çš„ä¸»è¦ææ–™ã€‚</p><h1 id="ç¬¬ä¸‰éƒ¨åˆ†-é«˜çº§æŠ½è±¡"><a class="markdownIt-Anchor" href="#ç¬¬ä¸‰éƒ¨åˆ†-é«˜çº§æŠ½è±¡"></a> ç¬¬ä¸‰éƒ¨åˆ† é«˜çº§æŠ½è±¡</h1><h2 id="chap-22-é—­åŒ…"><a class="markdownIt-Anchor" href="#chap-22-é—­åŒ…"></a> chap 22 é—­åŒ…</h2><ul><li><p>é—­åŒ…ï¼ˆclosureï¼‰æ˜¯ä¸€ç§åŒ¿åå‡½æ•°ï¼Œå…·æœ‰â€œæ•è·â€å¤–éƒ¨å˜é‡çš„èƒ½åŠ›ã€‚é—­åŒ…æœ‰æ—¶å€™ä¹Ÿè¢«ç§°ä½œ lambda è¡¨è¾¾å¼ã€‚å®ƒæœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼šï¼ˆ1ï¼‰å¯ä»¥åƒå‡½æ•°ä¸€æ ·è¢«è°ƒç”¨ï¼›ï¼ˆ2ï¼‰å¯ä»¥æ•è·å½“å‰ç¯å¢ƒä¸­çš„å˜é‡ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() &#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">add</span> = | a :<span class="hljs-type">i32</span>, b:<span class="hljs-type">i32</span> | <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">i32</span> &#123; <span class="hljs-keyword">return</span> a + b; &#125; ;<br>    <span class="hljs-comment">// é—­åŒ…çš„å‚æ•°å’Œè¿”å›å€¼ç±»å‹éƒ½æ˜¯å¯ä»¥çœç•¥çš„</span><br>    <span class="hljs-comment">// let add = |a, b| &#123; a + b &#125;;</span><br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">x</span> = <span class="hljs-title function_ invoke__">add</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>);<br>    <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;result is &#123;&#125;&quot;</span>, x);<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>å˜é‡æ•è·ï¼šclosure çš„åŸç†ä¸ C++11 çš„ lambda éå¸¸ç›¸ä¼¼ã€‚å½“ä¸€ä¸ª closure åˆ›å»ºçš„æ—¶å€™ï¼Œç¼–è¯‘å™¨å¸®æˆ‘ä»¬ç”Ÿæˆäº†ä¸€ä¸ªåŒ¿å struct ç±»å‹ï¼Œé€šè¿‡è‡ªåŠ¨åˆ†æ closure çš„å†…éƒ¨é€»è¾‘ï¼Œæ¥å†³å®šè¯¥ç»“æ„ä½“åŒ…æ‹¬å“ªäº›æ•°æ®ï¼Œä»¥åŠè¿™äº›æ•°æ®è¯¥å¦‚ä½•åˆå§‹åŒ–ã€‚</p><ul><li>åœ¨ä¿è¯èƒ½ç¼–è¯‘é€šè¿‡çš„æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨é€‰æ‹©ä¸€ç§å¯¹å¤–éƒ¨å½±å“æœ€å°çš„ç±»å‹å­˜å‚¨ã€‚å¯¹äºè¢«æ•è·çš„ç±»å‹ä¸º T çš„å¤–éƒ¨å˜é‡ï¼Œåœ¨åŒ¿åç»“æ„ä½“ä¸­çš„å­˜å‚¨æ–¹å¼é€‰æ‹©ä¸ºï¼šå°½å¯èƒ½å…ˆé€‰æ‹©&amp;T ç±»å‹ï¼Œå…¶æ¬¡é€‰æ‹©&amp;mut T ç±»å‹ï¼Œæœ€åé€‰æ‹© T ç±»å‹ã€‚</li></ul></li><li><p>move å…³é”®å­—ï¼šé—­åŒ…å‰åŠ ä¸Š move å…³é”®å­—ï¼Œæ‰€æœ‰çš„å˜é‡æ•è·å…¨éƒ¨ä½¿ç”¨ by value çš„æ–¹å¼ï¼Œæ‰€æœ‰è¢«æ•è·çš„å¤–éƒ¨å˜é‡æ‰€æœ‰æƒä¸€å¾‹è½¬ç§»è¿›é—­åŒ…ã€‚ä¸€èˆ¬ç”¨äºé—­åŒ…éœ€è¦ä¼ é€’åˆ°å‡½æ•°å¤–éƒ¨ï¼ˆescaping closureï¼‰çš„æƒ…å†µã€‚</p></li><li><p>Fn/FnMut/FnOnceï¼šé—­åŒ…è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œä¸éœ€è¦æ‰§è¡ŒæŸä¸ªæˆå‘˜å‡½æ•°ï¼Œè€Œæ˜¯é‡‡ç”¨ç±»ä¼¼å‡½æ•°è°ƒç”¨çš„è¯­æ³•æ¥æ‰§è¡Œã€‚è¿™æ˜¯å› ä¸ºå®ƒè‡ªåŠ¨å®ç°äº†ç¼–è¯‘å™¨æä¾›çš„å‡ ä¸ªç‰¹æ®Šçš„ traitï¼ŒFn æˆ–è€… FnMut æˆ–è€… FnOnceã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">pub</span> <span class="hljs-keyword">trait</span> <span class="hljs-title class_">FnOnce</span>&lt;Args&gt; &#123;<br>    <span class="hljs-keyword">type</span> <span class="hljs-title class_">Output</span>;<br>    <span class="hljs-keyword">extern</span> <span class="hljs-string">&quot;rust-call&quot;</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">call_once</span>(<span class="hljs-keyword">self</span>, args: Args) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span>::Output;<br>&#125;<br><br><span class="hljs-keyword">pub</span> <span class="hljs-keyword">trait</span> <span class="hljs-title class_">FnMut</span>&lt;Args&gt; : <span class="hljs-built_in">FnOnce</span>&lt;Args&gt; &#123;<br>    <span class="hljs-keyword">extern</span> <span class="hljs-string">&quot;rust-call&quot;</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">call_mut</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, args: Args) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span>::Output;<br>&#125;<br><br><span class="hljs-keyword">pub</span> <span class="hljs-keyword">trait</span> <span class="hljs-title class_">Fn</span>&lt;Args&gt; : <span class="hljs-built_in">FnMut</span>&lt;Args&gt; &#123;<br>    <span class="hljs-keyword">extern</span> <span class="hljs-string">&quot;rust-call&quot;</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">call</span>(&amp;<span class="hljs-keyword">self</span>, args: Args) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span>::Output;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™å‡ ä¸ª trait çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼Œè¢«è°ƒç”¨çš„æ—¶å€™ self å‚æ•°çš„ç±»å‹ã€‚FnOnce è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œself æ˜¯é€šè¿‡ move çš„æ–¹å¼ä¼ é€’çš„ï¼Œå› æ­¤å®ƒè¢«è°ƒç”¨ä¹‹åï¼Œè¿™ä¸ªé—­åŒ…çš„ç”Ÿå‘½å‘¨æœŸå°±å·²ç»ç»“æŸäº†ï¼Œå®ƒåªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡ï¼›FnMut è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œself æ˜¯&amp;mut Self ç±»å‹ï¼Œæœ‰èƒ½åŠ›ä¿®æ”¹å½“å‰é—­åŒ…æœ¬èº«çš„æˆå‘˜ï¼Œç”šè‡³å¯èƒ½é€šè¿‡æˆå‘˜ä¸­çš„å¼•ç”¨ï¼Œä¿®æ”¹å¤–éƒ¨çš„ç¯å¢ƒå˜é‡ï¼›Fn è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œself æ˜¯&amp;Self ç±»å‹ï¼Œåªæœ‰è¯»å–ç¯å¢ƒå˜é‡çš„èƒ½åŠ›ã€‚</p><ul><li>å¯¹äºä¸€ä¸ªé—­åŒ…ï¼Œç¼–è¯‘å™¨æ˜¯å¦‚ä½•é€‰æ‹© impl å“ªä¸ª trait å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼Œç¼–è¯‘å™¨ä¼šéƒ½å°è¯•ä¸€éï¼Œå®ç°èƒ½è®©ç¨‹åºç¼–è¯‘é€šè¿‡çš„é‚£å‡ ä¸ªã€‚é—­åŒ…è°ƒç”¨çš„æ—¶å€™ï¼Œä¼šå°½å¯èƒ½å…ˆé€‰æ‹©è°ƒç”¨ â€‹<code>fn call(&amp;selfï¼Œargsï¼šArgs)</code>å‡½æ•°ï¼Œå…¶æ¬¡å°è¯•é€‰æ‹© <code>fn call_mut(&amp;selfï¼Œargsï¼šArgs)</code>â€‹â€‹â€‹ å‡½æ•°ï¼Œæœ€åå°è¯•ä½¿ç”¨ â€‹<code>fn call_once(selfï¼Œargsï¼šArgs) â€‹</code>å‡½æ•°ã€‚</li><li><a href="https://stackoverflow.com/questions/42859330/how-do-i-make-a-struct-callable">ä¸ºè‡ªå®šä¹‰ç±»å‹å®ç° Fn trait</a> è¦ä½¿ç”¨ nightly ç‰ˆæœ¬çš„ Rust</li></ul></li><li><p>æ¯ä¸ªé—­åŒ…ï¼Œç¼–è¯‘å™¨éƒ½ä¼šä¸ºå®ƒç”Ÿæˆä¸€ä¸ªåŒ¿åç»“æ„ä½“ç±»å‹ï¼›å³ä½¿ä¸¤ä¸ªé—­åŒ…çš„å‚æ•°å’Œè¿”å›å€¼ä¸€è‡´ï¼Œå®ƒä»¬ä¹Ÿæ˜¯å®Œå…¨ä¸åŒçš„ä¸¤ä¸ªç±»å‹ï¼Œåªæ˜¯éƒ½å®ç°äº†åŒä¸€ä¸ª trait è€Œå·²ã€‚</p></li><li><p>é—­åŒ…ä¸æ³›å‹çº¦æŸ</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">call_with_closure</span>&lt;F&gt;(some_closure: F) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">i32</span><br>    <span class="hljs-keyword">where</span> F : <span class="hljs-title function_ invoke__">Fn</span>(<span class="hljs-type">i32</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">i32</span> &#123;<br>    <span class="hljs-title function_ invoke__">some_closure</span>(<span class="hljs-number">1</span>)<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>å…¶ä¸­æ³›å‹å‚æ•° F çš„çº¦æŸæ¡ä»¶æ˜¯ Fï¼šFnï¼ˆi32ï¼‰-&gt;i32ã€‚è¿™é‡Œ Fnï¼ˆi32ï¼‰-&gt; i32 æ˜¯é’ˆå¯¹é—­åŒ…è®¾è®¡çš„ä¸“é—¨çš„è¯­æ³•ï¼Œè€Œä¸æ˜¯åƒæ™®é€š trait é‚£æ ·ä½¿ç”¨ Fn&lt;i32ï¼Œi32&gt; æ¥å†™ã€‚è¿™æ ·è®¾è®¡ä¸ºäº†è®©å®ƒä»¬çœ‹èµ·æ¥è·Ÿæ™®é€šå‡½æ•°ç±»å‹ fnï¼ˆi32ï¼‰-&gt;i32 æ›´ç›¸ä¼¼ã€‚é™¤äº†è¯­æ³•ä¹‹å¤–ï¼ŒFn FnMut FnOnce å…¶ä»–æ–¹é¢éƒ½è·Ÿæ™®é€šçš„æ³›å‹ä¸€è‡´ã€‚</li></ul></li><li><p>å‘å‡½æ•°ä¸­ä¼ é€’é—­åŒ…çš„ä¸¤ç§æ–¹å¼ï¼ˆé—­åŒ…ä½œä¸ºå‡½æ•°å‚æ•°ï¼‰</p><ul><li><p>é€šè¿‡æ³›å‹çš„æ–¹å¼ã€‚è¿™ç§æ–¹å¼ä¼šä¸ºä¸åŒçš„é—­åŒ…å‚æ•°ç±»å‹ç”Ÿæˆä¸åŒç‰ˆæœ¬çš„å‡½æ•°ï¼Œå®ç°é™æ€åˆ†æ´¾ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-comment">// è¿™é‡Œæ˜¯æ³›å‹å‚æ•°ã€‚å¯¹äºæ¯ä¸ªä¸åŒç±»å‹çš„å‚æ•°,ç¼–è¯‘å™¨å°†ä¼šç”Ÿæˆä¸åŒç‰ˆæœ¬çš„å‡½æ•°</span><br><span class="hljs-keyword">fn</span> <span class="hljs-title function_">static_dispatch</span>&lt;F&gt;(closure: &amp;F)<br>    <span class="hljs-keyword">where</span> F: <span class="hljs-title function_ invoke__">Fn</span>(<span class="hljs-type">i32</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">i32</span><br>&#123;<br>    <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;static dispatch &#123;&#125;&quot;</span>, <span class="hljs-title function_ invoke__">closure</span>(<span class="hljs-number">42</span>));<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>é€šè¿‡ trait object çš„æ–¹å¼ã€‚è¿™ç§æ–¹å¼ä¼šå°†é—­åŒ…è£…ç®±è¿›å…¥å †å†…å­˜ä¸­ï¼Œå‘å‡½æ•°ä¼ é€’ä¸€ä¸ªèƒ–æŒ‡é’ˆï¼Œå®ç°è¿è¡ŒæœŸåŠ¨æ€åˆ†æ´¾ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-comment">// è¿™é‡Œæ˜¯ `trait object``Box&lt;Fn(i32)-&gt;i32&gt;`ä¹Ÿç®—`trait object`</span><br><span class="hljs-keyword">fn</span> <span class="hljs-title function_">dynamic_dispatch</span>(closure: &amp;<span class="hljs-title function_ invoke__">Fn</span>(<span class="hljs-type">i32</span>)<span class="hljs-punctuation">-&gt;</span><span class="hljs-type">i32</span>)<br>&#123;<br><span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;dynamic dispatch &#123;&#125;&quot;</span>, <span class="hljs-title function_ invoke__">closure</span>(<span class="hljs-number">42</span>));<br>&#125;<br></code></pre></td></tr></table></figure></li></ul></li><li><p>é—­åŒ…ä½œä¸ºå‡½æ•°çš„è¿”å›å€¼</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs rust"><br><span class="hljs-comment">// å¦‚æœæˆ‘ä»¬å¸Œæœ›ä¸€ä¸ªé—­åŒ…ä½œä¸ºå‡½æ•°çš„è¿”å›å€¼ï¼Œé‚£ä¹ˆå°±ä¸èƒ½ä½¿ç”¨æ³›å‹çš„æ–¹å¼</span><br><span class="hljs-comment">// äº†ã€‚å› ä¸ºå¦‚æœæ³›å‹ç±»å‹ä¸åœ¨å‚æ•°ä¸­å‡ºç°ï¼Œè€Œä»…åœ¨è¿”å›ç±»å‹ä¸­å‡ºç°çš„è¯ï¼Œä¼šè¦</span><br><span class="hljs-comment">// æ±‚åœ¨è°ƒç”¨çš„æ—¶å€™æ˜¾å¼æŒ‡å®šç±»å‹ï¼Œç¼–è¯‘å™¨æ‰èƒ½å®Œæˆç±»å‹æ¨å¯¼ã€‚å¯æ˜¯è°ƒç”¨æ–¹æ ¹æœ¬</span><br><span class="hljs-comment">// æ— æ³•æŒ‡å®šå…·ä½“ç±»å‹ï¼Œå› ä¸ºé—­åŒ…ç±»å‹æ˜¯åŒ¿åç±»å‹ï¼Œç”¨æˆ·æ— æ³•æ˜¾å¼æŒ‡å®šã€‚æ‰€ä»¥ä¸‹</span><br><span class="hljs-comment">// é¢è¿™æ ·çš„å†™æ³•æ˜¯ç¼–è¯‘ä¸è¿‡çš„ï¼š</span><br><br><span class="hljs-keyword">fn</span> <span class="hljs-title function_">test</span>&lt;F&gt;() <span class="hljs-punctuation">-&gt;</span> F<br><span class="hljs-keyword">where</span> F: <span class="hljs-title function_ invoke__">Fn</span>(<span class="hljs-type">i32</span>)<span class="hljs-punctuation">-&gt;</span><span class="hljs-type">i32</span><br>&#123;<br>    <span class="hljs-keyword">return</span> | i | i * <span class="hljs-number">2</span>;<br>&#125;<br><br><span class="hljs-comment">// ä½†ä¸‹é¢è¿™ç§æ˜¯å¯ä»¥çš„</span><br><span class="hljs-keyword">fn</span> <span class="hljs-title function_">test</span>&lt;F&gt;(arg: F) <span class="hljs-punctuation">-&gt;</span> F<br>    <span class="hljs-keyword">where</span> F: <span class="hljs-built_in">Copy</span><br>&#123;<br>    arg<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>é™æ€åˆ†æ´¾ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ç§æ–°çš„è¯­æ³• <code>fn test() -&gt; impl Fnï¼ˆi32ï¼‰-&gt; i32</code>â€‹ æ¥å®ç°ã€‚</li><li>åŠ¨æ€åˆ†æ´¾ã€‚å°±æ˜¯æŠŠé—­åŒ…è£…ç®±è¿›å…¥å †å†…å­˜ä¸­ï¼Œä½¿ç”¨ <code>Box&lt;dyn Fn(i32) -&gt; i32&gt;</code>â€‹ è¿™ç§ trait object ç±»å‹è¿”å›</li></ul></li></ul><h2 id="chap-23-åŠ¨æ€åˆ†æ´¾å’Œé™æ€åˆ†æ´¾"><a class="markdownIt-Anchor" href="#chap-23-åŠ¨æ€åˆ†æ´¾å’Œé™æ€åˆ†æ´¾"></a> chap 23 åŠ¨æ€åˆ†æ´¾å’Œé™æ€åˆ†æ´¾</h2><ul><li><p>Rust å¯ä»¥åŒæ—¶æ”¯æŒâ€œé™æ€åˆ†æ´¾â€ï¼ˆstatic dispatchï¼‰å’Œâ€œåŠ¨æ€åˆ†æ´¾â€ï¼ˆdynamic dispatchï¼‰ã€‚æ‰€è°“â€œé™æ€åˆ†æ´¾â€ï¼Œæ˜¯æŒ‡å…·ä½“è°ƒç”¨å“ªä¸ªå‡½æ•°ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µå°±ç¡®å®šä¸‹æ¥äº†ã€‚Rust ä¸­çš„â€œé™æ€åˆ†æ´¾â€é æ³›å‹ä»¥åŠ impl trait æ¥å®Œæˆã€‚å¯¹äºä¸åŒçš„æ³›å‹ç±»å‹å‚æ•°ï¼Œç¼–è¯‘å™¨ä¼šç”Ÿæˆä¸åŒç‰ˆæœ¬çš„å‡½æ•°ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µå°±ç¡®å®šå¥½äº†åº”è¯¥è°ƒç”¨å“ªä¸ªå‡½æ•°ã€‚æ‰€è°“â€œåŠ¨æ€åˆ†æ´¾â€ï¼Œæ˜¯æŒ‡å…·ä½“è°ƒç”¨å“ªä¸ªå‡½æ•°ï¼Œåœ¨æ‰§è¡Œé˜¶æ®µæ‰èƒ½ç¡®å®šã€‚Rust ä¸­çš„â€œåŠ¨æ€åˆ†æ´¾â€é  Trait Object æ¥å®Œæˆã€‚Trait Object æœ¬è´¨ä¸Šæ˜¯æŒ‡é’ˆï¼Œå®ƒå¯ä»¥æŒ‡å‘ä¸åŒçš„ç±»å‹ï¼›æŒ‡å‘çš„å…·ä½“ç±»å‹ä¸åŒï¼Œè°ƒç”¨çš„æ–¹æ³•ä¹Ÿå°±ä¸åŒã€‚</p></li><li><p>Traitobjectï¼šå‘ Trait çš„æŒ‡é’ˆã€‚&amp;dyn Traitã€&amp;mut dyn Traitã€Box<dyn Trait>ã€const dyn Trait*ã€*mut dyn Trait ä»¥åŠ Rc<dyn Trait> ç­‰ç­‰éƒ½æ˜¯ Trait Objectã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">pub</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">TraitObject</span> &#123;<br>    <span class="hljs-keyword">pub</span> data: *<span class="hljs-title function_ invoke__">mut</span> (),<br>    <span class="hljs-keyword">pub</span> vtable: *<span class="hljs-title function_ invoke__">mut</span> (),<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>è‡ªå·±åœ¨æƒ³ï¼šTrait Object ä¸­æŒ‡å‘å®é™…æ•°æ®çš„æŒ‡é’ˆæœ‰ä»€ä¹ˆç”¨ï¼Ÿ<br />answerï¼šè®¿é—® trait ä¸­æ–¹æ³•çš„ self å‚æ•°</li><li>Rust çš„åŠ¨æ€åˆ†æ´¾å’Œ C++ çš„åŠ¨æ€åˆ†æ´¾ï¼Œå†…å­˜å¸ƒå±€æœ‰æ‰€ä¸åŒã€‚åœ¨ C++ é‡Œï¼Œå¦‚æœä¸€ä¸ªç±»å‹é‡Œé¢æœ‰è™šå‡½æ•°ï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ªè¿™ç§ç±»å‹çš„å˜é‡å†…éƒ¨éƒ½åŒ…å«ä¸€ä¸ªæŒ‡å‘è™šå‡½æ•°è¡¨çš„åœ°å€ã€‚è€Œåœ¨ Rust é‡Œé¢ï¼Œå¯¹è±¡æœ¬èº«ä¸åŒ…å«æŒ‡å‘è™šå‡½æ•°è¡¨çš„æŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆæ˜¯å­˜åœ¨äº trait object æŒ‡é’ˆé‡Œé¢çš„ã€‚å¦‚æœä¸€ä¸ªç±»å‹å®ç°äº†å¤šä¸ª traitï¼Œé‚£ä¹ˆä¸åŒçš„ trait object æŒ‡å‘çš„è™šå‡½æ•°è¡¨ä¹Ÿä¸ä¸€æ ·ã€‚</li></ul></li><li><p>object safeã€‚æœ‰ä»¥ä¸‹æ¡ä»¶ä¹‹ä¸€åˆ™ä¸æ˜¯ object safeï¼Œä¸èƒ½åˆ›å»º trait object</p><ul><li><strong>å½“ trait æœ‰ Selfï¼šSized çº¦æŸæ—¶</strong>ã€‚å¦‚æœä¸å¸Œæœ›ä¸€ä¸ª trait é€šè¿‡ trait object çš„æ–¹å¼ä½¿ç”¨ï¼Œå¯ä»¥ä¸ºå®ƒåŠ ä¸Š Selfï¼šSized çº¦æŸã€‚åŒç†ï¼Œå¦‚æœæˆ‘ä»¬æƒ³é˜»æ­¢ä¸€ä¸ªå‡½æ•°åœ¨è™šå‡½æ•°è¡¨ä¸­å‡ºç°ï¼Œå¯ä»¥ä¸“é—¨ä¸ºè¯¥å‡½æ•°åŠ ä¸Š Selfï¼šSized çº¦æŸã€‚</li><li><strong>å½“å‡½æ•°ä¸­æœ‰ Self ç±»å‹ä½œä¸ºå‚æ•°ï¼ˆé™¤äº† selfï¼‰æˆ–è€…è¿”å›ç±»å‹æ—¶</strong>ã€‚Rust è§„å®šï¼Œå¦‚æœå‡½æ•°ä¸­é™¤äº† self è¿™ä¸ªå‚æ•°ä¹‹å¤–ï¼Œè¿˜åœ¨å…¶ä»–å‚æ•°æˆ–è€…è¿”å›å€¼ä¸­ç”¨åˆ°äº† Self ç±»å‹ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å°±ä¸æ˜¯ object safe çš„ã€‚è¿™æ ·çš„å‡½æ•°æ˜¯ä¸èƒ½ä½¿ç”¨ trait object æ¥è°ƒç”¨çš„ã€‚è¿™æ ·çš„æ–¹æ³•æ˜¯ä¸èƒ½åœ¨è™šå‡½æ•°è¡¨ä¸­å­˜åœ¨çš„ã€‚</li><li><strong>å½“å‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°ä¸æ˜¯ self æ—¶</strong>ã€‚å¦‚æœæœ‰â€œé™æ€æ–¹æ³•â€ï¼Œé‚£è¿™ä¸ªâ€œé™æ€æ–¹æ³•â€æ˜¯ä¸æ»¡è¶³ object safe æ¡ä»¶çš„ã€‚è¿™ä¸ªæ¡ä»¶å‡ ä¹æ˜¯æ˜¾ç„¶çš„ï¼Œç¼–è¯‘å™¨æ²¡æœ‰åŠæ³•æŠŠé™æ€æ–¹æ³•åŠ å…¥åˆ°è™šå‡½æ•°è¡¨ä¸­ã€‚å¦‚æœä¸€ä¸ª trait ä¸­å­˜åœ¨é™æ€æ–¹æ³•ï¼Œè€Œåˆå¸Œæœ›é€šè¿‡ trait object æ¥è°ƒç”¨å…¶ä»–çš„æ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦åœ¨è¿™ä¸ªé™æ€æ–¹æ³•åé¢åŠ ä¸Š Selfï¼šSized çº¦æŸï¼Œå°†å®ƒä»è™šå‡½æ•°è¡¨ä¸­å‰”é™¤ã€‚</li><li><strong>å½“å‡½æ•°æœ‰æ³›å‹å‚æ•°æ—¶</strong>ã€‚é€šè¿‡ trait object è°ƒç”¨æˆå‘˜çš„æ–¹æ³•æ˜¯é€šè¿‡ vtable è™šå‡½æ•°è¡¨æ¥è¿›è¡ŒæŸ¥æ‰¾å¹¶è°ƒç”¨ã€‚ç°åœ¨éœ€è¦è¢«æŸ¥æ‰¾çš„å‡½æ•°æˆäº†æ³›å‹å‡½æ•°ï¼Œè€Œæ³›å‹å‡½æ•°åœ¨ Rust ä¸­æ˜¯ç¼–è¯‘é˜¶æ®µè‡ªåŠ¨å±•å¼€çš„ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªæ ¹æœ¬æ€§çš„å†²çªé—®é¢˜ã€‚Rust é€‰æ‹©çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œç¦æ­¢ä½¿ç”¨ trait object æ¥è°ƒç”¨æ³›å‹å‡½æ•°ï¼Œæ³›å‹å‡½æ•°æ˜¯ä»è™šå‡½æ•°è¡¨ä¸­å‰”é™¤äº†çš„ã€‚è¿™ä¸ªè¡Œä¸ºè·Ÿ C++ æ˜¯ä¸€æ ·çš„ã€‚C++ ä¸­åŒæ ·è§„å®šäº†ç±»çš„è™šæˆå‘˜å‡½æ•°ä¸å¯ä»¥æ˜¯ template æ–¹æ³•ã€‚</li></ul></li></ul>]]></content>
    
    
    <categories>
      
      <category>Rust</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>æ·±å…¥æµ…å‡º Rustç¬”è®° Series 2</title>
    <link href="/2023/02/06/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%20Rust%E7%AC%94%E8%AE%B0%20Series%202/"/>
    <url>/2023/02/06/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%20Rust%E7%AC%94%E8%AE%B0%20Series%202/</url>
    
    <content type="html"><![CDATA[<h1 id="ç³»åˆ—å¯¼èˆª"><a class="markdownIt-Anchor" href="#ç³»åˆ—å¯¼èˆª"></a> ç³»åˆ—å¯¼èˆª</h1><ul><li><a href="https://young-flash.github.io/2023/01/30/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%20Rust%E7%AC%94%E8%AE%B0%20Series%201/">æ·±å…¥æµ…å‡º Rustç¬”è®° Series 1</a></li><li><a href="https://young-flash.github.io/2023/02/06/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%20Rust%E7%AC%94%E8%AE%B0%20Series%202/">æ·±å…¥æµ…å‡º Rustç¬”è®° Series 2</a></li><li><a href="https://young-flash.github.io/2023/03/09/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%20Rust%E7%AC%94%E8%AE%B0%20Series%203/">æ·±å…¥æµ…å‡º Rustç¬”è®° Series 3</a></li><li><a href="https://young-flash.github.io/2023/03/09/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%20Rust%E7%AC%94%E8%AE%B0%20Series%204/">æ·±å…¥æµ…å‡º Rustç¬”è®° Series 4</a></li></ul><p>è¿™æ˜¯æˆ‘åœ¨é˜…è¯»èŒƒé•¿æ˜¥çš„ã€Šæ·±å…¥æµ…å‡º Rustã€‹æ—¶åšçš„ç¬”è®°ï¼Œç»å¤§éƒ¨åˆ†å†…å®¹æºè‡ªæ­¤ä¹¦ï¼Œå¦æœ‰å°éƒ¨åˆ†å†…å®¹æºè‡ª <a href="https://course.rs/about-book.html">Rust åœ£ç»</a>ã€‚è¿™ä¸¤ä»½èµ„æ–™æ˜¯æˆ‘å…¥é—¨ Rust çš„ä¸»è¦ææ–™ã€‚</p><h1 id="ç¬¬äºŒéƒ¨åˆ†-å†…å­˜å®‰å…¨"><a class="markdownIt-Anchor" href="#ç¬¬äºŒéƒ¨åˆ†-å†…å­˜å®‰å…¨"></a> ç¬¬äºŒéƒ¨åˆ† å†…å­˜å®‰å…¨</h1><p>Rust å¸Œæœ›é€šè¿‡è¯­è¨€çš„æœºåˆ¶å’Œç¼–è¯‘å™¨çš„åŠŸèƒ½ï¼ŒæŠŠç¨‹åºå‘˜æ˜“çŠ¯é”™ã€ä¸æ˜“æ£€æŸ¥çš„é—®é¢˜è§£å†³åœ¨ç¼–è¯‘æœŸï¼Œé¿å…è¿è¡Œæ—¶çš„å†…å­˜é”™è¯¯ã€‚è¿™ä¸€éƒ¨åˆ†ä¸»è¦æ¢è®¨ Rust æ˜¯å¦‚ä½•è¾¾åˆ°å†…å­˜å®‰å…¨ç‰¹æ€§çš„ã€‚</p><h2 id="chap-10-å†…å­˜ç®¡ç†åŸºç¡€"><a class="markdownIt-Anchor" href="#chap-10-å†…å­˜ç®¡ç†åŸºç¡€"></a> chap 10 å†…å­˜ç®¡ç†åŸºç¡€</h2><ul><li><p>segmentation fault å½¢æˆï¼šè¿›ç¨‹ç©ºé—´ä¸­çš„æ¯ä¸ªæ®µé€šè¿‡ç¡¬ä»¶ MMU æ˜ å°„åˆ°çœŸæ­£çš„ç‰©ç†ç©ºé—´ï¼›åœ¨è¿™ä¸ªæ˜ å°„è¿‡ç¨‹ä¸­å¯ä»¥ç»™ä¸åŒçš„æ®µè®¾ç½®ä¸åŒçš„è®¿é—®æƒé™ï¼Œæ¯”å¦‚ä»£ç æ®µå°±æ˜¯åªèƒ½è¯»ä¸èƒ½å†™ï¼›è¿›ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœè¿åäº†è¿™äº›æƒé™ï¼ŒCPU ä¼šç›´æ¥äº§ç”Ÿä¸€ä¸ªç¡¬ä»¶å¼‚å¸¸ï¼›ç¡¬ä»¶å¼‚å¸¸ä¼šè¢«æ“ä½œç³»ç»Ÿå†…æ ¸å¤„ç†ï¼Œä¸€èˆ¬å†…æ ¸ä¼šå‘å¯¹åº”çš„è¿›ç¨‹å‘é€ä¸€æ¡ä¿¡å·ï¼›å¦‚æœæ²¡æœ‰å®ç°è‡ªå·±ç‰¹æ®Šçš„ä¿¡å·å¤„ç†å‡½æ•°ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªè¿›ç¨‹ä¼šç›´æ¥éæ­£å¸¸é€€å‡ºï¼›å¦‚æœæ“ä½œç³»ç»Ÿæ‰“å¼€äº† core dump åŠŸèƒ½ï¼Œåœ¨è¿›ç¨‹é€€å‡ºçš„æ—¶å€™æ“ä½œç³»ç»Ÿä¼šæŠŠå®ƒå½“æ—¶çš„å†…å­˜çŠ¶æ€ã€å¯„å­˜å™¨çŠ¶æ€ä»¥åŠå„ç§ç›¸å…³ä¿¡æ¯ä¿å­˜åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä¾›ç”¨æˆ·ä»¥åè°ƒè¯•ä½¿ç”¨ã€‚</p></li><li><p>éå†…å­˜å®‰å…¨çš„æƒ…å†µ</p><ul><li>ç©ºæŒ‡é’ˆï¼šè§£å¼•ç”¨ç©ºæŒ‡é’ˆæ˜¯ä¸å®‰å…¨çš„ã€‚è¿™å—åœ°å€ç©ºé—´ä¸€èˆ¬æ˜¯å—ä¿æŠ¤çš„ï¼Œå¯¹ç©ºæŒ‡é’ˆè§£å¼•ç”¨åœ¨å¤§éƒ¨åˆ†å¹³å°ä¸Šä¼šäº§ç”Ÿ segfaultã€‚</li><li>é‡æŒ‡é’ˆï¼šæŒ‡çš„æ˜¯æœªåˆå§‹åŒ–çš„æŒ‡é’ˆã€‚å®ƒçš„å€¼å–å†³äºå®ƒè¿™ä¸ªä½ç½®ä»¥å‰é—ç•™ä¸‹æ¥çš„æ˜¯ä»€ä¹ˆå€¼ã€‚æ‰€ä»¥å®ƒå¯èƒ½æŒ‡å‘ä»»æ„ä¸€ä¸ªåœ°æ–¹ã€‚å¯¹å®ƒè§£å¼•ç”¨ï¼Œå¯èƒ½ä¼šé€ æˆ segfaultï¼Œä¹Ÿå¯èƒ½ä¸ä¼šï¼Œçº¯ç²¹å‡­è¿æ°”ã€‚ä½†æ— è®ºå¦‚ä½•ï¼Œè¿™ä¸ªè¡Œä¸ºéƒ½ä¸ä¼šæ˜¯é¢„æœŸå†…çš„è¡Œä¸ºï¼Œæ˜¯ä¸€å®šä¼šäº§ç”Ÿ bug çš„ã€‚</li><li>æ‚¬ç©ºæŒ‡é’ˆ:æŒ‡çš„æ˜¯å†…å­˜ç©ºé—´åœ¨è¢«é‡Šæ”¾äº†ä¹‹åï¼Œç»§ç»­ä½¿ç”¨ã€‚å®ƒè·Ÿé‡æŒ‡é’ˆç±»ä¼¼ï¼ŒåŒæ ·ä¼šè¯»å†™å·²ç»ä¸å±äºè¿™ä¸ªæŒ‡é’ˆçš„å†…å®¹ã€‚</li><li>ä½¿ç”¨æœªåˆå§‹åŒ–å†…å­˜ï¼šä¸åªæ˜¯æŒ‡é’ˆç±»å‹ï¼Œä»»ä½•ä¸€ç§ç±»å‹ä¸åˆå§‹åŒ–å°±ç›´æ¥ä½¿ç”¨éƒ½æ˜¯å±é™©çš„ï¼Œé€ æˆçš„åæœå®Œå…¨æ— æ³•é¢„æµ‹ã€‚</li><li>éæ³•é‡Šæ”¾ï¼šå†…å­˜åˆ†é…å’Œé‡Šæ”¾è¦é…å¯¹ã€‚å¦‚æœå¯¹åŒä¸€ä¸ªæŒ‡é’ˆé‡Šæ”¾ä¸¤æ¬¡ï¼Œä¼šåˆ¶é€ å‡ºå†…å­˜é”™è¯¯ã€‚å¦‚æœæŒ‡é’ˆå¹¶ä¸æ˜¯å†…å­˜åˆ†é…å™¨è¿”å›çš„å€¼ï¼Œå¯¹å…¶æ‰§è¡Œé‡Šæ”¾æ“ä½œï¼Œä¹Ÿæ˜¯å±é™©çš„ã€‚</li><li>ç¼“å†²åŒºæº¢å‡ºï¼šæŒ‡é’ˆè®¿é—®è¶Šç•Œäº†ï¼Œç»“æœä¹Ÿæ˜¯ç±»ä¼¼äºé‡æŒ‡é’ˆï¼Œä¼šè¯»å–æˆ–è€…ä¿®æ”¹ä¸´è¿‘å†…å­˜ç©ºé—´çš„å€¼ï¼Œé€ æˆå±é™©ã€‚</li><li>æ‰§è¡Œéæ³•å‡½æ•°æŒ‡é’ˆï¼šå¦‚æœä¸€ä¸ªå‡½æ•°æŒ‡é’ˆä¸æ˜¯å‡†ç¡®åœ°æŒ‡å‘ä¸€ä¸ªå‡½æ•°åœ°å€ï¼Œé‚£ä¹ˆè°ƒç”¨è¿™ä¸ªå‡½æ•°æŒ‡é’ˆä¼šå¯¼è‡´ä¸€æ®µéšæœºæ•°æ®è¢«å½“æˆæŒ‡ä»¤æ¥æ‰§è¡Œï¼Œæ˜¯éå¸¸å±é™©çš„ã€‚</li><li>æ•°æ®ç«äº‰ï¼šåœ¨æœ‰å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œé’ˆå¯¹åŒä¸€å—å†…å­˜åŒæ—¶è¯»å†™ï¼Œä¸”æ²¡æœ‰åŒæ­¥æªæ–½ã€‚</li></ul></li><li><p>ä¸€äº›å†…å­˜é”™è¯¯æ˜¯ä¸ç®—åœ¨â€œå†…å­˜å®‰å…¨â€èŒƒç•´å†…çš„ï¼Œæ¯”å¦‚å†…å­˜æ³„æ¼ä»¥åŠå†…å­˜è€—å°½ã€‚å¦å¤–ï¼Œpanic ä¹Ÿä¸å±äºå†…å­˜å®‰å…¨ç›¸å…³çš„é—®é¢˜ã€‚</p></li><li><p>panic å’Œ core dump ä¹‹é—´æœ‰é‡è¦åŒºåˆ«ã€‚panic æ˜¯å‘ç”Ÿä¸å¯æ¢å¤é”™è¯¯åï¼Œç¨‹åºä¸»åŠ¨æ‰§è¡Œçš„ä¸€ç§é”™è¯¯å¤„ç†æœºåˆ¶ï¼›è€Œ core dump åˆ™æ˜¯ç¨‹åºå¤±æ§ä¹‹åï¼Œè§¦å‘äº†æ“ä½œç³»ç»Ÿçš„ä¿æŠ¤æœºåˆ¶è€Œè¢«åŠ¨é€€å‡ºçš„ã€‚å‘ç”Ÿ panic çš„æ—¶å€™ï¼Œæ­¤å¤„å°±æ˜¯ç¡®å®šæ€§çš„ç¬¬ä¸€ç°åœºï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ® call stack ä¿¡æ¯å¾ˆå¿«æ‰¾åˆ°äº‹å‘åœ°ç‚¹ï¼Œç„¶åä¿®å¤ã€‚panic æ˜¯é˜²æ­¢æ›´ä¸¥é‡å†…å­˜å®‰å…¨é”™è¯¯çš„é‡è¦æœºåˆ¶ã€‚</p></li></ul><p>â€</p><h2 id="chap-11-æ‰€æœ‰æƒå’Œç§»åŠ¨è¯­ä¹‰"><a class="markdownIt-Anchor" href="#chap-11-æ‰€æœ‰æƒå’Œç§»åŠ¨è¯­ä¹‰"></a> chap 11 æ‰€æœ‰æƒå’Œç§»åŠ¨è¯­ä¹‰</h2><h3 id="111-æ‰€æœ‰æƒ"><a class="markdownIt-Anchor" href="#111-æ‰€æœ‰æƒ"></a> 11.1 æ‰€æœ‰æƒ</h3><ul><li><p>â€œæ‰€æœ‰æƒâ€ä»£è¡¨ç€ä»¥ä¸‹æ„ä¹‰ï¼š</p><ul><li>æ¯ä¸ªå€¼åœ¨ Rust ä¸­éƒ½æœ‰ä¸€ä¸ªå˜é‡æ¥ç®¡ç†å®ƒï¼Œè¿™ä¸ªå˜é‡å°±æ˜¯è¿™ä¸ªå€¼ã€è¿™å—å†…å­˜çš„æ‰€æœ‰è€…ï¼›</li><li>æ¯ä¸ªå€¼åœ¨ä¸€ä¸ªæ—¶é—´ç‚¹ä¸Šåªæœ‰ä¸€ä¸ªç®¡ç†è€…ï¼›</li><li>å½“å˜é‡æ‰€åœ¨çš„ä½œç”¨åŸŸç»“æŸçš„æ—¶å€™ï¼Œå˜é‡ä»¥åŠå®ƒä»£è¡¨çš„å€¼å°†ä¼šè¢«é”€æ¯ã€‚</li></ul></li><li><p>åœ¨ Rust ä¸­ä¸å¯ä»¥åšâ€œèµ‹å€¼è¿ç®—ç¬¦é‡è½½â€ï¼Œè‹¥éœ€è¦â€œæ·±å¤åˆ¶â€ï¼Œå¿…é¡»æ‰‹å·¥è°ƒç”¨ clone æ–¹æ³•ã€‚è¿™ä¸ª clone æ–¹æ³•æ¥è‡ªäº std::clone::Clone è¿™ä¸ª traitã€‚clone æ–¹æ³•é‡Œé¢çš„è¡Œä¸ºæ˜¯å¯ä»¥è‡ªå®šä¹‰çš„ã€‚</p></li></ul><h3 id="112-ç§»åŠ¨è¯­ä¹‰"><a class="markdownIt-Anchor" href="#112-ç§»åŠ¨è¯­ä¹‰"></a> 11.2 ç§»åŠ¨è¯­ä¹‰</h3><ul><li><p>ä¸€ä¸ªå˜é‡å¯ä»¥æŠŠå®ƒæ‹¥æœ‰çš„å€¼è½¬ç§»ç»™å¦å¤–ä¸€ä¸ªå˜é‡ï¼Œç§°ä¸ºâ€œæ‰€æœ‰æƒè½¬ç§»â€ã€‚<strong>èµ‹å€¼è¯­å¥ã€å‡½æ•°è°ƒç”¨ã€å‡½æ•°è¿”å›ç­‰ï¼Œéƒ½æœ‰å¯èƒ½å¯¼è‡´æ‰€æœ‰æƒè½¬ç§»ã€‚</strong></p></li><li><p>Rust ä¸­çš„å˜é‡ç»‘å®šæ“ä½œï¼Œé»˜è®¤æ˜¯ move è¯­ä¹‰ï¼Œæ‰§è¡Œäº†æ–°çš„å˜é‡ç»‘å®šåï¼ŒåŸæ¥çš„å˜é‡å°±ä¸èƒ½å†è¢«ä½¿ç”¨ã€‚</p></li><li><p>â€œè¯­ä¹‰â€ä¸ä»£è¡¨æœ€ç»ˆçš„æ‰§è¡Œæ•ˆç‡ã€‚â€œè¯­ä¹‰â€åªæ˜¯è§„å®šäº†ä»€ä¹ˆæ ·çš„ä»£ç æ˜¯ç¼–è¯‘å™¨å¯ä»¥æ¥å—çš„ï¼Œä»¥åŠå®ƒæ‰§è¡Œåçš„æ•ˆæœå¯ä»¥ç”¨æ€æ ·çš„æ€ç»´æ¨¡å‹å»ç†è§£ã€‚<strong>ç¼–è¯‘å™¨æœ‰æƒåœ¨ä¸æ”¹å˜è¯­ä¹‰çš„æƒ…å†µä¸‹åšä»»ä½•æœ‰åˆ©äºæ‰§è¡Œæ•ˆç‡çš„ä¼˜åŒ–ã€‚è¯­ä¹‰å’Œä¼˜åŒ–æ˜¯ä¸¤ä¸ªé˜¶æ®µçš„äº‹æƒ…ã€‚</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">create</span>() <span class="hljs-punctuation">-&gt;</span> BigObject &#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">local</span> = â€¦;<br>    <span class="hljs-keyword">return</span> local;<br>&#125;<br><span class="hljs-keyword">let</span> <span class="hljs-variable">v</span> = <span class="hljs-title function_ invoke__">create</span>();<br><br><span class="hljs-comment">// å®Œå…¨å¯èƒ½è¢«ä¼˜åŒ–ä¸ºç±»ä¼¼å¦‚ä¸‹çš„æ•ˆæœï¼š</span><br><br><span class="hljs-keyword">fn</span> <span class="hljs-title function_">create</span>(p: &amp;<span class="hljs-keyword">mut</span> BigObject) &#123;<br>    ptr::<span class="hljs-title function_ invoke__">write</span>(p, â€¦);<br>&#125;<br><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">v</span>: BigObject = <span class="hljs-title function_ invoke__">uninitialized</span>();<br><span class="hljs-title function_ invoke__">create</span>(&amp;<span class="hljs-keyword">mut</span> v);<br></code></pre></td></tr></table></figure><p>ç¼–è¯‘å™¨å¯ä»¥æå‰åœ¨å½“å‰è°ƒç”¨æ ˆä¸­æŠŠå¤§å¯¹è±¡çš„ç©ºé—´åˆ†é…å¥½ï¼Œç„¶åæŠŠè¿™ä¸ªå¯¹è±¡çš„æŒ‡é’ˆä¼ é€’ç»™å­å‡½æ•°ï¼Œç”±å­å‡½æ•°æ‰§è¡Œè¿™ä¸ªå˜é‡çš„åˆå§‹åŒ–ã€‚è¿™æ ·å°±é¿å…äº†å¤§å¯¹è±¡çš„å¤åˆ¶å·¥ä½œï¼Œå‚æ•°ä¼ é€’åªæ˜¯ä¸€ä¸ªæŒ‡é’ˆè€Œå·²ã€‚è¿™ä¹ˆåšæ˜¯å®Œå…¨æ»¡è¶³ç§»åŠ¨è¯­ä¹‰è¦æ±‚çš„ï¼Œè€Œä¸”ç¼–è¯‘å™¨è¿˜æœ‰æƒåˆ©åšæ›´å¤šç±»ä¼¼çš„ä¼˜åŒ–ã€‚</p></li></ul><h3 id="113-å¤åˆ¶è¯­ä¹‰"><a class="markdownIt-Anchor" href="#113-å¤åˆ¶è¯­ä¹‰"></a> 11.3 å¤åˆ¶è¯­ä¹‰</h3><ul><li><p>å¯¹äºä¸€äº›ç®€å•ç±»å‹ï¼Œæ¯”å¦‚æ•´æ•°ã€boolï¼Œåœ¨èµ‹å€¼çš„æ—¶å€™é»˜è®¤é‡‡ç”¨å¤åˆ¶æ“ä½œ</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() &#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">v1</span> : <span class="hljs-type">isize</span> = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">v2</span> = v1;<br>    <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>, v1);<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ Rust ä¸­æœ‰ä¸€éƒ¨åˆ†â€œç‰¹æ®Šç…§é¡¾â€çš„ç±»å‹ï¼Œå…¶å˜é‡ç»‘å®šæ“ä½œæ˜¯ copy è¯­ä¹‰ã€‚æ‰€è°“çš„ copy è¯­ä¹‰ï¼Œæ˜¯æŒ‡åœ¨æ‰§è¡Œå˜é‡ç»‘å®šæ“ä½œçš„æ—¶å€™ï¼Œv2 æ˜¯å¯¹ v1 æ‰€å±æ•°æ®çš„ä¸€ä»½å¤åˆ¶ã€‚v1 æ‰€ç®¡ç†çš„è¿™å—å†…å­˜ä¾ç„¶å­˜åœ¨ï¼Œå¹¶æœªå¤±æ•ˆï¼Œè€Œ v2 æ˜¯æ–°å¼€è¾Ÿäº†ä¸€å—å†…å­˜ï¼Œå®ƒçš„å†…å®¹æ˜¯ä» v1 ç®¡ç†çš„å†…å­˜ä¸­å¤åˆ¶è€Œæ¥çš„ã€‚å’Œæ‰‹åŠ¨è°ƒç”¨ clone æ–¹æ³•æ•ˆæœä¸€æ ·ï¼Œ<code>let v2=v1;</code>â€‹ ç­‰æ•ˆäº <code>let v2 = v1.clone();</code>â€‹ã€‚</p></li><li><p>copy è¯­ä¹‰ä¸ move è¯­ä¹‰ï¼š<strong>è¿™ä¸¤ä¸ªæ“ä½œæœ¬èº«æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯ç®€å•çš„å†…å­˜å¤åˆ¶ï¼ŒåŒºåˆ«åœ¨äºå¤åˆ¶å®Œ<br />ä»¥åï¼ŒåŸå…ˆé‚£ä¸ªå˜é‡çš„ç”Ÿå‘½å‘¨æœŸæ˜¯å¦ç»“æŸã€‚</strong></p></li><li><p>åœ¨æ™®é€šå˜é‡ç»‘å®šã€å‡½æ•°ä¼ å‚ã€æ¨¡å¼åŒ¹é…ç­‰åœºæ™¯ä¸‹ï¼Œå‡¡æ˜¯å®ç°äº† std::marker::Copy trait çš„ç±»å‹ï¼Œéƒ½ä¼šæ‰§è¡Œ copy è¯­ä¹‰ã€‚åŸºæœ¬ç±»å‹ï¼Œæ¯”å¦‚æ•°å­—ã€å­—ç¬¦ã€bool ç­‰ï¼Œéƒ½å®ç°äº† Copy traitï¼Œå› æ­¤å…·å¤‡ copy è¯­ä¹‰ã€‚</p></li><li><p>å¯¹äºè‡ªå®šä¹‰ç±»å‹ï¼Œé»˜è®¤æ˜¯æ²¡æœ‰å®ç° Copy trait çš„ï¼Œå¯ä»¥æ‰‹åŠ¨æ·»ä¸Šã€‚Copy ç»§æ‰¿äº† Cloneï¼Œè¦å®ç° Copy trait å¿…é¡»åŒæ—¶å®ç° Clone traitã€‚åªè¦ä¸€ä¸ªç±»å‹çš„æ‰€æœ‰æˆå‘˜éƒ½å…·æœ‰ Clone traitï¼Œå°±å¯ä»¥ä½¿ç”¨ <code>#[derive(Copy, Clone)]</code> â€‹æ¥è®©ç¼–è¯‘å™¨å®ç° Clone trait äº†ã€‚</p></li></ul><h3 id="114-box-ç±»å‹"><a class="markdownIt-Anchor" href="#114-box-ç±»å‹"></a> 11.4 Box ç±»å‹</h3><ul><li>Box ç±»å‹æ˜¯ Rust ä¸­ä¸€ç§å¸¸ç”¨çš„æŒ‡é’ˆç±»å‹ã€‚<strong>Box ä»£è¡¨â€œæ‹¥æœ‰æ‰€æœ‰æƒçš„æŒ‡é’ˆâ€</strong>ï¼Œç±»ä¼¼äº C++ é‡Œé¢çš„ unique_ptrï¼ˆä¸¥æ ¼æ¥è¯´ï¼Œunique_ptr<T> æ›´åƒ Option&lt;Box<T>&gt;ï¼‰</li><li>Box ç±»å‹æ°¸è¿œæ‰§è¡Œçš„æ˜¯ move è¯­ä¹‰ï¼Œä¸èƒ½æ˜¯ copy è¯­ä¹‰ã€‚Rust ä¸­çš„ copy è¯­ä¹‰å°±æ˜¯æµ…å¤åˆ¶ã€‚å¯¹äº Box è¿™æ ·çš„ç±»å‹è€Œè¨€ï¼Œæµ…å¤åˆ¶å¿…ç„¶ä¼šé€ æˆäºŒæ¬¡é‡Šæ”¾é—®é¢˜ã€‚</li><li>å®ƒåŒ…è£¹çš„å€¼ä¼šè¢«å¼ºåˆ¶åˆ†é…åœ¨å †ä¸Š</li><li>â€‹<img src="/img/blog_pic/2023/image-20230118104121-gclzz19.png" alt="image" /></li><li>â€‹ç”±äº <code>Box</code>â€‹ æ˜¯ç®€å•çš„å°è£…ï¼Œé™¤äº†å°†å€¼å­˜å‚¨åœ¨å †ä¸Šå¤–ï¼Œå¹¶æ²¡æœ‰å…¶å®ƒæ€§èƒ½ä¸Šçš„æŸè€—ã€‚è€Œæ€§èƒ½å’ŒåŠŸèƒ½å¾€å¾€æ˜¯é±¼å’Œç†ŠæŒï¼Œå› æ­¤ <code>Box</code>â€‹ ç›¸æ¯”å…¶å®ƒæ™ºèƒ½æŒ‡é’ˆï¼ŒåŠŸèƒ½è¾ƒä¸ºå•ä¸€ï¼Œå¯ä»¥åœ¨ä»¥ä¸‹åœºæ™¯ä¸­ä½¿ç”¨å®ƒï¼š<ul><li>ç‰¹æ„çš„å°†æ•°æ®åˆ†é…åœ¨å †ä¸Š</li><li>æ•°æ®è¾ƒå¤§æ—¶ï¼Œåˆä¸æƒ³åœ¨è½¬ç§»æ‰€æœ‰æƒæ—¶è¿›è¡Œæ•°æ®æ‹·è´ï¼šå½“æ ˆä¸Šæ•°æ®è½¬ç§»æ‰€æœ‰æƒæ—¶ï¼Œå®é™…ä¸Šæ˜¯æŠŠæ•°æ®æ‹·è´äº†ä¸€ä»½ï¼Œæœ€ç»ˆæ–°æ—§å˜é‡å„è‡ªæ‹¥æœ‰ä¸åŒçš„æ•°æ®ï¼Œå› æ­¤æ‰€æœ‰æƒå¹¶æœªè½¬ç§»ã€‚è€Œå †ä¸Šåˆ™ä¸ç„¶ï¼Œåº•å±‚æ•°æ®å¹¶ä¸ä¼šè¢«æ‹·è´ï¼Œè½¬ç§»æ‰€æœ‰æƒä»…ä»…æ˜¯å¤åˆ¶ä¸€ä»½æ ˆä¸­çš„æŒ‡é’ˆï¼Œå†å°†æ–°çš„æŒ‡é’ˆèµ‹äºˆæ–°çš„å˜é‡ï¼Œç„¶åè®©æ‹¥æœ‰æ—§æŒ‡é’ˆçš„å˜é‡å¤±æ•ˆï¼Œæœ€ç»ˆå®Œæˆäº†æ‰€æœ‰æƒçš„è½¬ç§»ã€‚</li><li>ç±»å‹çš„å¤§å°åœ¨ç¼–è¯‘æœŸæ— æ³•ç¡®å®šï¼Œä½†æ˜¯æˆ‘ä»¬åˆéœ€è¦å›ºå®šå¤§å°çš„ç±»å‹æ—¶</li><li>ç‰¹å¾å¯¹è±¡ï¼Œç”¨äºè¯´æ˜å¯¹è±¡å®ç°äº†ä¸€ä¸ªç‰¹å¾ï¼Œè€Œä¸æ˜¯æŸä¸ªç‰¹å®šçš„ç±»å‹</li></ul></li><li><a href="https://course.rs/advance/smart-pointer/box.html#boxleak">Box::leak</a> ä½¿ç”¨åœºæ™¯ï¼š<strong>éœ€è¦ä¸€ä¸ªåœ¨è¿è¡ŒæœŸåˆå§‹åŒ–çš„å€¼ï¼Œä½†æ˜¯å¯ä»¥å…¨å±€æœ‰æ•ˆï¼Œä¹Ÿå°±æ˜¯å’Œæ•´ä¸ªç¨‹åºæ´»å¾—ä¸€æ ·ä¹…</strong></li></ul><h3 id="115-clone-vs-copy"><a class="markdownIt-Anchor" href="#115-clone-vs-copy"></a> 11.5 Clone VS Copy</h3><ul><li><p>std::marker::Copyï¼šå¦‚æœä¸€ä¸ªç±»å‹ impl äº† Copy traitï¼Œæ„å‘³ç€ä»»ä½•æ—¶å€™éƒ½å¯ä»¥é€šè¿‡ç®€å•çš„å†…å­˜å¤åˆ¶ï¼ˆåœ¨ C è¯­è¨€é‡ŒæŒ‰å­—èŠ‚å¤åˆ¶ memcpyï¼‰å®ç°è¯¥ç±»å‹çš„å¤åˆ¶ï¼Œå¹¶ä¸”ä¸ä¼šäº§ç”Ÿä»»ä½•å†…å­˜å®‰å…¨é—®é¢˜ã€‚ä¸€æ—¦ä¸€ä¸ªç±»å‹å®ç°äº† Copy traitï¼Œé‚£ä¹ˆå®ƒåœ¨å˜é‡ç»‘å®šã€å‡½æ•°å‚æ•°ä¼ é€’ã€å‡½æ•°è¿”å›å€¼ä¼ é€’ç­‰åœºæ™¯ä¸‹ï¼Œéƒ½æ˜¯ copy è¯­ä¹‰ï¼Œè€Œä¸å†æ˜¯é»˜è®¤çš„ move è¯­ä¹‰ã€‚</p><ul><li>std::marker æ¨¡å—é‡Œé¢æ‰€æœ‰çš„ trait éƒ½æ˜¯ç‰¹æ®Šçš„ traitã€‚ç›®å‰ç¨³å®šçš„æœ‰å››ä¸ªï¼Œå®ƒä»¬æ˜¯ Copyã€Sendã€Sizedã€Syncã€‚<strong>å®ƒä»¬çš„ç‰¹æ®Šä¹‹å¤„åœ¨äºï¼šå®ƒä»¬æ˜¯è·Ÿç¼–è¯‘å™¨å¯†åˆ‡ç»‘å®šçš„ï¼Œimpl è¿™äº› trait å¯¹ç¼–è¯‘å™¨çš„è¡Œä¸ºæœ‰é‡è¦å½±å“ã€‚åœ¨ç¼–è¯‘å™¨çœ¼é‡Œï¼Œå®ƒä»¬ä¸å…¶ä»–çš„ trait ä¸ä¸€æ ·ã€‚è¿™å‡ ä¸ª trait å†…éƒ¨éƒ½æ²¡æœ‰æ–¹æ³•ï¼Œå®ƒä»¬çš„å”¯ä¸€ä»»åŠ¡æ˜¯ç»™ç±»å‹æ‰“ä¸€ä¸ªâ€œæ ‡è®°â€ï¼Œè¡¨æ˜å®ƒç¬¦åˆæŸç§çº¦å®šâ€”â€”è¿™äº›çº¦å®šä¼šå½±å“ç¼–è¯‘å™¨çš„é™æ€æ£€æŸ¥ä»¥åŠä»£ç ç”Ÿæˆã€‚</strong></li></ul></li><li><p>Copy çš„å®ç°æ¡ä»¶</p><ul><li>å¯¹äºè‡ªå®šä¹‰ç±»å‹ï¼Œåªæœ‰æ‰€æœ‰æˆå‘˜éƒ½å®ç°äº† Copy traitï¼Œè¿™ä¸ªç±»å‹æ‰æœ‰èµ„æ ¼å®ç° Copy traitã€‚struct å’Œ enum ç±»å‹ä¸ä¼šè‡ªåŠ¨å®ç° Copy traitï¼Œåªæœ‰å½“ struct å’Œ enum å†…éƒ¨çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ Copy ç±»å‹æ—¶ï¼Œç¼–è¯‘å™¨æ‰å…è®¸é’ˆå¯¹æ­¤ç±»å‹å®ç° Copy traitã€‚è€Œå¯¹äºå…ƒç»„ tuple ç±»å‹ï¼Œå¦‚æœå®ƒçš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½æ˜¯ Copy ç±»å‹ï¼Œé‚£ä¹ˆè¿™ä¸ª tuple ä¹Ÿæ˜¯ Copy ç±»å‹ã€‚</li><li>å¸¸è§çš„æ•°å­—ç±»å‹ã€bool ç±»å‹ã€å…±äº«å€Ÿç”¨æŒ‡é’ˆ&amp;ï¼Œéƒ½æ˜¯å…·æœ‰ Copy å±æ€§çš„ç±»å‹ã€‚</li><li>Boxã€Vecã€å¯å†™å€Ÿç”¨æŒ‡é’ˆ&amp;mut ç­‰ç±»å‹éƒ½æ˜¯ä¸å…·å¤‡ Copy å±æ€§çš„ç±»å‹ã€‚</li><li><strong>å¯¹äºæ•°ç»„ç±»å‹ï¼Œå¦‚æœå®ƒå†…éƒ¨çš„å…ƒç´ ç±»å‹æ˜¯ Copyï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°ç»„ä¹Ÿæ˜¯ Copy ç±»å‹ã€‚</strong></li></ul></li><li><p>std::clone::Cloneï¼šclone æ–¹æ³•ä¸€èˆ¬ç”¨äºâ€œåŸºäºè¯­ä¹‰çš„å¤åˆ¶â€æ“ä½œã€‚æ‰€ä»¥ï¼Œå®ƒåšä»€ä¹ˆäº‹æƒ…ï¼Œè·Ÿå…·<br />ä½“ç±»å‹çš„ä½œç”¨æ¯æ¯ç›¸å…³ã€‚æ¯”å¦‚ï¼Œå¯¹äº Box ç±»å‹ï¼Œclone æ‰§è¡Œçš„æ˜¯â€œæ·±å¤åˆ¶â€ï¼›è€Œå¯¹äº Rc ç±»å‹ï¼Œclone åšçš„äº‹æƒ…å°±æ˜¯æŠŠå¼•ç”¨è®¡æ•°å€¼åŠ  1ã€‚<strong>å¯¹äºå®ç°äº† copy çš„ç±»å‹ï¼Œå®ƒçš„ clone æ–¹æ³•åº”è¯¥è·Ÿ copy è¯­ä¹‰ç›¸å®¹ï¼Œç­‰åŒäºæŒ‰å­—èŠ‚å¤åˆ¶ã€‚</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">pub</span> <span class="hljs-keyword">trait</span> <span class="hljs-title class_">Clone</span> : <span class="hljs-built_in">Sized</span> &#123;<br>    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">clone</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span>;<br>    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">clone_from</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, source: &amp;<span class="hljs-keyword">Self</span>) &#123;<br>        *<span class="hljs-keyword">self</span> = source.<span class="hljs-title function_ invoke__">clone</span>()<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ‰ä¸¤ä¸ªå…³è”æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯ clone_from å’Œ cloneï¼Œclone_from æ˜¯æœ‰é»˜è®¤å®ç°çš„ï¼Œä¾èµ–äº clone æ–¹æ³•çš„å®ç°ã€‚clone æ–¹æ³•æ²¡æœ‰é»˜è®¤å®ç°ï¼Œéœ€è¦æ‰‹åŠ¨å®ç°ã€‚</p><ul><li>â€‹<code>#[derive(Clone)]</code>â€‹ è®©ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆé‚£äº›é‡å¤çš„ä»£ç ã€‚ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„ clone æ–¹æ³•éå¸¸æœºæ¢°ï¼Œå°±æ˜¯ä¾æ¬¡è°ƒç”¨æ¯ä¸ªæˆå‘˜çš„ clone æ–¹æ³•ã€‚</li></ul></li><li><p>æ€»ç»“</p><ul><li>Copy å†…éƒ¨æ²¡æœ‰æ–¹æ³•ï¼ŒClone å†…éƒ¨æœ‰ä¸¤ä¸ªæ–¹æ³•(cloneã€clone_from)</li><li>Copy trait æ˜¯ç»™ç¼–è¯‘å™¨ç”¨çš„ï¼Œå‘Šè¯‰ç¼–è¯‘å™¨è¿™ä¸ªç±»å‹é»˜è®¤é‡‡ç”¨ copy è¯­ä¹‰è€Œä¸æ˜¯ move è¯­ä¹‰ã€‚Clone trait æ˜¯ç»™ç¨‹åºå‘˜ç”¨çš„ï¼Œå¿…é¡»æ‰‹åŠ¨è°ƒç”¨ clone æ–¹æ³•å®ƒæ‰èƒ½å‘æŒ¥ä½œç”¨ã€‚</li><li>Copy trait ä¸æ˜¯æƒ³å®ç°å°±èƒ½å®ç°çš„ï¼Œå®ƒå¯¹ç±»å‹æ˜¯æœ‰è¦æ±‚çš„ï¼Œæœ‰äº›ç±»å‹ï¼ˆBox<T>ï¼‰ä¸å¯èƒ½ impl Copyã€‚è€Œ Clone trait åˆ™æ²¡æœ‰ä»€ä¹ˆå‰ææ¡ä»¶ï¼Œä»»ä½•ç±»å‹éƒ½å¯ä»¥å®ç°ï¼ˆunsized ç±»å‹é™¤å¤–ï¼Œå› ä¸ºæ— æ³•ä½¿ç”¨ unsized ç±»å‹ä½œä¸ºè¿”å›å€¼ï¼‰ã€‚</li><li>Copy trait è§„å®šäº†è¿™ä¸ªç±»å‹åœ¨æ‰§è¡Œå˜é‡ç»‘å®šã€å‡½æ•°å‚æ•°ä¼ é€’ã€å‡½æ•°è¿”å›ç­‰åœºæ™¯ä¸‹çš„æ“ä½œæ–¹å¼ã€‚å³è¿™ä¸ªç±»å‹åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œå¿…ç„¶æ‰§è¡Œçš„æ˜¯â€œç®€å•å†…å­˜å¤åˆ¶â€æ“ä½œï¼Œè¿™æ˜¯ç”±ç¼–è¯‘å™¨ä¿è¯çš„ï¼Œç¨‹åºå‘˜æ— æ³•æ§åˆ¶ã€‚Clone trait é‡Œé¢çš„ clone æ–¹æ³•ç©¶ç«Ÿä¼šæ‰§è¡Œä»€ä¹ˆæ“ä½œï¼Œåˆ™æ˜¯å–å†³äºç¨‹åºå‘˜è‡ªå·±å†™çš„é€»è¾‘ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œclone æ–¹æ³•åº”è¯¥æ‰§è¡Œä¸€ä¸ªâ€œæ·±å¤åˆ¶â€æ“ä½œï¼Œä½†è¿™ä¸æ˜¯å¼ºåˆ¶æ€§çš„</li><li>Rust è§„å®šäº†åœ¨ Tï¼šCopy çš„æƒ…å†µä¸‹ Clone trait ä»£è¡¨çš„å«ä¹‰ã€‚å³ï¼šå½“æŸå˜é‡ tï¼šT ç¬¦åˆ Tï¼šCopy æ—¶ï¼Œå®ƒè°ƒç”¨ t.clone() æ–¹æ³•çš„å«ä¹‰å¿…é¡»ç­‰åŒäºâ€œç®€å•å†…å­˜å¤åˆ¶â€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>t.clone()</code>â€‹ çš„è¡Œä¸ºå¿…é¡»ç­‰åŒäº <code>let x = std::ptr::read(&amp;t);</code>â€‹ ï¼Œä¹Ÿç­‰åŒäº <code>let x = t;</code>â€‹ ã€‚</li></ul></li></ul><h3 id="ææ„"><a class="markdownIt-Anchor" href="#ææ„"></a> ææ„</h3><ul><li><p>åœ¨ Rust ä¸­ç¼–å†™â€œææ„å‡½æ•°â€çš„åŠæ³•æ˜¯ impl std::ops::Dropã€‚Drop trait çš„å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">trait</span> <span class="hljs-title class_">Drop</span> &#123;<br>    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">drop</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>);<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ä¸»åŠ¨ææ„ï¼šç”¨æˆ·ä¸»åŠ¨è°ƒç”¨ææ„å‡½æ•°æ˜¯éæ³•çš„ã€‚éœ€è°ƒç”¨æ ‡å‡†åº“ä¸­çš„ std::mem::drop()</p><ul><li><p>std::mem::drop() å®ç°</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-meta">#[inline]</span><br><span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">drop</span>&lt;T&gt;(_x: T) &#123; &#125;<br></code></pre></td></tr></table></figure><ul><li>drop å‡½æ•°ä¸éœ€è¦ä»»ä½•çš„å‡½æ•°ä½“ï¼Œåªéœ€è¦å‚æ•°ä¸ºâ€œå€¼ä¼ é€’â€å³å¯ã€‚å°†å¯¹è±¡çš„æ‰€æœ‰æƒç§»å…¥å‡½æ•°ä¸­ï¼Œä»€ä¹ˆéƒ½ä¸ç”¨åšï¼Œç¼–è¯‘å™¨å°±ä¼šè‡ªåŠ¨é‡Šæ”¾æ‰è¿™ä¸ªå¯¹è±¡äº†ã€‚</li><li>å› ä¸ºè¿™ä¸ª drop å‡½æ•°çš„å…³é”®åœ¨äºä½¿ç”¨ move è¯­ä¹‰æŠŠå‚æ•°ä¼ è¿›æ¥ï¼Œä½¿å¾—å˜é‡çš„æ‰€æœ‰æƒä»è°ƒç”¨æ–¹ç§»åŠ¨åˆ° drop å‡½æ•°ä½“å†…ï¼Œå‚æ•°ç±»å‹ä¸€å®šè¦æ˜¯ Tï¼Œè€Œä¸æ˜¯&amp;T æˆ–è€…å…¶ä»–å¼•ç”¨ç±»å‹ã€‚å‡½æ•°ä½“æœ¬èº«å…¶å®æ ¹æœ¬ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯æŠŠå˜é‡çš„æ‰€æœ‰æƒ move è¿›å…¥è¿™ä¸ªå‡½æ•°ä½“ä¸­ï¼Œå‡½æ•°è°ƒç”¨ç»“æŸçš„æ—¶å€™è¯¥å˜é‡çš„ç”Ÿå‘½å‘¨æœŸç»“æŸï¼Œå˜é‡çš„ææ„å‡½æ•°ä¼šè‡ªåŠ¨è°ƒç”¨ï¼Œç®¡ç†çš„å†…å­˜ç©ºé—´ä¹Ÿä¼šè‡ªç„¶é‡Šæ”¾ã€‚è¿™ä¸ªè¿‡ç¨‹å®Œå…¨ç¬¦åˆå‰é¢è®²çš„ç”Ÿå‘½å‘¨æœŸã€move è¯­ä¹‰ï¼Œæ— é¡»ç¼–è¯‘å™¨åšç‰¹æ®Šå¤„ç†ã€‚</li><li>å› æ­¤ï¼Œå¯¹äº Copy ç±»å‹çš„å˜é‡ï¼Œå¯¹å®ƒè°ƒç”¨  std::mem::drop() æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚å› ä¸º Copy ç±»å‹åœ¨å‡½æ•°å‚æ•°ä¼ é€’çš„æ—¶å€™æ‰§è¡Œçš„æ˜¯å¤åˆ¶è¯­ä¹‰ï¼ŒåŸæ¥çš„é‚£ä¸ªå˜é‡ä¾ç„¶å­˜åœ¨ï¼Œä¼ å…¥å‡½æ•°ä¸­çš„åªæ˜¯ä¸€ä¸ªå¤åˆ¶å“ï¼Œå› æ­¤åŸå˜é‡çš„ç”Ÿå‘½å‘¨æœŸä¸ä¼šå—åˆ°å½±å“ã€‚</li></ul></li></ul></li><li><p>å˜é‡é®è”½ï¼ˆShadowingï¼‰ä¸ä¼šå¯¼è‡´å˜é‡ç”Ÿå‘½å‘¨æœŸæå‰ç»“æŸï¼Œå®ƒä¸ç­‰åŒäº dropã€‚</p></li><li><p>æ³¨æ„ï¼šç”¨ä¸‹åˆ’çº¿æ¥ç»‘å®šä¸€ä¸ªå˜é‡ï¼Œé‚£ä¹ˆè¿™ä¸ªå˜é‡ä¼šå½“åœºæ‰§è¡Œææ„ï¼Œè€Œä¸æ˜¯ç­‰åˆ°å½“å‰è¯­å¥å—ç»“æŸçš„æ—¶å€™å†æ‰§è¡Œã€‚ä¸‹åˆ’çº¿æ˜¯ç‰¹æ®Šç¬¦å·ï¼Œä¸æ˜¯æ™®é€šæ ‡è¯†ç¬¦ã€‚</p></li><li><p>std::mem::dropï¼ˆï¼‰å‡½æ•°å’Œ std::ops::Drop::dropï¼ˆï¼‰æ–¹æ³•çš„åŒºåˆ«</p><ol><li>std::mem::dropï¼ˆï¼‰å‡½æ•°æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å‡½æ•°ï¼Œä¸æ˜¯æŸä¸ªç±»å‹çš„æˆå‘˜æ–¹æ³•ï¼Œå®ƒç”±ç¨‹åºå‘˜ä¸»åŠ¨è°ƒç”¨ï¼Œä½œç”¨æ˜¯ä½¿å˜é‡çš„ç”Ÿå‘½å‘¨æœŸæå‰ç»“æŸï¼›std::ops::Drop::dropï¼ˆï¼‰æ–¹æ³•æ˜¯ä¸€ä¸ª trait ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œå½“å˜é‡çš„ç”Ÿå‘½å‘¨æœŸç»“æŸçš„æ—¶å€™ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨è°ƒç”¨ï¼Œæ‰‹åŠ¨è°ƒç”¨æ˜¯ä¸å…è®¸çš„ã€‚</li><li>std::mem::drop<T>ï¼ˆ_xï¼šTï¼‰çš„å‚æ•°ç±»å‹æ˜¯ Tï¼Œé‡‡ç”¨çš„æ˜¯ move è¯­ä¹‰ï¼›std::ops::Drop::dropï¼ˆ&amp;mut selfï¼‰çš„å‚æ•°ç±»å‹æ˜¯&amp;mut Selfï¼Œé‡‡ç”¨çš„æ˜¯å¯å˜å€Ÿç”¨ã€‚åœ¨ææ„å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œç¨‹åºå‘˜è¿˜æœ‰æœºä¼šè¯»å–æˆ–è€…ä¿®æ”¹æ­¤å¯¹è±¡çš„å±æ€§ã€‚</li></ol></li></ul><h2 id="chap-12-å€Ÿç”¨å’Œç”Ÿå‘½å‘¨æœŸ"><a class="markdownIt-Anchor" href="#chap-12-å€Ÿç”¨å’Œç”Ÿå‘½å‘¨æœŸ"></a> chap 12 å€Ÿç”¨å’Œç”Ÿå‘½å‘¨æœŸ</h2><ul><li><p>ç”Ÿå‘½å‘¨æœŸç®€è€Œè¨€ä¹‹å°±æ˜¯å¼•ç”¨çš„æœ‰æ•ˆä½œç”¨åŸŸã€‚ç”Ÿå‘½å‘¨æœŸç¬¦å·ä½¿ç”¨å•å¼•å·å¼€å¤´ï¼Œåé¢è·Ÿä¸€ä¸ªåˆæ³•çš„åå­—ã€‚ç”Ÿå‘½å‘¨æœŸæ ‡è®°å’Œæ³›å‹ç±»å‹å‚æ•°æ˜¯ä¸€æ ·çš„ï¼Œéƒ½éœ€è¦å…ˆå£°æ˜åä½¿ç”¨ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">test</span>&lt;<span class="hljs-symbol">&#x27;a</span>&gt;(arg: &amp;<span class="hljs-symbol">&#x27;a</span> T) <span class="hljs-punctuation">-&gt;</span> &amp;<span class="hljs-symbol">&#x27;a</span> <span class="hljs-type">i32</span> &#123;<br>    &amp;arg.member<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸæ ‡æ³¨ï¼Œå®ƒè‡ªèº«å¹¶ä¸å…·æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Œå› ä¸ºç”Ÿå‘½å‘¨æœŸçš„ä½œç”¨å°±æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨å¤šä¸ªå¼•ç”¨ä¹‹é—´çš„å…³ç³»ã€‚ä¾‹å¦‚ï¼Œæœ‰ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•° <code>first</code>â€‹ æ˜¯ä¸€ä¸ªæŒ‡å‘ <code>i32</code>â€‹ ç±»å‹çš„å¼•ç”¨ï¼Œå…·æœ‰ç”Ÿå‘½å‘¨æœŸ <code>'a</code>â€‹ï¼Œè¯¥å‡½æ•°è¿˜æœ‰å¦ä¸€ä¸ªå‚æ•° <code>second</code>â€‹ï¼Œå®ƒä¹Ÿæ˜¯æŒ‡å‘ <code>i32</code>â€‹ ç±»å‹çš„å¼•ç”¨ï¼Œå¹¶ä¸”åŒæ ·å…·æœ‰ç”Ÿå‘½å‘¨æœŸ <code>'a</code>â€‹ã€‚æ­¤å¤„ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨ä»…ä»…è¯´æ˜ï¼Œè¿™ä¸¤ä¸ªå‚æ•° <code>first</code>â€‹ å’Œ <code>second</code>â€‹ è‡³å°‘æ´»å¾—å’Œâ€™a ä¸€æ ·ä¹…ï¼Œè‡³äºåˆ°åº•æ´»å¤šä¹…æˆ–è€…å“ªä¸ªæ´»å¾—æ›´ä¹…éƒ½æ— æ³•å¾—çŸ¥ã€‚</p></li><li><p>å€Ÿç”¨æŒ‡é’ˆç±»å‹éƒ½æœ‰ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸæ³›å‹å‚æ•°ï¼Œå®ƒä»¬çš„å®Œæ•´å†™æ³•åº”è¯¥æ˜¯&amp;'a Tã€&amp;'a mut Tï¼Œåªä¸è¿‡åœ¨åšå±€éƒ¨å˜é‡çš„æ—¶å€™ï¼Œç”Ÿå‘½å‘¨æœŸå‚æ•°æ˜¯å¯ä»¥çœç•¥çš„ã€‚</p></li><li><p>ç”Ÿå‘½å‘¨æœŸä¹‹é—´æœ‰é‡è¦çš„åŒ…å«å…³ç³»ã€‚<strong>å¦‚æœç”Ÿå‘½å‘¨æœŸâ€™a æ¯”â€™b æ›´é•¿æˆ–ç›¸ç­‰ï¼Œåˆ™è®°ä¸ºâ€™a: 'bï¼Œæ„æ€æ˜¯â€™a è‡³å°‘ä¸ä¼šæ¯”â€™b çŸ­</strong>ã€‚'static æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç”Ÿå‘½å‘¨æœŸï¼Œå®ƒä»£è¡¨çš„æ˜¯è¿™ä¸ªç¨‹åºä»å¼€å§‹åˆ°ç»“æŸçš„æ•´ä¸ªé˜¶æ®µï¼Œæ‰€ä»¥å®ƒæ¯”å…¶ä»–ä»»ä½•ç”Ÿå‘½å‘¨æœŸéƒ½é•¿ã€‚è¿™æ„å‘³ç€ï¼Œä»»æ„ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸâ€™a éƒ½æ»¡è¶³â€™static: 'aã€‚</p></li><li><p>Rust çš„å¼•ç”¨ç±»å‹æ˜¯æ”¯æŒâ€œåå˜â€çš„ã€‚åœ¨ç¼–è¯‘å™¨çœ¼é‡Œï¼Œç”Ÿå‘½å‘¨æœŸå°±æ˜¯ä¸€ä¸ªåŒºé—´ï¼Œç”Ÿå‘½å‘¨æœŸå‚æ•°å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„æ³›å‹å‚æ•°ï¼Œå®ƒå¯ä»¥è¢«ç‰¹åŒ–ä¸ºæŸä¸ªå…·ä½“çš„ç”Ÿå‘½å‘¨æœŸã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">select</span>&lt;<span class="hljs-symbol">&#x27;a</span>&gt;(arg1: &amp;<span class="hljs-symbol">&#x27;a</span> <span class="hljs-type">i32</span>, arg2: &amp;<span class="hljs-symbol">&#x27;a</span> <span class="hljs-type">i32</span>) <span class="hljs-punctuation">-&gt;</span> &amp;<span class="hljs-symbol">&#x27;a</span> <span class="hljs-type">i32</span> &#123;<br>    <span class="hljs-keyword">if</span> *arg1 &gt; *arg2 &#123;<br>        arg1<br>    &#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>        arg2<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() &#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">x</span> = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">y</span> = <span class="hljs-number">2</span>;<br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">selected</span> = <span class="hljs-title function_ invoke__">select</span>(&amp;x, &amp;y);<br>    <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>, selected);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>select å‡½æ•°å¼•å…¥äº†ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸæ ‡è®°ï¼Œä¸¤ä¸ªå‚æ•°ä»¥åŠè¿”å›å€¼éƒ½æ˜¯ç”¨çš„è¿™ä¸ªç”Ÿå‘½å‘¨æœŸæ ‡è®°ã€‚åœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œä¼ é€’çš„å®å‚å…¶å®æ˜¯å…·å¤‡ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸçš„ã€‚x çš„ç”Ÿå‘½å‘¨æœŸæ˜æ˜¾å¤§äº y çš„ç”Ÿå‘½å‘¨æœŸï¼Œ&amp;x å¯å­˜æ´»çš„èŒƒå›´è¦å¤§äº&amp;y å¯å­˜æ´»çš„èŒƒå›´ï¼Œå°†å®ƒä»¬çš„å®é™…ç”Ÿå‘½å‘¨æœŸåˆ†åˆ«è®°å½•ä¸ºâ€™x å’Œâ€™yã€‚select å‡½æ•°çš„å½¢å¼å‚æ•°è¦æ±‚çš„æ˜¯åŒæ ·çš„ç”Ÿå‘½å‘¨æœŸï¼Œè€Œå®é™…å‚æ•°æ˜¯ä¸¤ä¸ªä¸åŒç”Ÿå‘½å‘¨æœŸçš„å¼•ç”¨ï¼Œè¿™ä¸ªç±»å‹ä¹‹æ‰€ä»¥å¯ä»¥åŒ¹é…æˆåŠŸï¼Œå°±æ˜¯å› ä¸ºç”Ÿå‘½å‘¨æœŸçš„åå˜ç‰¹æ€§ã€‚ç¼–è¯‘å™¨å¯ä»¥æŠŠ&amp;x å’Œ&amp;y çš„ç”Ÿå‘½å‘¨æœŸéƒ½ç¼©å°åˆ°æŸä¸ªç”Ÿå‘½å‘¨æœŸâ€™a ä»¥å†…ï¼Œä¸”æ»¡è¶³â€™xï¼š'aï¼Œ'yï¼š'aã€‚è¿”å›çš„ selected å˜é‡å…·å¤‡â€™a ç”Ÿå‘½å‘¨æœŸï¼Œä¹Ÿå¹¶æ²¡æœ‰è¶…è¿‡â€™x å’Œâ€™y çš„èŒƒå›´ã€‚æ‰€ä»¥ï¼Œæœ€ç»ˆçš„ç”Ÿå‘½å‘¨æœŸæ£€æŸ¥å¯ä»¥é€šè¿‡ã€‚</li></ul></li><li><p>ç¼–è¯‘å™¨ä½¿ç”¨ä¸‰æ¡æ¶ˆé™¤è§„åˆ™æ¥ç¡®å®šå“ªäº›åœºæ™¯ä¸éœ€è¦æ˜¾å¼åœ°å»æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸã€‚å…¶ä¸­ç¬¬ä¸€æ¡è§„åˆ™åº”ç”¨åœ¨è¾“å…¥ç”Ÿå‘½å‘¨æœŸä¸Šï¼Œç¬¬äºŒã€ä¸‰æ¡åº”ç”¨åœ¨è¾“å‡ºç”Ÿå‘½å‘¨æœŸä¸Šã€‚è‹¥ç¼–è¯‘å™¨å‘ç°ä¸‰æ¡è§„åˆ™éƒ½ä¸é€‚ç”¨æ—¶ï¼Œå°±ä¼šæŠ¥é”™ï¼Œæç¤ºä½ éœ€è¦æ‰‹åŠ¨æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸã€‚</p><ol><li>æ¯ä¸€ä¸ªå¼•ç”¨å‚æ•°éƒ½ä¼šè·å¾—ç‹¬è‡ªçš„ç”Ÿå‘½å‘¨æœŸä¾‹å¦‚ä¸€ä¸ªå¼•ç”¨å‚æ•°çš„å‡½æ•°å°±æœ‰ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸæ ‡æ³¨: <code>fn foo&lt;'a&gt;(x: &amp;'a i32)</code>â€‹ï¼Œä¸¤ä¸ªå¼•ç”¨å‚æ•°çš„æœ‰ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸæ ‡æ³¨:<code>fn foo&lt;'a, 'b&gt;(x: &amp;'a i32, y: &amp;'b i32)</code>â€‹, ä¾æ­¤ç±»æ¨ã€‚</li><li>â€‹è‹¥åªæœ‰ä¸€ä¸ªè¾“å…¥ç”Ÿå‘½å‘¨æœŸ(å‡½æ•°å‚æ•°ä¸­åªæœ‰ä¸€ä¸ªå¼•ç”¨ç±»å‹)ï¼Œé‚£ä¹ˆè¯¥ç”Ÿå‘½å‘¨æœŸä¼šè¢«èµ‹ç»™æ‰€æœ‰çš„è¾“å‡ºç”Ÿå‘½å‘¨æœŸâ€‹ï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰è¿”å›å€¼çš„ç”Ÿå‘½å‘¨æœŸéƒ½ç­‰äºè¯¥è¾“å…¥ç”Ÿå‘½å‘¨æœŸä¾‹å¦‚å‡½æ•° <code>fn foo(x: &amp;i32) -&gt; &amp;i32</code>â€‹ï¼Œ<code>x</code>â€‹ å‚æ•°çš„ç”Ÿå‘½å‘¨æœŸä¼šè¢«è‡ªåŠ¨èµ‹ç»™è¿”å›å€¼ <code>&amp;i32</code>â€‹ï¼Œå› æ­¤è¯¥å‡½æ•°ç­‰åŒäº <code>fn foo&lt;'a&gt;(x: &amp;'a i32) -&gt; &amp;'a i32</code>â€‹</li><li>è‹¥å­˜åœ¨å¤šä¸ªè¾“å…¥ç”Ÿå‘½å‘¨æœŸï¼Œä¸”å…¶ä¸­ä¸€ä¸ªæ˜¯ â€‹<code>&amp;self</code>â€‹ æˆ– â€‹â€‹<code>&amp;mut self</code>â€‹ï¼Œåˆ™ â€‹<code>&amp;self</code>â€‹â€‹ çš„ç”Ÿå‘½å‘¨æœŸè¢«èµ‹ç»™æ‰€æœ‰çš„è¾“å‡ºç”Ÿå‘½å‘¨æœŸæ‹¥æœ‰ <code>&amp;self</code>â€‹ å½¢å¼çš„å‚æ•°ï¼Œè¯´æ˜è¯¥å‡½æ•°æ˜¯ä¸€ä¸ª <code>æ–¹æ³•</code>â€‹ï¼Œè¯¥è§„åˆ™è®©æ–¹æ³•çš„ä½¿ç”¨ä¾¿åˆ©åº¦å¤§å¹…æå‡ã€‚</li></ol></li></ul><h2 id="chap-15-å†…éƒ¨å¯å˜æ€§"><a class="markdownIt-Anchor" href="#chap-15-å†…éƒ¨å¯å˜æ€§"></a> chap 15 å†…éƒ¨å¯å˜æ€§</h2><ul><li><p>Rust çš„ borrow checker çš„æ ¸å¿ƒæ€æƒ³æ˜¯â€œå…±äº«ä¸å¯å˜ï¼Œå¯å˜ä¸å…±äº«â€ã€‚ä½†æ˜¯åªæœ‰è¿™ä¸ªè§„åˆ™æ˜¯ä¸å¤Ÿçš„ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„ç¡®éœ€è¦åœ¨å­˜åœ¨å…±äº«çš„æƒ…å†µä¸‹å¯å˜ã€‚ä¸ºäº†è®©è¿™ç§æƒ…å†µæ˜¯å¯æ§çš„ã€å®‰å…¨çš„ï¼ŒRust è¿˜è®¾è®¡äº†ä¸€ç§â€œå†…éƒ¨å¯å˜æ€§â€ï¼ˆinterior mutabilityï¼‰</p></li><li><p>æ‰¿è¢­å¯å˜æ€§ï¼š<strong>Rust ä¸­çš„ mut å…³é”®å­—ä¸èƒ½åœ¨å£°æ˜ç±»å‹çš„æ—¶å€™ä½¿ç”¨ï¼Œåªèƒ½è·Ÿå˜é‡ä¸€èµ·ä½¿ç”¨ã€‚ç±»å‹æœ¬èº«ä¸èƒ½è§„å®šè‡ªå·±æ˜¯å¦æ˜¯å¯å˜çš„ã€‚ä¸€ä¸ªå˜é‡æ˜¯å¦æ˜¯å¯å˜çš„ï¼Œå–å†³äºå®ƒçš„ä½¿ç”¨ç¯å¢ƒï¼Œè€Œä¸æ˜¯å®ƒçš„ç±»å‹ã€‚å¯å˜è¿˜æ˜¯ä¸å¯å˜å–å†³äºå˜é‡çš„ä½¿ç”¨æ–¹å¼ã€‚ä¸èƒ½åœ¨ç±»å‹å£°æ˜çš„æ—¶å€™æŒ‡å®šå¯å˜æ€§ï¼Œæ¯”å¦‚åœ¨ struct ä¸­å¯¹æŸéƒ¨åˆ†æˆå‘˜ä½¿ç”¨ mut ä¿®é¥°ï¼Œè¿™æ˜¯ä¸åˆæ³•çš„ã€‚åªèƒ½åœ¨å˜é‡å£°æ˜çš„æ—¶å€™æŒ‡å®šå¯å˜æ€§ã€‚ä¹Ÿä¸èƒ½é’ˆå¯¹å˜é‡çš„æŸä¸€éƒ¨åˆ†æˆå‘˜æŒ‡å®šå¯å˜æ€§ï¼Œå…¶ä»–éƒ¨åˆ†ä¿æŒä¸å˜ã€‚</strong></p></li><li><p>å­˜åœ¨ &amp;mut T å°±ä¸èƒ½å­˜åœ¨ &amp;T çš„åŸå› ï¼šè¿™ä¼šå¼•å‘å†…å­˜å®‰å…¨é—®é¢˜ã€‚æ¯”å¦‚åŒæ—¶æ‹¥æœ‰ Vec çš„å¯å˜å¼•ç”¨å’Œä¸å¯å˜å¼•ç”¨ï¼Œé€šè¿‡å¯å˜å¼•ç”¨å‘è¯¥ Vec ä¸­ push æ•°æ®ï¼Œå‘ç”Ÿæ‰©å®¹åå†å»è¯»åŸæ¥çš„ä¸å¯å˜å¼•ç”¨ï¼Œæ­¤æ—¶é‚£å—å†…å­˜å·²ç»å¤±æ•ˆï¼ˆè¿­ä»£å™¨å¤±æ•ˆï¼‰</p></li><li><p>å†…éƒ¨å¯å˜æ€§â€”â€”å¯ä»¥é€šè¿‡å…±äº«æŒ‡é’ˆä¿®æ”¹å®ƒå†…éƒ¨çš„å€¼ã€‚è™½ç„¶ç²—ç•¥ä¸€çœ‹ï¼ŒCell ç±»å‹ä¼¼ä¹è¿åäº† Rust çš„â€œå”¯ä¸€ä¿®æ”¹æƒâ€åŸåˆ™ã€‚å¯ä»¥å­˜åœ¨å¤šä¸ªæŒ‡å‘ Cell ç±»å‹çš„ä¸å¯å˜å¼•ç”¨ï¼ŒåŒæ—¶è¿˜èƒ½åˆ©ç”¨ä¸å¯å˜å¼•ç”¨æ”¹å˜ Cell å†…éƒ¨çš„å€¼ã€‚ä½†å®é™…ä¸Šï¼Œè¿™ä¸ªç±»å‹æ˜¯å®Œå…¨ç¬¦åˆâ€œå†…å­˜å®‰å…¨â€çš„ã€‚å†æƒ³æƒ³ï¼Œä¸ºä»€ä¹ˆ Rust è¦å°½åŠ›é¿å… alias å’Œ mutation åŒæ—¶å­˜åœ¨ï¼Ÿå› ä¸ºå‡å¦‚åŒæ—¶æœ‰å¯å˜æŒ‡é’ˆå’Œä¸å¯å˜æŒ‡é’ˆæŒ‡å‘åŒä¸€å—å†…å­˜ï¼Œæœ‰å¯èƒ½å‡ºç°é€šè¿‡ä¸€ä¸ªå¯å˜æŒ‡é’ˆä¿®æ”¹å†…å­˜çš„è¿‡ç¨‹ä¸­ï¼Œæ•°æ®ç»“æ„å¤„äºè¢«ç ´åçŠ¶æ€çš„æƒ…å†µä¸‹ï¼Œè¢«å…¶ä»–çš„æŒ‡é’ˆè§‚æµ‹åˆ°ã€‚Cell ç±»å‹æ˜¯ä¸ä¼šå‡ºç°è¿™æ ·çš„æƒ…å†µçš„ã€‚å› ä¸º Cell ç±»å‹æŠŠæ•°æ®åŒ…è£¹åœ¨å†…éƒ¨ï¼Œç”¨æˆ·æ— æ³•è·å¾—æŒ‡å‘å†…éƒ¨çŠ¶æ€çš„æŒ‡é’ˆï¼Œè¿™æ„å‘³ç€æ¯æ¬¡æ–¹æ³•è°ƒç”¨éƒ½æ˜¯æ‰§è¡Œçš„ä¸€æ¬¡å®Œæ•´çš„æ•°æ®ç§»åŠ¨æ“ä½œã€‚æ¯æ¬¡æ–¹æ³•è°ƒç”¨ä¹‹åï¼ŒCell ç±»å‹çš„å†…éƒ¨éƒ½å¤„äºä¸€ä¸ªæ­£ç¡®çš„çŠ¶æ€ï¼Œä¸å¯èƒ½è§‚å¯Ÿåˆ°æ•°æ®è¢«ç ´åæ‰çš„çŠ¶æ€ã€‚å¤šä¸ªå…±äº«æŒ‡é’ˆæŒ‡å‘ Cell ç±»å‹çš„çŠ¶æ€å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒCell å°±æ˜¯ä¸€ä¸ªâ€œå£³â€ï¼Œå®ƒæŠŠæ•°æ®ä¸¥ä¸¥å®å®åœ°åŒ…è£¹åœ¨é‡Œé¢ï¼Œæ‰€æœ‰çš„æŒ‡é’ˆåªèƒ½æŒ‡å‘ Cellï¼Œä¸èƒ½ç›´æ¥æŒ‡å‘æ•°æ®ã€‚ä¿®æ”¹æ•°æ®åªèƒ½é€šè¿‡ Cell æ¥å®Œæˆï¼Œç”¨æˆ·æ— æ³•åˆ›é€ ä¸€ä¸ªç›´æ¥æŒ‡å‘æ•°æ®çš„æŒ‡é’ˆã€‚</p><ul><li>â€‹<img src="/img/blog_pic/2023/image-20230122104639-2m2f737.png" alt="image" />â€‹</li></ul></li><li><p>å†…éƒ¨å¯å˜æ€§çš„å®ç°æ˜¯å› ä¸º Rust ä½¿ç”¨äº† <code>unsafe</code>â€‹ æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œä½†æ˜¯å¯¹äºä½¿ç”¨è€…æ¥è¯´ï¼Œè¿™äº›éƒ½æ˜¯é€æ˜çš„ï¼Œå› ä¸ºè¿™äº›ä¸å®‰å…¨ä»£ç éƒ½è¢«å°è£…åˆ°äº†å®‰å…¨çš„ API ä¸­ ç”±äº <code>Cell</code>â€‹ ç±»å‹é’ˆå¯¹çš„æ˜¯å®ç°äº† <code>Copy</code>â€‹ ç‰¹å¾çš„å€¼ç±»å‹ï¼Œå› æ­¤åœ¨å®é™…å¼€å‘ä¸­ï¼Œ<code>Cell</code>â€‹ ä½¿ç”¨çš„å¹¶ä¸å¤šï¼Œå› ä¸ºæ—¶å®é™…è¦è§£å†³çš„å¾€å¾€æ˜¯å¯å˜ã€ä¸å¯å˜å¼•ç”¨å…±å­˜å¯¼è‡´çš„é—®é¢˜ï¼Œæ­¤æ—¶å°±éœ€è¦å€ŸåŠ©äº <code>RefCell</code>â€‹ æ¥è¾¾æˆç›®çš„ã€‚Cell ç±»å‹æ²¡åŠæ³•åˆ¶é€ å‡ºç›´æ¥æŒ‡å‘å†…éƒ¨æ•°æ®çš„æŒ‡é’ˆï¼Œè€Œ RefCell å¯ä»¥ï¼›Cell åªé€‚ç”¨äº Copy ç±»å‹ï¼Œç”¨äºæä¾›å€¼ï¼Œè€Œ RefCell ç”¨äºæä¾›å¼•ç”¨ã€‚RefCell ç±»å‹æ”¾å¼ƒäº†ç¼–è¯‘é˜¶æ®µçš„ alias+mutation åŸåˆ™ï¼Œä½†ä¾ç„¶ä¼šåœ¨æ‰§è¡Œé˜¶æ®µä¿è¯ alias+mutation åŸåˆ™ã€‚</p></li><li><table><thead><tr><th>Rust è§„åˆ™</th><th>æ™ºèƒ½æŒ‡é’ˆå¸¦æ¥çš„é¢å¤–è§„åˆ™</th></tr></thead><tbody><tr><td>ä¸€ä¸ªæ•°æ®åªæœ‰ä¸€ä¸ªæ‰€æœ‰è€…</td><td>â€‹<code>Rc/Arc</code> â€‹è®©ä¸€ä¸ªæ•°æ®å¯ä»¥æ‹¥æœ‰å¤šä¸ªæ‰€æœ‰è€…</td></tr><tr><td>è¦ä¹ˆå¤šä¸ªä¸å¯å˜å€Ÿç”¨ï¼Œè¦ä¹ˆä¸€ä¸ªå¯å˜å€Ÿç”¨</td><td>â€‹<code>RefCell</code> â€‹å®ç°ç¼–è¯‘æœŸå¯å˜ã€ä¸å¯å˜å¼•ç”¨å…±å­˜</td></tr><tr><td>è¿èƒŒè§„åˆ™å¯¼è‡´<strong>ç¼–è¯‘é”™è¯¯</strong></td><td>è¿èƒŒè§„åˆ™å¯¼è‡´è¿è¡Œæ—¶<code>panic</code>â€‹</td></tr></tbody></table><ul><li>å¯ä»¥çœ‹å‡ºï¼Œ<code>Rc/Arc</code>â€‹ å’Œ <code>RefCell</code>â€‹ åˆåœ¨ä¸€èµ·ï¼Œè§£å†³äº† Rust ä¸­ä¸¥è‹›çš„æ‰€æœ‰æƒå’Œå€Ÿç”¨è§„åˆ™å¸¦æ¥çš„æŸäº›åœºæ™¯ä¸‹éš¾ä½¿ç”¨çš„é—®é¢˜ã€‚ä½†æ˜¯å®ƒä»¬å¹¶ä¸æ˜¯é“¶å¼¹ï¼Œä¾‹å¦‚ <code>RefCell</code>â€‹ å®é™…ä¸Šå¹¶æ²¡æœ‰è§£å†³å¯å˜å¼•ç”¨å’Œå¼•ç”¨å¯ä»¥å…±å­˜çš„é—®é¢˜ï¼Œåªæ˜¯å°†æŠ¥é”™ä»ç¼–è¯‘æœŸæ¨è¿Ÿåˆ°è¿è¡Œæ—¶ï¼Œä»ç¼–è¯‘å™¨é”™è¯¯å˜æˆäº† <code>panic</code>â€‹ å¼‚å¸¸</li></ul></li><li><p>å†…éƒ¨å¯å˜æ€§å°ä¾‹å­</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs rust"><br><span class="hljs-keyword">pub</span> <span class="hljs-keyword">trait</span> <span class="hljs-title class_">Messenger</span> &#123;<br>    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">send</span>(&amp;<span class="hljs-keyword">self</span>, msg: <span class="hljs-type">String</span>);<br>&#125;<br><br><span class="hljs-comment">// --------------------------</span><br><span class="hljs-comment">// æˆ‘ä»¬çš„ä»£ç ä¸­çš„æ•°æ®ç»“æ„å’Œå®ç°</span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">MsgQueue</span> &#123;<br>    msg_cache: <span class="hljs-type">Vec</span>&lt;<span class="hljs-type">String</span>&gt;,<br>&#125;<br><br><span class="hljs-keyword">impl</span> <span class="hljs-title class_">Messenger</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">MsgQueue</span> &#123;<br>    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">send</span>(&amp;<span class="hljs-keyword">self</span>, msg: <span class="hljs-type">String</span>) &#123;<br>        <span class="hljs-keyword">self</span>.msg_cache.<span class="hljs-title function_ invoke__">push</span>(msg)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><p>å¦‚ä¸Šæ‰€ç¤ºï¼Œå¤–éƒ¨åº“ä¸­å®šä¹‰äº†ä¸€ä¸ªæ¶ˆæ¯å‘é€å™¨ç‰¹å¾ <code>Messenger</code>â€‹â€‹ï¼Œå®ƒåªæœ‰ä¸€ä¸ªå‘é€æ¶ˆæ¯çš„åŠŸèƒ½ï¼š<code>fn send(&amp;self, msg: String)</code>â€‹â€‹ï¼Œå› ä¸ºå‘é€æ¶ˆæ¯ä¸éœ€è¦ä¿®æ”¹è‡ªèº«ï¼Œå› æ­¤åŸä½œè€…åœ¨å®šä¹‰æ—¶ï¼Œä½¿ç”¨äº† <code>&amp;self</code>â€‹â€‹ çš„ä¸å¯å˜å€Ÿç”¨ï¼Œè¿™ä¸ªæ— å¯åšéã€‚</p><p>è¦åœ¨è‡ªå·±çš„ä»£ç ä¸­ä½¿ç”¨è¯¥ç‰¹å¾å®ç°ä¸€ä¸ªå¼‚æ­¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå‡ºäºæ€§èƒ½çš„è€ƒè™‘ï¼Œæ¶ˆæ¯å…ˆå†™åˆ°æœ¬åœ°ç¼“å­˜(å†…å­˜)ä¸­ï¼Œç„¶åæ‰¹é‡å‘é€å‡ºå»ï¼Œå› æ­¤åœ¨ <code>send</code>â€‹ æ–¹æ³•ä¸­ï¼Œéœ€è¦å°†æ¶ˆæ¯å…ˆè¡Œæ’å…¥åˆ°æœ¬åœ°ç¼“å­˜ <code>msg_cache</code>â€‹ ä¸­ã€‚ä½†æ˜¯é—®é¢˜æ¥äº†ï¼Œè¯¥ <code>send</code>â€‹ æ–¹æ³•çš„ç­¾åæ˜¯ <code>&amp;self</code>â€‹ï¼Œå› æ­¤ä¸Šè¿°ä»£ç ä¼šæŠ¥é”™ï¼š</p></li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs rust">error[E0596]: cannot borrow `<span class="hljs-keyword">self</span>.msg_cache` <span class="hljs-keyword">as</span> mutable, <span class="hljs-keyword">as</span> it is behind a `&amp;` reference<br>  -<span class="hljs-punctuation">-&gt;</span> src/main.rs:<span class="hljs-number">11</span>:<span class="hljs-number">9</span><br>   |<br><span class="hljs-number">2</span>  |     <span class="hljs-keyword">fn</span> <span class="hljs-title function_">send</span>(&amp;<span class="hljs-keyword">self</span>, msg: <span class="hljs-type">String</span>);<br>   |             ----- help: consider changing that to be a mutable reference: `&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>`<br>...<br><span class="hljs-number">11</span> |         <span class="hljs-keyword">self</span>.msg_cache.<span class="hljs-title function_ invoke__">push</span>(msg)<br>   |         ^^^^^^^^^^^^^^^^^^ `<span class="hljs-keyword">self</span>` is a `&amp;` reference, so the data it refers to cannot be borrowed <span class="hljs-keyword">as</span> mutable<br></code></pre></td></tr></table></figure><ul><li>åœ¨æŠ¥é”™çš„åŒæ—¶ï¼Œç¼–è¯‘å™¨å¤§èªæ˜è¿˜å–„æ„åœ°ç»™å‡ºäº†æç¤ºï¼šå°† <code>&amp;self</code>â€‹â€‹ ä¿®æ”¹ä¸º <code>&amp;mut self</code>â€‹â€‹ï¼Œä½†æ˜¯ã€‚ã€‚ã€‚æˆ‘ä»¬å®ç°çš„ç‰¹å¾æ˜¯å®šä¹‰åœ¨å¤–éƒ¨åº“ä¸­ï¼Œå› æ­¤è¯¥ç­¾åæ ¹æœ¬ä¸èƒ½ä¿®æ”¹ã€‚å€¼æ­¤å±æ€¥å…³å¤´ï¼Œ <code>RefCell</code>â€‹â€‹ é—ªäº®ç™»åœºï¼š</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">use</span> std::cell::RefCell;<br><span class="hljs-keyword">pub</span> <span class="hljs-keyword">trait</span> <span class="hljs-title class_">Messenger</span> &#123;<br>    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">send</span>(&amp;<span class="hljs-keyword">self</span>, msg: <span class="hljs-type">String</span>);<br>&#125;<br><br><span class="hljs-keyword">pub</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">MsgQueue</span> &#123;<br>    msg_cache: RefCell&lt;<span class="hljs-type">Vec</span>&lt;<span class="hljs-type">String</span>&gt;&gt;,<br>&#125;<br><br><span class="hljs-keyword">impl</span> <span class="hljs-title class_">Messenger</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">MsgQueue</span> &#123;<br>    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">send</span>(&amp;<span class="hljs-keyword">self</span>, msg: <span class="hljs-type">String</span>) &#123;<br>        <span class="hljs-keyword">self</span>.msg_cache.<span class="hljs-title function_ invoke__">borrow_mut</span>().<span class="hljs-title function_ invoke__">push</span>(msg)<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() &#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">mq</span> = MsgQueue &#123;<br>        msg_cache: RefCell::<span class="hljs-title function_ invoke__">new</span>(Vec::<span class="hljs-title function_ invoke__">new</span>()),<br>    &#125;;<br>    mq.<span class="hljs-title function_ invoke__">send</span>(<span class="hljs-string">&quot;hello, world&quot;</span>.<span class="hljs-title function_ invoke__">to_string</span>());<br>&#125;<br><br></code></pre></td></tr></table></figure><ul><li>è¿™ä¸ª MQ åŠŸèƒ½å¾ˆå¼±ï¼Œä½†æ˜¯å¹¶ä¸å¦¨ç¢æˆ‘ä»¬æ¼”ç¤ºå†…éƒ¨å¯å˜æ€§çš„æ ¸å¿ƒç”¨æ³•ï¼šé€šè¿‡åŒ…è£¹ä¸€å±‚ <code>RefCell</code>â€‹â€‹ï¼ŒæˆåŠŸçš„è®© <code>&amp;self</code>â€‹â€‹ ä¸­çš„ <code>msg_cache</code>â€‹â€‹ æˆä¸ºä¸€ä¸ªå¯å˜å€¼ï¼Œç„¶åå®ç°å¯¹å…¶çš„ä¿®æ”¹ã€‚</li></ul></li><li><p>æ€§èƒ½ä¸Šçœ‹ï¼Œ<code>RefCell</code>â€‹ ç”±äºæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œå› æ­¤æ— éœ€ä¿è¯åŸå­æ€§ï¼Œæ€§èƒ½è™½ç„¶æœ‰ä¸€ç‚¹æŸè€—ï¼ˆéœ€è¦ç»´æŠ¤ä¸€ä¸ªå€Ÿç”¨è®¡æ•°å™¨ï¼‰ï¼Œä½†æ˜¯ä¾ç„¶éå¸¸å¥½ï¼Œè€Œ <code>Cell</code>â€‹ åˆ™å®Œå…¨ä¸å­˜åœ¨ä»»ä½•é¢å¤–çš„æ€§èƒ½æŸè€—ã€‚</p><ul><li>RefCell åŸç†ï¼šRefCell å†…éƒ¨æœ‰ä¸€ä¸ªâ€œå€Ÿç”¨è®¡æ•°å™¨â€ï¼Œè°ƒç”¨ borrow æ–¹æ³•çš„æ—¶å€™ï¼Œè®¡æ•°å™¨é‡Œé¢çš„â€œå…±äº«å¼•ç”¨è®¡æ•°â€å€¼å°±åŠ  1ã€‚å½“è¿™ä¸ª borrow ç»“æŸçš„æ—¶å€™ï¼Œä¼šå°†è¿™ä¸ªå€¼è‡ªåŠ¨å‡ 1ï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰ã€‚åŒæ ·ï¼Œborrow_mut æ–¹æ³•è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œå®ƒå°±è®°å½•ä¸€ä¸‹å½“å‰å­˜åœ¨â€œå¯å˜å¼•ç”¨â€ã€‚å¦‚æœâ€œå…±äº«å¼•ç”¨â€å’Œâ€œå¯å˜å¼•ç”¨â€åŒæ—¶å‡ºç°äº†ï¼Œå°±ä¼šæŠ¥é”™ã€‚</li><li>â€‹<img src="/img/blog_pic/2023/image-20230122111220-h8k92j6.png" alt="image" />â€‹</li></ul></li><li><p><code>Cell::get_mut(&amp;mut self)</code>â€‹ å¯ä»¥è·å– &amp;mut Tï¼Œç”±æ­¤å¯ä»¥æ”¹å˜ Cell å†…éƒ¨åŒ…è£¹çš„å€¼ï¼›è¿™ä¸ªæ–¹æ³•å’Œ <code>Cell::set(&amp;self, , val: T)</code>â€‹ æœ‰ä½•åŒºåˆ«ï¼Ÿ å›ç­”ï¼šåŒºåˆ«åœ¨äº self çš„ç±»å‹ï¼Œå‰è€…æ˜¯å¯å˜å¼•ç”¨ï¼Œåè€…æ˜¯ä¸å¯å˜å¼•ç”¨ã€‚åœ¨èƒ½è·å–åˆ°å¯å˜å¼•ç”¨çš„æƒ…å†µä¸‹ä¿®æ”¹å†…éƒ¨çš„æ•°æ®æ˜¯ç†æ‰€å½“ç„¶çš„ï¼Œä½†æ­£æ˜¯åœ¨ä¸å¯å˜å¼•ç”¨ä¸‹è¿˜èƒ½ä¿®æ”¹ä½“ç°äº†å†…éƒ¨å¯å˜æ€§ã€‚</p></li><li><p>Cell å’Œ RefCell éƒ¨åˆ† API</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">impl</span>&lt;T&gt; Cell&lt;T&gt; &#123;<br>    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_mut</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> &amp;<span class="hljs-keyword">mut</span> T &#123; &#125;<br>    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">set</span>(&amp;<span class="hljs-keyword">self</span>, val: T) &#123; &#125;<br>    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">swap</span>(&amp;<span class="hljs-keyword">self</span>, other: &amp;<span class="hljs-keyword">Self</span>) &#123; &#125;<br>    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">replace</span>(&amp;<span class="hljs-keyword">self</span>, val: T) <span class="hljs-punctuation">-&gt;</span> T &#123; &#125;<br>    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">into_inner</span>(<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> T &#123; &#125;<br>&#125;<br><br><span class="hljs-keyword">impl</span>&lt;T:<span class="hljs-built_in">Copy</span>&gt; Cell&lt;T&gt; &#123;<br>    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">get</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> T &#123; &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">impl</span>&lt;T: ?<span class="hljs-built_in">Sized</span>&gt; RefCell&lt;T&gt; &#123;<br>    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">borrow</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> Ref&lt;T&gt; &#123; &#125;<br>    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">try_borrow</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;Ref&lt;T&gt;, BorrowError&gt; &#123; &#125;<br>    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">borrow_mut</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> RefMut&lt;T&gt; &#123; &#125;<br>    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">try_borrow_mut</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;RefMut&lt;T&gt;, BorrowMutError&gt; &#123; &#125;<br>    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_mut</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> &amp;<span class="hljs-keyword">mut</span> T &#123; &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h2 id="chap-16-è§£å¼•ç”¨æ™ºèƒ½æŒ‡é’ˆ"><a class="markdownIt-Anchor" href="#chap-16-è§£å¼•ç”¨æ™ºèƒ½æŒ‡é’ˆ"></a> chap 16 è§£å¼•ç”¨ï¼ˆæ™ºèƒ½æŒ‡é’ˆï¼‰</h2><ul><li><p>è§£å¼•ç”¨æ“ä½œå¯ä»¥è¢«è‡ªå®šä¹‰ã€‚æ–¹æ³•æ˜¯å®ç°æ ‡å‡†åº“ä¸­çš„ std::ops::Deref æˆ–è€… std::ops::DerefMut è¿™ä¸¤ä¸ª traitã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">pub</span> <span class="hljs-keyword">trait</span> <span class="hljs-title class_">Deref</span> &#123;<br>    <span class="hljs-keyword">type</span> <span class="hljs-title class_">Target</span>: ?<span class="hljs-built_in">Sized</span>;<br>    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">deref</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> &amp;<span class="hljs-keyword">Self</span>::Target;<br>&#125;<br><br><span class="hljs-keyword">pub</span> <span class="hljs-keyword">trait</span> <span class="hljs-title class_">DerefMut</span>: Deref &#123;<br>    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">deref_mut</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> &amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">Self</span>::Target;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>Rust æä¾›çš„â€œè‡ªåŠ¨è§£å¼•ç”¨â€æœºåˆ¶ï¼Œæ˜¯åœ¨æŸäº›åœºæ™¯ä¸‹â€œéšå¼åœ°â€â€œè‡ªåŠ¨åœ°â€åšäº†ä¸€äº›äº‹æƒ…ï¼šRust ç¼–è¯‘å™¨åšäº†éšå¼çš„ deref è°ƒç”¨ï¼Œå½“å®ƒæ‰¾ä¸åˆ°è¿™ä¸ªæˆå‘˜æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨å°è¯•ä½¿ç”¨ deref æ–¹æ³•åå†æ‰¾è¯¥æ–¹æ³•ï¼Œä¸€ç›´å¾ªç¯ä¸‹å»ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåœ¨å‡½æ•°è°ƒç”¨çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨ä¼šå¸®æˆ‘ä»¬å°è¯•è‡ªåŠ¨è§£å¼•ç”¨ã€‚ä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨ä¸ä¼šä¸ºæˆ‘ä»¬è‡ªåŠ¨æ’å…¥è‡ªåŠ¨è§£å¼•ç”¨çš„ä»£ç ã€‚</p></li><li><p>è‡ªåŠ¨ deref çš„è§„åˆ™æ˜¯ï¼Œå¦‚æœç±»å‹ T å¯ä»¥è§£å¼•ç”¨ä¸º Uï¼Œå³ <code>Tï¼šDeref&lt;U&gt;</code>ï¼Œåˆ™&amp;T å¯ä»¥è½¬ä¸º&amp;Uã€‚<strong>è®©æ™ºèƒ½æŒ‡é’ˆé€æ˜ã€‚è¿™å°±æ˜¯è‡ªåŠ¨ Deref çš„æ„ä¹‰ã€‚</strong></p></li><li><p>std::rc::Rc<T>ï¼šRc æŒ‡é’ˆåŠå…¶ clone å‡ºçš„æŒ‡é’ˆå¯¹å®ƒæŒ‡å‘çš„å†…éƒ¨æ•°æ®åªæœ‰è¯»åŠŸèƒ½ï¼Œå’Œå…±äº«å¼•ç”¨&amp;ä¸€è‡´ï¼Œå› æ­¤ï¼Œå®ƒæ˜¯å®‰å…¨çš„ã€‚åŒºåˆ«åœ¨äºï¼Œå…±äº«å¼•ç”¨å¯¹æ•°æ®å®Œå…¨æ²¡æœ‰æ‰€æœ‰æƒï¼Œä¸è´Ÿè´£å†…å­˜çš„é‡Šæ”¾ï¼ŒRc æŒ‡é’ˆä¼šåœ¨å¼•ç”¨è®¡æ•°å€¼å‡åˆ° 0 çš„æ—¶å€™é‡Šæ”¾å†…å­˜ã€‚Rust é‡Œé¢çš„ Rc&lt;T&gt;ç±»å‹ç±»ä¼¼äº C++ é‡Œé¢çš„ shared_ptr&lt;const T&gt;ç±»å‹ï¼Œä¸”å¼ºåˆ¶ä¸å¯ä¸ºç©ºã€‚</p><ul><li>Rc å®ç°äº† Clone å’Œ Drop è¿™ä¸¤ä¸ª traitã€‚åœ¨ clone æ–¹æ³•ä¸­ï¼Œå®ƒæ²¡æœ‰å¯¹å®ƒå†…éƒ¨çš„æ•°æ®å®è¡Œæ·±å¤åˆ¶ï¼Œè€Œæ˜¯å°†å¼ºå¼•ç”¨è®¡æ•°å€¼åŠ  1ï¼›åœ¨ drop æ–¹æ³•ä¸­ï¼Œä¹Ÿæ²¡æœ‰ç›´æ¥æŠŠå†…éƒ¨æ•°æ®é‡Šæ”¾æ‰ï¼Œè€Œæ˜¯å°†å¼ºå¼•ç”¨è®¡æ•°å€¼å‡ 1ï¼Œå½“å¼ºå¼•ç”¨è®¡æ•°å€¼å‡åˆ° 0 çš„æ—¶å€™ï¼Œæ‰ä¼šææ„æ‰å…±äº«çš„é‚£å—æ•°æ®ã€‚å½“å¼±å¼•ç”¨è®¡æ•°å€¼ä¹Ÿå‡ä¸º 0 çš„æ—¶å€™ï¼Œæ‰è¯´æ˜æ²¡æœ‰ä»»ä½• Rc/Weak æŒ‡é’ˆæŒ‡å‘è¿™å—å†…å­˜ï¼Œå®ƒå ç”¨çš„å†…å­˜æ‰ä¼šè¢«å½»åº•é‡Šæ”¾ã€‚</li><li>å†…éƒ¨çš„å¼•ç”¨è®¡æ•°æ˜¯ Cell<usize> ç±»å‹</li></ul></li><li><p>std::borrow::Cowï¼šå½“å®ƒåªéœ€è¦å¯¹æ‰€æŒ‡å‘çš„æ•°æ®è¿›è¡Œåªè¯»è®¿é—®çš„æ—¶å€™ï¼Œå®ƒå°±åªæ˜¯ä¸€ä¸ªå€Ÿç”¨æŒ‡é’ˆï¼›å½“å®ƒéœ€è¦å†™æ•°æ®åŠŸèƒ½æ—¶ï¼Œå®ƒä¼šå…ˆåˆ†é…å†…å­˜ï¼Œæ‰§è¡Œå¤åˆ¶æ“ä½œï¼Œå†å¯¹è‡ªå·±æ‹¥æœ‰æ‰€æœ‰æƒçš„å†…å­˜è¿›è¡Œå†™å…¥æ“ä½œã€‚</p></li><li><p>é›¶å¼€é”€åŸåˆ™ï¼š</p><blockquote><p>C++ implementations obey the zero-overhead principleï¼šWhat you donâ€™t useï¼Œyou donâ€™t pay for. And furtherï¼šWhat you do useï¼Œyou couldnâ€™t hand code any better.        â€”â€”Stroustrup</p></blockquote></li></ul>]]></content>
    
    
    <categories>
      
      <category>Rust</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>æ·±å…¥æµ…å‡º Rust ç¬”è®° Series 1</title>
    <link href="/2023/01/30/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%20Rust%E7%AC%94%E8%AE%B0%20Series%201/"/>
    <url>/2023/01/30/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%20Rust%E7%AC%94%E8%AE%B0%20Series%201/</url>
    
    <content type="html"><![CDATA[<h1 id="ç³»åˆ—å¯¼èˆª"><a class="markdownIt-Anchor" href="#ç³»åˆ—å¯¼èˆª"></a> ç³»åˆ—å¯¼èˆª</h1><ul><li><a href="https://young-flash.github.io/2023/01/30/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%20Rust%E7%AC%94%E8%AE%B0%20Series%201/">æ·±å…¥æµ…å‡º Rustç¬”è®° Series 1</a></li><li><a href="https://young-flash.github.io/2023/02/06/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%20Rust%E7%AC%94%E8%AE%B0%20Series%202/">æ·±å…¥æµ…å‡º Rustç¬”è®° Series 2</a></li><li><a href="https://young-flash.github.io/2023/03/09/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%20Rust%E7%AC%94%E8%AE%B0%20Series%203/">æ·±å…¥æµ…å‡º Rustç¬”è®° Series 3</a></li><li><a href="https://young-flash.github.io/2023/03/09/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%20Rust%E7%AC%94%E8%AE%B0%20Series%204/">æ·±å…¥æµ…å‡º Rustç¬”è®° Series 4</a></li></ul><p>è¿™æ˜¯æˆ‘åœ¨é˜…è¯»èŒƒé•¿æ˜¥çš„ã€Šæ·±å…¥æµ…å‡º Rustã€‹æ—¶åšçš„ç¬”è®°ï¼Œç»å¤§éƒ¨åˆ†å†…å®¹æºè‡ªæ­¤ä¹¦ï¼Œå¦æœ‰å°éƒ¨åˆ†å†…å®¹æºè‡ª <a href="https://course.rs/about-book.html">Rust åœ£ç»</a>ã€‚è¿™ä¸¤ä»½èµ„æ–™æ˜¯æˆ‘å…¥é—¨ Rust çš„ä¸»è¦ææ–™ã€‚</p><h1 id="ç¬¬ä¸€éƒ¨åˆ†-åŸºç¡€çŸ¥è¯†"><a class="markdownIt-Anchor" href="#ç¬¬ä¸€éƒ¨åˆ†-åŸºç¡€çŸ¥è¯†"></a> ç¬¬ä¸€éƒ¨åˆ† åŸºç¡€çŸ¥è¯†</h1><h2 id="chap-04-å‡½æ•°"><a class="markdownIt-Anchor" href="#chap-04-å‡½æ•°"></a> chap 04 å‡½æ•°</h2><h3 id="41-ç®€ä»‹"><a class="markdownIt-Anchor" href="#41-ç®€ä»‹"></a> 4.1 ç®€ä»‹</h3><ul><li><p>å‡½æ•°å¯ä»¥å½“æˆå¤´ç­‰å…¬æ°‘ï¼ˆfirst class valueï¼‰è¢«å¤åˆ¶åˆ°ä¸€ä¸ªå€¼ä¸­ï¼Œè¿™ä¸ªå€¼å¯ä»¥åƒå‡½æ•°ä¸€æ ·è¢«è°ƒç”¨ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>  <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">add2</span>((x,y) : (<span class="hljs-type">i32</span>,<span class="hljs-type">i32</span>)) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">i32</span> &#123;<br>x + y<br>&#125;<br><br><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() &#123;<br><span class="hljs-keyword">let</span> <span class="hljs-variable">p</span> = (<span class="hljs-number">1</span>, <span class="hljs-number">3</span>);<br><span class="hljs-comment">// func æ˜¯ä¸€ä¸ªå±€éƒ¨å˜é‡</span><br><span class="hljs-keyword">let</span> <span class="hljs-variable">func</span> = add2;<br><span class="hljs-comment">// func å¯ä»¥è¢«å½“æˆæ™®é€šå‡½æ•°ä¸€æ ·è¢«è°ƒç”¨</span><br><span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;evaluation output &#123;&#125;&quot;</span>, <span class="hljs-title function_ invoke__">func</span>(p));<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>æ¯ä¸€ä¸ªå‡½æ•°éƒ½å…·æœ‰è‡ªå·±å•ç‹¬çš„ç±»å‹ï¼Œä½†æ˜¯è¿™ä¸ªç±»å‹å¯ä»¥è‡ªåŠ¨è½¬æ¢åˆ° fn ç±»å‹</strong></p>  <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() &#123;<br><span class="hljs-comment">// å…ˆè®© func æŒ‡å‘ add1</span><br><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">func</span> = add1;<br><span class="hljs-comment">// å†é‡æ–°èµ‹å€¼,è®© func æŒ‡å‘ add2</span><br>func = add2;<br>&#125;<br><br>error[E0308]: mismatched types<br>-<span class="hljs-punctuation">-&gt;</span> test.rs:<span class="hljs-number">11</span>:<span class="hljs-number">12</span><br>|<br><span class="hljs-number">11</span> | func = add2;<br>| ^^^^ expected <span class="hljs-keyword">fn</span> <span class="hljs-title function_">item</span>, found a different <span class="hljs-keyword">fn</span> <span class="hljs-title function_">item</span><br>|<br>= note: expected <span class="hljs-keyword">type</span> `<span class="hljs-title function_ invoke__">fn</span>((<span class="hljs-type">i32</span>, <span class="hljs-type">i32</span>)) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">i32</span> &#123;add1&#125;`<br>found <span class="hljs-keyword">type</span> `<span class="hljs-title function_ invoke__">fn</span>((<span class="hljs-type">i32</span>, <span class="hljs-type">i32</span>)) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">i32</span> &#123;add2&#125;`<br></code></pre></td></tr></table></figure></li><li><p>è™½ç„¶ add1 å’Œ add2 æœ‰åŒæ ·çš„å‚æ•°ç±»å‹å’ŒåŒæ ·çš„è¿”å›å€¼ç±»å‹ï¼Œä½†å®ƒä»¬æ˜¯ä¸åŒç±»å‹ï¼Œæ‰€ä»¥è¿™é‡ŒæŠ¥é”™äº†ã€‚ä¿®å¤æ–¹æ¡ˆæ˜¯è®© func çš„ç±»å‹ä¸ºé€šç”¨çš„ fn ç±»å‹å³å¯ï¼š</p>  <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-comment">// å†™æ³•ä¸€,ç”¨ as ç±»å‹è½¬æ¢</span><br><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">func</span> = add1 <span class="hljs-keyword">as</span> <span class="hljs-title function_ invoke__">fn</span>((<span class="hljs-type">i32</span>,<span class="hljs-type">i32</span>))<span class="hljs-punctuation">-&gt;</span><span class="hljs-type">i32</span>;<br><span class="hljs-comment">// å†™æ³•äºŒ,ç”¨æ˜¾å¼ç±»å‹æ ‡è®°</span><br><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">func</span> : <span class="hljs-title function_ invoke__">fn</span>((<span class="hljs-type">i32</span>,<span class="hljs-type">i32</span>))<span class="hljs-punctuation">-&gt;</span><span class="hljs-type">i32</span> = add1;<br></code></pre></td></tr></table></figure></li><li><p>Rust çš„å‡½æ•°ä½“å†…ä¹Ÿå…è®¸å®šä¹‰å…¶ä»– itemï¼ŒåŒ…æ‹¬é™æ€å˜é‡ã€å¸¸é‡ã€å‡½æ•°ã€traitã€ç±»å‹ã€æ¨¡å—ç­‰ã€‚å½“ä½ éœ€è¦ä¸€äº› item ä»…åœ¨æ­¤å‡½æ•°å†…æœ‰ç”¨çš„æ—¶å€™ï¼Œå¯ä»¥æŠŠå®ƒä»¬ç›´æ¥å®šä¹‰åˆ°å‡½æ•°ä½“å†…ï¼Œä»¥é¿å…æ±¡æŸ“å¤–éƒ¨çš„å‘½åç©ºé—´ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">test_inner</span>() &#123;<br>    <span class="hljs-keyword">static</span> INNER_STATIC: <span class="hljs-type">i64</span> = <span class="hljs-number">42</span>;<br>    <span class="hljs-comment">// å‡½æ•°å†…éƒ¨å®šä¹‰çš„å‡½æ•°</span><br>    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">internal_incr</span>(x: <span class="hljs-type">i64</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">i64</span> &#123;<br>    x + <span class="hljs-number">1</span><br>    &#125;<br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">InnerTemp</span>(<span class="hljs-type">i64</span>);<br>    <span class="hljs-keyword">impl</span> <span class="hljs-title class_">InnerTemp</span> &#123;<br>        <span class="hljs-keyword">fn</span> <span class="hljs-title function_">incr</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) &#123;<br>            <span class="hljs-keyword">self</span>.<span class="hljs-number">0</span> = <span class="hljs-title function_ invoke__">internal_incr</span>(<span class="hljs-keyword">self</span>.<span class="hljs-number">0</span>);<br>        &#125;<br>    &#125;<br>     <span class="hljs-comment">// å‡½æ•°ä½“,æ‰§è¡Œè¯­å¥</span><br>    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">t</span> = <span class="hljs-title function_ invoke__">InnerTemp</span>(INNER_STATIC);<br>    t.<span class="hljs-title function_ invoke__">incr</span>();<br>    <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>, t.<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h3 id="42-å‘æ•£å‡½æ•°"><a class="markdownIt-Anchor" href="#42-å‘æ•£å‡½æ•°"></a> 4.2 å‘æ•£å‡½æ•°</h3><ul><li><p>Rust æ”¯æŒä¸€ç§ç‰¹æ®Šçš„å‘æ•£å‡½æ•°ï¼ˆDiverging functionsï¼‰ï¼Œå®ƒçš„è¿”å›ç±»å‹æ˜¯æ„Ÿå¹å·ï¼ã€‚</p></li><li><p>å‘æ•£ç±»å‹ ! çš„æœ€å¤§ç‰¹ç‚¹å°±æ˜¯ï¼Œå®ƒå¯ä»¥è¢«è½¬æ¢ä¸ºä»»æ„ä¸€ä¸ªç±»å‹ã€‚</p></li><li><p>åœ¨ Rust ä¸­ï¼Œæœ‰ä»¥ä¸‹è¿™äº›æƒ…å†µæ°¸è¿œä¸ä¼šè¿”å›ï¼Œå®ƒä»¬çš„ç±»å‹å°±æ˜¯ï¼</p><ul><li>panicï¼ä»¥åŠåŸºäºå®ƒå®ç°çš„å„ç§å‡½æ•°/å®ï¼Œæ¯”å¦‚ unimplementedï¼ã€unreachableï¼ï¼›</li><li>æ­»å¾ªç¯ loop{}ï¼›</li><li>è¿›ç¨‹é€€å‡ºå‡½æ•° std::process::exit ä»¥åŠç±»ä¼¼çš„ libc ä¸­çš„ exec ä¸€ç±»å‡½æ•°ã€‚</li></ul></li></ul><h3 id="43-main-å‡½æ•°"><a class="markdownIt-Anchor" href="#43-main-å‡½æ•°"></a> 4.3 main å‡½æ•°</h3><ul><li><p>ä¸å…¶ä»–ç¼–ç¨‹è¯­è¨€ä¹Ÿå› æ­¤ä¸º main å‡½æ•°è®¾è®¡äº†å‚æ•°å’Œè¿”å›å€¼ç±»å‹ç›¸æ¯”ï¼ŒRust çš„è®¾è®¡ç¨å¾®æœ‰ç‚¹ä¸ä¸€æ ·ï¼Œä¼ é€’å‚æ•°å’Œè¿”å›çŠ¶æ€ç éƒ½ç”±å•ç‹¬çš„ API æ¥å®Œæˆï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() &#123;<br>    <span class="hljs-keyword">for</span> <span class="hljs-variable">arg</span> <span class="hljs-keyword">in</span> std::env::<span class="hljs-title function_ invoke__">args</span>() &#123;<br>        <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;Arg: &#123;&#125;&quot;</span>, arg);<br>    &#125;<br>    std::process::<span class="hljs-title function_ invoke__">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br><br>ç¼–è¯‘ï¼Œæ‰§è¡Œå¹¶æºå¸¦å‡ ä¸ªå‚æ•°ï¼Œå¯ä»¥çœ‹åˆ°ï¼š<br>$ test -opt1 opt2 -- opt3<br>Arg: test<br>Arg: -opt1<br>Arg: opt2<br>Arg: --<br>Arg: opt3<br></code></pre></td></tr></table></figure></li><li><p>ç”¨ std::env::var() ä»¥åŠ std::env::vars() å‡½æ•°è¯»å–ç¯å¢ƒå˜é‡</p><ul><li>var() å‡½æ•°å¯ä»¥æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹å‚æ•°ï¼Œç”¨äºæŸ¥æ‰¾å½“å‰ç¯å¢ƒå˜é‡ä¸­æ˜¯å¦å­˜åœ¨è¿™ä¸ªåå­—çš„ç¯å¢ƒå˜é‡ï¼Œvars() å‡½æ•°ä¸æºå¸¦å‚æ•°ï¼Œå¯ä»¥è¿”å›æ‰€æœ‰çš„ç¯å¢ƒå˜é‡</li><li>æ­¤å‰ï¼ŒRust çš„ main å‡½æ•°åªæ”¯æŒæ— å‚æ•°ã€æ— è¿”å›å€¼ç±»å‹çš„å£°æ˜æ–¹å¼ï¼Œå³ main å‡½æ•°çš„ç­¾åå›ºå®šä¸ºï¼šfn mainï¼ˆï¼‰-&gt;ï¼ˆï¼‰ã€‚ä½†æ˜¯ï¼Œåœ¨å¼•å…¥äº†ï¼Ÿç¬¦å·ä½œä¸ºé”™è¯¯å¤„ç†è¯­æ³•ç³–ä¹‹åï¼Œå°±å˜å¾—ä¸é‚£ä¹ˆä¼˜é›…äº†ï¼Œå› ä¸ºï¼Ÿç¬¦å·è¦æ±‚å½“å‰æ‰€åœ¨çš„å‡½æ•°è¿”å›çš„æ˜¯ Result ç±»å‹ï¼Œè¿™æ ·ä¸€æ¥ï¼Œé—®å·å°±æ— æ³•ç›´æ¥åœ¨ main å‡½æ•°ä¸­ä½¿ç”¨äº†ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒRust è®¾è®¡ç»„æ‰©å±•äº† main å‡½æ•°çš„ç­¾åï¼Œä½¿å®ƒå˜æˆäº†ä¸€ä¸ªæ³›å‹å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„è¿”å›ç±»å‹å¯ä»¥æ˜¯ä»»ä½•ä¸€ä¸ªæ»¡è¶³ Terminationtrait çº¦æŸçš„ç±»å‹ï¼Œå…¶ä¸­ï¼ˆï¼‰ã€boolã€Result éƒ½æ˜¯æ»¡è¶³è¿™ä¸ªçº¦æŸçš„å®ƒä»¬éƒ½å¯ä»¥ä½œä¸º main å‡½æ•°çš„è¿”å›ç±»å‹ã€‚å…³äºè¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥å‚è§ç¬¬ 33 ç« </li></ul></li></ul><h3 id="44-const-fn"><a class="markdownIt-Anchor" href="#44-const-fn"></a> 4.4 const fn</h3><ul><li>å‡½æ•°å¯ä»¥ç”¨ const å…³é”®å­—ä¿®é¥°ï¼Œè¿™æ ·çš„å‡½æ•°å¯ä»¥åœ¨ç¼–è¯‘é˜¶æ®µè¢«ç¼–è¯‘å™¨æ‰§è¡Œï¼Œè¿”å›å€¼ä¹Ÿè¢«è§†ä¸ºç¼–è¯‘æœŸå¸¸é‡ã€‚const å‡½æ•°æ˜¯åœ¨ç¼–è¯‘é˜¶æ®µæ‰§è¡Œçš„ï¼Œå› æ­¤ç›¸æ¯”æ™®é€šå‡½æ•°æœ‰è®¸å¤šé™åˆ¶ï¼Œå¹¶éæ‰€æœ‰çš„è¡¨è¾¾å¼å’Œè¯­å¥éƒ½å¯ä»¥åœ¨å…¶ä¸­ä½¿ç”¨ã€‚</li></ul><h2 id="chap-05-trait"><a class="markdownIt-Anchor" href="#chap-05-trait"></a> chap 05 trait</h2><ul><li><p>Rust è¯­è¨€ä¸­çš„ trait æ˜¯éå¸¸é‡è¦çš„æ¦‚å¿µã€‚åœ¨ Rust ä¸­ï¼Œtrait è¿™ä¸€ä¸ªæ¦‚å¿µæ‰¿æ‹…äº†å¤šç§èŒè´£ã€‚</p></li><li><p><strong>trait æœ¬èº«æ—¢ä¸æ˜¯å…·ä½“ç±»å‹ï¼Œä¹Ÿä¸æ˜¯æŒ‡é’ˆç±»å‹ï¼Œå®ƒåªæ˜¯å®šä¹‰äº†é’ˆå¯¹ç±»å‹çš„ã€æŠ½è±¡çš„â€œçº¦æŸâ€ã€‚<strong>ä¸åŒçš„ç±»å‹å¯ä»¥å®ç°åŒä¸€ä¸ª traitï¼Œæ»¡è¶³åŒä¸€ä¸ª trait çš„ç±»å‹å¯èƒ½å…·æœ‰ä¸åŒçš„å¤§å°ã€‚å› æ­¤</strong>ï¼Œtrait åœ¨ç¼–è¯‘é˜¶æ®µæ²¡æœ‰å›ºå®šå¤§å°</strong>ï¼Œç›®å‰æˆ‘ä»¬ä¸èƒ½ç›´æ¥ä½¿ç”¨ trait ä½œä¸ºå®ä¾‹å˜é‡ã€å‚æ•°ã€è¿”å›å€¼ã€‚</p></li><li><p><a href="https://course.rs/basic/trait/trait.html#%E7%89%B9%E5%BE%81%E7%BA%A6%E6%9D%9Ftrait-bound">impl trait</a> åªæ˜¯ä¸€ä¸ªè¯­æ³•ç³–ã€‚<code>impl Trait</code> â€‹æ˜¯é™æ€åˆ†å‘ã€‚ç”¨äºæŒ‡å®šæœªå‘½åä½†æ˜¯å…·ä½“å­˜åœ¨çš„ç±»å‹ï¼ˆå¯ä»¥è¡¨è¾¾ä¸€ä¸ªä¸ç”¨è£…ç®±çš„åŒ¿åç±»å‹ï¼Œä»¥åŠå®ƒæ‰€æ»¡è¶³çš„åŸºæœ¬æ¥å£ï¼‰ï¼Œå…¶å®ç°äº†æŒ‡å®šçš„ <code>Trait</code>â€‹ï¼Œå¯ç”¨ä½œå‡½æ•°å‚æ•°ç±»å‹å’Œè¿”å›å€¼ç±»å‹ã€‚<strong>è·Ÿæ³›å‹å‡½æ•°çš„ä¸»è¦åŒºåˆ«æ˜¯ï¼šæ³›å‹å‡½æ•°çš„ç±»å‹å‚æ•°æ˜¯å‡½æ•°çš„è°ƒç”¨è€…æŒ‡å®šçš„ï¼›è€Œ impl trait çš„å…·ä½“ç±»å‹æ˜¯å‡½æ•°çš„å®ç°ä½“æŒ‡å®šçš„ï¼ˆè¿˜ä¸å¤ªç†è§£ï¼‰ã€‚</strong></p><p>â€‹<img src="/img/blog_pic/2023/image-20230118144746-y4rop2h.png" alt="image" />â€‹</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">notify</span>(item: &amp;<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Summary</span>) &#123;<br>    <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;Breaking news! &#123;&#125;&quot;</span>, item.<span class="hljs-title function_ invoke__">summarize</span>());<br>&#125;<br><br><span class="hljs-comment">// https://rust-book.cs.brown.edu/ch10-02-traits.html#trait-bound-syntax</span><br><span class="hljs-comment">// The impl Trait syntax works for straightforward cases </span><br><span class="hljs-comment">// but is actually syntax sugar for a longer form known as a trait bound;</span><br><span class="hljs-comment">// it looks like this:</span><br><br><br><span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">notify</span>&lt;T: Summary&gt;(item: &amp;T) &#123;<br>    <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;Breaking news! &#123;&#125;&quot;</span>, item.<span class="hljs-title function_ invoke__">summarize</span>());<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><p>â€‹<code>impl dyn Trait</code>â€‹ï¼šç»™ <code>Trait Object</code> â€‹å¢åŠ æ–¹æ³•ã€‚<a href="https://zhuanlan.zhihu.com/p/257090324">å‚è€ƒ</a></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">trait</span> <span class="hljs-title class_">Animal</span> &#123;<br>     <span class="hljs-keyword">fn</span> <span class="hljs-title function_">walk</span>(&amp;<span class="hljs-keyword">self</span>) &#123;<br>         <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;walk&quot;</span>);<br>     &#125;<br> &#125;<br> â€‹<br> <span class="hljs-keyword">impl</span> <span class="hljs-title class_">dyn</span> Animal &#123;<br>     <span class="hljs-keyword">fn</span> <span class="hljs-title function_">talk</span>(&amp;<span class="hljs-keyword">self</span>) &#123;<br>         <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;talk&quot;</span>);<br>     &#125;<br> &#125;<br> â€‹<br> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">Person</span>;<br> â€‹<br> <span class="hljs-keyword">impl</span> <span class="hljs-title class_">Animal</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">Person</span> &#123;&#125;<br> â€‹<br> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">demo</span>() <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Box</span>&lt;<span class="hljs-keyword">dyn</span> Animal&gt; &#123;<br>     <span class="hljs-keyword">let</span> <span class="hljs-variable">p</span> = Person;<br>     Box::<span class="hljs-title function_ invoke__">new</span>(p)<br> &#125;<br> â€‹<br> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() &#123;<br>     <span class="hljs-keyword">let</span> <span class="hljs-variable">p</span> = Person;<br>     p.<span class="hljs-title function_ invoke__">walk</span>();<br> â€‹<br>     <span class="hljs-keyword">let</span> <span class="hljs-variable">p1</span> = <span class="hljs-title function_ invoke__">demo</span>();<br>     p1.<span class="hljs-title function_ invoke__">walk</span>();<br>     p1.<span class="hljs-title function_ invoke__">talk</span>();<br> &#125;<br></code></pre></td></tr></table></figure></li></ul></li><li><p>å‚è€ƒ</p><ul><li><a href="https://zhuanlan.zhihu.com/p/109990547">æ‹æ‹ Rust ä¸­çš„ impl Trait å’Œ dyn Trait</a></li></ul></li></ul><h3 id="51-æˆå‘˜æ–¹æ³•"><a class="markdownIt-Anchor" href="#51-æˆå‘˜æ–¹æ³•"></a> 5.1 æˆå‘˜æ–¹æ³•</h3><ul><li><p>Self ç±»å‹ï¼šæ‰€æœ‰çš„ trait ä¸­éƒ½æœ‰ä¸€ä¸ªéšè—çš„ç±»å‹ Selfï¼ˆå¤§å†™ Sï¼‰ï¼Œä»£è¡¨å½“å‰è¿™ä¸ªå®ç°äº†æ­¤ trait çš„å…·ä½“ç±»å‹ã€‚Rust ä¸­ Selfï¼ˆå¤§å†™ Sï¼‰å’Œ selfï¼ˆå°å†™ sï¼‰éƒ½æ˜¯å…³é”®å­—ï¼Œå¤§å†™ S çš„æ˜¯ç±»å‹åï¼Œå°å†™ s çš„æ˜¯å˜é‡åã€‚</p></li><li><p><strong>self å‚æ•°åŒæ ·ä¹Ÿå¯ä»¥æŒ‡å®šç±»å‹ï¼Œå½“ç„¶è¿™ä¸ªç±»å‹æ˜¯æœ‰é™åˆ¶çš„ï¼Œå¿…é¡»æ˜¯åŒ…è£…åœ¨ Self ç±»å‹ä¹‹ä¸Šçš„ç±»å‹</strong>ã€‚å¯¹äºç¬¬ä¸€ä¸ª self å‚æ•°ï¼Œå¸¸è§çš„ç±»å‹æœ‰ selfï¼šSelfã€selfï¼š&amp;Selfã€selfï¼š&amp;mut Self ç­‰ç±»å‹ã€‚å¯¹äºä»¥ä¸Šè¿™äº›ç±»å‹ï¼ŒRust æä¾›äº†ä¸€ç§ç®€åŒ–çš„å†™æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å°†å‚æ•°ç®€å†™ä¸º selfã€&amp;selfã€&amp;mut selfã€‚<strong>self å‚æ•°ç”šè‡³å¯ä»¥æ˜¯ Box æŒ‡é’ˆç±»å‹ selfï¼šBox&lt;Self&gt;</strong>ã€‚self å‚æ•°åªèƒ½ç”¨åœ¨ç¬¬ä¸€ä¸ªå‚æ•°çš„ä½ç½®ã€‚è¯·æ³¨æ„â€œå˜é‡ selfâ€å’Œâ€œç±»å‹ Selfâ€çš„å¤§å°å†™ä¸åŒã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">trait</span> <span class="hljs-title class_">T</span> &#123;<br>    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">method1</span>(<span class="hljs-keyword">self</span>: <span class="hljs-keyword">Self</span>);<br>    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">method2</span>(<span class="hljs-keyword">self</span>: &amp;<span class="hljs-keyword">Self</span>);<br>    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">method3</span>(<span class="hljs-keyword">self</span>: &amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">Self</span>);<br>&#125;<br><span class="hljs-comment">// ä¸Šä¸‹ä¸¤ç§å†™æ³•æ˜¯å®Œå…¨ä¸€æ ·çš„</span><br><span class="hljs-keyword">trait</span> <span class="hljs-title class_">T</span> &#123;<br>    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">method1</span>(<span class="hljs-keyword">self</span>);<br>    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">method2</span>(&amp;<span class="hljs-keyword">self</span>);<br>    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">method3</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>);<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>trait ä¸­å®šä¹‰çš„å‡½æ•°ï¼Œä¹Ÿå¯ä»¥ç§°ä½œå…³è”å‡½æ•°ï¼ˆassociated functionï¼‰ã€‚å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å¦‚æœæ˜¯ Self ç›¸å…³çš„ç±»å‹ï¼Œä¸”å‘½åä¸º selfï¼ˆå°å†™ sï¼‰ï¼Œè¿™ä¸ªå‚æ•°å¯ä»¥è¢«ç§°ä¸ºâ€œreceiverâ€ï¼ˆæ¥æ”¶è€…ï¼‰ã€‚å…·æœ‰ receiver å‚æ•°çš„å‡½æ•°ï¼Œæˆ‘ä»¬ç§°ä¸ºâ€œæ–¹æ³•â€ï¼ˆmethodï¼‰ï¼Œå¯ä»¥é€šè¿‡å˜é‡å®ä¾‹ä½¿ç”¨å°æ•°ç‚¹æ¥è°ƒç”¨ã€‚æ²¡æœ‰ receiver å‚æ•°çš„å‡½æ•°ï¼Œæˆ‘ä»¬ç§°ä¸ºâ€œé™æ€å‡½æ•°â€ï¼ˆstatic functionï¼‰ï¼Œå¯ä»¥é€šè¿‡ç±»å‹åŠ åŒå†’å·::çš„æ–¹å¼æ¥è°ƒç”¨ã€‚åœ¨ Rust ä¸­ï¼Œå‡½æ•°å’Œæ–¹æ³•æ²¡æœ‰æœ¬è´¨åŒºåˆ«</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Circle</span> &#123;<br>    radius: <span class="hljs-type">f64</span>,<br>&#125;<br><br><span class="hljs-keyword">trait</span> <span class="hljs-title class_">Shape</span> &#123;<br>    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">area</span>(<span class="hljs-keyword">self</span>: &amp;<span class="hljs-keyword">Self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">f64</span>;<br>&#125;<br><br><span class="hljs-keyword">impl</span> <span class="hljs-title class_">Shape</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">Circle</span> &#123;<br>    <span class="hljs-comment">// Self ç±»å‹å°±æ˜¯ Circle</span><br>    <span class="hljs-comment">// self çš„ç±»å‹æ˜¯ &amp;Self,å³ &amp;Circle</span><br>    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">area</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">f64</span> &#123;<br>        <span class="hljs-comment">// è®¿é—®æˆå‘˜å˜é‡,éœ€è¦ç”¨ self.radius</span><br>        std::f64::consts::PI * <span class="hljs-keyword">self</span>.radius * <span class="hljs-keyword">self</span>.radius<br>    &#125;<br>&#125;<br><br><br><span class="hljs-keyword">let</span> <span class="hljs-variable">c</span> = Circle &#123; radius : <span class="hljs-number">2f64</span>&#125;;<br><span class="hljs-comment">// ç¬¬ä¸€ä¸ªå‚æ•°åå­—æ˜¯ self,å¯ä»¥ä½¿ç”¨å°æ•°ç‚¹è¯­æ³•è°ƒç”¨</span><br><span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;The area is &#123;&#125;&quot;</span>, c.<span class="hljs-title function_ invoke__">area</span>());  <span class="hljs-comment">// è¿™é‡Œç”¨ c æˆ–è€… &amp;c éƒ½å¯ä»¥ã€‚Deref ?</span><br></code></pre></td></tr></table></figure></li><li><p>é’ˆå¯¹ä¸€ä¸ªç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å¯¹å®ƒ impl æ¥å¢åŠ æˆå‘˜æ–¹æ³•ï¼Œæ— é¡» trait åå­—ã€‚<strong>å¯ä»¥çœ‹ä½œæ˜¯ä¸ºè¯¥ç±»å‹ impl äº†ä¸€ä¸ªåŒ¿åçš„ trait</strong>ã€‚ç”¨è¿™ç§æ–¹å¼å®šä¹‰çš„æ–¹æ³•å«ä½œè¿™ä¸ªç±»å‹çš„â€œå†…åœ¨æ–¹æ³•â€ï¼ˆinherent methodsï¼‰</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Circle</span> &#123;<br>    radius: <span class="hljs-type">f64</span>,<br>&#125;<br><br><span class="hljs-keyword">impl</span> <span class="hljs-title class_">Circle</span> &#123;<br>    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_radius</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">f64</span> &#123; <span class="hljs-keyword">self</span>.radius &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h3 id="52-é™æ€æ–¹æ³•"><a class="markdownIt-Anchor" href="#52-é™æ€æ–¹æ³•"></a> 5.2 é™æ€æ–¹æ³•</h3><ul><li><p>æ²¡æœ‰ receiver å‚æ•°çš„æ–¹æ³•ï¼ˆç¬¬ä¸€ä¸ªå‚æ•°ä¸æ˜¯ self å‚æ•°çš„æ–¹æ³•ï¼‰ç§°ä½œâ€œé™æ€æ–¹æ³•â€ã€‚é™æ€æ–¹æ³•å¯ä»¥é€šè¿‡ Type::FunctionNameï¼ˆï¼‰çš„æ–¹å¼è°ƒç”¨ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå³ä¾¿æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ Self ç›¸å…³ç±»å‹ï¼Œåªè¦å˜é‡åå­—ä¸æ˜¯ selfï¼Œå°±ä¸èƒ½ä½¿ç”¨å°æ•°ç‚¹çš„è¯­æ³•è°ƒç”¨å‡½æ•°ã€‚</p><ul><li>åœ¨æ ‡å‡†åº“ä¸­å°±æœ‰ä¸€äº›è¿™æ ·çš„ä¾‹å­ã€‚Box çš„ä¸€ç³»åˆ—æ–¹æ³• Box::into_rawï¼ˆbï¼šSelfï¼‰Box::leakï¼ˆbï¼šSelfï¼‰ï¼Œä»¥åŠ Rc çš„ä¸€ç³»åˆ—æ–¹æ³• Rc::try_unwrapï¼ˆthisï¼šSelfï¼‰Rc::downgradeï¼ˆthisï¼š&amp;Selfï¼‰ï¼Œéƒ½æ˜¯è¿™ç§æƒ…å†µã€‚å®ƒä»¬çš„ receiver ä¸æ˜¯ self å…³é”®å­—ï¼Œè¿™æ ·è®¾è®¡çš„ç›®çš„æ˜¯å¼ºåˆ¶ç”¨æˆ·ç”¨ Rc::downgradeï¼ˆ&amp;objï¼‰çš„å½¢å¼è°ƒç”¨ï¼Œè€Œç¦æ­¢ obj.downgradeï¼ˆï¼‰å½¢å¼çš„è°ƒç”¨ã€‚è¿™æ ·æºç è¡¨è¾¾å‡ºæ¥çš„æ„æ€æ›´æ¸…æ™°ï¼Œä¸ä¼šå› ä¸º Rc<T> é‡Œé¢çš„æˆå‘˜æ–¹æ³•å’Œ T é‡Œé¢çš„æˆå‘˜æ–¹æ³•é‡åè€Œé€ æˆè¯¯è§£é—®é¢˜ï¼ˆè¿™åˆæ¶‰åŠ Deref trait çš„å†…å®¹ï¼Œè¯»è€…å¯ä»¥æŠŠç¬¬ 16 ç« è¯»å®Œå†å›çœ‹è¿™ä¸€æ®µï¼‰ã€‚</li></ul></li></ul><h3 id="53-æ‰©å±•æ–¹æ³•"><a class="markdownIt-Anchor" href="#53-æ‰©å±•æ–¹æ³•"></a> 5.3 æ‰©å±•æ–¹æ³•</h3><ul><li><p>å¯ä»¥åˆ©ç”¨ trait ç»™å…¶ä»–çš„ç±»å‹æ·»åŠ æˆå‘˜æ–¹æ³•ï¼Œå°±åƒ C# é‡Œé¢çš„â€œæ‰©å±•æ–¹æ³•â€ä¸€æ ·ã€‚å“ªæ€•è¿™ä¸ªç±»å‹ä¸æ˜¯åœ¨å½“å‰çš„é¡¹ç›®ä¸­å£°æ˜çš„ï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥ä¸ºå®ƒå¢åŠ ä¸€äº›æˆå‘˜æ–¹æ³•ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">trait</span> <span class="hljs-title class_">Double</span> &#123;<br>    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">double</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span>;<br>&#125;<br><span class="hljs-keyword">impl</span> <span class="hljs-title class_">Double</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">i32</span> &#123;<br>    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">double</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">i32</span> &#123; *<span class="hljs-keyword">self</span> * <span class="hljs-number">2</span> &#125;<br>&#125;<br><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() &#123;<br><span class="hljs-comment">// å¯ä»¥åƒæˆå‘˜æ–¹æ³•ä¸€æ ·è°ƒç”¨</span><br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">x</span> : <span class="hljs-type">i32</span> = <span class="hljs-number">10</span>.<span class="hljs-title function_ invoke__">double</span>();<br>    <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>, x);<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>åœ¨å£°æ˜ trait å’Œ impl trait çš„æ—¶å€™ï¼ŒRust è§„å®šäº†ä¸€ä¸ª Coherence Ruleï¼ˆä¸€è‡´æ€§è§„åˆ™ï¼‰æˆ–ç§°ä¸º <strong>Orphan Ruleï¼ˆå­¤å„¿è§„åˆ™ï¼‰</strong>ï¼šimpl å—è¦ä¹ˆä¸ trait çš„å£°æ˜åœ¨åŒä¸€ä¸ªçš„ crate ä¸­ï¼Œè¦ä¹ˆä¸ç±»å‹çš„å£°æ˜åœ¨åŒä¸€ä¸ª crate ä¸­ã€‚</p><ul><li>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœ trait æ¥è‡ªäºå¤–éƒ¨ crateï¼Œè€Œä¸”ç±»å‹ä¹Ÿæ¥è‡ªäºå¤–éƒ¨ crateï¼Œç¼–è¯‘å™¨ä¸å…è®¸ä½ ä¸ºè¿™ä¸ªç±»å‹ impl è¿™ä¸ª traitã€‚å®ƒä»¬ä¹‹ä¸­å¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ªæ˜¯åœ¨å½“å‰ crate ä¸­å®šä¹‰çš„ã€‚</li><li>ä¸Šæ¸¸å¼€å‘è€…åœ¨ç»™åˆ«äººå†™åº“çš„æ—¶å€™ï¼Œå°¤å…¶è¦æ³¨æ„ï¼Œä¸€äº›æ¯”è¾ƒå¸¸è§çš„æ ‡å‡†åº“ä¸­çš„ traitï¼Œå¦‚ Display Debug ToString Default ç­‰ï¼Œåº”è¯¥å°½å¯èƒ½åœ°æä¾›å¥½ã€‚å¦åˆ™ï¼Œä½¿ç”¨è¿™ä¸ªåº“çš„ä¸‹æ¸¸å¼€å‘è€…æ˜¯æ²¡åŠæ³•å¸®æˆ‘ä»¬æŠŠè¿™äº› trait å®ç°çš„ã€‚</li></ul></li></ul><h3 id="54-å®Œæ•´å‡½æ•°è°ƒç”¨è¯­æ³•"><a class="markdownIt-Anchor" href="#54-å®Œæ•´å‡½æ•°è°ƒç”¨è¯­æ³•"></a> 5.4 å®Œæ•´å‡½æ•°è°ƒç”¨è¯­æ³•</h3><ul><li><p>Fully Qualified Syntax æä¾›ä¸€ç§æ— æ­§ä¹‰çš„å‡½æ•°è°ƒç”¨è¯­æ³•ï¼Œå…è®¸ç¨‹åºå‘˜ç²¾ç¡®åœ°æŒ‡å®šæƒ³è°ƒç”¨çš„æ˜¯é‚£ä¸ªå‡½æ•°ã€‚ä»¥å‰ä¹Ÿå« UFCSï¼ˆuniversal function call syntaxï¼‰ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„â€œé€šç”¨å‡½æ•°è°ƒç”¨è¯­æ³•â€ï¼ŒåŒ…æ‹¬æˆå‘˜æ–¹æ³•å’Œé™æ€æ–¹æ³•ã€‚</p></li><li><p>å…·ä½“å†™æ³•ä¸º T as TraitName::item</p></li><li><p>å¦‚æœä¸€ä¸ªç±»å‹åŒæ—¶å®ç°äº†è¿™ä¸¤ä¸ª traitï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬ä½¿ç”¨ obj.method() è¿™æ ·çš„è¯­æ³•æ‰§è¡Œæ–¹æ³•è°ƒç”¨çš„è¯ï¼Œå°±ä¼šå‡ºç°æ­§ä¹‰ï¼Œç¼–è¯‘å™¨ä¸çŸ¥é“ä½ å…·ä½“æƒ³è°ƒç”¨å“ªä¸ªæ–¹æ³•ï¼Œç¼–è¯‘é”™è¯¯ä¿¡æ¯ä¸ºâ€œmultiple applicable items in scopeâ€ã€‚æ­¤æ—¶å°±æœ‰å¿…è¦ä½¿ç”¨å®Œæ•´çš„å‡½æ•°è°ƒç”¨è¯­æ³•æ¥è¿›è¡Œæ–¹æ³•è°ƒç”¨ï¼Œåªæœ‰è¿™æ ·å†™ï¼Œæ‰èƒ½æ¸…æ™°æ˜ç™½ä¸”æ— æ­§ä¹‰åœ°è¡¨è¾¾æ¸…æ¥šæœŸæœ›è°ƒç”¨çš„æ˜¯å“ªä¸ªå‡½æ•°ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">trait</span> <span class="hljs-title class_">Cook</span> &#123;<br>    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">start</span>(&amp;<span class="hljs-keyword">self</span>);<br>&#125;<br><span class="hljs-keyword">trait</span> <span class="hljs-title class_">Wash</span> &#123;<br>    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">start</span>(&amp;<span class="hljs-keyword">self</span>);<br>&#125;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Chef</span>;<br><span class="hljs-keyword">impl</span> <span class="hljs-title class_">Cook</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">Chef</span> &#123;<br>    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">start</span>(&amp;<span class="hljs-keyword">self</span>) &#123; <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;Cook::start&quot;</span>);&#125;<br>&#125;<br><span class="hljs-keyword">impl</span> <span class="hljs-title class_">Wash</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">Chef</span> &#123;<br>    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">start</span>(&amp;<span class="hljs-keyword">self</span>) &#123; <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;Wash::start&quot;</span>);&#125;<br>&#125;<br><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() &#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">me</span> = Chef;<br>    <span class="hljs-comment">// me.start();  // ç¼–è¯‘é”™è¯¯</span><br><br>    <span class="hljs-comment">// åº”å†™ä¸ºä¸‹é¢è¿™ç§å½¢å¼</span><br>    &lt;Cook&gt;::<span class="hljs-title function_ invoke__">start</span>(&amp;me);<br>    &lt;Chef <span class="hljs-keyword">as</span> Wash&gt;::<span class="hljs-title function_ invoke__">start</span>(&amp;me);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>ç”±æ­¤ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œæ‰€è°“çš„â€œæˆå‘˜æ–¹æ³•â€ä¹Ÿæ²¡ä»€ä¹ˆç‰¹æ®Šä¹‹å¤„ï¼Œå®ƒè·Ÿæ™®é€šçš„é™æ€æ–¹æ³•çš„å”¯ä¸€åŒºåˆ«æ˜¯ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ selfï¼Œè€Œè¿™ä¸ª self åªæ˜¯ä¸€ä¸ªæ™®é€šçš„å‡½æ•°å‚æ•°è€Œå·²ã€‚åªä¸è¿‡è¿™ç§æˆå‘˜æ–¹æ³•ä¹Ÿå¯ä»¥é€šè¿‡å˜é‡åŠ å°æ•°ç‚¹çš„æ–¹å¼è°ƒç”¨ã€‚<strong>å˜é‡åŠ å°æ•°ç‚¹çš„è°ƒç”¨æ–¹å¼åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹çœ‹èµ·æ¥æ›´ç®€å•æ›´ç¾è§‚ï¼Œå®Œå…¨å¯ä»¥è§†ä¸ºä¸€ç§è¯­æ³•ç³–ã€‚</strong></li><li><strong>é€šè¿‡å°æ•°ç‚¹è¯­æ³•è°ƒç”¨æ–¹æ³•è°ƒç”¨ï¼Œæœ‰ä¸€ä¸ªâ€œéšè—ç€â€çš„â€œå–å¼•ç”¨â€æ­¥éª¤</strong>ã€‚è™½ç„¶æˆ‘ä»¬çœ‹èµ·æ¥æºä»£ç é•¿çš„æ˜¯è¿™ä¸ªæ ·å­ me.startï¼ˆï¼‰ï¼Œä½†æ˜¯çœŸæ­£ä¼ é€’ç»™ startï¼ˆï¼‰æ–¹æ³•çš„å‚æ•°æ˜¯&amp;me è€Œä¸æ˜¯ meï¼Œè¿™ä¸€æ­¥æ˜¯ç¼–è¯‘å™¨è‡ªåŠ¨åšçš„ã€‚ä¸è®ºè¿™ä¸ªæ–¹æ³•æ¥å—çš„ self å‚æ•°ç©¶ç«Ÿæ˜¯ Selfã€&amp;Self è¿˜æ˜¯&amp;mut Selfï¼Œæœ€ç»ˆåœ¨æºç ä¸Šï¼Œæˆ‘ä»¬éƒ½æ˜¯ç»Ÿä¸€çš„å†™æ³•ï¼švariable.methodï¼ˆï¼‰ã€‚è€Œå¦‚æœç”¨ UFCS è¯­æ³•æ¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå°±ä¸èƒ½è®©ç¼–è¯‘å™¨è‡ªåŠ¨å–å¼•ç”¨äº†ï¼Œå¿…é¡»æ‰‹åŠ¨å†™æ¸…æ¥šã€‚</li></ul></li></ul><h3 id="55-trait-çº¦æŸå’Œç»§æ‰¿"><a class="markdownIt-Anchor" href="#55-trait-çº¦æŸå’Œç»§æ‰¿"></a> 5.5 trait çº¦æŸå’Œç»§æ‰¿</h3><ul><li><p>Rust çš„ trait çš„å¦å¤–ä¸€ä¸ªå¤§ç”¨å¤„æ˜¯ï¼Œä½œä¸ºæ³›å‹çº¦æŸä½¿ç”¨ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">my_print</span>&lt;T : <span class="hljs-built_in">Debug</span>&gt;(x: T) &#123;<br>    <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;The value is &#123;:?&#125;.&quot;</span>, x);<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢è¿™æ®µä»£ç ä¸­ï¼Œmy_print å‡½æ•°å¼•å…¥äº†ä¸€ä¸ªæ³›å‹å‚æ•° Tï¼Œæ‰€ä»¥å®ƒçš„å‚æ•°ä¸æ˜¯ä¸€ä¸ªå…·ä½“ç±»å‹ï¼Œè€Œæ˜¯ä¸€ç»„ç±»å‹ã€‚å†’å·åé¢åŠ  trait åå­—ï¼Œå°±æ˜¯è¿™ä¸ªæ³›å‹å‚æ•°çš„çº¦æŸæ¡ä»¶ã€‚å®ƒè¦æ±‚è¿™ä¸ª T ç±»å‹å®ç° Debug è¿™ä¸ª traitã€‚</p><ul><li><p>æ³›å‹çº¦æŸè¿˜æœ‰å¦å¤–ä¸€ç§å†™æ³•ï¼Œå³ where å­å¥</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">my_print</span>&lt;T&gt;(x: T) <span class="hljs-keyword">where</span> T: <span class="hljs-built_in">Debug</span> &#123;<br>    <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;The value is &#123;:?&#125;.&quot;</span>, x);<br>&#125;<br></code></pre></td></tr></table></figure></li></ul></li><li><p>trait ç»§æ‰¿</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">trait</span> <span class="hljs-title class_">Base</span> &#123; ... &#125;<br><span class="hljs-keyword">trait</span> <span class="hljs-title class_">Derived</span> : Base &#123; ... &#125;<br></code></pre></td></tr></table></figure><p>è¿™è¡¨ç¤º Derived trait ç»§æ‰¿äº† Base traitã€‚å®ƒè¡¨è¾¾çš„æ„æ€æ˜¯ï¼Œæ»¡è¶³ Derived çš„ç±»å‹ï¼Œå¿…ç„¶ä¹Ÿæ»¡è¶³ Base traitã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨é’ˆå¯¹ä¸€ä¸ªå…·ä½“ç±»å‹ impl Derived çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨ä¹Ÿä¼šè¦æ±‚æˆ‘ä»¬åŒæ—¶ impl Baseã€‚</p><p>å®é™…ä¸Šï¼Œåœ¨ç¼–è¯‘å™¨çš„çœ¼ä¸­ï¼Œ<code>trait Derivedï¼šBase&#123;&#125;</code>â€‹ ç­‰åŒäº <code>trait Derived where Selfï¼šBase&#123;&#125;</code>â€‹ã€‚è¿™ä¸¤ç§å†™æ³•æ²¡æœ‰æœ¬è´¨ä¸Šçš„åŒºåˆ«ï¼Œéƒ½æ˜¯ç»™ Derived è¿™ä¸ª trait åŠ äº†ä¸€ä¸ªçº¦æŸæ¡ä»¶ï¼Œå³å®ç° Derived trait çš„å…·ä½“ç±»å‹ï¼Œä¹Ÿå¿…é¡»æ»¡è¶³ Base trait çš„çº¦æŸã€‚</p></li></ul><h3 id="56-derive-è‡ªåŠ¨-impl-æŸäº›-trait"><a class="markdownIt-Anchor" href="#56-derive-è‡ªåŠ¨-impl-æŸäº›-trait"></a> 5.6 derive: è‡ªåŠ¨ impl æŸäº› trait</h3><ul><li><p>è¯­æ³•:åœ¨ä½ å¸Œæœ› impl trait çš„ç±»å‹å‰é¢å†™ #[deriveï¼ˆâ€¦ï¼‰]ï¼Œæ‹¬å·é‡Œé¢æ˜¯ä½ å¸Œæœ› impl çš„ trait çš„åå­—ã€‚</p></li><li><p>ç›®å‰ï¼ŒRust æ”¯æŒçš„å¯ä»¥è‡ªåŠ¨ derive çš„ trait æœ‰ä»¥ä¸‹è¿™äº›ï¼š</p><ul><li>Debug, Clone, Copy, Hash</li><li>RustcEncodable RustcDecodable</li><li>PartialEq, Eq, ParialOrd, Ord</li><li>Default, FromPrimitive</li><li>Send, Sync</li><li>è¿™äº› trait éƒ½æ˜¯æ ‡å‡†åº“å†…éƒ¨çš„è¾ƒç‰¹æ®Šçš„ traitï¼Œå®ƒä»¬å¯èƒ½åŒ…å«æœ‰æˆå‘˜æ–¹æ³•ï¼Œä½†æ˜¯æˆå‘˜æ–¹æ³•çš„é€»è¾‘æœ‰ä¸€ä¸ªç®€å•è€Œä¸€è‡´çš„â€œæ¨¡æ¿â€å¯ä»¥ä½¿ç”¨ï¼Œç¼–è¯‘å™¨å°±æœºæ¢°åŒ–åœ°é‡å¤è¿™ä¸ªæ¨¡æ¿ï¼Œå¸®æˆ‘ä»¬å®ç°è¿™ä¸ªé»˜è®¤é€»è¾‘ã€‚å½“ç„¶ä¹Ÿå¯ä»¥æ‰‹åŠ¨å®ç°ã€‚</li></ul></li></ul><h3 id="59-æ€»ç»“"><a class="markdownIt-Anchor" href="#59-æ€»ç»“"></a> 5.9 æ€»ç»“</h3><ul><li><p>trait å…¶ä»–ç”¨å¤„ï¼š</p><ul><li>trait æœ¬èº«å¯ä»¥æºå¸¦æ³›å‹å‚æ•°ï¼›</li><li>trait å¯ä»¥ç”¨åœ¨æ³›å‹å‚æ•°çš„çº¦æŸä¸­ï¼›</li><li>trait å¯ä»¥ä¸ºä¸€ç»„ç±»å‹ implï¼Œä¹Ÿå¯ä»¥å•ç‹¬ä¸ºæŸä¸€ä¸ªå…·ä½“ç±»å‹ implï¼Œè€Œä¸”å®ƒä»¬å¯ä»¥åŒæ—¶å­˜åœ¨ï¼›</li><li>trait å¯ä»¥ä¸ºæŸä¸ª trait implï¼Œè€Œä¸æ˜¯ä¸ºæŸä¸ªå…·ä½“ç±»å‹ implï¼›</li><li>trait å¯ä»¥åŒ…å«å…³è”ç±»å‹ï¼Œè€Œä¸”è¿˜å¯ä»¥åŒ…å«ç±»å‹æ„é€ å™¨ï¼Œå®ç°é«˜é˜¶ç±»å‹çš„æŸäº›åŠŸèƒ½ï¼›</li><li><strong>trait å¯ä»¥å®ç°æ³›å‹ä»£ç çš„é™æ€åˆ†æ´¾ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ trait object å®ç°åŠ¨æ€åˆ†æ´¾ï¼›</strong></li><li>trait å¯ä»¥ä¸åŒ…å«ä»»ä½•æ–¹æ³•ï¼Œç”¨äºç»™ç±»å‹åšæ ‡ç­¾ï¼ˆmarkerï¼‰ï¼Œä»¥æ­¤æ¥æè¿°ç±»å‹çš„ä¸€äº›é‡è¦ç‰¹æ€§</li><li>trait å¯ä»¥åŒ…å«å¸¸é‡ã€‚</li></ul></li></ul><h2 id="chap-06-æ•°ç»„å’Œå­—ç¬¦ä¸²"><a class="markdownIt-Anchor" href="#chap-06-æ•°ç»„å’Œå­—ç¬¦ä¸²"></a> chap 06 æ•°ç»„å’Œå­—ç¬¦ä¸²</h2><h3 id="61-æ•°ç»„"><a class="markdownIt-Anchor" href="#61-æ•°ç»„"></a> 6.1 æ•°ç»„</h3><ul><li><p>æ•°ç»„ç±»å‹çš„è¡¨ç¤ºæ–¹å¼ä¸º[T; n]ã€‚å…¶ä¸­ T ä»£è¡¨å…ƒç´ ç±»å‹ï¼›<strong>n ä»£è¡¨å…ƒç´ ä¸ªæ•°ï¼›å®ƒå¿…é¡»æ˜¯ç¼–è¯‘æœŸå¸¸é‡æ•´æ•°ã€‚</strong></p><ul><li>å¯¹äºä¸¤ä¸ªæ•°ç»„ç±»å‹ï¼Œåªæœ‰å…ƒç´ ç±»å‹å’Œå…ƒç´ ä¸ªæ•°éƒ½å®Œå…¨ç›¸åŒï¼Œè¿™ä¸¤ä¸ªæ•°ç»„æ‰æ˜¯åŒç±»å‹çš„ã€‚æ•°ç»„ä¸æŒ‡é’ˆä¹‹é—´ä¸èƒ½éšå¼è½¬æ¢ã€‚åŒç±»å‹çš„æ•°ç»„ä¹‹é—´å¯ä»¥äº’ç›¸èµ‹å€¼ã€‚</li><li>å¤šç»´æ•°ç»„ï¼š[[T: m]; n]</li></ul></li><li><p>æ•°ç»„åˆ‡ç‰‡ï¼šå¯¹æ•°ç»„å–å€Ÿç”¨ borrow æ“ä½œï¼Œå¯ä»¥ç”Ÿæˆä¸€ä¸ªâ€œæ•°ç»„åˆ‡ç‰‡â€ï¼ˆSliceï¼‰ã€‚æ•°ç»„åˆ‡ç‰‡å¯¹æ•°ç»„æ²¡æœ‰â€œæ‰€æœ‰æƒâ€ã€‚<strong>å¯ä»¥æŠŠæ•°ç»„åˆ‡ç‰‡çœ‹ä½œä¸“é—¨ç”¨äºæŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆï¼Œæ˜¯å¯¹æ•°ç»„çš„å¦å¤–ä¸€ä¸ªâ€œè§†å›¾â€ã€‚</strong></p><ul><li>æ¯”å¦‚ï¼Œæœ‰ä¸€ä¸ªæ•°ç»„[Tï¼›n]ï¼Œå®ƒçš„å€Ÿç”¨æŒ‡é’ˆçš„ç±»å‹å°±æ˜¯&amp;[Tï¼›n]ã€‚å®ƒå¯ä»¥é€šè¿‡ç¼–è¯‘å™¨å†…éƒ¨é­”æ³•è½¬æ¢ä¸ºæ•°ç»„åˆ‡ç‰‡ç±»å‹&amp;[T]ã€‚<strong>æ•°ç»„åˆ‡ç‰‡å®è´¨ä¸Šè¿˜æ˜¯æŒ‡é’ˆï¼Œå®ƒä¸è¿‡æ˜¯åœ¨ç±»å‹ç³»ç»Ÿä¸­ä¸¢å¼ƒäº†ç¼–è¯‘é˜¶æ®µå®šé•¿æ•°ç»„ç±»å‹çš„é•¿åº¦ä¿¡æ¯ï¼Œè€Œå°†æ­¤é•¿åº¦ä¿¡æ¯å­˜å‚¨ä¸ºè¿è¡ŒæœŸçš„å€¼ã€‚</strong></li></ul></li><li><p>æ•°ç»„åˆ‡ç‰‡(Slice)æ˜¯æŒ‡å‘ä¸€ä¸ªæ•°ç»„çš„æŒ‡é’ˆï¼Œè€Œå®ƒæ¯”æŒ‡é’ˆåˆå¤šäº†ä¸€ç‚¹ä¸œè¥¿â€”â€”å®ƒä¸æ­¢åŒ…å«æœ‰ä¸€ä¸ªæŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆï¼Œåˆ‡ç‰‡æœ¬èº«è¿˜å«å¸¦é•¿åº¦ä¿¡æ¯ã€‚<strong>Slice æ˜¯èƒ–æŒ‡é’ˆç±»å‹ã€‚èƒ–æŒ‡é’ˆçš„è®¾è®¡ï¼Œé¿å…äº†æ•°ç»„ç±»å‹ä½œä¸ºå‚æ•°ä¼ é€’æ—¶è‡ªåŠ¨é€€åŒ–ä¸ºè£¸æŒ‡é’ˆç±»å‹ï¼Œä¸¢å¤±äº†é•¿åº¦ä¿¡æ¯çš„é—®é¢˜ï¼Œä¿è¯äº†ç±»å‹å®‰å…¨</strong></p></li><li><p>åŠ¨æ€å¤§å°ç±»å‹ï¼ˆDynamic Sized Typeï¼ŒDSTï¼‰ã€‚DST æŒ‡çš„æ˜¯ç¼–è¯‘é˜¶æ®µæ— æ³•ç¡®å®šå ç”¨ç©ºé—´å¤§å°çš„ç±»å‹ã€‚ä¸ºäº†å®‰å…¨æ€§ï¼ŒæŒ‡å‘ DST çš„æŒ‡é’ˆä¸€èˆ¬æ˜¯èƒ–æŒ‡é’ˆã€‚</p><ul><li><p>å¯¹äº DST ç±»å‹ï¼ŒRust æœ‰å¦‚ä¸‹é™åˆ¶ï¼š</p><ul><li>åªèƒ½é€šè¿‡æŒ‡é’ˆæ¥é—´æ¥åˆ›å»ºå’Œæ“ä½œ DST ç±»å‹ï¼Œ&amp;[T]ã€Box&lt;[T]&gt; å¯ä»¥ï¼Œ[T]ä¸å¯ä»¥</li><li>enum ä¸­ä¸èƒ½åŒ…å« DST ç±»å‹ï¼Œstruct ä¸­åªæœ‰æœ€åä¸€ä¸ªå…ƒç´ å¯ä»¥æ˜¯ DSTï¼Œå…¶ä»–åœ°æ–¹ä¸è¡Œï¼Œå¦‚æœåŒ…å«æœ‰ DST ç±»å‹ï¼Œé‚£ä¹ˆè¿™ä¸ªç»“æ„ä½“ä¹Ÿå°±æˆäº† DST ç±»å‹ã€‚</li></ul></li></ul></li><li><p>è¾¹ç•Œæ£€æŸ¥ï¼šåœ¨ Rust ä¸­é ç¼–è¯‘é˜¶æ®µé™æ€æ£€æŸ¥æ˜¯æ— æ³•æ¶ˆé™¤æ•°ç»„è¶Šç•Œçš„è¡Œä¸ºçš„ã€‚è‹¥ä¸ç¡®å®šä½¿ç”¨çš„â€œç´¢å¼•â€æ˜¯å¦åˆæ³•ï¼Œåº”è¯¥ä½¿ç”¨ getï¼ˆï¼‰æ–¹æ³•è°ƒç”¨æ¥è·å–æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œè¿™ä¸ªæ–¹æ³•ä¸ä¼šå¼•èµ· panicï¼ï¼Œå®ƒçš„è¿”å›ç±»å‹æ˜¯ Option<T></p><ul><li>ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒRust ä¸é¼“åŠ±å¤§é‡ä½¿ç”¨â€œç´¢å¼•â€æ“ä½œã€‚æ­£å¸¸çš„â€œç´¢å¼•â€æ“ä½œéƒ½ä¼šæ‰§è¡Œä¸€æ¬¡â€œè¾¹ç•Œæ£€æŸ¥â€ã€‚ä»æ‰§è¡Œæ•ˆç‡ä¸Šæ¥è¯´ï¼ŒRust æ¯” C/C++ çš„æ•°ç»„ç´¢å¼•æ•ˆç‡ä½ä¸€ç‚¹ï¼Œå› ä¸º C/C++ çš„ç´¢å¼•æ“ä½œæ˜¯ä¸æ‰§è¡Œä»»ä½•å®‰å…¨æ€§æ£€æŸ¥çš„ï¼Œå®ƒä»¬å¯¹åº”çš„ Rust ä»£ç ç›¸å½“äºè°ƒç”¨ get_uncheckedï¼ˆï¼‰å‡½æ•°ã€‚åœ¨ Rust ä¸­ï¼Œæ›´åŠ åœ°é“çš„åšæ³•æ˜¯å°½é‡ä½¿ç”¨â€œè¿­ä»£å™¨â€æ–¹æ³•ã€‚</li></ul></li></ul><h3 id="62-å­—ç¬¦ä¸²"><a class="markdownIt-Anchor" href="#62-å­—ç¬¦ä¸²"></a> 6.2 å­—ç¬¦ä¸²</h3><p>Rust çš„å­—ç¬¦ä¸²æ¶‰åŠä¸¤ç§ç±»å‹ï¼Œä¸€ç§æ˜¯&amp;strï¼Œå¦å¤–ä¸€ç§æ˜¯ Stringã€‚</p><h4 id="621-str"><a class="markdownIt-Anchor" href="#621-str"></a> 6.2.1 &amp;str</h4><ul><li>str æ˜¯ Rust çš„å†…ç½®ç±»å‹ã€‚&amp;str æ˜¯å¯¹ str çš„å€Ÿç”¨ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªèƒ–æŒ‡é’ˆã€‚</li><li>Rust çš„å­—ç¬¦ä¸²å†…éƒ¨é»˜è®¤æ˜¯ä½¿ç”¨ utf-8 ç¼–ç æ ¼å¼çš„ã€‚è€Œå†…ç½®çš„ char ç±»å‹æ˜¯ 4 å­—èŠ‚é•¿åº¦çš„ï¼Œå­˜å‚¨çš„å†…å®¹æ˜¯ Unicode Scalar Valueã€‚æ‰€ä»¥ï¼ŒRust é‡Œé¢çš„å­—ç¬¦ä¸²ä¸èƒ½è§†ä¸º char ç±»å‹çš„æ•°ç»„ï¼Œè€Œæ›´æ¥è¿‘ u8 ç±»å‹çš„æ•°ç»„ã€‚</li><li>&amp;str ç±»å‹æ˜¯å¯¹ä¸€å—å­—ç¬¦ä¸²åŒºé—´çš„å€Ÿç”¨ï¼Œå®ƒå¯¹æ‰€æŒ‡å‘çš„å†…å­˜ç©ºé—´æ²¡æœ‰æ‰€æœ‰æƒï¼Œå“ªæ€•&amp;mut str ä¹Ÿä¸€æ ·ã€‚</li></ul><h4 id="622-string"><a class="markdownIt-Anchor" href="#622-string"></a> 6.2.2 String</h4><ul><li>String ç±»å‹è·Ÿ&amp;str ç±»å‹çš„ä¸»è¦åŒºåˆ«æ˜¯ï¼Œå®ƒæœ‰ç®¡ç†å†…å­˜ç©ºé—´çš„æƒåŠ›ã€‚</li><li>String å®ç°äº† Deref&lt;Target=str&gt; çš„ traitã€‚æ‰€ä»¥åœ¨å¾ˆå¤šæƒ…å†µä¸‹ &amp;String ç±»å‹å¯ä»¥è¢«ç¼–è¯‘å™¨è‡ªåŠ¨è½¬æ¢ä¸º&amp;str ç±»å‹ã€‚</li><li>Rust çš„ String ç±»å‹ç±»ä¼¼äº std::stringï¼Œè€Œ Rust çš„&amp;str ç±»å‹ç±»ä¼¼äº std::string_viewã€‚</li></ul><p>â€</p>]]></content>
    
    
    <categories>
      
      <category>Rust</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>GSoC 2022 Series - 4</title>
    <link href="/2022/09/08/GSoC%202022%20Series%204/"/>
    <url>/2022/09/08/GSoC%202022%20Series%204/</url>
    
    <content type="html"><![CDATA[<h2 id="ç³»åˆ—å¯¼èˆª"><a class="markdownIt-Anchor" href="#ç³»åˆ—å¯¼èˆª"></a> ç³»åˆ—å¯¼èˆª</h2><ul><li><a href="https://young-flash.github.io/2022/05/21/GSoC%202022%20Series%201/">GSoC 2022 Series - 1</a></li><li><a href="https://young-flash.github.io/2022/05/23/GSoC%202022%20Series%202/">GSoC 2022 Series - 2</a></li><li><a href="https://young-flash.github.io/2022/07/02/GSoC%202022%20Series%203/">GSoC 2022 Series - 3</a></li><li><a href="https://young-flash.github.io/2022/09/08/GSoC%202022%20Series%204/">GSoC 2022 Series - 4</a></li></ul><p>å¼€ä¸ªå‘ï¼Œå…³äºå°†äº’æ–¥é”æ”¹ä¸ºå…±äº«é”è¿™ä¸€éƒ¨åˆ†åé¢å†å†™ï¼Œè¿™é‡Œå…ˆæ”¾ä¸€ä¸‹ç»“é¡¹çš„ final report</p><h1 id="gsoc-final-report"><a class="markdownIt-Anchor" href="#gsoc-final-report"></a> GSoC final report</h1><ul><li>project: <a href="https://summerofcode.withgoogle.com/programs/2022/projects/Qr45UY5M">Introduce WebSockets into rTorrent</a></li><li>Organization: <a href="https://ccextractor.org/">CCExtractor Development</a></li><li>Contributor: <a href="https://github.com/Young-Flash">Dongyang Zheng</a></li><li>mentor: <a href="https://github.com/jesec">jesec</a></li></ul><h1 id="introduction"><a class="markdownIt-Anchor" href="#introduction"></a> Introduction</h1><p>This GSoC project will replace the antique SCGI protocol in rTorrent with Websocket, which will allows real-time events, less serialization/transfer overheads, better security, etc. There isnâ€™t a modern c++ websockets library that supports unix domain socket, we will add this important feature into uWebsockets. And we also replace the global mutex in libtorrent with shared_mutex to improve concurrency.</p><h1 id="what-was-done"><a class="markdownIt-Anchor" href="#what-was-done"></a> What was done</h1><ul><li>introduce websocket into rTorrent and implement â€œserver pushâ€, that is, client can subscribe some specific topics, once the event occurs,server will push the notification to client automatically</li></ul><p><img src="/img/blog_pic/2022/ws_postman_screenshot.png" alt="" /></p><ul><li>add unix domain socket support for uWebSockets, now websocket can listen on unix domain socket, with better security.</li><li>replace global mutex in libtorrent with shared_mutex</li></ul><h1 id="link-to-work"><a class="markdownIt-Anchor" href="#link-to-work"></a> Link to work</h1><ul><li><a href="https://github.com/Young-Flash/translator">qualification task before get selected</a></li><li><a href="https://github.com/Young-Flash/uWebSockets">unix domain socket support for uWebsocket</a></li><li><a href="https://github.com/Young-Flash/libtorrent">replace mutex with shared_mutex in libtorrent</a></li><li><a href="https://github.com/CCExtractor/rtorrent-ws">project code repo</a></li><li><a href="https://github.com/CCExtractor/rtorrent-ws/commits/master">code commits</a></li><li><a href="https://young-flash.github.io/2022/05/21/GSoC%202022%20Series%201/">related blogs (records of the development process)</a></li></ul><h1 id="acknowledgements"><a class="markdownIt-Anchor" href="#acknowledgements"></a> Acknowledgements</h1><p>Not only technical things I have learned but also the ability to think and tackle problems. Mentor jesec is very great, he gave me a lot of guidance and inspiration in the process of completing the project, work with jesec is wonderful, thanks jesec for help. Thanks Google and GSoC program and CCExtractor Development community provided such a good activity.</p>]]></content>
    
    
    <categories>
      
      <category>GSoC</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¼€æº</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¾®è½¯å®ä¹ å°è®°</title>
    <link href="/2022/07/29/%E5%BE%AE%E8%BD%AF%E5%AE%9E%E4%B9%A0%E5%B0%8F%E8%AE%B0/"/>
    <url>/2022/07/29/%E5%BE%AE%E8%BD%AF%E5%AE%9E%E4%B9%A0%E5%B0%8F%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<p>5 æœˆä¸­æ—¬å…¥èŒï¼Œç»å†äº†å·®ä¸å¤šåŠä¸ªæœˆçš„ remote åç»ˆäºåˆ°è‹å· onsite äº†ã€‚How time fliesï¼Œç°åœ¨å®ä¹ å·²ç»æ¥è¿‘å°¾å£°äº†ï¼Œåœ¨å¾®è½¯å®ä¹ çš„è¿™æ®µç»å†ä¼šæ˜¯æˆ‘å®è´µçš„ä½“éªŒã€‚</p><p>å› ä¸ºç–«æƒ…è¿˜åœ¨å­¦æ ¡ remote çš„æ—¶å€™å…¶å®å¹¶æ²¡æœ‰å®ä¹ çš„æ„Ÿè§‰ï¼Œè™½è¯´ mentor ä¹Ÿæœ‰åœ¨ teams ä¸Šå’Œæˆ‘è”ç³»ï¼Œç»™æˆ‘è®²å®ä¹ è¦åšçš„ taskï¼Œä½†ä¸èƒ½åˆ°å®åœ°ä½“éªŒæ€»å½’è¿˜æ˜¯å·®ç‚¹æ„æ€ã€‚å…¥èŒä¸¤ä¸ªæ˜ŸæœŸåç»ˆäºèƒ½æ¥åˆ°åŠå…¬å®¤äº†ï¼Œçº¿ä¸‹å®åœ°çš„å®ä¹ ä½“éªŒæ‰æ˜¯æˆ‘çœŸæ­£æƒ³è¦çš„ä½“éªŒã€‚å…¥èŒç¬¬ä¸€å¤©å…ˆé…äº†è®¾å¤‡ï¼ŒHP çš„å·¥ä½œç«™ï¼Œ32G å†…å­˜ + 400G å›ºæ€ï¼Œæ—¥å¸¸å¼€å‘è¶³å¤Ÿäº†ï¼Œ4K çš„æ˜¾ç¤ºå™¨æ˜¯æˆ‘æœ€æ»¡æ„çš„å“ˆå“ˆå“ˆï¼Œä¸€å¼€å§‹ç”±äºè®¾å¤‡ç´§å¼ æ¯ä¸ªå®ä¹ ç”Ÿåªèƒ½é¢†ä¸€ä¸ªï¼Œåæ¥æˆ‘æ­»ç¼ çƒ‚æ‰“æ‰¾ AA åˆè¦äº†ä¸€ä¸ªï¼Œä¸¤ä¸ª 4K æ˜¾ç¤ºå™¨ï¼Œä¸€ä¸ªå­—å°±æ˜¯çˆ½ï¼</p><table><thead><tr><th><img src="/img/blog_pic/2022/ms4.jpg" alt="" /></th><th><img src="/img/blog_pic/2022/ms5.jpg" alt="" /></th></tr></thead><tbody><tr><td>ä»å¤§è€æ¿æœ‹å‹åœˆç›—çš„å›¾</td><td></td></tr></tbody></table><p>ç»„é‡ŒåŒäº‹æ€»ä½“æ¥è¯´éƒ½æ¯”è¾ƒå¹´è½»ï¼Œå¥½å‡ ä¸ªéƒ½æ˜¯å»å¹´æ ¡æ‹›å…¥èŒçš„ï¼Œè¿˜æœ‰å‡ ä¸ªå·¥ä½œäº†æ¯”è¾ƒä¹…å¾ˆæœ‰ç»éªŒçš„åŒäº‹ï¼Œæˆ‘è§‰å¾—è¿™ä¸ªæ­é…è¿˜æ˜¯å¾ˆå¥½çš„ï¼Œæ–°è€æ­é…ï¼Œå›¢é˜Ÿæœ‰å¹´è½»äººçš„æ´»åŠ›ä¹Ÿæœ‰è€å¸æœºçš„ç»éªŒï¼Œç»„é‡Œçš„æ°›å›´æˆ‘æŒºå–œæ¬¢çš„ï¼Œå¹³æ—¶éƒ½æ˜¯ä¸€å—å»é¥­å ‚åƒé¥­ï¼Œå¤§å®¶ç›¸å¤„éƒ½æ¯”è¾ƒèæ´½ï¼Œå¸Œæœ›ä»¥åæ­£å¼å·¥ä½œäº†ä¹Ÿèƒ½åœ¨è¿™ä¹ˆä¸€ä¸ªå›¢é˜Ÿé‡Œå“ˆå“ˆå“ˆã€‚ç»„é‡Œçš„åŒäº‹éƒ½å¾ˆä¼˜ç§€ï¼Œå¥½å‡ ä¸ªæµ·å½’ï¼Œä¹Ÿæœ‰ä»è…¾è®¯åä¸ºè·³è¿‡æ¥çš„ï¼Œæˆ‘ mentor æ˜¯ seniorï¼Œæ˜¯ä¸ªæœ‰å¤šå¹´ç»éªŒçš„è€å…µäº†ã€‚mentor äººå¾ˆå¥½ï¼Œæœ‰ä»€ä¹ˆä¸æ‡‚çš„æˆ–è€…é‡åˆ°ä»€ä¹ˆé—®é¢˜è¯·æ•™ä»–éƒ½èƒ½ç»™æˆ‘è§£ç­”ï¼Œè·Ÿæˆ‘è®²äº†ä»»åŠ¡åå°±æ”¾æ‰‹è®©æˆ‘å»åšï¼Œæ²¡æœ‰å‚¬è¿›åº¦ï¼Œéƒ½æ˜¯æˆ‘è‡ªå·±åšäº†ç‚¹ä»€ä¹ˆä¸œè¥¿åè·Ÿä»–è¯´çš„ï¼Œæ²¡å•¥å·¥ä½œå‹åŠ›ï¼Œåº”è¯¥å¾®è½¯æ€»ä½“æ¥è¯´éƒ½æ˜¯å¦‚æ­¤å§ï¼Œå½“ç„¶ä¸æ’é™¤ä¹Ÿæœ‰ä¸€äº›æ¯”è¾ƒå¿™çš„ç»„ï¼Œä¸è¿‡æˆ‘æ‰€åœ¨çš„ CMD éƒ¨é—¨æ„Ÿè§‰éƒ½è¿˜å¥½ï¼Œæ²¡å¬è¯´è¿‡ç»å¸¸åŠ ç­çš„æƒ…å†µï¼Œäº”ç‚¹å¤šå»åƒé¥­åæœ‰çš„ç›´æ¥èµ°äº†ï¼Œä¹Ÿæœ‰çš„å†å›åŠå…¬å®¤å¾…ä¸€ä¼šå„¿çš„ï¼Œå¤§å¤šæ™šä¸Š 7 ç‚¹å¤šå°±éƒ½èµ°äº†ï¼›ä½†æ˜¯å¶å°”ä¹Ÿæœ‰æ¯”è¾ƒå¿™çš„æ—¶å€™ï¼Œå‰æ®µæ—¶é—´çœ‹æˆ‘ mentor å¥½å‡ å¤©åˆ°å…«ä¹ç‚¹æ‰èµ°ã€‚Anywayï¼Œå¾®è½¯åœ¨ work life balance è¿™æ–¹é¢æ˜¯å¾ˆæœ‰ä¼˜åŠ¿çš„ã€‚</p><p><img src="/img/blog_pic/2022/ms-demo.png" alt="" /></p><p>ä»Šå¤©åœ¨ä¸€ä¸ª meeting ä¸Šåšä¸ªäº† demo è®²äº†è‡ªå·±å®ä¹ æœŸé—´åšçš„ä»»åŠ¡ï¼Œç¬¬ä¸€æ¬¡å…¨è‹±çš„æ±‡æŠ¥æœ‰äº›ç´§å¼ ï¼Œå¼€å§‹ä¹‹å‰ mentor è¿˜æ¥å’Œæˆ‘è¯´ä¸ç”¨ç´§å¼ éšä¾¿è®²å“ˆå“ˆå“ˆã€‚å‡†å¤‡å¾—è¿˜ç®—å……åˆ†ï¼Œå‰ä¸€å¤©æ™šä¸ŠæŠŠè‡ªå·±è¦çš„ä¸œè¥¿è¿‡äº†å‡ éæ‰€ä»¥æ±‡æŠ¥çš„æ—¶å€™æ¯”è¾ƒé¡ºåˆ©ï¼Œç»“æŸåè¿˜æœ‰åŒäº‹å¤¸æˆ‘å£è¯­ä¸é”™å“ˆå“ˆå“ˆã€‚è™½ç„¶åªæœ‰ä¸åˆ°ååˆ†é’Ÿçš„æ—¶é—´ï¼Œä½†è¿™æ¬¡æ±‡æŠ¥è¶³å¤Ÿè®©æˆ‘å°è±¡æ·±åˆ»äº†ã€‚ç»„é‡Œçš„ä¸šåŠ¡éœ€è¦å’Œå¤–å›½åŒäº‹å¯¹æ¥ï¼Œæ‰€ä»¥å¹³æ—¶åŒäº‹ä»¬å¼€ä¼šä¹Ÿç»å¸¸ä¼šè®²è‹±æ–‡ï¼Œè¿™ä¹Ÿæ˜¯åœ¨å¤–ä¼å·¥ä½œçš„ä¸€ä¸ªç‰¹ç‚¹å§ï¼Œæˆ‘è§‰å¾—æœ‰è¿™ç§æœºä¼šè¿˜æ˜¯æŒºä¸é”™çš„ï¼Œæ˜¯æå‡è‡ªå·±è‹±è¯­çš„å¥½æœºä¼šã€‚</p><table><thead><tr><th><img src="/img/blog_pic/2022/ms6.jpg" alt="" /></th><th><img src="/img/blog_pic/2022/ms7.jpg" alt="" /></th></tr></thead></table><p>æ”¾ç‚¹éšæ‰‹æ‹çš„ç…§ç‰‡å§</p><table><thead><tr><th><img src="/img/blog_pic/2022/ms1.jpg" alt="" /></th><th><img src="/img/blog_pic/2022/ms12.jpg" alt="" /></th></tr></thead></table><table><thead><tr><th><img src="/img/blog_pic/2022/ms8.jpg" alt="" /></th><th><img src="/img/blog_pic/2022/ms9.jpg" alt="" /></th></tr></thead></table><table><thead><tr><th><img src="/img/blog_pic/2022/ms10.jpg" alt="èŒ¶æ°´é—´çš„èŠ±" /></th><th><img src="/img/blog_pic/2022/ms11.jpg" alt="ä¸æ˜¯è¯´ win 11 ä¸ä¼šè“å±å—ï¼Ÿï¼Ÿï¼Ÿ" /></th></tr></thead></table> <!-- å·®ä¸å¤šè¿˜æœ‰ä¸¤ä¸ªæ˜ŸæœŸå®ä¹ å°±ç»“æŸäº†ï¼Œå¸Œæœ›ç§‹æ‹›é¡ºåˆ©æ¯•ä¸šä¹Ÿé¡ºåˆ©å“ˆå“ˆå“ˆå“ˆ --><center>æ›´æ–°</center><p>èšæ•£ç»ˆæœ‰åˆ«ï¼Œæ¯æ®µæ—…é€”ã€æ¯æ®µäººç”Ÿç»å†éƒ½æœ‰ç»ˆç‚¹ã€‚è€Œæˆ‘çš„å¾®è½¯å®ä¹ ç»å†ä¹Ÿèµ°åˆ°äº†æœ€åï¼Œè¿˜å‰©ä¸‹æœ€åä¸¤ä¸‰å¤©åœ¨æƒ³ç¦»èŒå¾…åŠçš„æ—¶å€™å¿ƒä¸­æœ‰äº†è¦ç¦»å¼€è¿™é‡Œçš„æ„Ÿè§‰ï¼Œåœ¨è¿™é‡Œçš„ä¸‰ä¸ªæœˆæ˜¯å¾ˆç¾å¥½çš„ä¸€æ®µç»å†ï¼Œæƒ³èµ·è¦ç¦»å¼€äº†éš¾å…æœ‰äº›ä¸èˆã€‚last day çš„ä¸­åˆæ—¶å€™ manager è¯·äº†æˆ‘å’Œ mentor åƒé¥­ï¼Œä¸‹åˆçš„æ—¶å€™æˆ‘ç‚¹äº† 18 æ¯å¥¶èŒ¶è¯·åŒäº‹ä»¬å–ï¼Œåšä¸ªæœ€åçš„ç•™å¿µå“ˆå“ˆå“ˆï¼Œæ™šä¸Šå†å’Œå‡ ä¸ªåŒäº‹åœ¨å›­åŒºé‡Œçš„å°é¦†å­é‡Œåƒäº†é¡¿é¥­ã€‚</p><table><thead><tr><th><img src="/img/blog_pic/2022/%E7%95%99%E8%A8%80.jpg" alt="" /></th><th><img src="/img/blog_pic/2022/ms%E6%90%9C%E7%B4%A2%E6%88%AA%E5%9B%BE.jpg" alt="" /></th></tr></thead></table><table><thead><tr><th><img src="/img/blog_pic/2022/ms%E5%A4%A7%E6%A5%BC.jpg" alt="" /></th><th><img src="/img/blog_pic/2022/%E6%9C%88%E4%BA%AE%E6%B9%BE.jpg" alt="" /></th></tr></thead></table><p>è‡³æ­¤ï¼Œå¾®è½¯å®ä¹ ç»å†ç»“æŸï¼Œwill I backï¼Ÿ</p>]]></content>
    
    
    <categories>
      
      <category>å·¥ä½œ</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>GSoC 2022 Series - 3</title>
    <link href="/2022/07/02/GSoC%202022%20Series%203/"/>
    <url>/2022/07/02/GSoC%202022%20Series%203/</url>
    
    <content type="html"><![CDATA[<h2 id="ç³»åˆ—å¯¼èˆª"><a class="markdownIt-Anchor" href="#ç³»åˆ—å¯¼èˆª"></a> ç³»åˆ—å¯¼èˆª</h2><ul><li><a href="https://young-flash.github.io/2022/05/21/GSoC%202022%20Series%201/">GSoC 2022 Series - 1</a></li><li><a href="https://young-flash.github.io/2022/05/23/GSoC%202022%20Series%202/">GSoC 2022 Series - 2</a></li><li><a href="https://young-flash.github.io/2022/07/02/GSoC%202022%20Series%203/">GSoC 2022 Series - 3</a></li><li><a href="https://young-flash.github.io/2022/09/08/GSoC%202022%20Series%204/">GSoC 2022 Series - 4</a></li></ul><h2 id="è®¾è®¡ä¸å®ç°"><a class="markdownIt-Anchor" href="#è®¾è®¡ä¸å®ç°"></a> è®¾è®¡ä¸å®ç°</h2><p>mentor å¸Œæœ›åœ¨ rtorrent ä¸­å¼•å…¥ websocket çš„åŒæ—¶è¿˜ä¿ç•™ scgiã€‚ç°åœ¨ rtorrent æœ‰ 3 ä¸ªçº¿ç¨‹ï¼Œæˆ‘çš„æƒ³æ³•æ˜¯åœ¨ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æ¥è¿è¡Œ websocket æœåŠ¡ï¼Œå±Šæ—¶æ•´ä¸ªè¿›ç¨‹ä¸­å°†ä¼šæœ‰ 4 ä¸ªçº¿ç¨‹ã€‚å¼•å…¥ RpcThreadManager ç±»æ¥ç®¡ç† scgi å’Œ websocket çº¿ç¨‹ï¼Œç±»ä¸­çš„æˆå‘˜å˜é‡æ˜¯ ThreadWorker å’Œ WebsocketsThread çš„æŒ‡é’ˆï¼Œæˆå‘˜æ–¹æ³•æ˜¯ ThreadWorker ç±»ä¸­æš´éœ²çš„ public æ–¹æ³•ï¼Œè¿™æ ·åªéœ€è¦å°† global.h ä¸­çš„å…¨å±€å˜é‡ worker_thread çš„ç±»å‹ä» ThreadWorker æ”¹ä¸º RpcThreadManager ä»è€Œä¸éœ€è¦æ”¹å˜è°ƒç”¨æ¥å£çš„å®šä¹‰ã€‚</p><p>åˆ©ç”¨ uWebsockets æ¥å®ç° websocket æœåŠ¡ï¼Œæ‰€æœ‰çš„é€»è¾‘éƒ½æ”¾åœ¨ WebsocketsThread è¿™ä¸ªç±»ä¸­ï¼Œä¸»è¦çš„æˆå‘˜å˜é‡æœ‰ï¼š</p><ul><li><code>std::unique_ptr&lt;std::thread&gt; m_websockets_thread</code>:<br />å½“å‰è¿è¡Œ websocket æœåŠ¡çš„çº¿ç¨‹æŒ‡é’ˆï¼Œææ„æ—¶ join æ‰çº¿ç¨‹</li><li><code>uWS::App* m_websockets_app</code>:<br />websocket App å¯¹è±¡ï¼Œåç»­è°ƒç”¨å…¶ publish æ–¹æ³•å‘ client æ¨é€é€šçŸ¥</li><li><code>std::pair&lt;std::string, int&gt;* listen_info</code>:<br />websocket æœåŠ¡ç›‘å¬æ–¹å¼(unix domain socket è¿˜æ˜¯ tcp:ip port ä»¥åŠç›‘å¬çš„åœ°å€ä¿¡æ¯</li><li><code>std::vector&lt;uWS::WebSocket&lt;false, true, ConnectionData&gt;*&gt; all_connection</code>:<br />ä¿å­˜ä¸æ‰€æœ‰ client çš„è¿æ¥ï¼Œææ„æ—¶ close</li></ul><p>ä¸»è¦çš„æˆå‘˜å˜é‡æœ‰ï¼š</p><ul><li><code>void start_thread();</code><br />åˆå§‹åŒ– uWS::App å¯¹è±¡å¹¶åˆ›å»ºçº¿ç¨‹è¿è¡Œ websocket æœåŠ¡</li><li><code>void publish_ws_topic(std::string_view topic, std::string_view message);</code><br />å¤–éƒ¨å‘ client æ¨é€é€šçŸ¥çš„æ¥å£</li><li><code>void handle_request(const std::string_view&amp;);</code><br />æ”¶åˆ° client çš„ JSON-RPC å‘½ä»¤ååˆ†æ´¾ç»™ RpcManager å¤„ç†ç„¶åè¿”å›å¤„ç†ç»“æœ</li><li><code>~WebsocketsThread();</code><br />å…³é—­æ‰æ‰€æœ‰ ws è¿æ¥ï¼Œæ¸…ç†èµ„æºï¼Œjoin æ‰å½“å‰çº¿ç¨‹</li></ul><h2 id="é‡åˆ°çš„é—®é¢˜"><a class="markdownIt-Anchor" href="#é‡åˆ°çš„é—®é¢˜"></a> é‡åˆ°çš„é—®é¢˜</h2><h3 id="å¦‚ä½•ä¼˜é›…ç»“æŸè¿›ç¨‹"><a class="markdownIt-Anchor" href="#å¦‚ä½•ä¼˜é›…ç»“æŸè¿›ç¨‹"></a> å¦‚ä½•ä¼˜é›…ç»“æŸè¿›ç¨‹ï¼Ÿ</h3><p>æ¯æ¬¡é€€å‡ºçš„æ—¶å€™éƒ½ä¼šé˜»å¡åœ¨ <code>m_websockets_thread-&gt;join();</code> ä¸Šï¼ŒæŒ‰ç…§ uWebsockets æ–‡æ¡£çš„æè¿°ï¼Œæ¸…ç†æ‰ App å¯¹è±¡ä¾èµ–çš„èµ„æºåå…¶ run æ–¹æ³•ä¼šè‡ªåŠ¨é€€å‡ºï¼Œå¯æ˜¯æ‰§è¡Œäº† <code>us_listen_socket_close(0, m_listen_socket);</code> ä¹‹å run æ–¹æ³•è¿˜æ˜¯æ²¡æœ‰è¿”å›ã€‚åæ¥å°è¯•äº†åœ¨å…³é—­ socket ä¹‹å‰ close æ‰ä¸æ‰€æœ‰ client çš„è¿æ¥å run æ–¹æ³•å°±æˆåŠŸè¿”å›äº†ï¼Œè¿›è€Œ m_websockets_thread å°±èƒ½é¡ºåˆ© join æ‰äº†ã€‚</p><h3 id="bazel-build"><a class="markdownIt-Anchor" href="#bazel-build"></a> bazel build</h3><p>æˆ‘æ˜¯åœ¨ windows ä¸Šç”¨ wsl ç¯å¢ƒå¼€å‘çš„ã€‚é¡¹ç›®ä¸­ç”¨åˆ°äº† bazel æ„å»ºç³»ç»Ÿæ‰€ä»¥æˆ‘ä¹Ÿå¾—æ”¯æŒè¿™ç§æ„å»ºæ–¹å¼ï¼Œè¿è¡Œ bazel build rtorrent åæŠ¥é”™ ERROR: /home/flash/.cache/bazel/_bazel_flash/deb97f29152e01999a06e8171eedc056/external/cares/BUILD.bazel:115:8: Executing genrule @cares//:configure failed: (Exit 127): bash failed: error executing command /bin/bash -c â€¦ (remaining 1 argument skipped) <code>/bin/bash: $'\r': command not found</code>ã€‚è¿™æ˜¯ wsl çš„é”…ï¼Œå‚è€ƒ<a href="https://askubuntu.com/questions/966488/how-do-i-fix-r-command-not-found-errors-running-bash-scripts-in-wsl">è¿™é‡Œ</a>ç”¨ dos2unix æŠŠæœ‰é—®é¢˜çš„æ–‡ä»¶æ ¼å¼åŒ–ä¹‹åé‡æ–°æ‰§è¡Œ bazel build rtorrent å°±æˆåŠŸäº†</p><h3 id="æ¨é€é€šçŸ¥åˆ°-client-æ—¶ç¨‹åºå°±-segmentation-fault-äº†"><a class="markdownIt-Anchor" href="#æ¨é€é€šçŸ¥åˆ°-client-æ—¶ç¨‹åºå°±-segmentation-fault-äº†"></a> æ¨é€é€šçŸ¥åˆ° client æ—¶ç¨‹åºå°± Segmentation fault äº†</h3><p>ä¸€å¼€å§‹è¿˜ä»¥ä¸ºæ˜¯ä¸åŒçº¿ç¨‹ä¹‹é—´å†…å­˜çš„è®¿é—®å¯è§æ€§é—®é¢˜ï¼Œä½†æ˜¯çº¿ç¨‹ä¹‹é—´æ˜¯å…±äº«å†…å­˜çš„å‘€ï¼Œåœ¨åˆ›å»ºå¥½ <code>uWS::App</code> å¯¹è±¡åå°±é€šè¿‡æŒ‡é’ˆä¿å­˜åˆ° m_websockets_appï¼Œè€Œä¸”åœ¨ websocket çº¿ç¨‹ä¸­å’Œå¤–éƒ¨è°ƒç”¨çº¿ç¨‹ä¸­ <code>m_websockets_app</code> æ‰“å°å‡ºæ¥çš„æŒ‡é’ˆå€¼éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¸ºä»€ä¹ˆä¸€è°ƒç”¨æ–¹æ³•å°±å‡ºé”™ï¼Ÿï¼Ÿï¼Ÿè¿™ä¸ªé—®é¢˜å›°æ‰°äº†æˆ‘å¥½ä¹…ï¼Œåæ¥çªç„¶æƒ³åˆ°æ˜¯ä¸æ˜¯ publish çš„æ—¶å€™ App è¿˜æ²¡åˆå§‹åŒ–å¥½ï¼Ÿç»“æœè¿˜çœŸæ˜¯ï¼ï¼ï¼çŸ¥é“äº†åŸå› ä¹‹åå°±å¾ˆå¥½è§£å†³äº†ï¼špublishçš„æ—¶å€™å¯¹ m_websockets_app åˆ¤ç©ºå°± OK äº†ã€‚æˆ‘åœ¨ debug çš„æ—¶å€™çœ‹åˆ° m_websockets_app ä¸º NULL çš„æ—¶å€™æ‰æƒ³åˆ°è¿™ä¸€ç‚¹ï¼Œå¦‚æœæ²¡æœ‰æƒ³åˆ°çš„è¯è‚¯å®šä¼šèµ°ä¸å°‘å¼¯è·¯ï¼ˆå…¶å®å·²ç»èµ°äº†ä¸å°‘äº†ï¼‰</p><p>æƒ³åˆ°åœ¨ leetcode ç”¨ C++ åšé¢˜çš„æ—¶å€™ï¼Œå¦‚æœè®¿é—®äº†ç©ºæŒ‡é’ˆä¼šç»™å‡ºæŠ¥é”™åŸå› </p><p><img src="/img/blog_pic/2022/leetcodeC++%E9%94%99%E8%AF%AF.png" alt="" /></p><p>å¦‚æœå½“æ—¶ IDE åœ¨æˆ‘è®¿é—®è¿˜æ²¡åˆå§‹åŒ–çš„ m_websockets_app ä¹Ÿèƒ½ç»™å‡ºè¿™æ ·çš„æç¤ºé‚£ä¹ˆæˆ‘é©¬ä¸Šå°±çŸ¥é“é—®é¢˜åœ¨å“ªäº†ã€‚åæ¥ Google åˆ°äº† sanitize ç¼–è¯‘é€‰é¡¹ï¼Œåœ¨è®¿é—®ç©ºæŒ‡é’ˆçš„æµ‹è¯•ä»£ç ä¸­ç”¨<br /><code>set(CMAKE_CXX_FLAGS &quot;$&#123;CMAKE_CXX_FLAGS&#125; -fsanitize=null -fsanitize=leak -fsanitize=address&quot;)</code> è¿™äº›é€‰é¡¹ç¼–è¯‘å°±èƒ½æœ‰ç±»ä¼¼çš„æç¤ºã€‚ä½†æ˜¯åœ¨ rtorrent ä¸­åŠ å…¥è¿™äº›ç¼–è¯‘é€‰é¡¹åè¿˜æ˜¯æ²¡æœ‰ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆã€‚ã€‚ã€‚</p><h3 id="hash-string-ä¹±ç "><a class="markdownIt-Anchor" href="#hash-string-ä¹±ç "></a> hash string ä¹±ç </h3><p>æˆ‘æƒ³åœ¨è¿”å›æ¶ˆæ¯ä¸­å¸¦ä¸Šå½“å‰ torrent çš„ hash string ç»™ client ä½œä¸ºåˆ¤æ–­æ˜¯é’ˆå¯¹å“ªä¸ª torrent çš„äº‹ä»¶é€šçŸ¥ï¼Œçœ‹ä»£ç åº”è¯¥æ˜¯ <code>download-&gt;info()-&gt;hash().str()</code> è¿™ä¸ªæ–¹æ³•ï¼Œç»“æœ json æ— æ³•è§£æï¼Œæ‰“å°å‡ºæ¥ä¸€çœ‹æ˜¯ä¹±ç ã€‚ä¸€å¼€å§‹è¿˜åœ¨æƒ³ä¼šä¸ä¼šåˆæ˜¯ wsl çš„é”…ï¼Œåæ¥æ”¾åˆ°è™šæ‹Ÿæœºä¸Šè·‘è¿˜æ˜¯ä¸€æ ·ã€‚æœ€åæ˜¯ä» rpc å‘½ä»¤å…¥æ‰‹çš„ï¼šå‘ç°æœ‰ä¸€æ¡ â€œd.hashâ€ çš„å‘½ä»¤å¯ä»¥è¿”å› torrent çš„ hash stringï¼Œé‚£ä¹ˆ rtorrent ä¸­è‚¯å®šæœ‰å¤„ç†è¿™æ¡å‘½ä»¤çš„ä»£ç ï¼Œé€šè¿‡åœ¨ IDE ä¸­æœç´¢ â€œd.hashâ€ æ‰¾åˆ° src/command_download.cc line 802ï¼Œå‘ç°åŸæ¥è¿˜è¦ transform ä¸€ä¸‹æ‰å¯ä»¥ï¼š<code>torrent::utils::transform_hex_str(download-&gt;info()-&gt;hash().str())</code></p><h3 id="scgi-å’Œ-websocket-ç›‘å¬åŒä¸€ä¸ª-socket"><a class="markdownIt-Anchor" href="#scgi-å’Œ-websocket-ç›‘å¬åŒä¸€ä¸ª-socket"></a> scgi å’Œ websocket ç›‘å¬åŒä¸€ä¸ª socket</h3><p>ç»™ mentor çœ‹å®Œä»£ç å mentor è¯´èƒ½ä¸èƒ½è®© scgi å’Œ websocket ç›‘å¬åŒä¸€ä¸ª socketï¼Œåé¢æˆ‘å»äº†è§£åˆ°äº† <code>SO_REUSEPORT</code> è¿™ä¸ª socket optionï¼Œåœ¨ scgi ä¸­å¼€å¯åç¨‹åºå¯ä»¥å¯åŠ¨ï¼Œä½†æ˜¯ scgi æœåŠ¡å´ä¸èƒ½æ­£å¸¸è¿è¡Œï¼Œæ¥ä¸‹æ¥å°è¯•äº†è®©ä¸€ä¸ª tcp echo server å’Œ websocket ç›‘å¬åœ¨åŒä¸€ä¸ª port ä¸Šï¼Œå‘ç°äº†æ¶ˆæ¯é”™ä¹±çš„ç°è±¡ï¼šwebsocket çš„ç¬¬ä¸€ä¸ª http æŠ¥æ–‡æœ‰å¯èƒ½è¢« tcp echo server æ”¶äº†ï¼Œè¿”å›çš„å†…å®¹è‡ªç„¶ä¸æ˜¯ websocket client èƒ½å¤„ç†å°±æŠ¥é”™äº†ï¼ŒäºŒè€…éƒ½æ˜¯è¿è¡Œåœ¨ tcp ä¹‹ä¸Šï¼Œä¸èƒ½ä¿è¯ client å‘æ¥çš„æ¶ˆæ¯è¢«æ­£ç¡®çš„ server æ”¶åˆ°ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>GSoC</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¼€æº</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GSoC 2022 Series - 2</title>
    <link href="/2022/05/23/GSoC%202022%20Series%202/"/>
    <url>/2022/05/23/GSoC%202022%20Series%202/</url>
    
    <content type="html"><![CDATA[<h2 id="ç³»åˆ—å¯¼èˆª"><a class="markdownIt-Anchor" href="#ç³»åˆ—å¯¼èˆª"></a> ç³»åˆ—å¯¼èˆª</h2><ul><li><a href="https://young-flash.github.io/2022/05/21/GSoC%202022%20Series%201/">GSoC 2022 Series - 1</a></li><li><a href="https://young-flash.github.io/2022/05/23/GSoC%202022%20Series%202/">GSoC 2022 Series - 2</a></li><li><a href="https://young-flash.github.io/2022/07/02/GSoC%202022%20Series%203/">GSoC 2022 Series - 3</a></li><li><a href="https://young-flash.github.io/2022/09/08/GSoC%202022%20Series%204/">GSoC 2022 Series - 4</a></li></ul><h2 id="ç†Ÿæ‚‰ä»£ç "><a class="markdownIt-Anchor" href="#ç†Ÿæ‚‰ä»£ç "></a> ç†Ÿæ‚‰ä»£ç </h2><p>è”ç³» mentor åä»–è®©æˆ‘å»çœ‹ src/rpc ä¸‹çš„ä»£ç ï¼ŒJSON-RPC åè®®ä»¥åŠ SCGI åè®®çš„å®ç°éƒ½åœ¨è¿™é‡Œï¼ŒåŸå…ˆåªæœ‰ XML-RPCï¼Œmentor ä¸ºå®ƒå¢åŠ äº† JSON-RPC çš„æ”¯æŒï¼šæ ¹æ® XML-RPC ä¸­çš„æ¥å£å®šä¹‰äº†ä¸€ä¸ª IRPC æ¥å£ç±»ï¼Œç„¶åè®©åŸå…ˆçš„ XML RPC ä»¥åŠæ–°å¢çš„ JSON RPC ç»§æ‰¿è‡ªè¿™ä¸ªæ¥å£ï¼Œé€šè¿‡ RpcManager å°† RPC è¯·æ±‚æ ¹æ®å…¶å†…å®¹æ˜¯ XML è¿˜æ˜¯ JSON åˆ†æ´¾åˆ°å¯¹åº”çš„å¤„ç†ç±»ä¸­ç„¶åå†è¿”å›ç»“æœã€‚ä¸€å¼€å§‹çœ‹ä»£ç è¿˜æ˜¯æ¯”è¾ƒæ··çš„ï¼Œç”»ä¸€ä¸‹åˆ†æå›¾å¯¹äºç†æ¸…ç±»ä¹‹é—´çš„å…³ç³»å’Œå·¥ä½œæµç¨‹ä¼šå¾ˆæœ‰å¸®åŠ©ï¼š</p><p><img src="/img/blog_pic/2022/rtorrent-jsonRPC.jpg" alt="" /></p><p>æ­¤æ—¶çš„ RPC çš„ç½‘ç»œé€šä¿¡éƒ¨åˆ†æ˜¯ç”± SCGI åè®®å®ç°çš„ï¼Œè€Œè¿™ä¸ªé¡¹ç›®çš„ç›®æ ‡ä¹‹ä¸€æ˜¯å°†å¤è€çš„ SCGI åè®®æ›¿æ¢ä¸ºæ›´åŠ  Modern çš„ Websocket åè®®ã€‚å½“æ—¶æˆ‘çš„æƒ³æ³•æ˜¯ç…§çŒ«ç”»è™åœ°å¢åŠ  websockets.hã€ <a href="http://websockets.cc">websockets.cc</a> è¿™æ ·ä¸¤ä¸ªæ–‡ä»¶å»å®ç° Websocket åè®®ã€‚å½¼æ—¶çš„æˆ‘è¿˜ä¸çŸ¥é“ SCGI åè®®æ˜¯åŸºäº rTorrent çš„æ ¸å¿ƒä¾èµ– libtorrent ä¸­çš„ event loop å®ç°çš„ï¼Œä¹Ÿä¸æ¸…æ¥šä»£ç ä¸­ <code>Scgi</code> å’Œ <code>SCgiTask</code> è¿™ä¸¤ä¸ªç±»çš„å…³ç³»ï¼Œåæ¥èŠ±äº†æ›´å¤šæ—¶é—´å»é˜…è¯»ä»£ç ï¼Œç»“åˆ libtorrent ä¸­ event loop éƒ¨åˆ†çš„ä»£ç ç†è§£ä¹‹åæ‰ç†æ¸…æ¥šï¼š<code>Scgi</code> å’Œ <code>SCgiTask</code> çš„å…³ç³»ç±»ä¼¼äº reactor æ¨¡å‹ä¸­ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹çš„å…³ç³»ï¼Œ<code>Scgi</code> æ˜¯ listenerï¼Œ<code>activate</code> ä¹‹åæŠŠè‡ªå·±æ”¾åœ¨ event loop ä¸­ï¼Œ<code>event_read</code> ä¸­å°†æ¯ä¸€ä¸ªå¯è¯»äº‹ä»¶å°è£…ä¸º <code>SCgiTask</code> ç„¶åå°†å…¶æ”¾å…¥ event loop ä¸­ã€‚</p><h2 id="uwebsockets-å’Œ-usockets"><a class="markdownIt-Anchor" href="#uwebsockets-å’Œ-usockets"></a> uWebsockets å’Œ uSockets</h2><p><a href="https://github.com/uNetworking/uWebSockets">uWebsockets</a> æ˜¯ä¸€ä¸ª C++ çº¯å¤´æ–‡ä»¶å®ç°çš„ websocket åº“ï¼Œæ€§èƒ½ä¼˜è¶Šï¼ŒAPI å¾ˆç®€æ´ä¼˜é›…ï¼Œgithub ä¸Šæœ‰ 13 k startsï¼Œè®¡åˆ’ç”¨è¿™ä¸ªåº“æ¥å¼•å…¥ websocketï¼Œä¸è¿‡åœ¨ç¼–è¯‘å®‰è£…è¿™ä¸ªåº“çš„è¿‡ç¨‹ä¸­è¿˜æ˜¯é‡åˆ°äº†å¾ˆå¤šéº»çƒ¦çš„ã€‚uWebsockets èƒ½åšåˆ°çº¯å¤´æ–‡ä»¶å®ç°æ˜¯å› ä¸ºåº•å±‚ç”¨äº uSockets ä½œä¸ºç½‘ç»œåº“ï¼Œåœ¨å®éªŒå®¤çš„ GPU ä¸Šç¼–è¯‘ uWebSockets æ—¶æŠ¥é”™ <code>lto1: fatal error: bytecode stream in file â€˜uSockets/gcd.oâ€™ generated with GCC compiler older than 10.0 compilation terminated</code>ã€‚ æƒ³ç€æ˜¯é“¾æ¥å™¨ç‰ˆæœ¬å¤ªä½äºæ˜¯å®‰è£…æ–°çš„é“¾æ¥å™¨ï¼Œç»“æœç¼–è¯‘å®‰è£…æ–°ç‰ˆ binutils-2.38ï¼›æˆåŠŸå®‰è£…äº†æ–°ç‰ˆé“¾æ¥å™¨åè¿˜æ˜¯ä¸è¡Œï¼›è½¬è€Œå®‰è£…ç‰ˆæœ¬ä½äº 10.0 çš„ gcc â€¦ è£…äº† 9.2 ç‰ˆæœ¬çš„è¿˜æ˜¯ä¸è¡Œã€‚ã€‚ã€‚ã€‚ã€‚ã€‚åƒå®Œé¥­ååœ¨ Fisher çš„è™šæ‹Ÿæœºé‚£é‡Œè¯•äº†ä¸€ä¸‹ï¼Œä¸€ä¸‹å­å°±ç¼–è¯‘è¿‡äº†ã€‚ã€‚ã€‚å›æ¥è£…äº†ä¸ª 20.04 çš„ ubutun è™šæ‹Ÿæœºç„¶åæœç„¶ç¼–è¯‘æˆåŠŸäº†ï¼Œæ¥ä¸‹æ¥å°±å®Œå…¨åœ¨è™šæ‹Ÿæœºä¸­å¼€å‘äº†ã€‚è¿™ä¸ªè¿‡ç¨‹è®°å½•åœ¨äº†å‰é¢çš„<a href="https://young-flash.github.io/2022/03/27/uWebsockets%20%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/">è¿™ç¯‡åšå®¢</a>ä¸­ã€‚</p><p>å¼„å®Œè¿™äº›åæˆ‘è¿˜ç”¨ uWebsockets å†™äº†ä¸€ä¸ªå° <a href="https://github.com/Young-Flash/websockets-demo">demo</a> ç„¶åç»™ mentor çœ‹ï¼Œç°åœ¨çœ‹æ¥è¿™ä¸ª demo çœŸæ˜¯æœ‰å¤Ÿç®€å•çš„ã€‚ã€‚ã€‚mentor æŒ‡å‡ºäº†è¿™ä¸ªåº“ä¸æ”¯æŒ unix domain socketï¼Œä½†æ˜¯è¿™é¡¹ç‰¹æ€§å¯¹äº rTorrent æ¥è¯´å¾ˆé‡è¦ï¼š</p><blockquote><p>The feature is essential because rTorrent RPC interface has arbitrary command execution capabilities but doesnâ€™t have access control of its own. Unix socket could be access restricted as a file, much straightforward than a port.</p></blockquote><h2 id="unix-domain-socket"><a class="markdownIt-Anchor" href="#unix-domain-socket"></a> unix domain socket</h2><p>SCGI çš„å¯ä»¥è·‘åœ¨ TCP/IP çš„ç«¯å£ä¸Šï¼Œä¹Ÿå¯ä»¥è·‘åœ¨ unix domain socket ä¸Šï¼Œå½“æ—¶æˆ‘è¿˜ä¸çŸ¥é“ä»€ä¹ˆæ˜¯ unix domain socketï¼Œä¸€ç•ª Google ä¸‹æ¥åæ‰ç®—æœ‰æ‰€äº†è§£ã€‚mentor è¯´è·‘åœ¨ unix domain socket æ¯”è¾ƒå®‰å…¨ï¼Œå¸Œæœ› websocket ä¹Ÿèƒ½è·‘åœ¨ unix domain socket ä¸Šï¼Œä½†æ˜¯ uWebsockets ä¸æ”¯æŒ unix domain socketï¼Œæ­¤æ—¶åªæœ‰ä¸¤ä¸ªé€‰æ‹©ï¼šä¸€æ˜¯è‡ªå·±ä¸º uWebsockets å¢åŠ  unix domain socket æ”¯æŒï¼Œè€Œæ˜¯å¦å¯»å®ƒåº“ï¼Œå½“æ—¶è§‰å¾—è‡ªå·±å¢åŠ  unix domain socket æ”¯æŒè‚¯å®šå¾ˆéš¾å°±å»å¯»æ‰¾å…¶ä»–åº“ã€‚è¯•äº† libwebsocketï¼Œæœ‰ unix domain socket æ”¯æŒï¼Œä¸è¿‡æ˜¯ C å†™çš„ï¼Œmentor è¯´æ¥å£ old-styleï¼Œç¡®å®å¾ˆéš¾çœ‹æ‡‚ã€‚ä»–å»ºè®®æˆ‘å»å®ç° uWebsockets çš„ unix domain socket æ”¯æŒï¼ŒæŸ¥äº†ä¸€äº›èµ„æ–™ï¼Œæ„Ÿè§‰ä¹Ÿè¿˜æ˜¯æ²¡å•¥æ€è·¯ã€‚è½¬è€Œå»å¯»æ‰¾æ˜¯å¦æœ‰å…¶ä»–æ”¯æŒ Unix domain socket çš„ Websockets å®ç°ï¼Œçœ‹äº† websocketpp å’Œ boost çš„ websocket å¥½åƒéƒ½æ²¡æœ‰ã€‚</p><p>ç»“æœæœ€ååªèƒ½ç¡¬ç€å¤´çš®å°è¯•åœ¨ uWebsockets ä¸Šå®ç°è¿™é¡¹ç‰¹æ€§ï¼Œé¦–å…ˆåœ¨ uWebsockets å’Œ uSockets ä¸­ç¿»éäº†æ‰€æœ‰è·Ÿ unix domain socket æœ‰å…³çš„ issueï¼Œç¡®å®æœ‰é‚£ä¹ˆå‡ ä¸ªï¼Œå…¶ä¸­å¯¹æˆ‘æœ‰å¯å‘çš„æ˜¯<a href="https://github.com/uNetworking/uWebSockets/issues/1364">è¿™ä¸ª</a>ï¼Œè®©æˆ‘çŸ¥é“äº†ä» uSockets çš„ <code>bsd.c</code> è¿™ä¸ªæ–‡ä»¶ä¸­çš„åˆ›å»º socket éƒ¨åˆ†å…¥æ‰‹ï¼Œæ¥ç€è¿˜åœ¨ uWebsockets ä¸­æäº†ä¸€ä¸ª <a href="https://github.com/uNetworking/uWebSockets/discussions/1438">discussion</a>ï¼Œ@äº†å¥½å¤šäººéƒ½æ²¡äººç†æˆ‘ã€‚ã€‚ã€‚å®é™…åŠ¨æ‰‹æ“ä½œåç«Ÿç„¶çœŸçš„è®©æˆ‘åšå‡ºæ¥äº†ï¼Œæ¯”æƒ³è±¡ä¸­çš„ç®€å•è®¸å¤šï¼Œè¿™ä¹Ÿå¾—ç›Šäº uWebsockets æœ¬èº«çš„è®¾è®¡å’Œç¼–ç éƒ½å¾ˆä¼˜ç§€ã€‚åœ¨ uSockets ä¸­æäº† <a href="https://github.com/uNetworking/uSockets/pull/178">PR</a>ï¼Œæƒ³ç€è¿™è¦æ˜¯èƒ½åˆè¿›å»äº†é‚£å¯å°±å¤ªæ£’äº†ï¼Œä¸è¿‡ä½œè€…è®¤ä¸ºè¿™è¿˜ä¸å¤Ÿï¼Œéœ€è¦è€ƒè™‘å…¼å®¹å…¶ä»–åè®®ï¼ˆå…¶å®ä½œè€…çš„æ„æ€æˆ‘ä¹Ÿä¸å¤ªç†è§£ï¼‰ï¼Œè¿™ PR å°±å…ˆæ”¾ç€å§ï¼Œæ—¥åæœ‰æ—¶é—´å† work on it</p><h2 id="qualification-task"><a class="markdownIt-Anchor" href="#qualification-task"></a> qualification task</h2><p>mentor åæ¥å‘å¸ƒäº† qualification taskï¼š</p><blockquote><p>Implement a minimal WebSockets -&gt; SCGI â€œtranslatorâ€ program in C++. Note that you donâ€™t have to implement it inside rTorrent, and you donâ€™t have to worry about the complicated stuff like events. <a href="https://gist.github.com/jesec/858daa0cfb3948b4209127550bf4fe1e">Here</a> is a simple JSON-RPC client for rTorrent. Currently it accepts command line arguments. Your task, basically, is to let it accept arguments from WebSockets instead. Alternatively, just passthrough the payload and pipe back the response.The experience you gained here will also help with the main project.</p></blockquote><p>æ„Ÿè§‰ä¸å¤ªéš¾ï¼Œclone äº† mentor ç»™çš„ simple JSON-RPC client æƒ³è·‘èµ·æ¥çš„æ—¶å€™é‡åˆ°äº†é—®é¢˜ï¼šåœ¨å°è¯•ç”¨ ip:port è¿æ¥ rtorrent çš„æ—¶å€™æ€»æ˜¯æŠ¥é”™ Failed to connect: -1ï¼Œç”¨ unix domain socket è¿æ¥çš„æ—¶å€™å°±æ­£å¸¸ï¼Œæäº†å¾ˆä¹…è¿˜ä¸çŸ¥é“æ˜¯ä»€ä¹ˆåŸå› ã€‚ã€‚ã€‚åæ¥åœ¨è¯¦ç»†çœ‹ä»£ç æ‰å‘ç°æ˜¯ mentor åœ¨ <code>sin-&gt;sin_port = ::htons(std::stoi(port))</code> è¿™é‡Œç«Ÿç„¶å†™é”™äº†å˜é‡åã€‚ã€‚ã€‚ã€‚ã€‚ã€‚slack ä¸Šè”ç³»ä»–è¯´äº†è¿™ä¸ªäº‹æƒ…ï¼Œé—®ä»–æ˜¯ä¸æ˜¯è‡ªå·±éƒ½æ²¡ç”¨ ip:port è·‘è¿‡ï¼Œæœç„¶å¦‚æ­¤ã€‚ã€‚ã€‚è¿˜åœ¨æƒ³ç€ä¼šä¸ä¼šä¹Ÿæ˜¯ qualification task çš„å†…å®¹ä¹‹ä¸€ã€‚</p><p>è¿™ä¸ª task æˆ‘æ˜¯å¾ˆè®¤çœŸå®Œæˆäº†çš„ï¼Œæ”¾åœ¨äº†ä»£ç éƒ½æ”¾åœ¨äº†æˆ‘ github ä¸Šï¼Œåœ¨<a href="https://github.com/Young-Flash/translator">è¿™é‡Œ</a>å¯ä»¥çœ‹åˆ°ã€‚å¯¹äºå†…éƒ¨æ•°æ®æµè½¬çš„è¿™ä¸ªè®¾è®¡ç”šè‡³è‡ªæˆ‘æ„Ÿè§‰è‰¯å¥½å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ</p><p><img src="/img/blog_pic/2022/%E6%B5%81%E7%A8%8B%E5%9B%BE.png" alt="" /></p><h2 id="more"><a class="markdownIt-Anchor" href="#more"></a> more</h2><p>4 æœˆ 15 å·çš„æ—¶å€™è”ç³» mentor è¯´æˆ‘ä¸º uWebSockets å¢åŠ äº† unix domain socket çš„æ”¯æŒï¼Œå¹¶ä¸”è®¡åˆ’å‘å®˜æ–¹ repo æ PRï¼Œä¸è¿‡ mentor ä¹Ÿè¯´ä»–  open to a custom fork so that shouldnâ€™t be a big problemï¼Œè¿™æ ·çš„è¯å°±ç®— PR ä¸è¢« merge çš„è¯ä¹Ÿå¯ä»¥ç”¨æˆ‘è‡ªå·±çš„ forkã€‚5 æœˆä¸Šæ—¬æäº¤äº†ä¸¤ä¸ª commitï¼Œåœ¨ rTorrent ä¸­å¼•å…¥äº† websocketï¼Œæ”¯æŒ TCP/IP ç«¯å£ä»¥åŠ unix domain socket çš„è¿æ¥ï¼Œè·Ÿ mentor è¯´äº†è¿™äº‹å„¿ï¼Œå¾—åˆ°åé¦ˆè¿˜ä¸é”™ï¼Œè‡³æ­¤æ„Ÿè§‰åº”è¯¥æ²¡å•¥å¤§é—®é¢˜äº†å“ˆå“ˆå“ˆå“ˆ</p>]]></content>
    
    
    <categories>
      
      <category>GSoC</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¼€æº</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GSoC 2022 Series - 1</title>
    <link href="/2022/05/21/GSoC%202022%20Series%201/"/>
    <url>/2022/05/21/GSoC%202022%20Series%201/</url>
    
    <content type="html"><![CDATA[<h2 id="ç³»åˆ—å¯¼èˆª"><a class="markdownIt-Anchor" href="#ç³»åˆ—å¯¼èˆª"></a> ç³»åˆ—å¯¼èˆª</h2><ul><li><a href="https://young-flash.github.io/2022/05/21/GSoC%202022%20Series%201/">GSoC 2022 Series - 1</a></li><li><a href="https://young-flash.github.io/2022/05/23/GSoC%202022%20Series%202/">GSoC 2022 Series - 2</a></li><li><a href="https://young-flash.github.io/2022/07/02/GSoC%202022%20Series%203/">GSoC 2022 Series - 3</a></li><li><a href="https://young-flash.github.io/2022/09/08/GSoC%202022%20Series%204/">GSoC 2022 Series - 4</a></li></ul><h2 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h2><p>æ˜¨å¤©æ—©ä¸Š 5 ç‚¹å¤šèµ·æ¥çœ‹ GSoC çš„ä¸­é€‰ç»“æœå…¬å¸ƒï¼Œå‘ç°è‡ªå·±<a href="https://summerofcode.withgoogle.com/programs/2022/projects/Qr45UY5M">æˆåŠŸä¸­é€‰</a>äº†ï¼Œæ„æ–™ä¹‹å†…ä½†ä¹Ÿè¿˜æ˜¯æŒºå¼€å¿ƒçš„å“ˆå“ˆå“ˆå“ˆã€‚å†³å®šå¼€ä¸ªå‘è®°å½•ä¸‹è‡ªå·±æ•´ä¸ª GSoC çš„å…¨è¿‡ç¨‹ï¼Œä¸€æ–¹é¢ä½œä¸ºè‡ªå·±çš„æ€»ç»“å›é¡¾ï¼Œå¦ä¸€æ–¹é¢æˆ–è®¸ä¹Ÿå¯ä»¥ä¸ºåæ¥è€…æä¾›ä¸€äº›å‚è€ƒã€‚</p><h2 id="è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹"></a> è¿‡ç¨‹</h2><h3 id="é€‰æ‹©é¡¹ç›®"><a class="markdownIt-Anchor" href="#é€‰æ‹©é¡¹ç›®"></a> é€‰æ‹©é¡¹ç›®</h3><p>GSoC çš„é¡¹ç›®çœŸæ˜¯åˆå¤šåˆæ‚å•Šï¼Œç”šè‡³è¿˜æœ‰ä¿æŠ¤é²¸é±¼çš„ç»„ç»‡å’Œé¡¹ç›®ï¼Œè¿™å°±æ˜¯ diversity å—å“ˆå“ˆå“ˆã€‚ä¸€å¼€å§‹å¹¶æ²¡æœ‰æƒ³å¥½å°è¯•å“ªä¸ªé¡¹ç›®ï¼Œæƒ³ç€ä»è‡ªå·±çš„æŠ€æœ¯æ ˆå‡ºå‘æ‰¾ä¸€äº›é¡¹ç›®çœ‹çœ‹ï¼Œæˆ‘å¯¹ Linux C++ æ¯”è¾ƒæœ‰å…´è¶£æ‰€ä»¥æƒ³æ‰¾ä¸€äº›è¿™æ–¹é¢çš„é¡¹ç›®ï¼Œä¸€ç•ªæµè§ˆä¸‹æ¥å‘ç°äº† <a href="https://wiki.videolan.org/SoC_2022/">Develop a MPD server inside VLC</a>ã€<a href="https://github.com/casbin/SummerOfCode2022#casbin-for-cc">Casbin for C/C++</a>ã€HAIKU ä»¥åŠ <a href="https://ccextractor.org/public/gsoc/rtorrent-modern-rpc/">Implement a modern RPC interface for rTorrent</a>ï¼Œå…¶ä¸­ VLC å’Œ HAIKU åˆçœ‹ä¸Šå»ä¸å¤ªå¥‘åˆæˆ‘ï¼ŒCasbin çš„æœ‰å°è¯•è¿‡è·‘ä¸€ä¸‹é¡¹ç›®ä¸è¿‡ä¹Ÿæ²¡å•¥æ€è·¯ï¼Œæœ€åå‘ç°äº† rTorrent çš„è¿™ä¸ªé¡¹ç›®ï¼Œä¸»è¦æ˜¯ä¸º rTorrent å¼•å…¥ Websockets åè®®ï¼Œæ¶‰åŠåˆ°ç½‘ç»œç¼–ç¨‹å’Œ Modern C++ï¼ŒäºŒè€…æˆ‘éƒ½æœ‰ä¸€ç‚¹åŸºç¡€å¹¶ä¸”ä¹Ÿéƒ½æŒºæ„Ÿå…´è¶£çš„æ‰€ä»¥å°±é”å®šè¿™ä¸ªé¡¹ç›®äº†ã€‚å¹¶æ²¡æœ‰æƒ³è¿‡åŒæ—¶å°è¯•å¤šä¸ªé¡¹ç›®ï¼Œå› ä¸ºä¸æƒ³èŠ±å¾ˆå¤šæ—¶é—´ç²¾åŠ›å»å¤šçº¿ç¨‹ï¼Œè®¤å®šå¥½ä¸€ä¸ªç„¶å all in å°±å¥½äº†ï¼Œå°½äººäº‹å¬å¤©å‘½ã€‚</p><h3 id="ç†Ÿæ‚‰é¡¹ç›®"><a class="markdownIt-Anchor" href="#ç†Ÿæ‚‰é¡¹ç›®"></a> ç†Ÿæ‚‰é¡¹ç›®</h3><p>rTorrent æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå¼çš„ç§å­ä¸‹è½½ç¨‹åºï¼Œé€šè¿‡ SCGI åè®®å®ç° JSON RPC ä»è€Œæ”¯æŒæµè§ˆå™¨ç«¯çš„ GUIã€‚åŸæ¥æ˜¯ç”± <a href="https://github.com/rakshasa/rtorrent">rakshasa</a> å¼€å‘çš„ï¼Œæˆ‘è¦å‚ä¸çš„è¿™ä¸ªæ˜¯ jesec (åŒæ—¶ä¹Ÿæ˜¯æˆ‘çš„é¡¹ç›®å¯¼å¸ˆ) çš„å¦ä¸€ä¸ª <a href="https://github.com/jesec/rtorrent">distribution</a>ï¼Œä¸»è¦çš„åŒºåˆ«å¯ä»¥çœ‹<a href="https://flood.js.org/Changelog-4.5/">è¿™é‡Œ</a>ã€‚é€‰å®šå¥½è¿™ä¸ªé¡¹ç›®åæˆ‘é¦–å…ˆæŠŠå®ƒ clone ä¸‹æ¥ï¼Œç”±äºæ˜¯ CMake æ„å»ºçš„é¡¹ç›®æ‰€ä»¥åœ¨ CLion é‡Œé¢å¼€å‘è°ƒè¯•ä¹Ÿæ¯”è¾ƒæ–¹ä¾¿ï¼Œæ¥ç€ç²—ç•¥æµè§ˆä¸€ä¸‹ä»£ç ï¼Œç»“åˆä»£ç å»ç†è§£è¿™ä¸ªé¡¹ç›®çš„éœ€æ±‚ï¼Œè¿™ä¸€ç‚¹è¿˜æ˜¯èŠ±äº†æˆ‘ä¸€äº›æ—¶é—´çš„ï¼Œæ¯”å¦‚äº†è§£ SCGI åè®®ï¼ŒJSON-RPC ä»¥åŠ torrent çš„ä¸€äº›åŸºæœ¬çŸ¥è¯†ã€‚</p><h3 id="å¥—ç£"><a class="markdownIt-Anchor" href="#å¥—ç£"></a> å¥—ç£</h3><p>äº†è§£çš„å·®ä¸å¤šäº†å°±åœ¨ slack ä¸Šè”ç³»å¯¼å¸ˆï¼Œé¦–å…ˆä»‹ç»äº†è‡ªå·±çš„åŸºæœ¬æƒ…å†µï¼Œä¸ªäººæŠ€æœ¯æ ˆï¼Œå»å¹´å¼€æºä¹‹å¤çš„ç»å†ä»¥åŠæ¥ä¸‹æ¥çš„å¾®è½¯å®ä¹ ï¼Œé…ç½®å¥½äº†é¡¹ç›®çš„å¼€å‘ç¯å¢ƒå¹¶ä¸”æˆåŠŸè·‘èµ·æ¥äº†ã€‚</p><blockquote><p>hello jesec. I am Dongyang Zheng, interesting in GSoC project [Implement a modern RPC interface for rTorrent]. I guess you are the mentor of this project according to the info in slack and github, am I right ğŸ˜„ ?<br />First let me introduce myself, now I am in the second year of my master`s degree in South China Normal University, majoring computer science and technology. My major programming language is C++ and I really like it,  I understand the syntax of C++, new features in modern C++,  some knowledge about CMake and network programming over TCP/IP.<br />I have open source experience. I participated in a similar activity similar to GSoC last summer and successfully passed the review of mentor and organizers. The project I am responsible for is to encapsulate the JDBC protocol for a graph database named <a href="https://github.com/vesoft-inc/nebula">Nebula Graph</a>, it was done by me almost independently (of course, with the guidance of my mentor), the output (code and documentation) have been merged into offical github repository. Now I am now also a volunteer contributor in this open source community and continue to maintain this project. You can see the activity info <a href="https://summer.iscas.ac.cn/#/org/prodetail/210360225?lang=en">here</a> and now the outcome can be seen <a href="https://github.com/nebula-contrib/nebula-jdbc">here</a>.<br />These days I got json-rpc, libwebsockets ready on my dev machine and tried to build and run rTorrent on my computer. The basic conditions for development are in place. I wonder how far along the project is and where I should start if I want to work on it ?</p></blockquote><p>ç¬¬äºŒå¤© mentor å°±å›å¤æˆ‘äº†ï¼Œè¯´æˆ‘çš„ profile looks greatï¼Œå’Œæˆ‘è®²äº†ä¸€ä¸‹é¡¹ç›®çš„ç›®æ ‡ï¼Œä»¥åŠæ¥ä¸‹æ¥ä¼šå‘å¸ƒ qualification tasks to identify the best candidateã€‚å…³äºå¥—ç£çš„è¿‡ç¨‹åŠ qualification tasks æˆ‘åº”è¯¥ä¼šè®°å½•åœ¨ä¸‹ä¸€ç¯‡ä¸­ï¼Œå…ˆç»™è‡ªå·±å¼€ä¸ªå‘ã€‚</p><h3 id="ç”³è¯·"><a class="markdownIt-Anchor" href="#ç”³è¯·"></a> ç”³è¯·</h3><p>å…³äº proposal çš„æ’°å†™æˆ‘å‚è€ƒäº†è¿™ä¸ª <a href="https://github.com/saketkc/fos-proposals">repo</a>ï¼Œä¸»è¦å†™äº† 6 ä¸ªç‚¹ï¼šPersonal Informationã€Project Descriptionã€About meã€Homeworkã€Planã€Timeline å’Œ Why meã€‚é‡ç‚¹æ˜¯ Homework å’Œ Plan éƒ¨åˆ†ï¼Œåˆ†åˆ«ä»‹ç»äº†è‡ªå·±å‰æœŸçš„ä¸€äº›å‡†å¤‡å·¥ä½œä»¥åŠè‹¥æ˜¯èƒ½ä¸­é€‰è¿™ä¸ªé¡¹ç›®åçš„å¼€å‘è®¡åˆ’ï¼Œåç»­æˆ‘å†æŠŠæˆ‘è¿™ä»½ proposal å›é¦ˆç»™è¿™ä¸ª repoã€‚</p><h2 id="ä¸­é€‰"><a class="markdownIt-Anchor" href="#ä¸­é€‰"></a> ä¸­é€‰</h2><p>æˆ‘å¯¹è‡ªå·±çš„å‰æœŸå·¥ä½œä»¥åŠå’Œ mentor çš„äº¤æµè¿‡ç¨‹æ„Ÿè§‰è¿˜æ˜¯æŒºä¸é”™çš„ï¼Œæ‰€ä»¥è®¤ä¸ºè‡ªå·±ä¸­é€‰çš„æ¦‚ç‡è¿˜æ˜¯æ¯”è¾ƒå¤§çš„ã€‚GSoC ä»æˆªæ­¢æäº¤ proposal åˆ°å…¬å¸ƒä¸­é€‰ä¸­é—´éš”äº†ä¸€ä¸ªæœˆï¼Œè¿˜æ˜¯è®©äººç­‰å¾—å¤Ÿä¹…çš„ï¼Œä¸­é—´æˆ‘ç»™ rTorrent æäº¤äº†ä¸¤ä¸ª <a href="https://github.com/Young-Flash/rtorrent/commit/8e25383e69ce8b3017fa599167aaf66ac9d07d5b">commit</a>ï¼Œåˆæ­¥å¼•å…¥äº† websocketï¼Œç»™ mentor çœ‹åä»–è¯´ looks good at the first glanceï¼Œæåˆ°è¦åŒæ—¶ä¿ç•™ SCGI å’Œ websockets ä»¥åŠæ”¯æŒ Bazel æ„å»ºï¼Œè‡³æ­¤æˆ‘å°±è§‰å¾—ä¸­é€‰åº”è¯¥æ²¡é—®é¢˜äº†ï¼Œç»§ç»­ç­‰ Google å…¬å¸ƒç»“æœå§ã€‚ç»ˆäºåœ¨æ˜¨å¤©æ”¶åˆ°äº†ä¸­é€‰é‚®ä»¶ï¼ï¼ï¼</p><p><img src="/img/blog_pic/2022/GSoC-accepted.png" alt="" /></p>]]></content>
    
    
    <categories>
      
      <category>GSoC</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¼€æº</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windows ä¸Šä¸º uSockets æ­å»ºå¼€å‘ç¯å¢ƒ</title>
    <link href="/2022/04/17/Windows%20%E4%B8%8A%E4%B8%BA%20uSockets%20%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/"/>
    <url>/2022/04/17/Windows%20%E4%B8%8A%E4%B8%BA%20uSockets%20%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h2><p>å‰ä¸¤å¤©ä¸º uWebSockets å¢åŠ äº†æœåŠ¡ç«¯çš„ unix domain socket æ”¯æŒï¼Œè”ç³»äº†ä½œè€…æ˜¯å¦æ„¿æ„æ¥å—æˆ‘çš„ PRï¼Œå¾—åˆ°çš„<a href="https://github.com/uNetworking/uWebSockets/discussions/1438#discussioncomment-2570789">å›å¤</a>æ˜¯éœ€è¦èƒ½å¤Ÿè·¨å¹³å°å¹¶ä¸”å®¢æˆ·ç«¯ä¹Ÿéœ€è¦æ”¯æŒã€‚äºæ˜¯æ‰“ç®—å°è¯•åœ¨ Windows ä¸Šè·‘èµ·æ¥è¿™ä¸ªé¡¹ç›®ï¼Œç„¶ååœ¨å…¶ä¸Šå¢åŠ  unix domain socket æ”¯æŒã€‚æ­å»ºç¯å¢ƒçš„è¿‡ç¨‹å¾ˆè‰°è¾›ï¼ŒèŠ±äº†æˆ‘æ•´æ•´ä¸€å¤©å¤šçš„æ—¶é—´ï¼ŒC/C++ å¼€å‘è¿˜æ˜¯åœ¨ Linux ä¸‹æ¯”è¾ƒèˆ’æœã€‚ã€‚ã€‚</p><h2 id="è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹"></a> è¿‡ç¨‹</h2><h3 id="af_unix-windows-sdk"><a class="markdownIt-Anchor" href="#af_unix-windows-sdk"></a> AF_UNIX &amp;&amp; Windows SDK</h3><p>Windows åæ¥æ”¯æŒäº†unix domain socketï¼Œéœ€è¦ä¸‹æ¥å®‰è£… SDK æ‰èƒ½ä½“éªŒè¿™é¡¹ç‰¹æ€§ï¼Œå…·ä½“å¯ä»¥çœ‹è¿™ç¯‡<a href="https://devblogs.microsoft.com/commandline/af_unix-comes-to-windows/">åšå®¢</a>ï¼Œæœ€æ–°çš„ SDK è¦ 3 ä¸ª Gï¼Œåœ¨ç½‘ä¸Šæœäº†ä»¥å‰çš„ç‰ˆæœ¬ï¼Œ1 ä¸ª G å¤šç‚¹ï¼Œè¿™æ ·ä¹Ÿä¸ç”¨ä¸‹å¤ªä¹…ã€‚å®‰è£…å®Œä¹‹åå°±å¯ä»¥æ‰¾åˆ° <code>afunix.h</code> å¤´æ–‡ä»¶äº†ã€‚å…·ä½“çš„ example åœ¨å¾®è½¯çš„å¦ä¸€ç¯‡<a href="https://devblogs.microsoft.com/commandline/windowswsl-interop-with-af_unix/">åšå®¢</a>é‡Œã€‚</p><h3 id="vcpkg"><a class="markdownIt-Anchor" href="#vcpkg"></a> vcpkg</h3><p>C/C++ å…ä¸äº†è¦ä¾èµ–ç¬¬ä¸‰æ–¹åº“ï¼Œå¦‚æœæ¯ä¸€é¡¹ä¾èµ–éƒ½å¾—ç”±è‡ªå·±æ‰‹åŠ¨ç¼–è¯‘å®‰è£…å°±å¾ˆç¹çäº†ã€‚vcpkg æ˜¯ä¸€ä¸ªè·¨å¹³å°çš„åŒ…ç®¡ç†å·¥å…·ï¼Œå®‰è£…æ­¥éª¤åœ¨<a href="https://github.com/microsoft/vcpkg/blob/master/README_zh_CN.md#%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B-windows">è¿™é‡Œ</a>ã€‚æˆ‘åœ¨å®‰è£…å®Œä¹‹åä¸‹è½½ libuv çš„è¿‡ç¨‹ä¸­é‡åˆ°è¿™ä¸ªé”™è¯¯ï¼š<code>Error: in triplet x64-windows: Unable to find a valid Visual Studio instance</code>ï¼Œä¸€ç•ª Google ä¹‹åè§£å†³äº†ï¼Œéœ€è¦åœ¨ä¸º Visual Studio å®‰è£… English language ä»¥åŠå®‰è£…ä¸€ä¸ªç»„ä»¶ï¼š<strong>C++ CMake tools for Windows</strong>ã€‚å…·ä½“çœ‹<a href="https://otland.net/threads/compiling-tfs-with-vcpkg-unable-to-find-a-valid-visual-studio-instance.279856/">è¿™é‡Œ</a>ã€‚</p><h3 id="å·¥å…·é“¾"><a class="markdownIt-Anchor" href="#å·¥å…·é“¾"></a> å·¥å…·é“¾</h3><p>VS çš„å·¥å…·é“¾å’Œ GNU çš„ä¸åŒï¼ŒGNU çš„ g++ å’Œ gcc åœ¨ VS ä¸­éƒ½æ˜¯ clï¼Œå‘½ä»¤æ ¼å¼ä¹Ÿä¸ä¸€æ ·ï¼Œæ¯”å¦‚ g++ ä¸­æŒ‡å®š include ç›®å½•æ˜¯ -I<code>path</code>ï¼Œcl ä¸­æ˜¯ /I<code>path</code>ï¼Œ-std=c<ins>17 åœ¨ cl ä¸­æ˜¯ /std:c</ins>17ã€‚ã€‚ã€‚ä¸€å¼€å§‹ä¸çŸ¥é“è¿™äº›å·®å¼‚ï¼Œæ€»æ˜¯åœ¨ cl ä¸­ä¹ æƒ¯æ€§åœ°å†™ä¸Š g++ çš„å‘½ä»¤æ ¼å¼å¯¼è‡´å‡ºç°äº†å¾ˆå¤šè«åå…¶å¦™çš„é—®é¢˜ã€‚</p><p>make è¿è¡Œ uSockets ä¸­çš„ Makefile æ—¶è¿˜æŠ¥é”™æ‰¾ä¸åˆ° <code>CC</code>ï¼Œåæ¥çœ‹äº† Makefile åçŸ¥é“ <code>CC</code> æ˜¯é‡Œé¢å®šä¹‰çš„ä¸€ä¸ªå˜é‡ï¼Œä»£æŒ‡ç¼–è¯‘å™¨ã€‚è§£å†³æ–¹æ³•æ˜¯åœ¨ make å‘½ä»¤ä¸­æ˜¾ç¤ºæŒ‡æ˜ <code>CC</code>ï¼šmake CC=gcc.exeï¼Œä½†æ˜¯è¿™æ ·ç¼–è¯‘å‡ºæ¥çš„æ˜¯ä¸€ä¸ªä¸ª .o æ–‡ä»¶(linux ä¸‹çš„æ–‡ä»¶æ ¼å¼ï¼ŒWindows ä¸­å¯¹åº”çš„æ˜¯ .obj)ï¼Œå¹¶ä¸”è¿˜æŠ¥é”™æ‰¾ä¸åˆ° <code>uv.h</code>ï¼Œåæ¥çµå…‰ä¸€ç°æŠŠå‘½ä»¤æ¢æˆ <code>make CC=cl.exe</code> å°±ç¼–è¯‘å‡º .obj äº†ï¼Œç”±äº Makefile ä¸­æ²¡æœ‰ä¸º Windows å®šä¹‰æŠŠ .obj æ‰“åŒ…æˆé™æ€é“¾æ¥åº“çš„å‘½ä»¤ï¼Œæ‰€ä»¥æˆ‘æ‰‹åŠ¨æŠŠç¼–è¯‘å‡ºæ¥çš„ .obj æ‰“åŒ…æˆä¸€ä¸ª .lib äº†ï¼Œæ­¥éª¤å‚è€ƒè¿™ç¯‡<a href="https://blog.csdn.net/lixiangminghate/article/details/78943496">åšå®¢</a>ã€‚è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªå‘ï¼ŒVS ä¸­æœ‰ link.exeï¼ŒGit ä¸­ä¹Ÿæœ‰ï¼Œè€Œä¸”åœ¨æˆ‘çš„ç¯å¢ƒå˜é‡è®¾ç½®ä¸­ Git çš„è·¯å¾„æ˜¯é å‰çš„ï¼Œç»“æœæ‰§è¡Œ link çš„æ—¶å€™æŠ¥é”™ <code>/usr/bin/link: extra operand</code>ï¼Œæ¥ç€åœ¨å‘½ä»¤è¡Œä¸­æ˜¾ç¤ºæŒ‡å®š VS çš„ link è·¯å¾„åæ‰§è¡Œæ‰“åŒ…å‘½ä»¤å°±æˆåŠŸäº†ï¼Œå¾—çŸ¥åŸå› åæŠŠ Git çš„è·¯å¾„æŒªåˆ° VS åé¢ï¼Œè¿™æ ·æ¯æ¬¡æ‰§è¡Œ link çš„æ—¶å€™å°±ä¸ç”¨æ˜¾ç¤ºæŒ‡å®šè·¯å¾„äº†ã€‚</p><h3 id="ç¯å¢ƒå˜é‡çš„è®¾ç½®"><a class="markdownIt-Anchor" href="#ç¯å¢ƒå˜é‡çš„è®¾ç½®"></a> ç¯å¢ƒå˜é‡çš„è®¾ç½®</h3><p>ç¼–è¯‘çš„è¿‡ç¨‹æ€»æ˜¯é‡åˆ°æ‰¾ä¸åˆ°å¤´æ–‡ä»¶ä»¥åŠè¿è¡Œæ—¶æ‰¾ä¸åˆ°åŠ¨æ€é“¾æ¥çš„é—®é¢˜ï¼ŒçŒœæƒ³åº”è¯¥æ˜¯ç¯å¢ƒå˜é‡çš„é—®é¢˜ï¼Œå‚è€ƒäº†è¿™ç¯‡<a href="https://blog.csdn.net/weixin_43997331/article/details/104764873">åšå®¢</a>ï¼Œè®¾ç½®äº†ä¸€ç³»åˆ—ç¯å¢ƒå˜é‡ä¹‹åå°± OK äº†ã€‚ä¸‹é¢æ˜¯æˆ‘çš„ç¯å¢ƒå˜é‡è®¾ç½®ï¼š</p><p>å¤´æ–‡ä»¶ï¼š<code>INCLUDE</code></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">E</span>:\WindowsSDK\Lib\<span class="hljs-number">10</span>.<span class="hljs-number">0</span>.<span class="hljs-number">20344</span>.<span class="hljs-number">0</span>\um\x64<br><span class="hljs-attribute">E</span>:\WindowsSDK\Lib\<span class="hljs-number">10</span>.<span class="hljs-number">0</span>.<span class="hljs-number">20344</span>.<span class="hljs-number">0</span>\ucrt\x64<br><span class="hljs-attribute">D</span>:\developmentTools\VisualStudio2022\VC\Tools\MSVC\<span class="hljs-number">14</span>.<span class="hljs-number">31</span>.<span class="hljs-number">31103</span>\lib\x64<br><span class="hljs-attribute">D</span>:\environment\vcpkg\installed\x64-windows\lib<br></code></pre></td></tr></table></figure><p>é™æ€é“¾æ¥åº“æ–‡ï¼š<code>LIB</code></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">E</span>:\WindowsSDK\Lib\<span class="hljs-number">10</span>.<span class="hljs-number">0</span>.<span class="hljs-number">20344</span>.<span class="hljs-number">0</span>\um\x64<br><span class="hljs-attribute">E</span>:\WindowsSDK\Lib\<span class="hljs-number">10</span>.<span class="hljs-number">0</span>.<span class="hljs-number">20344</span>.<span class="hljs-number">0</span>\ucrt\x64<br><span class="hljs-attribute">D</span>:\developmentTools\VisualStudio2022\VC\Tools\MSVC\<span class="hljs-number">14</span>.<span class="hljs-number">31</span>.<span class="hljs-number">31103</span>\lib\x64<br><span class="hljs-attribute">D</span>:\environment\vcpkg\installed\x64-windows\lib<br></code></pre></td></tr></table></figure><p>åŠ¨æ€é“¾æ¥åº“ï¼šåœ¨ <code>Path</code> ä¸­æ–°å¢ vcpkg å­˜æ”¾ .dll çš„è·¯å¾„<br /><code>D:\environment\vcpkg\installed\x64-windows\bin</code></p><h3 id="æœºå™¨ä½“ç³»ç»“æ„ä¸åŒ¹é…"><a class="markdownIt-Anchor" href="#æœºå™¨ä½“ç³»ç»“æ„ä¸åŒ¹é…"></a> æœºå™¨ä½“ç³»ç»“æ„ä¸åŒ¹é…</h3><p>åœ¨ CLion ä¸­è¿è¡Œçš„æ—¶å€™æ€»æ˜¯æŠ¥é”™<code>â€œæ¨¡å—è®¡ç®—æœºç±»å‹â€œx64â€ä¸ç›®æ ‡è®¡ç®—æœºç±»å‹â€œX86â€</code>çš„é”™è¯¯ï¼Œæˆ‘çš„æœºå™¨æ˜¯ x64 çš„ï¼Œè¿™å®åœ¨è®©äººè¿·æƒ‘ï¼Œæˆ‘è®¾ç½®åœ¨ CMake ä¸­è®¾ç½®äº†ä¸€ç³»åˆ—æŒ‡ä»¤æŒ‡å®šæœºå™¨ç±»å‹å’Œç¼–è¯‘å™¨ä»¥åŠé“¾æ¥å™¨çš„è·¯å¾„ï¼Œç»“æœè¿˜æ˜¯å¾—åˆ°ä¸€æ ·æˆ–è€…åè¿‡æ¥çš„é”™è¯¯ã€‚ã€‚ã€‚</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">set</span>(CMAKE_EXE_LINKER_FLAGS <span class="hljs-string">&quot;/machine:x64&quot;</span>)<br><br><span class="hljs-keyword">set</span>(CMAKE_C_COMPILER <span class="hljs-string">&quot;D:/developmentTools/VisualStudio2022/VC/Tools/MSVC/14.31.31103/bin/Hostx64/x64/cl.exe&quot;</span>)<br><span class="hljs-keyword">set</span>(CMAKE_CXX_COMPILER <span class="hljs-string">&quot;D:/developmentTools/VisualStudio2022/VC/Tools/MSVC/14.31.31103/bin/Hostx64/x64/cl.exe&quot;</span>)<br><span class="hljs-keyword">set</span>(CMAKE_RC_COMPILER <span class="hljs-string">&quot;E:/WindowsSDK/bin/10.0.20344.0/x64/rc.exe&quot;</span>)<br><span class="hljs-keyword">set</span>(CMAKE_MT_COMPILER <span class="hljs-string">&quot;E:/WindowsSDK/bin/10.0.20344.0/x64/mt.exe&quot;</span>)<br><span class="hljs-keyword">SET</span>(CMAKE_C_LINK_EXECUTABLE <span class="hljs-string">&quot;D:/developmentTools/VisualStudio2022/VC/Tools/MSVC/14.31.31103/bin/Hostx64/x64/link.exe&quot;</span>)<br></code></pre></td></tr></table></figure><p>åé¢æƒ³ç€å»çœ‹çœ‹ CLion ä¸­ toolchain çš„è®¾ç½®ï¼Œç»“æœå‘ç°æ˜¯ VS çš„ Architecture é»˜è®¤æ˜¯ x86ï¼Œæ¢æˆ amd64 åå°±å¯ä»¥äº†ã€‚</p><h3 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“"></a> æ€»ç»“</h3><p>è¿™ä¸ªè¿‡ç¨‹å¯è°“æ˜¯ä¸€æ³¢ N æŠ˜ã€‚ã€‚ã€‚ä¸è¿‡æœ€åæˆåŠŸåœ¨ CLion ä¸­è·‘èµ·æ¥çš„æ—¶å€™å¿ƒæƒ…è¿˜æ˜¯å¾ˆæ¿€åŠ¨çš„ã€‚ã€‚ã€‚è‡³äºå®‡å®™æœ€å¼ºçš„ Visual Studioï¼Œæˆ‘æ˜¯çœŸçš„ä¸ä¼šç”¨ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p><h2 id="å‚è€ƒ"><a class="markdownIt-Anchor" href="#å‚è€ƒ"></a> å‚è€ƒ</h2><ul><li><a href="https://github.com/uNetworking/uSockets">uSockets</a></li><li><a href="https://blog.csdn.net/weixin_43997331/article/details/104764873">åœ¨Windowså‘½ä»¤è¡Œä¸­ä½¿ç”¨cl.exe</a></li><li><a href="https://blog.csdn.net/lixiangminghate/article/details/78943496">objæ–‡ä»¶æ‰“åŒ…ä¸ºé™æ€åº“ï¼Œé™æ€åº“ä¸­æŠ½å–objæ–‡ä»¶</a></li><li><a href="https://cwang.me/2020/02/06/check-dll-type/">Windows ä¸­æŸ¥çœ‹åº“æ–‡ä»¶ï¼ˆlib æˆ– dllï¼‰æ˜¯ 32 ä½è¿˜æ˜¯ 64 ä½</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
      <tag>ç¯å¢ƒæ­å»º</tag>
      
      <tag>GSoC</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>uWebsockets ç¼–è¯‘å®‰è£…</title>
    <link href="/2022/03/27/uWebsockets%20%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/"/>
    <url>/2022/03/27/uWebsockets%20%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h2><p>æœ€è¿‘ç”±äºé¡¹ç›®éœ€è¦ç”¨åˆ° websocket æ‰€ä»¥çœ‹äº†ä¸€ä¸‹ C++ å®ç°çš„ websocket åè®®ã€‚åœ¨ Github ä¸­æ‰¾åˆ°äº† <a href="https://github.com/uNetworking/uWebSockets">uWebSockets</a>ï¼ŒuWebSockets æœ€æ–°ç‰ˆä»¥ C++ 17 å®ç°äº† websocket åè®®ï¼Œç›®å‰æ‹¥æœ‰ 13.7k startsï¼Œåœ¨ C++ ä¸­æ˜¯ä¸»æµ websocket å®ç°ã€‚æˆ‘åœ¨ç¼–è¯‘å®‰è£…è¿™ä¸ªåº“ä¸Šè¿˜æ˜¯èŠ±äº†æŒºå¤šæ—¶é—´äº†ï¼Œåœ¨è¿™é‡Œè®°å½•ä¸€ä¸‹æˆ‘çš„ç¼–è¯‘å®‰è£…è¿‡ç¨‹ã€‚</p><h2 id="ç¯å¢ƒè®¾ç½®"><a class="markdownIt-Anchor" href="#ç¯å¢ƒè®¾ç½®"></a> ç¯å¢ƒè®¾ç½®</h2><p>uWebSockets ä»¥çº¯å¤´æ–‡ä»¶çš„å½¢å¼ç”¨ C++ 17 å®ç°ï¼Œrepo ä¸­çš„ç¤ºä¾‹è¿˜ç”¨åˆ°äº† C++ 20 çš„ç‰¹æ€§ï¼Œæ‰€ä»¥æœ€å¥½éœ€è¦æ”¯æŒ C++ 20 çš„ç¼–è¯‘å™¨ç‰ˆæœ¬ï¼ˆæˆ‘ç”¨çš„æ˜¯ gcc-9.20ï¼‰ã€‚</p><p>åœ¨å®éªŒå®¤çš„æœåŠ¡å™¨ä¸Šå°è¯•ç¼–è¯‘æ—¶é‡åˆ°äº† <code>lto1: fatal error: bytecode stream in file â€˜uSockets/gcd.oâ€™ generated with GCC compiler older than 10.0 compilation terminated</code> çš„é”™è¯¯ï¼Œçœ‹èµ·æ¥æ˜¯ç¼–è¯‘å™¨ ABI å…¼å®¹æ€§é—®é¢˜ã€‚å¯èƒ½æ˜¯å› ä¸ºæˆ‘è£…äº†å¤šä¸ªä¸åŒç‰ˆæœ¬çš„ gcc åŒæ—¶ç¯å¢ƒå˜é‡çš„è®¾ç½®ä¹Ÿæ¯”è¾ƒæ··ä¹±ï¼Œå°è¯•äº†å„ç§å‡çº§ç‰ˆæœ¬å’Œè®¾ç½®ç¯å¢ƒå˜é‡å‡æ— æœåè½¬è€Œåœ¨æ–°è£…çš„è™šæ‹Ÿæœºï¼ˆUbutun 20.04ï¼‰ä¸­ç¼–è¯‘å®‰è£…äº†ã€‚åœ¨ç¼–è¯‘æ—¶æœ€å¥½ç¡®ä¿ç¼–è¯‘ç¯å¢ƒâ€œå¹²å‡€ç®€æ´â€ã€‚</p><h2 id="æ­¥éª¤"><a class="markdownIt-Anchor" href="#æ­¥éª¤"></a> æ­¥éª¤</h2><p>uWebSockets èƒ½åšåˆ°çº¯å¤´æ–‡ä»¶å®ç°æ˜¯å› ä¸ºå®ƒåº•å±‚ä¾èµ–äº† <a href="https://github.com/uNetworking/uSockets">uSockets</a>ï¼ŒuSockets å°è£…äº†å„ç§ç½‘ç»œæ“ä½œã€‚æ ¹æ®ç¼–è¯‘é€‰é¡¹çš„ä¸åŒéœ€è¦å®‰è£…å¥½å®ƒçš„å„ç§ä¾èµ–é¡¹æ¯”å¦‚ opensslã€libuvã€zlib ç­‰ã€‚</p><h3 id="å…‹éš†-uwebsockets-åˆ°æœ¬åœ°"><a class="markdownIt-Anchor" href="#å…‹éš†-uwebsockets-åˆ°æœ¬åœ°"></a> <strong>å…‹éš† uWebSockets åˆ°æœ¬åœ°</strong></h3><p><code>git clone https://github.com/uNetworking/uWebSockets</code></p><h3 id="å…‹éš†-usockets-åˆ°-uwebsockets-ä¸­"><a class="markdownIt-Anchor" href="#å…‹éš†-usockets-åˆ°-uwebsockets-ä¸­"></a> <strong>å…‹éš† uSockets åˆ° uWebSockets ä¸­</strong></h3><p>é¡¹ç›®å…‹éš†ä¸‹æ¥ä¹‹åä¼šå‘ç°é‡Œé¢çš„ uSockets æ–‡ä»¶å¤¹æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥éœ€è¦åˆ æ‰è¯¥æ–‡ä»¶å¤¹ç„¶åå…‹éš† uSockets åˆ°é¡¹ç›®ä¸­ã€‚<br /><code>cd uWebSockets</code><br /><code>rm -rf uSockets</code><br /><code>git clone https://github.com/uNetworking/uSockets</code></p><h3 id="å¼€å¯-ssl-é€‰é¡¹ç¼–è¯‘"><a class="markdownIt-Anchor" href="#å¼€å¯-ssl-é€‰é¡¹ç¼–è¯‘"></a> <strong>å¼€å¯ ssl é€‰é¡¹ç¼–è¯‘</strong></h3><p><code>WITH_OPENSSL=1 make</code></p><h3 id="å®‰è£…"><a class="markdownIt-Anchor" href="#å®‰è£…"></a> <strong>å®‰è£…</strong></h3><p>æ³¨æ„åˆ° uWebSockets çš„ Makefile ä¸­æœ‰å†™ install å‘½ä»¤ï¼Œæ‰§è¡Œ <code>make install</code> åä¼šåœ¨ <code>/usr/local/include/</code> ä¸‹æ–°å»ºä¸€ä¸ª <code>uWebSockets</code> æ–‡ä»¶å¤¹ç„¶åå°† src ä¸‹çš„æ‰€æœ‰ .h æ–‡ä»¶æ‹·è´åˆ°å…¶ä¸­ã€‚è¿™æ—¶å€™è¿˜ä¸ç®—å…¨éƒ¨å®‰è£…æˆåŠŸï¼Œå‰é¢æåˆ° uWebSockets ä¾èµ–äº† uSocketsï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å®‰è£…å¥½ uSocketsã€‚</p><p>ç»è¿‡å‰é¢çš„ make ç¼–è¯‘åæ¥åˆ° uSockets æ–‡ä»¶å¤¹ï¼Œå‘ç°å…¶ä¸­å¤šå‡ºäº†å„ç§ .o ç›®æ ‡æ–‡ä»¶å’Œä¸€ä¸ª .a é™æ€é“¾æ¥åº“ï¼ˆå…¶å®è¿™ä¸ª .a å°±æ˜¯å¤šå‡ºçš„å„ä¸ª .o çš„é›†åˆï¼Œå¯ä»¥ç”¨ <code>readelf -A uSockets.a</code> æŸ¥çœ‹ï¼‰ã€‚uSockets çš„ Makefile ä¸­æ²¡æœ‰å†™å¥½ install å‘½ä»¤ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰‹åŠ¨æŠŠ src ä¸‹çš„ <code>libuSockets.h</code> å’Œç¼–è¯‘å‡ºæ¥çš„ uSockets.a é™æ€é“¾æ¥åº“å®‰è£…åˆ°ç³»ç»Ÿç›®å½•ä¸‹ï¼š<code>libuSockets.h</code> éœ€è¦æ‹·è´åˆ° <code>/usr/local/include</code> ä¸‹ï¼Œ<code>uSockets.a</code> éœ€è¦æ‹·è´åˆ° <code>/usr/lib/x86_64-linux-gnu</code> ä¸‹ç„¶åé‡å‘½åä¸º <code>libuSockets.a</code></p><h3 id="é“¾æ¥"><a class="markdownIt-Anchor" href="#é“¾æ¥"></a> <strong>é“¾æ¥</strong></h3><p>ä½¿ç”¨ uWebSockets å†™å®Œç¨‹åºåç¼–è¯‘æ—¶éœ€è¦æ‰‹åŠ¨é“¾æ¥ä¾èµ–çš„åº“æ–‡ä»¶ã€‚</p><p><code>-lz -lpthread -luSockets -lssl -lcrypto</code></p><h2 id="websocket-demo"><a class="markdownIt-Anchor" href="#websocket-demo"></a> websocket-demo</h2><p>è¿™æ˜¯ä¸€ä¸ªå…³äºå¦‚ä½•ä½¿ç”¨ uWebsockets æ¥å®ç°ä¸€ä¸ªæ”¯æŒå‘å¸ƒå’Œè®¢é˜…çš„ websocket æœåŠ¡å™¨ demoï¼Œä»£ç åœ¨<a href="https://github.com/Young-Flash/websockets-demo">è¿™é‡Œ</a>ã€‚</p><p>æœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œä¸»çº¿ç¨‹ç›‘å¬ ip: port ç­‰å¾… websockets å®¢æˆ·ç«¯è¿æ¥ï¼Œå®¢æˆ·ç«¯ä¼šåœ¨å®ƒå‘é€åˆ°æœåŠ¡å™¨çš„æ¶ˆæ¯ä¸­æŒ‡æ˜è¦è®¢é˜…çš„ topicï¼Œå¦ä¸€ä¸ªçº¿ç¨‹(publishtopicrandom)æ¨¡æ‹Ÿ topic å‘å¸ƒï¼Œå¦‚æœæŸä¸ª topic å·²ç»ç”±ç‰¹å®šçš„å®¢æˆ·ç«¯è®¢é˜…ï¼Œé‚£ä¹ˆåœ¨æœåŠ¡ç«¯å‘å¸ƒè¯¥ topic æ—¶ä¸è¯¥ topic ç›¸å…³çš„æ¶ˆæ¯å°†è‡ªåŠ¨è¢«å‘é€åˆ°ç›¸åº”çš„å®¢æˆ·ç«¯ã€‚mutex å’Œ condition_variable ç”¨äºåŒæ­¥ä¸¤ä¸ªçº¿ç¨‹ï¼Œåªæœ‰åœ¨å®¢æˆ·ç«¯è®¢é˜…åï¼Œçº¿ç¨‹ publishTopicRandomly æ‰ä¼šéšæœºå‘å¸ƒä¸»é¢˜ã€‚</p><h2 id="å‚è€ƒ"><a class="markdownIt-Anchor" href="#å‚è€ƒ"></a> å‚è€ƒ</h2><ul><li><a href="https://github.com/uNetworking/uWebSockets">uWebSockets</a></li><li><a href="https://github.com/uNetworking/uSockets">uSockets</a></li><li><a href="https://github.com/Young-Flash/websockets-demo">websockets-demo</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
      <tag>Linux</tag>
      
      <tag>ç¯å¢ƒæ­å»º</tag>
      
      <tag>GSoC</tag>
      
      <tag>websocket</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linux ä¸ºå½“å‰ç”¨æˆ·å®‰è£…æ–°ç‰ˆçš„ GCC å’Œ CMake</title>
    <link href="/2022/03/15/Linux%20%E4%B8%BA%E5%BD%93%E5%89%8D%E7%94%A8%E6%88%B7%E5%AE%89%E8%A3%85%E6%96%B0%E7%89%88%E7%9A%84%20GCC%20%E5%92%8C%20CMake/"/>
    <url>/2022/03/15/Linux%20%E4%B8%BA%E5%BD%93%E5%89%8D%E7%94%A8%E6%88%B7%E5%AE%89%E8%A3%85%E6%96%B0%E7%89%88%E7%9A%84%20GCC%20%E5%92%8C%20CMake/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h2><p>åœ¨å®éªŒå®¤æœåŠ¡å™¨ä¸Šç¼–è¯‘ä¸€ä¸ª C++ é¡¹ç›®çš„æ—¶å€™é‡åˆ°äº† GCC å’Œ CMake ç‰ˆæœ¬å¤ªä½çš„é—®é¢˜ï¼Œç¬¬ä¸€ååº”æ˜¯å‡çº§æœåŠ¡å™¨çš„ GCC å’Œ CMake ç‰ˆæœ¬ï¼Œä½†æ˜¯è¿™æ ·çš„è¯çªç„¶å‡çº§ç‰ˆæœ¬å¯èƒ½å¯¹å…¶ä»–åŒå­¦æœ‰å½±å“ï¼Œæ‰€ä»¥æœ€å¥½è¿˜æ˜¯ä¸ºè‡ªå·±é…ç½®ä¸€å¥—æ–°çš„ç¯å¢ƒå§ã€‚ä¸»è¦çš„è¿‡ç¨‹æ˜¯ä¸‹è½½ã€ç¼–è¯‘ååœ¨ ~/.bashrc ä¸­è®¾ç½®å½“å‰ç”¨æˆ·ç¯å¢ƒå˜é‡ã€‚</p><h2 id="å®‰è£…-gcc"><a class="markdownIt-Anchor" href="#å®‰è£…-gcc"></a> å®‰è£… GCC</h2><h3 id="æ­¥éª¤"><a class="markdownIt-Anchor" href="#æ­¥éª¤"></a> æ­¥éª¤</h3><ol><li><p><strong>ä¸‹è½½</strong><br />å½“å‰ gcc æœ€æ–°ç‰ˆæœ¬æ˜¯ 11.2.0ï¼Œé¦–å…ˆåœ¨è‡ªå·±ç”¨æˆ·ç©ºé—´ä¸‹æ–°å»ºä¸€ä¸ªç›®å½•ä¸‹è½½è¯¥ç‰ˆæœ¬çš„ gcc(å…¶ä»–<a href="http://ftp.gnu.org/gnu/gcc/">ç‰ˆæœ¬</a>å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°)<br /><code>wget http://ftp.gnu.org/gnu/gcc/gcc-11.2.0/gcc-11.2.0.tar.gz</code></p></li><li><p><strong>è§£å‹</strong><br /><code>tar -zxvf gcc-11.2.0.tar.gz</code><br />æ¥åˆ°è§£å‹åçš„ gcc-11.2.0 ç›®å½•ï¼Œä¸‹è½½æ‰€éœ€ä¾èµ–ï¼ˆGMP, MPFRã€MPC å’Œ ISLï¼‰ï¼Œå¯èƒ½ä¸èƒ½ä¸€æ¬¡æ€§ä¸‹è½½æˆåŠŸï¼Œè¿™æ ·çš„è¯åˆ æ‰å·²ä¸‹è½½çš„ä¾èµ–ç„¶åé‡æ–°æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ã€‚<br /><code>./contrib/download_prerequisites</code></p></li><li><p><strong>åœ¨ gcc-11.2.0 å¤–æ–°å»ºä¸€ä¸ªç›®å½•ä½œä¸ºç¼–è¯‘åçš„å®‰è£…è·¯å¾„ï¼š</strong><br /><code>mkdir gcc_11.2.0-flash</code></p></li><li><p><strong>æ¥åˆ° gcc-11.2.0 ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª build ç›®å½•ç”¨äºç¼–è¯‘ç„¶åé…ç½®ç¼–è¯‘å±æ€§ï¼š</strong><br /><code>../configure --disable-checking --enable-languages=c,c++ --disable-multilib --prefix=&quot;gcc_11.2.0-flash çš„ç»å¯¹è·¯å¾„&quot; --enable-threads=posix</code></p></li><li><p><strong>ç¼–è¯‘å¹¶å®‰è£…</strong><br />make -j 64(æœåŠ¡å™¨ 64 æ ¸æˆ‘å…¨å¼€äº†) &amp;&amp; make install</p></li><li><p><strong>åœ¨ ~/.bashrc ä¸­è®¾ç½®ç”¨æˆ·ç¯å¢ƒå˜é‡åæ‰§è¡Œ <code>source ~/.bashrc</code> ä½¿å…¶ç”Ÿæ•ˆ</strong></p></li></ol><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs txt">export PATH=/home/dongyang/env_of_flash/gcc-11.2.0-flash/bin:/home/dongyang/env_of_flash/gcc-11.2.0-flash/lib64:$PATH<br>export LD_LIBRARY_PATH=/home/dongyang/env_of_flash/gcc-11.2.0-flash/lib:$LD_LIBRARY_PATH<br><br># 1.gcc/g++ç­‰ç¨‹åºæœ¬èº«çš„è·¯å¾„<br>export PATH=/home/dongyang/env_of_flash/gcc-11.2.0-flash/bin:$PATH<br><br><br># 2.gccå¤´æ–‡ä»¶è·¯å¾„<br>export C_INCLUDE_PATH=$C_INCLUDE_PATH:/home/dongyang/env_of_flash/gcc-11.2.0-flash/include<br><br># 3.g++å¤´æ–‡ä»¶è·¯å¾„<br>export CPLUS_INCLUDE_PATH=$CPLUS_INCLUDE_PATH:/home/dongyang/env_of_flash/gcc-11.2.0-flash/include<br><br># 4.åŠ¨æ€é“¾æ¥åº“è·¯å¾„<br>export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/home/dongyang/env_of_flash/gcc-11.2.0-flash/lib64<br><br># 5.é™æ€åº“è·¯å¾„<br>export LIBRARY_PATH=$LIBRARY_PATH:/home/dongyang/env_of_flash/gcc-11.2.0-flash/lib<br></code></pre></td></tr></table></figure><ol start="7"><li><strong>éªŒè¯</strong><br /><code>gcc -v</code> éªŒè¯å½“å‰ gcc ç‰ˆæœ¬ï¼Œ<code>which gcc</code> æŸ¥çœ‹å…¶è·¯å¾„</li></ol><h3 id="è¸©å‘"><a class="markdownIt-Anchor" href="#è¸©å‘"></a> è¸©å‘</h3><p>make ç¼–è¯‘çš„æ—¶å€™é‡åˆ° fatal error No space left on device çš„é”™è¯¯ï¼Œå‚è€ƒ stackoverflow ä¸Š<a href="https://stackoverflow.com/questions/31493663/unable-to-compile-with-make-fatal-error-no-space-left-on-device">è¿™ä¸ªé—®é¢˜</a>çš„è§£å†³æ–¹æ³•ï¼Œåœ¨ç»ˆç«¯ä¸­æ‰§è¡Œ <code>export TMPDIR=~/tmp</code> åè§£å†³äº†</p><h2 id="å®‰è£…-cmake"><a class="markdownIt-Anchor" href="#å®‰è£…-cmake"></a> å®‰è£… CMake</h2><p>CMake çš„å®‰è£…æ¯”èµ· GCC ç®€å•è®¸å¤šå› ä¸ºå°‘äº†ç¼–è¯‘çš„è¿‡ç¨‹ï¼Œä¹Ÿå°±å°‘äº†æ½œåœ¨çš„æŠ¥é”™çš„æœºä¼šå“ˆå“ˆå“ˆå“ˆ</p><h3 id="æ­¥éª¤-2"><a class="markdownIt-Anchor" href="#æ­¥éª¤-2"></a> æ­¥éª¤</h3><ol><li><strong>ä¸‹è½½</strong><br />å½“å‰æœ€æ–°ç‰ˆæœ¬æ˜¯ 3.23.0-rc3ã€‚åœ¨<a href="https://cmake.org/download/">è¿™é‡Œ</a>æ‰¾åˆ°æƒ³è¦çš„ç‰ˆæœ¬ç„¶åä¸‹è½½å¹¶è§£å‹</li></ol><ul><li><code>wget https://github.com/Kitware/CMake/releases/download/v3.23.0-rc3/cmake-3.23.0-rc3.tar.gz</code></li><li><code>tar -zxvf cmake-3.23.0-rc3.tar.gz</code></li></ul><ol start="2"><li><p><strong>è®¾ç½®ç”¨æˆ·ç¯å¢ƒå˜é‡</strong><br />åœ¨ ~/.bashrc ä¸­åŠ ä¸Š <code>export PATH=/home/dongyang/env_of_flash/cmake-3.23.0-rc3/bin:$PATH</code> ç„¶ååœ¨ç»ˆç«¯è¿è¡Œ <code>source ~/.bashrc</code> ä½¿å…¶ç”Ÿæ•ˆ</p></li><li><p><strong>éªŒè¯</strong><br /><code>cmake --version</code> æŸ¥çœ‹å½“å‰ CMake ç‰ˆæœ¬ï¼›<code>which cmake</code> æŸ¥çœ‹å¯æ‰§è¡Œæ–‡ä»¶æ‰€åœ¨è·¯å¾„</p></li></ol><h2 id="å‚è€ƒ"><a class="markdownIt-Anchor" href="#å‚è€ƒ"></a> å‚è€ƒ</h2><ul><li><a href="https://stackoverflow.com/questions/31493663/unable-to-compile-with-make-fatal-error-no-space-left-on-device">fatal error No space left on device</a></li><li><a href="https://www.cnblogs.com/jessepeng/p/11674780.html">érootå®‰è£…GCC9.1.0</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
      <tag>Linux</tag>
      
      <tag>CMake</tag>
      
      <tag>ç¯å¢ƒæ­å»º</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é€šè¿‡ GitHub Action è‡ªåŠ¨å‘å¸ƒ Maven åŒ…åˆ°ä¸­å¤®ä»“åº“</title>
    <link href="/2022/03/11/%E9%80%9A%E8%BF%87%20GitHub%20Action%20%E8%87%AA%E5%8A%A8%E5%8F%91%E5%B8%83%20Maven%20%E5%8C%85%E5%88%B0%E4%B8%AD%E5%A4%AE%E4%BB%93%E5%BA%93/"/>
    <url>/2022/03/11/%E9%80%9A%E8%BF%87%20GitHub%20Action%20%E8%87%AA%E5%8A%A8%E5%8F%91%E5%B8%83%20Maven%20%E5%8C%85%E5%88%B0%E4%B8%AD%E5%A4%AE%E4%BB%93%E5%BA%93/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h2><p>å‰é˜µå­å¾®è½¯ leader round é¢è¯•çš„æ—¶å€™èŠåˆ°æˆ‘åšçš„çš„å¼€æºé¡¹ç›® <a href="https://github.com/nebula-contrib/nebula-jdbc">nebula-jdbc</a>ï¼Œé¢è¯•å®˜é—®åˆ°äº†è¿™ä¸ªé¡¹ç›®çš„è¢«ä½¿ç”¨æƒ…å†µï¼Œæˆ‘çŸ¥é“è¿™ä¸ªé¡¹ç›®æœ‰äººåœ¨ç”¨ï¼ˆå› ä¸ºæœ‰äººåœ¨ issue ä¸­æé—®äº†å“ˆå“ˆå“ˆå“ˆï¼‰ä½†æ˜¯ä¸çŸ¥é“æœ‰å¤šå°‘äººåœ¨ç”¨ï¼Œæ‰€ä»¥å½“æ—¶åªå›ç­”äº†è¿™ä¸ª repo çš„ watchã€fork å’Œ star æ•°é‡ï¼Œå› ä¸ºæˆ‘å¹¶æ²¡æœ‰æŠŠè¿™ä¸ªé¡¹ç›®æ‰“æˆ jar åŒ…å‘å¸ƒåˆ° maven ä¸­å¤®ä»“åº“ã€‚äº‹åæƒ³æƒ³ç¡®å®æœ‰å¿…è¦æ‰“åŒ…å‘å¸ƒï¼Œä¸€æ–¹é¢æ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨ï¼Œä¸€æ–¹é¢ä¹Ÿèƒ½çœ‹åˆ°è¢«ä½¿ç”¨çš„æƒ…å†µã€‚</p><h2 id="æµç¨‹"><a class="markdownIt-Anchor" href="#æµç¨‹"></a> æµç¨‹</h2><h3 id="é…ç½®-gpg"><a class="markdownIt-Anchor" href="#é…ç½®-gpg"></a> é…ç½® GPG</h3><p>GnuPGï¼Œç®€ç§° GPGï¼Œæ˜¯ GPG æ ‡å‡†çš„ä¸€ä¸ªå…è´¹å®ç°ã€‚ä¸ç®¡æ˜¯ Linux è¿˜æ˜¯ Windows å¹³å°ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ã€‚GPGneng å¯ä»¥ä¸ºæ–‡ä»¶ç”Ÿæˆç­¾åã€ç®¡ç†å¯†åŒ™ä»¥åŠéªŒè¯ç­¾åã€‚å‘å¸ƒåˆ°Mavenä»“åº“ä¸­çš„æ‰€æœ‰æ–‡ä»¶éƒ½è¦ä½¿ç”¨ GPG ç­¾åä¿è¯ä¸è¢«ç¯¡æ”¹ã€‚å…·ä½“çš„é…ç½®è¿‡ç¨‹å¯ä»¥å‚è€ƒè¿™ç¯‡<a href="https://www.timberkito.com/?p=141#hwpDMCYX">åšå®¢</a>ã€‚æœ€ç»ˆéœ€è¦ç”¨åˆ° GPG å¯†é’¥ï¼ˆå¯¼å‡ºçš„ä¸€é•¿ä¸²ï¼‰å’Œ Passphraseï¼ˆè‡ªå·±åœ¨ç”Ÿæˆå¯†é’¥è¿‡ç¨‹ä¸­è®¾ç½®çš„å¯†ç ï¼‰</p><h3 id="æ³¨å†Œ-sonatype-è´¦å·"><a class="markdownIt-Anchor" href="#æ³¨å†Œ-sonatype-è´¦å·"></a> æ³¨å†Œ Sonatype è´¦å·</h3><p>ä¸èƒ½ç›´æ¥å‘ maven ä¸­å¤®ä»“åº“ä¸­å‘åŒ…ï¼Œéœ€è¦å‘å¸ƒåˆ° Nexus ç„¶åç”±å®ƒå®šæœŸè‡ªåŠ¨åŒæ­¥åˆ° maven çš„ä¸­å¤®ä»“åº“ã€‚é¦–å…ˆéœ€è¦<a href="https://link.zhihu.com/?target=https%3A//issues.sonatype.org/secure/Signup%21default.jspa">æ³¨å†Œ Sonatype è´¦å·</a>ï¼Œç„¶åæäº¤ä¸€ä¸ª issue è¯´æ˜ä½ è¦å‘å¸ƒçš„è¿™ä¸ª jar åŒ…çš„ä¿¡æ¯ï¼Œå…·ä½“è¿‡ç¨‹å¯ä»¥å‚è€ƒè¿™ç¯‡<a href="https://blog.csdn.net/qq_36838191/article/details/81027586">åšå®¢</a>ã€‚ä¸€å¼€å§‹æˆ‘ä¸çŸ¥é“è¿˜æœ‰è¿™ä¸ªæ­¥éª¤ï¼Œç„¶åå‘åŒ…æ—¶å°±æŠ¥äº† 403 forBiden çš„é”™è¯¯ã€‚ã€‚ã€‚</p><h3 id="github-action"><a class="markdownIt-Anchor" href="#github-action"></a> GitHub Action</h3><p><a href="https://docs.github.com/cn/actions">GitHub Action</a> æ˜¯ GitHub æ¨å‡ºçš„å®ç° CI/CDï¼ˆæŒç»­é›†æˆã€æŒç»­äº¤ä»˜/éƒ¨ç½²ï¼‰çš„æ‰‹æ®µã€‚å¯ä»¥åˆ›å»ºå·¥ä½œæµç¨‹æ¥æ„å»ºå’Œæµ‹è¯•å­˜å‚¨åº“çš„æ¯ä¸ªæ‹‰å–è¯·æ±‚ï¼Œæˆ–å°†åˆå¹¶çš„æ‹‰å–è¯·æ±‚éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒï¼Œç”± GitHub æä¾›è™šæ‹Ÿæœºæ¥è¿è¡Œä½ åœ¨ workflow æ–‡ä»¶ä¸­å†™å¥½çš„æ‰§è¡Œæµç¨‹ã€‚</p><p>GitHub Action å¯ä»¥é’ˆå¯¹ä¸åŒçš„æ—¶é—´è®¾ç½®ä¸åŒçš„å¤„ç†æµç¨‹ï¼Œè¿™æ¬¡æˆ‘è¦å®ç°çš„ç›®æ ‡æ˜¯åœ¨ release ä¸€ä¸ªæ–°ç‰ˆæœ¬æ—¶è‡ªåŠ¨æ‰“åŒ…å‘å¸ƒï¼Œæ‰€ä»¥ç›‘å¬çš„æ˜¯ released äº‹ä»¶ï¼Œå¤„ç†æµç¨‹å¤ç”¨äº† samuelmeuli/action-maven-publishã€‚äº‹å®ä¸Š GitHub Action èƒ½åšçš„äº‹æƒ…è¿œä¸æ­¢å¦‚æ­¤ï¼Œæ¯”å¦‚è¿˜å¯ä»¥åœ¨æ–° pr æäº¤çš„æ—¶å€™è‡ªåŠ¨è·‘ä¸€éæµ‹è¯•ç”¨ä¾‹ä»¥åŠåšä¸€äº›å®šæ—¶ä»»åŠ¡ä¹‹ç±»çš„â€¦</p><p>é¦–å…ˆåœ¨ä»“åº“çš„ Actions ä¸­ new workflowï¼Œå·¥ä½œæµçš„ yml æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># ç›¸å½“äºè„šæœ¬ç”¨é€”çš„ä¸€ä¸ªå£°æ˜</span><br><span class="hljs-attr">name:</span> <span class="hljs-string">Maven</span> <span class="hljs-string">Central</span> <span class="hljs-string">Repo</span> <span class="hljs-string">Deployment</span><br><span class="hljs-comment"># è§¦å‘è„šæœ¬çš„äº‹ä»¶  è¿™é‡Œä¸ºå‘å¸ƒreleaseä¹‹åè§¦å‘</span><br><span class="hljs-attr">on:</span><br>  <span class="hljs-attr">release:</span><br>    <span class="hljs-attr">types:</span> [<span class="hljs-string">released</span>]<br><span class="hljs-comment"># å®šä¹‰ä¸€ä¸ªå‘è¡Œä»»åŠ¡</span><br><span class="hljs-attr">jobs:</span><br>  <span class="hljs-attr">release:</span><br>    <span class="hljs-comment"># è¿è¡Œå¤„ç†æµç¨‹çš„ OS ç¯å¢ƒ</span><br>    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-18.04</span><br>    <span class="hljs-attr">steps:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Check</span> <span class="hljs-string">out</span> <span class="hljs-string">Git</span> <span class="hljs-string">repository</span><br>        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v2</span><br><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">Java</span> <span class="hljs-string">and</span> <span class="hljs-string">Maven</span><br>        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-java@v1</span><br>        <span class="hljs-attr">with:</span><br>          <span class="hljs-attr">java-version:</span> <span class="hljs-number">8</span><br><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Release</span> <span class="hljs-string">Maven</span> <span class="hljs-string">package</span><br>        <span class="hljs-attr">uses:</span> <span class="hljs-string">samuelmeuli/action-maven-publish@v1</span><br>        <span class="hljs-attr">with:</span><br>            <span class="hljs-comment"># ä¸€ç³»åˆ—éœ€è¦çš„å¯†ç </span><br>            <span class="hljs-attr">gpg_private_key:</span> <span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">secrets.GPG_SECRET</span> <span class="hljs-string">&#125;&#125;</span>    <span class="hljs-comment"># GPG å¯¼å‡ºçš„é‚£æ®µé•¿é•¿çš„å¯†é’¥</span><br>            <span class="hljs-attr">gpg_passphrase:</span> <span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">secrets.GPG_PASSWORD</span> <span class="hljs-string">&#125;&#125;</span>   <span class="hljs-comment"># è‡ªå·±è®¾ç½®çš„ GPG å¯†ç </span><br>            <span class="hljs-attr">nexus_username:</span> <span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">secrets.OSSRH_USER</span> <span class="hljs-string">&#125;&#125;</span>     <span class="hljs-comment"># sonatype ç”¨æˆ·åï¼ˆä¸æ˜¯é‚®ç®±ï¼‰</span><br>            <span class="hljs-attr">nexus_password:</span> <span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">secrets.OSSRH_PASSWORD</span> <span class="hljs-string">&#125;&#125;</span> <span class="hljs-comment"># sonatype ç™»å½•å¯†ç </span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢æåˆ°çš„ä¸€ç³»åˆ—å¯†ç ä¿å­˜åœ¨ repo çš„ <code>Settings</code>-&gt;<code>Secrets</code>-&gt;<code>Actios</code>-&gt;<code>Repository secrets</code> ä¸‹</p><h3 id="pomxml-é…ç½®"><a class="markdownIt-Anchor" href="#pomxml-é…ç½®"></a> pom.xml é…ç½®</h3><p>å…·ä½“å¯ä»¥å‚è€ƒå¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>jar<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.github.young-flash<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>flash-GAT<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.source</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.source</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.target</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.target</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- é¡¹ç›®ä¿¡æ¯ --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>Github-Action-Test-By-Flash<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>Github-Action-Test-By-Flash<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>https://github.com/Young-Flash/GitHub-Action-Test<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!--  é¡¹ç›®åœ°å€ä¿¡æ¯   --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scm</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">connection</span>&gt;</span>scm:git:https://github.com/Young-Flash/GitHub-Action-Test<span class="hljs-tag">&lt;/<span class="hljs-name">connection</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>https://github.com/Young-Flash/GitHub-Action-Test.git<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">developerConnection</span>&gt;</span>scm:git:https://github.com/Young-Flash/GitHub-Action-Test<span class="hljs-tag">&lt;/<span class="hljs-name">developerConnection</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">scm</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- licenses ä¿¡æ¯    --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">licenses</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">license</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>Apache License, Version 2.0<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>https://www.apache.org/licenses/LICENSE-2.0.txt<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">license</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">licenses</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!--  å¼€å‘è€…ä¿¡æ¯   --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">developers</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">developer</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>Flash<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">email</span>&gt;</span>871946895@qq.com<span class="hljs-tag">&lt;/<span class="hljs-name">email</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">developer</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">developers</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!--  å¦‚æœç”¨åˆ°äº† snapshot ç‰ˆæœ¬çš„ä¾èµ–åˆ™éœ€è¦åŠ ä¸Šä¸‹é¢è¿™ä¸ªå£°æ˜    --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">repositories</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">repository</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>snapshots<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>https://oss.sonatype.org/content/repositories/snapshots/<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">repository</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">repositories</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--  ä½ çš„ä¾èµ–   --&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">profiles</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">profile</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>deploy<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>                    <span class="hljs-comment">&lt;!-- Javadoc plugin --&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-javadoc-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.2.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">doclint</span>&gt;</span>none<span class="hljs-tag">&lt;/<span class="hljs-name">doclint</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>attach-javadocs<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>jar<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span><br>                                <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br><br>                    <span class="hljs-comment">&lt;!-- Source plugin --&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-source-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.2.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>attach-sources<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>jar-no-fork<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span><br>                                <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br><br>                    <span class="hljs-comment">&lt;!-- GPG plugin --&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-gpg-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.6<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>sign-artifacts<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>verify<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>sign<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span><br>                                <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>                                    <span class="hljs-comment">&lt;!-- Prevent `gpg` from using pinentry programs --&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">gpgArguments</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">arg</span>&gt;</span>--pinentry-mode<span class="hljs-tag">&lt;/<span class="hljs-name">arg</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">arg</span>&gt;</span>loopback<span class="hljs-tag">&lt;/<span class="hljs-name">arg</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;/<span class="hljs-name">gpgArguments</span>&gt;</span><br>                                <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">profile</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">profiles</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">distributionManagement</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- Central Repository --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">snapshotRepository</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>ossrh<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>https://oss.sonatype.org/content/repositories/snapshots<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">snapshotRepository</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">repository</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>ossrh<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>Nexus Release Repository<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>https://oss.sonatype.org/service/local/staging/deploy/maven2/<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">repository</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">distributionManagement</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- Nexus Staging Plugin --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.sonatype.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>nexus-staging-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.6.8<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">extensions</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">extensions</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">serverId</span>&gt;</span>ossrh<span class="hljs-tag">&lt;/<span class="hljs-name">serverId</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">nexusUrl</span>&gt;</span>https://s01.oss.sonatype.org<span class="hljs-tag">&lt;/<span class="hljs-name">nexusUrl</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">autoReleaseAfterClose</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">autoReleaseAfterClose</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="å‘å¸ƒ"><a class="markdownIt-Anchor" href="#å‘å¸ƒ"></a> å‘å¸ƒ</h2><p>æ‰€æœ‰å‡†å¤‡å·¥ä½œå°±ç»ªåå°±å¯ä»¥å°è¯•å‘å¸ƒäº†ï¼Œrelease ä¸€ä¸ªæ–°ç‰ˆæœ¬ï¼Œæ­¤æ—¶ä¼šè‡ªåŠ¨è§¦å‘ä½ åœ¨ workflow çš„ yml æ–‡ä»¶ä¸­è®¾ç½®çš„æ‰§è¡Œæµç¨‹ï¼Œå…·ä½“åœ°è¿è¡Œæƒ…å†µå¯ä»¥åœ¨ Actions ä¸­çœ‹åˆ°ï¼Œå¯ä»¥ä¼šæŠ¥é”™ï¼Œè¿™ä¸ªå°±éœ€è¦çœ‹æŠ¥é”™ä¿¡æ¯è‡ªå·±å»æ‘¸ç´¢è§£å†³æ–¹æ³•äº†ã€‚</p><h2 id="è¸©å‘"><a class="markdownIt-Anchor" href="#è¸©å‘"></a> è¸©å‘</h2><h3 id="nexus-staging-maven-plugin168deploy-failed-403-forbidden"><a class="markdownIt-Anchor" href="#nexus-staging-maven-plugin168deploy-failed-403-forbidden"></a> â€œnexus-staging-maven-plugin:1.6.8:deploy failed: 403 - Forbiddenâ€</h3><p>æŒ‰ç…§å…¶ä»–æ•™ç¨‹çš„æ­¥éª¤æ¥ï¼Œä¸€åˆ‡é…ç½®å°±ç»ªåå‘å¸ƒæ—¶é‡åˆ°è¿™ä¸ªé”™è¯¯ï¼ŒæŸ¥äº†å¾ˆä¹…éƒ½æ²¡æ‰¾åˆ°è§£å†³æ–¹æ³•ã€‚åæ¥åœ¨è¿™ç¯‡<a href="https://blog.csdn.net/qq_36838191/article/details/81027586">åšå®¢</a>ä¸­çœ‹åˆ°è¿˜æœ‰ä¸€ä¸ªæ³¨å†Œå·¥å•çš„æ­¥éª¤ï¼Œå®Œæˆå·¥å•åå†å‘å¸ƒå°±æ²¡é—®é¢˜äº†ã€‚è¿‡ç¨‹ä¸­ä¼šæœ‰ç¤¾åŒºæœºå™¨äººéªŒè¯ä½ åˆ›å»ºçš„å·¥å•çš„åˆæ³•æ€§ï¼Œæ¯”å¦‚éœ€è¦éªŒè¯ä½ å¯¹è¯¥ github è´¦å·çš„æ‰€æœ‰æƒï¼ˆè®©ä½ å»ºä¸€ä¸ªæŒ‡å®šåå­—çš„ä¸´æ—¶ä»“åº“ï¼‰å’Œ groupId å¯¹åº”çš„åŸŸåçš„æ‰€æœ‰æƒã€‚</p><h3 id="the-pom-for-is-missing-no-dependency-information-available"><a class="markdownIt-Anchor" href="#the-pom-for-is-missing-no-dependency-information-available"></a> â€œThe POM for â€¦ is missing, no dependency information availableâ€</h3><p>åœ¨ä¸ºé¡¹ç›®å¼•å…¥ä¾èµ–åå‘å¸ƒæ—¶é‡åˆ°è¿™ä¸ªé”™è¯¯ï¼ŒåŸå› æ˜¯æˆ‘å¼•å…¥çš„é‚£ä¸ªä¾èµ–æ˜¯ SNAPSHOT ç‰ˆæœ¬ï¼Œéœ€è¦åœ¨ pom.xml ä¸­åŠ ä¸Š &lt;repository&gt; å£°æ˜</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">repositories</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">repository</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>snapshots<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>https://oss.sonatype.org/content/repositories/snapshots/<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">repository</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">repositories</span>&gt;</span><br></code></pre></td></tr></table></figure><p>åŒ…å‘å¸ƒæˆåŠŸåéœ€è¦ä¸€æ®µæ—¶é—´æ‰ä¼šåŒæ­¥åˆ°ä¸­å¤®ä»“åº“ï¼Œå‘å¸ƒåæˆåŠŸåè¿‡å°åŠå¤©åå¯ä»¥å…ˆåœ¨ <a href="https://search.maven.org/">sonatype</a> ä¸ŠæŸ¥çœ‹</p><h2 id="å‚è€ƒ"><a class="markdownIt-Anchor" href="#å‚è€ƒ"></a> å‚è€ƒ</h2><ul><li><a href="https://stackoverflow.com/questions/45730541/the-pom-for-is-missing-no-dependency-information-available-even-though-it">The POM for â€¦ is missing, no dependency information available</a></li><li><a href="https://segmentfault.com/a/1190000039716048">ä½¿ç”¨CI/CDå·¥å…·Github Actionå‘å¸ƒjaråˆ°Mavenä¸­å¤®ä»“åº“</a></li><li><a href="https://juejin.cn/post/6892965219791093773#heading-3">é€šè¿‡GitHub Actionè‡ªåŠ¨éƒ¨ç½²Mavené¡¹ç›®</a></li><li><a href="https://blogtech.top/2019/12/30/%E5%8F%91%E5%B8%83%E8%87%AA%E5%B7%B1%E7%9A%84%E9%A1%B9%E7%9B%AEJAR%E5%88%B0MAVEN%E4%B8%AD%E5%A4%AE%E4%BB%93%E5%BA%93/">å‘å¸ƒè‡ªå·±çš„é¡¹ç›® JAR åˆ° MAVEN ä¸­å¤®ä»“åº“</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CI/CD</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å³å€¼å¼•ç”¨ã€ç§»åŠ¨è¯­ä¹‰ã€å®Œç¾è½¬å‘</title>
    <link href="/2022/03/07/%E5%8F%B3%E5%80%BC%E5%BC%95%E7%94%A8%E3%80%81%E7%A7%BB%E5%8A%A8%E8%AF%AD%E4%B9%89%E3%80%81%E5%AE%8C%E7%BE%8E%E8%BD%AC%E5%8F%91/"/>
    <url>/2022/03/07/%E5%8F%B3%E5%80%BC%E5%BC%95%E7%94%A8%E3%80%81%E7%A7%BB%E5%8A%A8%E8%AF%AD%E4%B9%89%E3%80%81%E5%AE%8C%E7%BE%8E%E8%BD%AC%E5%8F%91/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h2><p>å³å€¼å¼•ç”¨ã€ç§»åŠ¨è¯­ä¹‰ã€å®Œç¾è½¬å‘æ˜¯ C++ 11 å¼•å…¥çš„ä¸€å¤§æ–°ç‰¹æ€§ã€‚å³ä½¿åœ¨ä»£ç ä¸­æ²¡æœ‰æ˜¾ç¤ºåœ°ä½¿ç”¨åˆ°ä»–ä»¬æˆ‘ä»¬ä¹Ÿèƒ½å¾—åˆ°æ€§èƒ½ä¸Šçš„æå‡ï¼ŒSTL ä¸­å®¹å™¨ç±»å°±å¤§é‡ä½¿ç”¨äº†è¿™äº›æ–°ç‰¹æ€§ï¼Œåœ¨ä½¿ç”¨è¿™äº›å®¹å™¨æ—¶æˆ‘ä»¬â€éšå¼â€œåœ°ä»ä¸­å—ç›Šã€‚æ¯”å¦‚ vector ç±»åœ¨æ‰©å®¹æ—¶éœ€è¦æŠŠåŸæ¥çš„å¯¹è±¡æŒªåˆ°æ–°å¼€è¾Ÿçš„ç©ºé—´ä¸­ï¼Œè‹¥æ•°æ®ç±»å‹é‡å†™äº†ç§»åŠ¨æ„é€ å‡½æ•°å¹¶ä¸”æ ‡è®°ä¸º <a href="https://flash-flash.gitee.io/2021/12/18/%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%B0%86%E7%A7%BB%E5%8A%A8%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E5%92%8C%E7%A7%BB%E5%8A%A8%E8%B5%8B%E5%80%BC%E8%BF%90%E7%AE%97%E7%AC%A6%E6%A0%87%E8%AE%B0%E4%B8%BA%20noexcept/">noexcept</a> å°±å¯ä»¥å°†æ—§å¯¹è±¡ç§»åŠ¨è¿‡å»è€Œä¸æ˜¯ä½¿ç”¨æ‹·è´æ„é€ çš„å½¢å¼ï¼Œå°±å¦‚ C++ Primer Plus ä¸­æ‰€è¯´ï¼šâ€œå¯¹å¤§å¤šæ•°ç¨‹åºå‘˜æ¥è¯´ï¼Œå³å€¼å¼•ç”¨å¸¦æ¥çš„ä¸»è¦å¥½å¤„å¹¶éæ˜¯è®©ä»–ä»¬èƒ½å¤Ÿç¼–å†™ä½¿ç”¨å³å€¼å¼•ç”¨çš„ä»£ç ï¼Œè€Œæ˜¯èƒ½å¤Ÿä½¿ç”¨åˆ©ç”¨å³å€¼å¼•ç”¨å®ç°ç§»åŠ¨è¯­ä¹‰çš„åº“ä»£ç â€ã€‚</p><h2 id="å³å€¼å¼•ç”¨ä¸ç§»åŠ¨è¯­ä¹‰"><a class="markdownIt-Anchor" href="#å³å€¼å¼•ç”¨ä¸ç§»åŠ¨è¯­ä¹‰"></a> å³å€¼å¼•ç”¨ä¸ç§»åŠ¨è¯­ä¹‰</h2><p><strong>å…ˆè¯´å…³ç³»ï¼Œå³å€¼å¼•ç”¨çš„æå‡ºæ˜¯ä¸ºäº†å®ç°ç§»åŠ¨è¯­ä¹‰ï¼Œå³ç§»åŠ¨è¯­ä¹‰æ˜¯ç›®çš„ï¼Œå³å€¼å¼•ç”¨æ˜¯æ‰‹æ®µã€‚</strong></p><ul><li>å¯¹äºå·¦å€¼ä¸å³å€¼ä¸€ç§ç®€å•çš„ç†è§£æ˜¯å·¦å€¼æ˜¯å¯ä»¥å–åœ°å€çš„è€Œå³å€¼ä¸å¯ä»¥ï¼Œå³å€¼å¼•ç”¨æ˜¯ C++ 11 ä¸­å¼•å…¥çš„æ–°ç±»å‹ï¼Œç”¨äºæ ‡è¯†å­—é¢å¸¸é‡ï¼ˆ1ï¼Œâ€œstringâ€ï¼‰ã€è¡¨è¾¾å¼ï¼ˆx+yï¼‰å’Œå‡½æ•°çš„æŒ‰å€¼è¿”å›ã€‚</li><li><strong>ç§»åŠ¨è¯­ä¹‰å®ç°äº†å°†ä¸€ä¸ªå³å€¼å¯¹è±¡çš„èµ„æºè½¬ç§»åˆ°å½“å‰å¯¹è±¡ï¼Œé¿å…äº†æ‹·è´æ„é€ çš„å¼€é”€</strong>ï¼›åœ¨åºåˆ—å®¹å™¨ç±»çš„æ‰©å®¹ä»¥åŠä¸¤ä¸ªå¯¹è±¡çš„ swap ç­‰æƒ…å†µæå¤§æé«˜äº†æ•ˆç‡ã€‚</li><li>ç§»åŠ¨è¯­ä¹‰ä¸»è¦ä½“ç°åœ¨ä¸ºæŸç±»é‡å†™çš„ç§»åŠ¨æ„é€ å‡½æ•°ä¸­ï¼Œåœ¨å®ç°ä¸­ä¸€èˆ¬æ˜¯è¿›è¡ŒæŒ‡é’ˆå€¼çš„æ‹·è´ç„¶åç½®ç©ºå³å€¼å¯¹è±¡ä¸­å¯¹åº”çš„æŒ‡é’ˆã€‚è¿›è¡ŒæŒ‡é’ˆå€¼çš„æ‹·è´ä¹Ÿå³æµ…æ‹·è´ï¼Œä»è¿™ç‚¹ä¸Šçœ‹ç§»åŠ¨è¯­ä¹‰ä¸æµ…æ‹·è´æœ‰ç‚¹ç›¸ä¼¼ï¼Œä½†å®é™…ä¸ŠäºŒè€…æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µï¼šæµ…æ‹·è´æ˜¯å…±äº«èµ„æºï¼Œè€Œ move æ˜¯ç‹¬å èµ„æºï¼ˆ<strong>çªƒå–åç½®ç©ºåŸæŒ‡é’ˆ</strong>ï¼‰ï¼Œæµ…æ‹·è´å› å…±äº«èµ„æºä»è€Œå¯èƒ½å¼•å‘é‡å¤ææ„çš„é—®é¢˜ï¼Œè€Œ move æ˜¯ç‹¬å åˆ™ä¸ä¼šã€‚</li></ul><h2 id="ä¸‡èƒ½å¼•ç”¨"><a class="markdownIt-Anchor" href="#ä¸‡èƒ½å¼•ç”¨"></a> ä¸‡èƒ½å¼•ç”¨</h2><p>whatï¼šå³å¯ä»¥æ¥å—å·¦å€¼å¼•ç”¨ä¹Ÿå¯ä»¥æ¥å—å³å€¼å¼•ç”¨çš„å‚æ•°ç±»å‹ï¼Œå†™ä½œ <strong>T&amp;&amp;ï¼Œæ³¨æ„åªæœ‰å½“å‘ç”Ÿè‡ªåŠ¨ç±»å‹æ¨æ–­ï¼ˆå¦‚å‡½æ•°æ¨¡æ¿çš„ç±»å‹è‡ªåŠ¨æ¨å¯¼ï¼Œæˆ– auto å…³é”®å­—ï¼‰æ—¶ T&amp;&amp; æ‰è¡¨ç¤ºä¸‡èƒ½å¼•ç”¨ï¼Œå¦åˆ™åªè¡¨ç¤ºå³å€¼å¼•ç”¨</strong></p><p>howï¼šé€šè¿‡å¼•ç”¨æŠ˜å å®ç°ï¼ˆåªæœ‰å³å€¼å¼•ç”¨çš„å³å€¼å¼•ç”¨ä¼šæŠ˜å æˆå³å€¼å¼•ç”¨ï¼Œå…¶ä½™æƒ…å†µéƒ½æ˜¯æŠ˜å æˆå·¦å€¼å¼•ç”¨ï¼‰ï¼š</p><ul><li>T&amp; &amp; -&gt; T&amp;</li><li>T&amp; &amp;&amp; -&gt; T&amp;</li><li>T&amp;&amp; &amp; -&gt; T&amp;</li><li>T&amp;&amp; &amp;&amp; -&gt; T&amp;&amp;</li></ul><p>å…³äºä¸‡èƒ½å¼•ç”¨åœ¨æˆ‘<a href="https://flash-flash.gitee.io/2021/12/31/C++%2011%20%E4%B8%87%E8%83%BD%E5%BC%95%E7%94%A8/">å¦ä¸€ç¯‡åšå®¢</a>ä¸­æœ‰æåˆ°ã€‚</p><h2 id="å®Œç¾è½¬å‘perfect-forwarding"><a class="markdownIt-Anchor" href="#å®Œç¾è½¬å‘perfect-forwarding"></a> å®Œç¾è½¬å‘ï¼ˆperfect forwardingï¼‰</h2><p>ä¸ºä»€ä¹ˆéœ€è¦å®Œç¾è½¬å‘çš„åŸå› ï¼šå³å€¼å¼•ç”¨æœ¬èº«æ˜¯ä¸€ä¸ªå·¦å€¼ï¼Œå¦‚å°†ä¸€ä¸ªå³å€¼å¼•ç”¨å‚æ•°ä¼ é€’ç»™æŸå‡½æ•° f1ï¼Œè€Œåœ¨è¯¥å‡½æ•°ä¸­åˆå°†è¯¥å‚æ•°ä¼ ç»™å¦ä¸€ä¸ªå‡½æ•° f2ï¼Œf2 ä¼šåœ¨è¿›è¡Œå®å‚å½¢å‚çš„åŒ¹é…æ—¶ä¼šå°†è¯¥å‚æ•°è§†ä¸ºå·¦å€¼ï¼Œè€Œæˆ‘ä»¬å¸Œæœ›æ— è®ºå¦‚ä½•è½¬å‘è¯¥å‚æ•°éƒ½èƒ½ä¿æŒå…¶ä¸ºå³å€¼å¯¹è±¡è¿™ä¸€ç‰¹ç‚¹ï¼Œå› æ­¤éœ€è¦å®Œç¾è½¬å‘ï¼šé€šè¿‡ä¸€ä¸ªå‡½æ•°å°†å‚æ•°ç»§ç»­è½¬äº¤ç»™å¦ä¸€ä¸ªå‡½æ•°è¿›è¡Œå¤„ç†ï¼ŒåŸå‚æ•°å¯èƒ½æ˜¯å³å€¼ï¼Œå¯èƒ½æ˜¯å·¦å€¼ï¼Œå¦‚æœè¿˜èƒ½ç»§ç»­ä¿æŒå‚æ•°çš„åŸæœ‰ç‰¹å¾ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯å®Œç¾çš„ã€‚å®ç°ä¸Šè¦å€ŸåŠ©â€™ä¸‡èƒ½å¼•ç”¨â€™å’Œ <code>std::forward</code>ã€‚</p><p>åˆ†æå®ç°ä»£ç ä¹‹å‰å…ˆçœ‹çœ‹ std::remove_reference</p><h3 id="stdremove_reference"><a class="markdownIt-Anchor" href="#stdremove_reference"></a> std::remove_reference</h3><p>std::forward çš„å®ç°ä¸­ç”¨åˆ°äº† std::remove_referenceã€‚std::remove_reference æ˜¯ type_traitsï¼ˆç±»å‹èƒå–ï¼‰ä¹‹ä¸€ï¼Œç”±ç±»æ¨¡æ¿å®ç°ã€‚</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sqf"><span class="hljs-comment">// 1</span><br>template&lt;<span class="hljs-built_in">typename</span> <span class="hljs-variable">_Tp</span>&gt;<br>    struct remove_reference<br>    &#123; typedef <span class="hljs-variable">_Tp</span>   <span class="hljs-built_in">type</span>; &#125;;<br><br><span class="hljs-comment">// 2</span><br>template&lt;<span class="hljs-built_in">typename</span> <span class="hljs-variable">_Tp</span>&gt;<br>    struct remove_reference&lt;<span class="hljs-variable">_Tp</span>&amp;&gt;<br>    &#123; typedef <span class="hljs-variable">_Tp</span>   <span class="hljs-built_in">type</span>; &#125;;<br><br><span class="hljs-comment">// 3</span><br>template&lt;<span class="hljs-built_in">typename</span> <span class="hljs-variable">_Tp</span>&gt;<br>    struct remove_reference&lt;<span class="hljs-variable">_Tp</span>&amp;&amp;&gt;<br>    &#123; typedef <span class="hljs-variable">_Tp</span>   <span class="hljs-built_in">type</span>; &#125;;<br></code></pre></td></tr></table></figure><p>1 æ¥å—åŸå§‹ç±»å‹ï¼Œ2 ã€3 ä½œä¸º 1 çš„ç‰¹åŒ–æ¥å— lvalue-refã€ rvalue-refã€‚å½“ remove_reference æ¨¡æ¿å®ä¾‹åŒ–åè¯¥æ¨¡æ¿ä¸­å®šä¹‰çš„ç±»å‹ <code>type</code> å°±å…·åŒ–ä¸ºæ¨¡æ¿å‚æ•°çš„åŸå§‹ç±»å‹</p><h3 id="stdforward-ä»£ç è§£æ"><a class="markdownIt-Anchor" href="#stdforward-ä»£ç è§£æ"></a> std::forward ä»£ç è§£æ</h3><p>std::forward æ˜¯ä¸€ä¸ªå‡½æ•°æ¨¡æ¿ï¼Œé’ˆå¯¹è½¬å‘å·¦å€¼å’Œè½¬å‘å³å€¼æœ‰ä¸åŒçš„é‡è½½ã€‚</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sqf"><span class="hljs-comment">// è½¬å‘å·¦å€¼</span><br>template&lt;<span class="hljs-built_in">typename</span> <span class="hljs-variable">_Tp</span>&gt;<br>    constexpr <span class="hljs-variable">_Tp</span>&amp;&amp;<br>    forward(<span class="hljs-built_in">typename</span> std::remove_reference&lt;<span class="hljs-variable">_Tp</span>&gt;::<span class="hljs-built_in">type</span>&amp; <span class="hljs-variable">__t</span>) noexcept<br>    &#123; return static_cast&lt;<span class="hljs-variable">_Tp</span>&amp;&amp;&gt;(<span class="hljs-variable">__t</span>); &#125;<br><br><span class="hljs-comment">// è½¬å‘å³å€¼</span><br>template&lt;<span class="hljs-built_in">typename</span> <span class="hljs-variable">_Tp</span>&gt;<br>    constexpr <span class="hljs-variable">_Tp</span>&amp;&amp;<br>    forward(<span class="hljs-built_in">typename</span> std::remove_reference&lt;<span class="hljs-variable">_Tp</span>&gt;::<span class="hljs-built_in">type</span>&amp;&amp; <span class="hljs-variable">__t</span>) noexcept<br>    &#123;<br>      static_assert(!std::is_lvalue_reference&lt;<span class="hljs-variable">_Tp</span>&gt;::value, <span class="hljs-string">&quot;template argument substituting _Tp is an lvalue reference type&quot;</span>);<br>      return static_cast&lt;<span class="hljs-variable">_Tp</span>&amp;&amp;&gt;(<span class="hljs-variable">__t</span>);<br>    &#125;<br></code></pre></td></tr></table></figure><ul><li>è¿”å›å€¼ç±»å‹ï¼šéƒ½æ˜¯ constexpr _Tp&amp;&amp;ï¼Œå¸¸é‡è¡¨è¾¾å¼å¯åœ¨ç¼–è¯‘æœŸç¡®å®šï¼Œ_Tp&amp;&amp; æ˜¯ä¸€ä¸ªä¸‡èƒ½å¼•ç”¨ã€‚</li><li>æ¥æ”¶å‚æ•°ï¼šç”¨ remove_reference å¾—åˆ°å‚æ•°çš„åŸå§‹ç±»å‹ï¼›è½¬å‘å·¦å€¼ç‰ˆæœ¬ç»™å‚æ•°åŠ ä¸Šå·¦å€¼å¼•ç”¨ï¼Œè½¬å‘å³å€¼ç‰ˆæœ¬ç»™å‚æ•°åŠ ä¸Šå³å€¼å¼•ç”¨ã€‚</li><li>å†…éƒ¨å®ç°ï¼šä¸¤ä¸ªé‡è½½çš„å®ç°ä¸ŠåŸºæœ¬ä¸€è‡´ï¼Œéƒ½åˆ©ç”¨ static_cast å°†å‚æ•°è½¬åŒ–ä¸ºå·¦å€¼å¼•ç”¨æˆ–è€…å³å€¼å¼•ç”¨ï¼Œè¿”å›è¯­å¥éƒ½æ˜¯ <code>return static_cast&lt;_Tp&amp;&amp;&gt;(__t);</code>ï¼Œè¿™é‡Œç”¨åˆ°äº†å¼•ç”¨æŠ˜å çš„æ€§è´¨ã€‚ç•¥æœ‰ä¸åŒçš„æ˜¯è½¬å‘å³å€¼çš„é‡è½½ä¸­å¤šäº†ä¸€ä¸ª static_assert åœ¨ç¼–è¯‘æ—¶é¿å…å°†å³å€¼å¼•ç”¨ forward ä¸ºå·¦å€¼å¼•ç”¨ã€‚åˆšå¼€å§‹çœ‹åˆ°è½¬å‘å³å€¼çš„ç‰ˆæœ¬ä¸­æœ‰ static_assert è€Œè½¬å‘å·¦å€¼çš„ç‰ˆæœ¬ä¸­æ²¡æœ‰æ—¶è¿˜ä¸å¤ªç†è§£ï¼Œåæ¥åœ¨ Stack Overflow ä¸Šæ‰¾åˆ°äº†ä¸€ä¸ªç±»ä¼¼çš„<a href="https://stackoverflow.com/questions/10335916/c11-why-is-static-assert-in-stdforward-necessary">æé—®</a>ï¼Œè½¬å‘å³å€¼çš„ç‰ˆæœ¬ä¸­çš„ static_assert æ˜¯ä¸ºäº†é¿å…ç±»ä¼¼ forward&lt;string&amp;&gt;(string())ï¼‰çš„æƒ…å†µã€‚å³ä¸å…è®¸å°†ä¸€ä¸ªâ€œçº¯å³å€¼â€è½¬å‘ä¸ºå·¦å€¼ï¼›ä½†æ˜¯å…è®¸å°†å·¦å€¼è½¬å‘ä¸ºå³å€¼ï¼Œå®é™…ä¸Šè¿™æ­£æ˜¯ â€˜std::move()â€™ åšçš„äº‹æƒ…ã€‚è¿™å…¶å®æ˜¯è®¾è®¡ç†å¿µæ–¹é¢çš„é—®é¢˜ï¼Œå…·ä½“å‚è§<a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2009/n2951.html">è¿™é‡Œ</a>ã€‚</li></ul><h2 id="å‚è€ƒ"><a class="markdownIt-Anchor" href="#å‚è€ƒ"></a> å‚è€ƒ</h2><ul><li><a href="https://segmentfault.com/a/1190000016041544">æˆ‘ç†è§£çš„å³å€¼å¼•ç”¨ã€ç§»åŠ¨è¯­ä¹‰å’Œå®Œç¾è½¬å‘</a></li><li><a href="https://stackoverflow.com/questions/10335916/c11-why-is-static-assert-in-stdforward-necessary">c++11: why is static_assert in std::forward necessary?</a></li><li><a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2009/n2951.html">forward</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å‡½æ•°è°ƒç”¨çš„è¯¦ç»†è¿‡ç¨‹</title>
    <link href="/2022/01/21/%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E7%9A%84%E8%AF%A6%E7%BB%86%E8%BF%87%E7%A8%8B/"/>
    <url>/2022/01/21/%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E7%9A%84%E8%AF%A6%E7%BB%86%E8%BF%87%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h2><p>æœ¬æ–‡æ¢è®¨å‡½æ•°è°ƒç”¨æ—¶å¯„å­˜å™¨çš„è¡Œä¸ºåŠæ ˆå¸§çš„å˜åŒ–ï¼Œé¦–å…ˆè¯´æ˜ x86 æ¶æ„ä¸‹é€šç”¨å¯„å­˜å™¨çš„ç”¨é€”ï¼Œè°ƒç”¨è€…ä¿å­˜ã€è¢«è°ƒç”¨è€…ä¿å­˜ä»¥åŠæ ˆå¸§çš„æ¦‚å¿µï¼Œç„¶åæ¦‚æ‹¬å‘ç”Ÿå‡½æ•°è°ƒç”¨æ—¶çš„ä¸€èˆ¬è¿‡ç¨‹ã€‚</p><h2 id="x86-æ¶æ„ä¸‹é€šç”¨å¯„å­˜å™¨çš„ç”¨é€”"><a class="markdownIt-Anchor" href="#x86-æ¶æ„ä¸‹é€šç”¨å¯„å­˜å™¨çš„ç”¨é€”"></a> x86 æ¶æ„ä¸‹é€šç”¨å¯„å­˜å™¨çš„ç”¨é€”</h2><blockquote><p>è¯·è‡ªè¡ŒåŒºåˆ†æ“ä½œç³»ç»Ÿä½æ•°å’Œcpuæ¶æ„ä½æ•°çš„åŒºåˆ«ã€‚x64ï¼ˆx86-64ï¼‰ï¼Œx86æ˜¯CPUæ¶æ„ã€‚å¦‚æœä½ æ˜¯x64çš„CPUè£…äº†32ä½ç³»ç»Ÿï¼Œé‚£ä¹ˆä¹Ÿä¸ä¼šä½¿ç”¨åˆ°x64çš„å¯„å­˜å™¨ï¼ˆæ¯”å¦‚r8dï¼‰ï¼Œæˆ–è€…ä¸èƒ½å®Œæ•´ä½¿ç”¨x64CPUçš„å¯„å­˜å™¨ï¼Œæ¯”å¦‚raxã€‚ä½ åªèƒ½ä½¿ç”¨è¯¥å¯„å­˜å™¨çš„ä¸€åŠï¼šeax</p></blockquote><p><img src="/img/blog_pic/2022/x86%E6%9E%B6%E6%9E%84%E4%B8%8B%E9%80%9A%E7%94%A8%E5%AF%84%E5%AD%98%E5%99%A8%E7%9A%84%E7%94%A8%E9%80%94.png" alt="x86 æ¶æ„ä¸‹é€šç”¨å¯„å­˜å™¨çš„ç”¨é€”" /></p><ul><li><strong>%rax é€šå¸¸ç”¨äºå­˜å‚¨å‡½æ•°è°ƒç”¨çš„è¿”å›ç»“æœ</strong>ï¼ŒåŒæ—¶ä¹Ÿç”¨äºä¹˜æ³•å’Œé™¤æ³•æŒ‡ä»¤ä¸­ã€‚åœ¨ imul æŒ‡ä»¤ä¸­ï¼Œä¸¤ä¸ª64ä½çš„ä¹˜æ³•æœ€å¤šä¼šäº§ç”Ÿ128ä½çš„ç»“æœï¼Œéœ€è¦ %rax ä¸ %rdx å…±åŒå­˜å‚¨ä¹˜æ³•ç»“æœï¼Œåœ¨div æŒ‡ä»¤ä¸­è¢«é™¤æ•°æ˜¯128 ä½çš„ï¼ŒåŒæ ·éœ€è¦%rax ä¸ %rdx å…±åŒå­˜å‚¨è¢«é™¤æ•°ã€‚</li><li><strong>%rsp æ˜¯å †æ ˆæŒ‡é’ˆå¯„å­˜å™¨ï¼Œé€šå¸¸ä¼šæŒ‡å‘æ ˆé¡¶ä½ç½®</strong>ï¼Œå †æ ˆçš„ pop å’Œpush æ“ä½œå°±æ˜¯é€šè¿‡æ”¹å˜ %rsp çš„å€¼å³ç§»åŠ¨å †æ ˆæŒ‡é’ˆçš„ä½ç½®æ¥å®ç°çš„ã€‚spæ‰€æŒ‡å‘çš„æ ˆé¡¶æ˜¯æ‰€èƒ½åˆ†é…çš„æ ˆç©ºé—´çš„æé™ï¼Œå¦‚æœæ ˆç©ºé—´ä¸å¤Ÿåˆ™éœ€è¦ç§»åŠ¨spæŒ‡é’ˆï¼Œåˆ†é…æ›´å¤šçš„æ ˆç©ºé—´ã€‚</li><li><strong>%rbp æ˜¯æ ˆå¸§æŒ‡é’ˆï¼Œç”¨äºæ ‡è¯†å½“å‰æ ˆå¸§çš„èµ·å§‹ä½ç½®</strong>ã€‚</li><li><strong>%rdi, %rsi, %rdx, %rcx,%r8, %r9 å…­ä¸ªå¯„å­˜å™¨ç”¨äºå­˜å‚¨å‡½æ•°è°ƒç”¨æ—¶çš„6ä¸ªå‚æ•°</strong>ï¼ˆå¦‚æœæœ‰6ä¸ªæˆ–6ä¸ªä»¥ä¸Šå‚æ•°çš„è¯ï¼‰ã€‚</li><li>è¢«æ ‡è¯†ä¸º â€œmiscellaneous registersâ€ çš„å¯„å­˜å™¨ï¼Œå±äºé€šç”¨æ€§æ›´ä¸ºå¹¿æ³›çš„å¯„å­˜å™¨ï¼Œç¼–è¯‘å™¨æˆ–æ±‡ç¼–ç¨‹åºå¯ä»¥æ ¹æ®éœ€è¦å­˜å‚¨ä»»ä½•æ•°æ®</li></ul><h2 id="è°ƒç”¨è€…ä¿å­˜-è¢«è°ƒç”¨è€…ä¿å­˜"><a class="markdownIt-Anchor" href="#è°ƒç”¨è€…ä¿å­˜-è¢«è°ƒç”¨è€…ä¿å­˜"></a> è°ƒç”¨è€…ä¿å­˜ã€è¢«è°ƒç”¨è€…ä¿å­˜</h2><ul><li>å½“äº§ç”Ÿå‡½æ•°è°ƒç”¨æ—¶ï¼Œå­å‡½æ•°å†…é€šå¸¸ä¹Ÿä¼šä½¿ç”¨åˆ°é€šç”¨å¯„å­˜å™¨ï¼Œé‚£ä¹ˆè¿™äº›å¯„å­˜å™¨ä¸­ä¹‹å‰ä¿å­˜çš„è°ƒç”¨è€…(çˆ¶å‡½æ•°ï¼‰çš„å€¼å°±ä¼šè¢«è¦†ç›–ã€‚ä¸ºäº†é¿å…æ•°æ®è¦†ç›–è€Œå¯¼è‡´ä»å­å‡½æ•°è¿”å›æ—¶å¯„å­˜å™¨ä¸­çš„æ•°æ®ä¸å¯æ¢å¤ï¼ŒCPU ä½“ç³»ç»“æ„ä¸­å°±è§„å®šäº†é€šç”¨å¯„å­˜å™¨çš„ä¿å­˜æ–¹å¼ã€‚</li><li>å¦‚æœä¸€ä¸ªå¯„å­˜å™¨è¢«æ ‡è¯†ä¸ºâ€Caller Saveâ€ï¼Œ é‚£ä¹ˆåœ¨è¿›è¡Œå­å‡½æ•°è°ƒç”¨å‰ï¼Œå°±éœ€è¦ç”±è°ƒç”¨è€…æå‰ä¿å­˜å¥½è¿™äº›å¯„å­˜å™¨çš„å€¼ï¼Œä¿å­˜æ–¹æ³•é€šå¸¸æ˜¯æŠŠå¯„å­˜å™¨çš„å€¼å‹å…¥å †æ ˆä¸­ï¼Œè°ƒç”¨è€…ä¿å­˜å®Œæˆåï¼Œåœ¨è¢«è°ƒç”¨è€…ï¼ˆå­å‡½æ•°ï¼‰ä¸­å°±å¯ä»¥éšæ„è¦†ç›–è¿™äº›å¯„å­˜å™¨çš„å€¼äº†ã€‚</li><li>å¦‚æœä¸€ä¸ªå¯„å­˜è¢«æ ‡è¯†ä¸ºâ€œCallee Saveâ€ï¼Œé‚£ä¹ˆåœ¨å‡½æ•°è°ƒç”¨æ—¶ï¼Œè°ƒç”¨è€…å°±ä¸å¿…ä¿å­˜è¿™äº›å¯„å­˜å™¨çš„å€¼è€Œç›´æ¥è¿›è¡Œå­å‡½æ•°è°ƒç”¨ï¼Œè¿›å…¥å­å‡½æ•°åï¼Œå­å‡½æ•°åœ¨è¦†ç›–è¿™äº›å¯„å­˜å™¨ä¹‹å‰ï¼Œéœ€è¦å…ˆä¿å­˜è¿™äº›å¯„å­˜å™¨çš„å€¼ï¼Œå³è¿™äº›å¯„å­˜å™¨çš„å€¼æ˜¯ç”±è¢«è°ƒç”¨è€…æ¥ä¿å­˜å’Œæ¢å¤çš„ã€‚</li></ul><h2 id="æ ˆå¸§"><a class="markdownIt-Anchor" href="#æ ˆå¸§"></a> æ ˆå¸§</h2><p>æ ˆå¸§ï¼Œstack frameï¼Œå…¶æœ¬è´¨å°±æ˜¯ä¸€æ®µå†…å­˜ç©ºé—´ï¼Œä¸“é—¨ç”¨äºä¿å­˜å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­çš„å„ç§ä¿¡æ¯ï¼ˆæœ¬åœ°å±€éƒ¨å˜é‡ï¼Œæ ˆå¸§çŠ¶æ€å€¼ï¼ˆå‰æ ˆå¸§çš„åº•éƒ¨ï¼‰ï¼Œè¿”å›åœ°å€ç­‰ï¼‰ã€‚ebp å’Œ esp ä¹‹é—´çš„å†…å­˜ç©ºé—´ä¸ºå½“å‰æ ˆå¸§ï¼Œebp æ ‡è¯†äº†å½“å‰æ ˆå¸§çš„åº•éƒ¨ï¼Œesp æ ‡è¯†äº†å½“å‰æ ˆå¸§çš„é¡¶éƒ¨</p><h2 id="å‡½æ•°è°ƒç”¨çš„ä¸€èˆ¬è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#å‡½æ•°è°ƒç”¨çš„ä¸€èˆ¬è¿‡ç¨‹"></a> å‡½æ•°è°ƒç”¨çš„ä¸€èˆ¬è¿‡ç¨‹</h2><ol><li><p><strong>å‚æ•°å…¥æ ˆï¼š</strong> å°†å‚æ•°ä»å³å‘å·¦ä¾æ¬¡å‹å…¥æ ˆä¸­ï¼ˆæˆ–è€…å°†å‚æ•°å­˜å…¥å¯„å­˜å™¨ä¸­ï¼‰ï¼›</p></li><li><p><strong>è¿”å›åœ°å€å…¥æ ˆï¼š</strong> å°†å½“å‰ä»£ç åŒºè°ƒç”¨æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€å‹å…¥æ ˆä¸­ï¼Œä¾›å‡½æ•°è¿”å›æ—¶ç»§ç»­æ‰§è¡Œï¼›</p></li><li><p><strong>ä»£ç åŒºè·³è½¬ï¼š</strong> å¤„ç†å™¨ä»å½“å‰ä»£ç åŒºè·³è½¬åˆ°è¢«è°ƒç”¨å‡½æ•°çš„å…¥å£å¤„ï¼›ï¼ˆç¬¬ 2 ã€3 æ­¥ç”± <code>call</code> æŒ‡ä»¤å®Œæˆï¼‰</p></li><li><p><strong>ä¿å­˜å½“å‰æ ˆå¸§åº•éƒ¨ï¼š</strong> å°†å½“å‰ ebp ï¼ˆcallee save registerï¼‰ çš„å€¼å…¥æ ˆï¼ˆä¿å­˜è°ƒç”¨è€…çš„æ ˆå¸§åº•éƒ¨ä½ç½®ï¼Œä¾¿äºå‡½æ•°è°ƒç”¨ç»“æŸåæ¢å¤åŸå‡½æ•°çš„æ ˆå¸§åº•éƒ¨ä½ç½® <code>push ebp</code>ï¼‰</p></li><li><p><strong>æ›´æ–°æ ˆå¸§åº•éƒ¨ï¼š</strong> å°† esp å€¼è£…å…¥ ebp <code>mov ebp esp</code> ï¼Œå³å¼€è¾Ÿæ–°æ ˆå¸§</p></li><li><p><strong>ç»™æ–°æ ˆå¸§åˆ†é…ç©ºé—´ï¼š</strong> ï¼ˆå‘ä½åœ°å€ï¼‰ç§»åŠ¨ esp</p></li><li><p><strong>æ‰§è¡Œè¢«è°ƒç”¨å‡½æ•°çš„ä»£ç ç„¶åä¿å­˜è¿”å›å€¼ï¼ˆåœ¨å¯„å­˜å™¨ eax ä¸­ï¼‰</strong></p></li><li><p><strong>æ¢å¤ä¸Šä¸€ä¸ªæ ˆå¸§ï¼ˆå¼¹å‡ºå½“å‰æ ˆå¸§ï¼‰ï¼š</strong></p><ul><li>å°† esp èµ‹å€¼ä¸ºå½“å‰ ebp (<code>movq ebp esp</code>)ï¼Œé™ä½æ ˆé¡¶ï¼Œå›æ”¶å½“å‰æ ˆå¸§çš„ç©ºé—´ï¼›</li><li>å°†å½“å‰æ ˆå¸§åº•éƒ¨ä¿å­˜çš„å‰æ ˆå¸§åº•éƒ¨ ebp å€¼å¼¹å…¥ ebp å¯„å­˜å™¨ (<code>pop ebp</code>)ï¼Œæ¢å¤å‡ºä¸Šä¸€ä¸ªæ ˆå¸§ï¼›(8.1ã€8.2 ç”± <code>leave </code>æŒ‡ä»¤å®Œæˆ)</li></ul></li><li><p><strong>è¿”å›ï¼š</strong> è°ƒç”¨ <code>ret </code>æŒ‡ä»¤ï¼ŒæŠŠ esp ä¸Šç§»ä¸€ä¸ªä½ç½®ï¼ˆç¬¬ 2 æ­¥ä¿å­˜çš„è¿”å›åœ°å€ï¼‰ï¼Œå°†å‡½æ•°è¿”å›åœ°å€å¼¹ç»™ eip å¯„å­˜å™¨ã€‚å½“æ‰§è¡Œå®Œæˆ <code>ret </code>åï¼Œesp æŒ‡å‘çš„æ˜¯çˆ¶æ ˆå¸§çš„ç»“å°¾å¤„ï¼Œçˆ¶æ ˆå¸§å°¾éƒ¨å­˜å‚¨çš„è°ƒç”¨å‚æ•°ç”±ç¼–è¯‘å™¨è‡ªåŠ¨é‡Šæ”¾</p></li></ol><h3 id="ç¤ºä¾‹ä»£ç "><a class="markdownIt-Anchor" href="#ç¤ºä¾‹ä»£ç "></a> ç¤ºä¾‹ä»£ç </h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">intfunc_B</span>(<span class="hljs-type">int</span> arg_B1, <span class="hljs-type">int</span> arg_B2)<br>&#123;<br> <span class="hljs-type">int</span> var_B1, var_B2;<br> var_B1=arg_B1+arg_B2;<br> var_B2=arg_B1-arg_B2;<br> <span class="hljs-keyword">return</span> var_B1*var_B2;<br>&#125;<br><br><span class="hljs-built_in">intfunc_A</span>(<span class="hljs-type">int</span> arg_A1, <span class="hljs-type">int</span> arg_A2)<br>&#123;<br> <span class="hljs-type">int</span> var_A;<br> var_A = <span class="hljs-built_in">func_B</span>(arg_A1,arg_A2) + arg_A1 ;<br> <span class="hljs-keyword">return</span> var_A;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> **argv, <span class="hljs-type">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br> <span class="hljs-type">int</span> var_main;<br> var_main=<span class="hljs-built_in">func_A</span>(<span class="hljs-number">4</span>,<span class="hljs-number">3</span>);<br> <span class="hljs-keyword">return</span> var_main;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="è¿‡ç¨‹å›¾ç¤º"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹å›¾ç¤º"></a> è¿‡ç¨‹å›¾ç¤º</h3><p><img src="/img/blog_pic/2022/%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E7%9A%84%E5%AE%9E%E7%8E%B0.png" alt="å‡½æ•°è°ƒç”¨çš„å®ç°" /></p><h2 id="å‚è€ƒ"><a class="markdownIt-Anchor" href="#å‚è€ƒ"></a> å‚è€ƒ</h2><ul><li><a href="https://mp.weixin.qq.com/s/KriHHXF3WkzVgmCMN6rEUg">C/C++ï¼šå †æ ˆé¢é¢è§‚</a></li><li><a href="https://zhuanlan.zhihu.com/p/27339191">x86-64 ä¸‹å‡½æ•°è°ƒç”¨åŠæ ˆå¸§åŸç†</a></li><li><a href="https://leeshine.github.io/2019/03/17/stack-of-fuc-call/">C++å‡½æ•°è°ƒç”¨æ ˆè¿‡ç¨‹</a></li><li>0day å®‰å…¨è½¯ä»¶æ¼æ´åˆ†ææŠ€æœ¯ï¼ˆç¬¬äºŒç‰ˆï¼‰ ç¬¬äºŒç«  ï¼ˆp40ï¼‰</li></ul>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ“ä½œç³»ç»Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>hardware_concurrency() è¿”å›å€¼æ˜¯ç‰©ç†æ ¸æ•°è¿˜æ˜¯è™šæ‹Ÿæ ¸æ•°</title>
    <link href="/2022/01/08/hardware_concurrency()%20%E8%BF%94%E5%9B%9E%E5%80%BC%E6%98%AF%E7%89%A9%E7%90%86%E6%A0%B8%E6%95%B0%E8%BF%98%E6%98%AF%E8%99%9A%E6%8B%9F%E6%A0%B8%E6%95%B0/"/>
    <url>/2022/01/08/hardware_concurrency()%20%E8%BF%94%E5%9B%9E%E5%80%BC%E6%98%AF%E7%89%A9%E7%90%86%E6%A0%B8%E6%95%B0%E8%BF%98%E6%98%AF%E8%99%9A%E6%8B%9F%E6%A0%B8%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h2><p>æ—©ä¸Šé¢è¯•çš„æ—¶å€™è¢«é—®åˆ°é¡¹ç›®ä¸­å¤šçº¿ç¨‹çš„å®ç°æ–¹å¼ä»¥åŠ<strong>çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°é‡çš„è¯¥å¦‚ä½•ç¡®å®šï¼Ÿ<strong>æˆ‘å›ç­”äº† hardware_concurrency()ï¼Œæ¥ç€è¢«è¿½é—® hardware_concurrency() è¿”å›å€¼æ˜¯ç‰©ç†æ ¸æ•°è¿˜æ˜¯è™šæ‹Ÿæ ¸æ•°ï¼Ÿæˆ‘è¯´åå­—é‡Œæœ‰ hardwareï¼Œåº”è¯¥æ˜¯ç‰©ç†æ ¸æ•°ï¼Œæ²¡æƒ³åˆ°çŒœé”™äº†å“ˆå“ˆå“ˆå“ˆå“ˆé¢è¯•å®˜è¯´æ˜¯</strong>è™šæ‹Ÿæ ¸æ•°</strong>.</p><h2 id="hardware_concurrency"><a class="markdownIt-Anchor" href="#hardware_concurrency"></a> hardware_concurrency()</h2><p><strong>cplusplus ä¸Šå¯¹äº hardware_concurrency() çš„æè¿°ï¼š</strong></p><blockquote><ul><li>Returns the number of hardware thread contexts.</li><li>The interpretation of this value is system- and implementation- specific, and may not be exact, but just an approximation.</li><li>Note that this does not need to match the actual number of processors or cores available in the system: A system can support multiple threads per processing unit, or restrict the access to its resources to the program.</li><li>If this value is not computable or well defined, the function returns 0.</li></ul></blockquote><p>ç¬¬ä¸€ç‚¹æåˆ°å…¶è¿”å›å€¼æ˜¯ç¡¬ä»¶çº¿ç¨‹ä¸Šä¸‹æ–‡çš„æ•°é‡ï¼Œç¬¬ä¸‰ç‚¹æåˆ°è¯¥è¿”å›å€¼å¯èƒ½å¹¶ä¸ä¸çœŸæ˜¯çš„å¤„ç†å™¨æˆ–è€…æ ¸æ•°ç›¸ä¸€è‡´ï¼ˆå› ä¸ºç³»ç»Ÿå¯ä»¥åœ¨ä¸€ä¸ªå¤„ç†å•å…ƒä¸Šè¿è¡Œå¤šä¸ªçº¿ç¨‹ï¼‰ã€‚</p><p><strong>StackOverflow ä¸Šæœ‰ä¸€ä¸ª<a href="https://stackoverflow.com/questions/27971195/handle-stdthreadhardware-concurrency">é—®é¢˜</a>æåˆ°è¿™ä¸ªæ–¹æ³•ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªå›ç­”ï¼š</strong></p><blockquote><p>Even when hardware_concurrency is implemented, it cannot be relied as a direct mapping to the number of cores. This is what the standard says it returns - The number of hardware thread contexts. And goes on to state - This value should only be considered to be a hint If your machine has hyperthreading enabled, itâ€™s entirely possible the value returned will be 2x the number of cores. If you want a reliable answer, youâ€™ll need to use whatever facilities your OS provides. â€“ PraetorianJan 15 '15 at 19:21</p></blockquote><p>è¯´åˆ°è¯¥è¿”å›å€¼ cannot be relied as a direct mapping to the number of coreï¼Œä¹Ÿå°±æ˜¯ä¸ç›´æ¥ä¸ï¼ˆç‰©ç†ï¼‰æ ¸æ•°å¯¹åº”ï¼Œå¦‚æœå¼€å¯äº†è¶…çº¿ç¨‹æŠ€æœ¯ï¼Œé‚£ä¹ˆè¿”å›å€¼å°†ä¼šæ˜¯ï¼ˆç‰©ç†ï¼‰æ ¸æ•°çš„ 2 å€ï¼Œä¹Ÿå°±æ˜¯è™šæ‹Ÿæ ¸æ•°ã€‚</p><h2 id="ç‰©ç†æ ¸-è™šæ‹Ÿæ ¸"><a class="markdownIt-Anchor" href="#ç‰©ç†æ ¸-è™šæ‹Ÿæ ¸"></a> ç‰©ç†æ ¸ã€è™šæ‹Ÿæ ¸</h2><p>å®é™…ä¸Šï¼Œæ ¸çš„æ¦‚å¿µåˆ†ä¸º ç‰©ç†æ ¸ï¼ˆPhysical Coreï¼‰ å’Œ é€»è¾‘æ ¸ï¼ˆLogical Coreï¼‰ï¼Œåœ¨æˆ‘ä»¬è¯´å¤šæ ¸å¤„ç†å™¨çš„æ—¶å€™ï¼Œå…¶å®æ˜¯æœ‰äºŒä¹‰æ€§çš„â€”â€”æˆ‘ä»¬ä¸çŸ¥é“è®²çš„æ˜¯å¤šä¸ª ç‰©ç†æ ¸ è¿˜æ˜¯ é€»è¾‘æ ¸ ã€‚</p><ul><li>ç‰©ç†æ ¸<ul><li>ç‰©ç†ä¸Šã€çœŸå®å­˜åœ¨çš„ æ ¸ï¼ˆCoreï¼‰ï¼Œå¯ä»¥åœ¨ç¡¬ä»¶å±‚é¢ä¸Šçœ‹åˆ°æ•°é‡çš„ æ ¸ï¼ˆCoreï¼‰</li></ul></li><li>é€»è¾‘æ ¸<ul><li>ç†è§£ä¸Šï¼Œåªæ˜¯é€»è¾‘ä¸Šå­˜åœ¨çš„ æ ¸ï¼ˆCoreï¼‰ æ— æ³•é€šè¿‡ç¡¬ä»¶å±‚é¢åˆ¤æ–­å‡ºæ•°é‡</li><li>å®é™…ä¸Šï¼ŒåŸºäº Intel çš„ è¶…çº¿ç¨‹æŠ€æœ¯ï¼ˆHyper-Threadingï¼‰ å°†ä¸€ä¸ªç‰©ç†æ ¸æ‹†åˆ†æˆä¸¤ä¸ªé€»è¾‘æ ¸ï¼Œæ›´åŠ é«˜æ•ˆåœ°æ‰§è¡Œ CPU æŒ‡ä»¤ä»¥åŠåˆ©ç”¨ L1 ç¼“å­˜</li></ul></li></ul><p>é™¤æ­¤ä¹‹å¤–ï¼Œæ— è®ºæ˜¯ Linux / Mac è¿˜æ˜¯ Windows çš„èµ„æºç®¡ç†å™¨ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„æ•°é‡éƒ½æ˜¯é€»è¾‘æ ¸çš„æ•°é‡ï¼Œè®¡ç®—å…¬å¼å¤§è‡´å¦‚ä¸‹ï¼š</p><ul><li>ç‰©ç†æ ¸æ•° = ç‰©ç†æ ¸æ•°ï¼ˆDual Core = åŒæ ¸ / Quad-Core = å››æ ¸ï¼‰</li><li>é€»è¾‘æ ¸æ•° = ç‰©ç†æ ¸æ•° or ç‰©ç†æ ¸æ•° x 2ï¼ˆå¼€å¯äº† HTï¼‰</li></ul><h2 id="è¶…çº¿ç¨‹-hyper-threading"><a class="markdownIt-Anchor" href="#è¶…çº¿ç¨‹-hyper-threading"></a> è¶…çº¿ç¨‹ Hyper-Threading</h2><p>æœ‰æ—¶å€™æˆ‘ä»¬è°ˆåˆ°åŒæ ¸å››çº¿ç¨‹çš„æ—¶å€™ï¼Œå®è´¨ä¸Šè°ˆåˆ°çš„å°±æ˜¯è¶…çº¿ç¨‹æŠ€æœ¯ï¼ˆHyper-Threadingï¼‰ï¼Œè¶…çº¿ç¨‹æŠ€æœ¯æ˜¯ä¸€ç§ç¡¬ä»¶åˆ›æ–°ï¼Œå…è®¸ä¸€ä¸ªä»¥ä¸Šçš„çº¿ç¨‹è¿è¡Œåœ¨æ¯ä¸ªæ ¸å¿ƒï¼Œæ›´å¤šçš„çº¿ç¨‹æ„å‘³ç€å¯ä»¥å¹¶è¡Œåœ°å®Œæˆæ›´å¤šçš„å·¥ä½œã€‚</p><blockquote><ul><li>How does Hyper-Threading work? When IntelÂ® Hyper-Threading Technology is active, the CPU exposes two execution contexts per physical core. This means that one physical core now works like two â€œlogical coresâ€ that can handle different software threads. The ten-core IntelÂ® Coreâ„¢ i9-10900K processor, for example, has 20 threads when Hyper-Threading is enabled.</li><li>Two logical cores can work through tasks more efficiently than a traditional single-threaded core. By taking advantage of idle time when the core would formerly be waiting for other tasks to complete, IntelÂ® Hyper-Threading Technology improves CPU throughput (by up to 30% in server applications3).</li></ul></blockquote><p><img src="/img/blog_pic/2022/%E5%8D%95%E6%A0%B8%E5%8F%8C%E7%BA%BF%E7%A8%8B.png" alt="å•æ ¸åŒçº¿ç¨‹" /></p><p>ä¸€ä¸ªæ”¯æŒè¶…çº¿ç¨‹æŠ€æœ¯çš„ CPU ç‰©ç†æ ¸å¿ƒï¼Œé‡Œé¢ä¼šæœ‰ä¸¤å¥—ç‹¬ç«‹çš„å¯„å­˜å™¨ä½†å…±ç”¨å‰©ä¸‹çš„è®¡ç®—å•å…ƒå’Œç¼“å­˜ï¼Œæ¯”å¦‚ ALUï¼ˆç®—æœ¯é€»è¾‘å•å…ƒï¼‰ å’Œ L1 / L2 ç¼“å­˜ã€‚åä¹‹ï¼Œè‹¥ä¸æ”¯æŒè¶…çº¿ç¨‹çš„ CPU ç‰©ç†æ ¸å¿ƒä¸­åªä¼šæœ‰ä¸€å¥—å¯„å­˜å™¨ï¼Œä¹Ÿèƒ½é€šè¿‡è¿™ä¸ªå›¾ç›´è§‚çš„ç†è§£è¶…çº¿ç¨‹å¸¦æ¥çš„ä¸€äº›æ•ˆç‡æå‡ã€‚ä»ä¸€ä¸ªè¿è¡Œåœ¨å¼€å¯äº†è¶…çº¿ç¨‹çš„ CPU çš„æ“ä½œç³»ç»Ÿçš„è§’åº¦æ¥çœ‹ï¼Œæ­¤æ—¶å®ƒç®¡ç†ç€ä¸¤ä¸ª CPUï¼ˆé€»è¾‘ä¸Šçš„ï¼‰ï¼Œè¿™ä¸¤ä¸ªé€»è¾‘ cpu åœ¨åŒä¸€ä¸ªç‰©ç† cpu ä¸Šè¿è¡Œã€‚ <strong>ä¸è¿‡è¿™æ ·å¹¶ä¸ä¼šäº§ç”Ÿä¸¤å€äºä¼ ç»Ÿå¤„ç†å™¨çš„å¤„ç†èƒ½åŠ›ï¼Œä¹Ÿä¸å¯èƒ½æä¾›å®Œå…¨çš„å¹¶è¡Œå¤„ç†èƒ½åŠ›ï¼Œå› ä¸ºå®ƒä»¬ä¸èƒ½ä½œä¸ºä¸¤ä¸ªå®Œæ•´çš„ç‹¬ç«‹çš„å¤„ç†å™¨æ¥æ‰§è¡Œã€‚</strong></p><p><img src="/img/blog_pic/2022/%E5%A4%9A%E6%A0%B8%E5%A4%9A%E7%BA%BF%E7%A8%8B.png" alt="å¤šæ ¸å¤šçº¿ç¨‹" /></p><p>å››æ ¸å…«çº¿ç¨‹å°±æ˜¯å°†å››ä¸ªå•æ ¸ä¸¤çº¿ç¨‹çš„ç‰©ç†æ ¸å¿ƒè£…åœ¨ä¸€ä¸ªèŠ¯ç‰‡ï¼ˆChipï¼‰ ä¸Šã€‚</p><h2 id="åœ¨-windows-ç³»ç»Ÿä¸Šå¼€å¯å…³é—­è™šæ‹ŸåŒ–hyper-v"><a class="markdownIt-Anchor" href="#åœ¨-windows-ç³»ç»Ÿä¸Šå¼€å¯å…³é—­è™šæ‹ŸåŒ–hyper-v"></a> åœ¨ Windows ç³»ç»Ÿä¸Šå¼€å¯/å…³é—­è™šæ‹ŸåŒ–ï¼ˆHyper-Vï¼‰</h2><p>å·¦å›¾æ˜¯åœ¨æˆ‘çš„ç”µè„‘ä¸Šå¼€å¯äº† Hyper-Vï¼Œå³å›¾æ˜¯å¥³æœ‹å‹çš„ç”µè„‘ï¼Œæ²¡æœ‰å¼€å¯ Hyper-Vã€‚åŒæ ·æ˜¯å››ä¸ªå†…æ ¸ï¼Œå¼€äº† Hyper-V åèµ„æºç®¡ç†å™¨ä¸­æ˜¾ç¤ºçš„é€»è¾‘å¤„ç†å™¨æ•°é‡ç¿»å€äº†ã€‚</p><table><thead><tr><th><img src="/img/blog_pic/2022/%E5%BC%80%E5%90%AF%E8%99%9A%E6%8B%9F%E5%8C%96.png" alt="å¼€å¯è™šæ‹ŸåŒ–" /></th><th><img src="/img/blog_pic/2022/%E5%85%B3%E9%97%AD%E8%99%9A%E6%8B%9F%E5%8C%96.png" alt="å…³é—­è™šæ‹ŸåŒ–" /></th></tr></thead></table><h2 id="å‚è€ƒ"><a class="markdownIt-Anchor" href="#å‚è€ƒ"></a> å‚è€ƒ</h2><ul><li><a href="http://www.cplusplus.com/reference/thread/thread/hardware_concurrency/">cplusplus-reference-hardware_concurrency</a></li><li><a href="https://stackoverflow.com/questions/27971195/handle-stdthreadhardware-concurrency">Handle std:ğŸ§µ:hardware_concurrency()</a></li><li><a href="https://davex.pw/2020/09/18/cpu-physical-and-logical-cores-and-hyper-threding/">äº†è§£ CPU ä¹‹ç‰©ç†æ ¸ã€é€»è¾‘æ ¸ã€è¶…çº¿ç¨‹</a></li><li><a href="https://www.intel.com/content/www/us/en/gaming/resources/hyper-threading.html">What Is Hyper-Threading?</a></li><li><a href="https://www.daniloaz.com/en/differences-between-physical-cpu-vs-logical-cpu-vs-core-vs-thread-vs-socket/">Differences between physical CPU vs logical CPU vs Core vs Thread vs Socket</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ“ä½œç³»ç»Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>TCP å››æ¬¡æŒ¥æ‰‹ï¼šä¸ºä»€ä¹ˆæœåŠ¡ç«¯éœ€è¦æ”¶åˆ°å®¢æˆ·ç«¯çš„ ACK åæ‰èƒ½ Closed</title>
    <link href="/2022/01/03/TCP%20%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%9C%80%E8%A6%81%E6%94%B6%E5%88%B0%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84%20ACK%20%E5%90%8E%E6%89%8D%E8%83%BD%20Closed/"/>
    <url>/2022/01/03/TCP%20%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%9C%80%E8%A6%81%E6%94%B6%E5%88%B0%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84%20ACK%20%E5%90%8E%E6%89%8D%E8%83%BD%20Closed/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h2><p>ä»Šå¤©é€›ç‰›å®¢ç½‘æ—¶çœ‹åˆ°ä¸€ä¸ªå¸–å­ï¼Œé‡Œé¢æäº†è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼š</p><blockquote><p>ä¸ºä»€ä¹ˆæœåŠ¡ç«¯å¤„äº last-ack åéœ€è¦æ”¶åˆ°å®¢æˆ·ç«¯çš„ ACK åæ‰èƒ½ closed ï¼Ÿ<br />last-ack çŠ¶æ€ä¸‹è®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨è¶…æ—¶åç›´æ¥ closed å¯ä»¥å—ï¼Ÿ</p></blockquote><p>ç¬¬ä¸€æ„Ÿè§‰å¥½åƒå¯ä»¥ï¼Œä¸è¿‡ç»†æƒ³ä¹‹ä¸‹å°±ä¼šå‘ç°æ˜¯ä¸å¯ä»¥çš„ã€‚</p><h2 id="ç†ç”±"><a class="markdownIt-Anchor" href="#ç†ç”±"></a> ç†ç”±</h2><ol><li><p>å¦‚æœæœåŠ¡ç«¯æ²¡æœ‰æ”¶åˆ°ç¬¬å››æ¬¡æŒ¥æ‰‹çš„ ACKï¼Œé‚£ä¹ˆå®ƒæ²¡æ³•ç¡®è®¤è‡ªå·±ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹çš„ FIN æœ‰æ²¡æœ‰è¢«å®¢æˆ·ç«¯æ¥å—ï¼›æ­¤æ—¶å‡è®¾å®¢æˆ·ç«¯æ²¡æœ‰æ¥å—åˆ°æœåŠ¡ç«¯çš„ FIN è€ŒæœåŠ¡ç«¯å¦‚é—®é¢˜å‡è®¾çš„é‚£æ ·åœ¨ last-ack ä¸‹è¶…æ—¶è€Œå…³é—­äº†ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯è¿˜æ˜¯å¤„äº FIN_WAIT_1 çŠ¶æ€ï¼ˆæ­£å¸¸æƒ…å†µä¸‹è¿™ä¸ªçŠ¶æ€è¡¨ç¤ºå®¢æˆ·ç«¯å·²ç»å…³é—­è¿æ¥ä¸èƒ½å‘é€æ•°æ®ï¼Œä½†æ˜¯è¿˜åœ¨ç­‰å¾…æ¥å—æœåŠ¡ç«¯çš„æ•°æ®ç›´åˆ°æ¥æ”¶åˆ°æœåŠ¡ç«¯çš„ FINï¼‰ï¼Œè€Œæ­¤æ—¶æœåŠ¡ç«¯å·²ç» closedï¼Œå†ä¹Ÿä¸ä¼šç»™å®¢æˆ·ç«¯å‘é€ FINï¼Œå¯¼è‡´å®¢æˆ·ç«¯åœ¨ FIN_WAIT_1 çŠ¶æ€ä¸‹ä¸€ç›´ç­‰å¾…ã€‚</p></li><li><p>æœåŠ¡ç«¯å¤„äº last-ack åéœ€è¦æ”¶åˆ°å®¢æˆ·ç«¯çš„ ACK åæ‰èƒ½ closedï¼šæœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯ç¬¬å››æ¬¡æŒ¥æ‰‹çš„ ACK æ„å‘³ç€æœåŠ¡ç«¯ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹çš„ FIN è¢«å¯¹æ–¹æˆåŠŸï¼ˆå®¢æˆ·ç«¯å¯ä»¥é¡ºåˆ©è½¬ç§»åˆ° TIME_WAIT çŠ¶æ€ç­‰å¾… 2MSL å closedï¼‰ï¼Œå¦‚æœæœåŠ¡ç«¯æ²¡æ”¶è¿™æœ€åä¸€æ¬¡æŒ¥æ‰‹çš„ ACK ï¼Œé‚£ä¹ˆå®ƒæ— æ³•ç¡®è®¤è‡ªå·±ä¸Šä¸€æ¬¡æŒ¥æ‰‹çš„ FIN ä¸¢å¤±äº†è¿˜æ˜¯å¯¹æ–¹å›å¤çš„ ACK ä¸¢å¤±äº†ï¼Œæ­¤æ—¶å°±ä¼šé‡å‘ FIN ç›´åˆ°æ”¶åˆ°æœ€åä¸€ä¸ª ACKã€‚</p></li><li><p>å¦‚æœæœåŠ¡ç«¯å¤„äº last-ack çŠ¶æ€åå®¢æˆ·ç«¯æ–­å¼€è¿æ¥å¯¼è‡´æœåŠ¡ç«¯ä¸å¯èƒ½æ”¶åˆ°ç¬¬å››æ¬¡æŒ¥æ‰‹çš„ ACKï¼Œè¿™ç§æƒ…å†µä¸‹æœåŠ¡ç«¯ä¼šé‡ä¼  FIN ç›´åˆ°é‡ä¼ æ¬¡æ•°è¾¾åˆ°å†…æ ¸å‚æ•° tcp_orphan_retriesï¼ˆé»˜è®¤å€¼ä¸º 8ï¼‰ åå…³é—­è¿æ¥</p></li></ol><p><img src="/img/blog_pic/2022/TCP%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B%E5%9B%BE%E7%A4%BA.png" alt="TCPå››æ¬¡æŒ¥æ‰‹å›¾ç¤º" /></p><h2 id="å°ç»“"><a class="markdownIt-Anchor" href="#å°ç»“"></a> å°ç»“</h2><p><strong>æ€è€ƒè¿™ç§é—®é¢˜è¦ä» TCP çš„ç¡®è®¤æœºåˆ¶å’Œå½“æ—¶å¤„äºå“ªä¸ªçŠ¶æ€ä»¥åŠè¯¥çŠ¶æ€çš„å«ä¹‰å‡ºå‘ã€‚</strong><br />å…¶ä»–ç±»ä¼¼é—®é¢˜ï¼š</p><ul><li><p>ç¬¬ä¸€æ¬¡æ¡æ‰‹çš„ SYN æŠ¥æ–‡ä¸¢å¤±å¦‚ä½•å¤„ç†ï¼Ÿ</p><ul><li>å®¢æˆ·ç«¯ç«¯é‡ä¼ ï¼Œé‡ä¼ æ¬¡æ•°ç”±å†…æ ¸å‚æ•° tcp_syn_retriesï¼ˆé»˜è®¤å€¼ä¸º 5ï¼‰ è§„å®š</li></ul></li><li><p>ç¬¬äºŒæ¬¡æ¡æ‰‹çš„ SYN + ACK æŠ¥æ–‡ä¸¢å¤±å¦‚ä½•å¤„ç†ï¼Ÿ</p><ul><li>å®¢æˆ·ç«¯ç«¯é‡ä¼ ï¼Œé‡ä¼ æ¬¡æ•°ç”±å†…æ ¸å‚æ•° tcp_syn_retriesï¼ˆé»˜è®¤å€¼ä¸º 5ï¼‰ è§„å®šï¼›å¯¹å…¶è€Œè¨€ä¸ç¬¬ä¸€æ¬¡æ¡æ‰‹åŒ…ä¸¢å¤±ä¸€è‡´</li><li>æœåŠ¡ç«¯ç«¯é‡ä¼ ï¼Œé‡ä¼ æ¬¡æ•°ç”±å†…æ ¸å‚æ•° tcp_synack_retriesï¼ˆé»˜è®¤å€¼ä¸º 5ï¼‰ è§„å®š</li></ul></li><li><p>ç¬¬ä¸‰æ¬¡æ¡æ‰‹çš„ ACK æŠ¥æ–‡ä¸¢å¤±å¦‚ä½•å¤„ç†ï¼Ÿ</p><ul><li>æœåŠ¡ç«¯é‡ä¼ ç¬¬äºŒæ¬¡çš„ SYN + ACKï¼Œæˆ–è€…æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€äº†å¸¦æœ‰ ACK çš„æ•°æ®åŒ…</li></ul></li><li><p>ç¬¬ä¸€æ¬¡æŒ¥æ‰‹çš„ FIN ä¸¢å¤±å¦‚ä½•å¤„ç†ï¼Ÿ</p><ul><li>å®¢æˆ·ç«¯ç«¯é‡ä¼ ï¼Œé‡ä¼ æ¬¡æ•°ç”±å†…æ ¸å‚æ•° tcp_orphan_retriesï¼ˆé»˜è®¤å€¼ä¸º 5ï¼‰ è§„å®š</li></ul></li><li><p>ç¬¬äºŒæ¬¡æŒ¥æ‰‹çš„ ACK ä¸¢å¤±å¦‚ä½•å¤„ç†ï¼Ÿ</p><ul><li>å®¢æˆ·ç«¯ç«¯é‡ä¼ ï¼Œé‡ä¼ æ¬¡æ•°ç”±å†…æ ¸å‚æ•° tcp_orphan_retriesï¼ˆé»˜è®¤å€¼ä¸º 5ï¼‰ è§„å®šï¼›å¯¹å…¶è€Œè¨€ä¸ç¬¬ä¸€æ¬¡æŒ¥æ‰‹åŒ…ä¸¢å¤±ä¸€è‡´</li><li>æœåŠ¡ç«¯ä¸ä¼šé‡ä¼ ï¼Œå› ä¸ºä¸¢å¤±çš„æ˜¯ ACK æŠ¥æ–‡ï¼ˆæ¥æ”¶æ–¹æ”¶åˆ° ACK æŠ¥æ–‡åä¸ä¼šå›å¤ç¡®è®¤æŠ¥æ–‡ï¼Œå¦åˆ™çš„è¯å°±æ— é™å¾ªç¯äº†ï¼‰</li></ul></li><li><p>ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹çš„ FIN ä¸¢å¤±å¦‚ä½•å¤„ç†ï¼Ÿ</p><ul><li>æœåŠ¡ç«¯ç«¯é‡ä¼ ï¼Œé‡ä¼ æ¬¡æ•°ç”±å†…æ ¸å‚æ•° tcp_orphan_retriesï¼ˆé»˜è®¤å€¼ä¸º 5ï¼‰ è§„å®šï¼›ä¸å®¢æˆ·ç«¯é‡ä¼ ç¬¬ä¸€æ¬¡çš„ FIN æŠ¥æ–‡æ®µæœºåˆ¶ä¸€è‡´</li></ul></li><li><p>ç¬¬å››æ¬¡æŒ¥æ‰‹çš„ ACK ä¸¢å¤±å¦‚ä½•å¤„ç†ï¼Ÿ</p><ul><li>æœåŠ¡ç«¯é‡ä¼ ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹çš„ FINï¼Œå®¢æˆ·ç«¯æ­¤æ—¶å¤„äº TIME_WAIT çŠ¶æ€ï¼Œåœ¨ 2 MSL å†…æ”¶åˆ° FINï¼Œé‡ä¼  ACKï¼Œé‡ç½®å®šæ—¶å™¨</li></ul></li></ul><h2 id="å‚è€ƒ"><a class="markdownIt-Anchor" href="#å‚è€ƒ"></a> å‚è€ƒ</h2><ul><li><a href="https://itectec.com/network/tcp-why-is-the-last-ack-needed-in-tcp-four-way-termination/">Tcp â€“ Why is the last ACK needed in TCP four way termination</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è®¡ç®—æœºç½‘ç»œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>C++ 11 ä¸‡èƒ½å¼•ç”¨</title>
    <link href="/2021/12/31/C++%2011%20%E4%B8%87%E8%83%BD%E5%BC%95%E7%94%A8/"/>
    <url>/2021/12/31/C++%2011%20%E4%B8%87%E8%83%BD%E5%BC%95%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="å¼•ç”¨æŠ˜å è§„åˆ™"><a class="markdownIt-Anchor" href="#å¼•ç”¨æŠ˜å è§„åˆ™"></a> å¼•ç”¨æŠ˜å è§„åˆ™</h2><ul><li>T&amp; &amp;   -&gt; T&amp;</li><li>T&amp; &amp;&amp;  -&gt; T&amp;</li><li>T&amp;&amp; &amp;  -&gt; T&amp;</li><li>T&amp;&amp; &amp;&amp; -&gt; T&amp;&amp;</li></ul><p>å°ç»“ï¼šåªæœ‰å³å€¼å¼•ç”¨çš„å³å€¼å¼•ç”¨ä¼šæŠ˜å æˆå³å€¼å¼•ç”¨ï¼Œå…¶ä½™æƒ…å†µéƒ½æ˜¯æŠ˜å æˆå·¦å€¼å¼•ç”¨</p><h2 id="å®Œç¾è½¬å‘"><a class="markdownIt-Anchor" href="#å®Œç¾è½¬å‘"></a> å®Œç¾è½¬å‘</h2><p>æŸäº›åœºæ™¯ä¸‹æœ‰å‚æ•°è½¬å‘çš„éœ€æ±‚ï¼šæœ€ç†æƒ³çš„æƒ…å†µä¸‹æ˜¯å¤–å±‚çš„Wrapper(ä¸‹é¢çš„ factory å‡½æ•°)å°±åƒä¸å­˜åœ¨ä¸€æ ·è€Œå†…å±‚å‡½æ•°å°±åƒç›´æ¥è¢«è°ƒç”¨ä¸€æ ·<br />è°ƒç”¨ wrapper æ—¶ä¼ é€’çš„æ˜¯å·¦å€¼ï¼Œå†…å±‚å‡½æ•°è¢«è°ƒç”¨æ—¶å¾—åˆ°çš„å°±æ˜¯å·¦å€¼ï¼›è°ƒç”¨ wrapper æ—¶ä¼ é€’çš„æ˜¯å³å€¼ï¼Œå†…å±‚å‡½æ•°è¢«è°ƒç”¨æ—¶å¾—åˆ°çš„å°±æ˜¯å³å€¼ã€‚</p><h2 id="ä¸‡èƒ½å¼•ç”¨"><a class="markdownIt-Anchor" href="#ä¸‡èƒ½å¼•ç”¨"></a> ä¸‡èƒ½å¼•ç”¨</h2><p>ä»¥å¼•ç”¨å½¢å¼ä½œä¸ºå‚æ•°çš„å‡½æ•°ï¼Œä¸€èˆ¬åªèƒ½åŒ¹é…å·¦å€¼æˆ–è€…åªèƒ½åŒ¹é…å³å€¼</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">foo</span><span class="hljs-params">(<span class="hljs-type">int</span> &amp; i)</span></span>;  <span class="hljs-comment">// åªèƒ½æ¥å—å·¦å€¼å¼•ç”¨å‚æ•°</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">foo</span><span class="hljs-params">(<span class="hljs-type">int</span> &amp;&amp; i)</span></span>; <span class="hljs-comment">// åªèƒ½æ¥å—å³å€¼å¼•ç”¨å‚æ•°</span><br></code></pre></td></tr></table></figure><ul><li>è‹¥æ˜¯æƒ³ä»¥å·¦å€¼å¼•ç”¨å½¢å¼æ¥å—å³å€¼å¼•ç”¨å‚æ•°ï¼Œåˆ™å¿…é¡»å°†å‚æ•°å£°æ˜ä¸º const çš„å·¦å€¼å¼•ç”¨ï¼›æ­¤æ—¶è‹¥æ˜¯æœ‰å¤šä¸ªå½¢å‚ï¼Œé’ˆå¯¹æ¯ä¸ªå½¢å‚éƒ½è¦é‡è½½ const å’Œé const ç‰ˆæœ¬ï¼Œæ˜¯å¾ˆå¤æ‚çš„æ’åˆ—ç»„åˆé—®é¢˜ï¼Œä¸”æ— æ³•è§¦å‘ç§»åŠ¨è¯­ä¹‰ã€‚</li><li>æ­¤æ—¶éœ€è¦ä¸‡èƒ½å¼•ç”¨ï¼šä»¥ä¸€ç§å½¢å¼çš„å‚æ•°å½¢å¼æ¥å—å·¦å€¼å¼•ç”¨å’Œå³å€¼å¼•ç”¨ï¼›ä¸‡èƒ½å¼•ç”¨çš„ä¸¤ä¸ªå‰ææ¡ä»¶ï¼šæ¨¡æ¿å½¢å¼ï¼›&amp;&amp; å‹å‚æ•°</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T, <span class="hljs-keyword">typename</span> Arg&gt;</span><br><span class="hljs-function">shared_ptr&lt;T&gt; <span class="hljs-title">factory</span><span class="hljs-params">(Arg &amp;&amp; arg)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">shared_ptr</span>&lt;T&gt;(<span class="hljs-keyword">new</span> <span class="hljs-built_in">T</span>(std::forward&lt;Arg&gt;(arg)));<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CTemp</span>&#123;<br>    <span class="hljs-type">int</span> data;<br><span class="hljs-keyword">public</span>:<br>     <span class="hljs-built_in">CTemp</span>(<span class="hljs-type">int</span>&amp; arg) : <span class="hljs-built_in">data</span>(arg)&#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;CTemp(int&amp; arg) called\n&quot;</span>;<br>    &#125;<br>     <span class="hljs-built_in">CTemp</span>(<span class="hljs-type">int</span>&amp;&amp; arg) : <span class="hljs-built_in">data</span>(arg)&#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;CTemp(int&amp;&amp; arg) called\n&quot;</span>;<br>    &#125;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-type">int</span> value = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">auto</span> p1 = <span class="hljs-built_in">factory</span>&lt;CTemp&gt;(value); <br>    <span class="hljs-keyword">auto</span> p2 = <span class="hljs-built_in">factory</span>&lt;CTemp&gt;(<span class="hljs-number">2</span>);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><br></code></pre></td></tr></table></figure><h2 id="è¿è¡Œç»“æœ"><a class="markdownIt-Anchor" href="#è¿è¡Œç»“æœ"></a> è¿è¡Œç»“æœ</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">CTemp</span>(<span class="hljs-type">int</span>&amp; arg) <span class="hljs-function">called</span><br><span class="hljs-function"><span class="hljs-title">CTemp</span><span class="hljs-params">(<span class="hljs-type">int</span>&amp;&amp; arg)</span> called</span><br></code></pre></td></tr></table></figure><p>è¯´æ˜ factory å‡½æ•°å°†æ¥æ”¶åˆ°çš„å‚æ•°â€œå®Œç¾â€è½¬å‘ï¼ˆä¸æ”¹å˜å‚æ•°çš„å·¦å³å€¼å±æ€§ï¼‰ç»™å†…å±‚å‡½æ•°</p><h2 id="å‚è€ƒ"><a class="markdownIt-Anchor" href="#å‚è€ƒ"></a> å‚è€ƒ</h2><ul><li><a href="https://www.bilibili.com/video/BV15g411w7Up?p=1&amp;share_medium=android&amp;share_plat=android&amp;share_session_id=ba802588-457d-4590-a1ab-a3297a38498b&amp;share_source=WEIXIN&amp;share_tag=s_i&amp;timestamp=1639629464&amp;unique_k=8h0hOXB">C++æ–°æ ‡å‡†002_åŠ¨åŠ¨å°æ‰‹æŒ‡å°±èƒ½å®ç° &quot; å®Œç¾è½¬å‘ &quot;</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸ºä»€ä¹ˆéœ€è¦å°†ç§»åŠ¨æ„é€ å‡½æ•°å’Œç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦æ ‡è®°ä¸º noexcept</title>
    <link href="/2021/12/18/%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%B0%86%E7%A7%BB%E5%8A%A8%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E5%92%8C%E7%A7%BB%E5%8A%A8%E8%B5%8B%E5%80%BC%E8%BF%90%E7%AE%97%E7%AC%A6%E6%A0%87%E8%AE%B0%E4%B8%BA%20noexcept/"/>
    <url>/2021/12/18/%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%B0%86%E7%A7%BB%E5%8A%A8%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E5%92%8C%E7%A7%BB%E5%8A%A8%E8%B5%8B%E5%80%BC%E8%BF%90%E7%AE%97%E7%AC%A6%E6%A0%87%E8%AE%B0%E4%B8%BA%20noexcept/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h2><p>åœ¨çœ‹ C++ Primer æ—¶æ³¨æ„åˆ°è¿™ä¸ªé—®é¢˜ï¼Œä»¥ä¸‹æ˜¯ä¹¦ä¸­å…³äºè¿™ä¸ªé—®é¢˜çš„è§£é‡Šï¼šå®¹å™¨ç±»åœ¨æ‰©å®¹æ—¶ä¼šå°†æ—§ç©ºé—´çš„å¯¹è±¡è½¬ç§»åˆ°æ–°ç©ºé—´ï¼Œå¦‚æœå®¹å™¨ä¸èƒ½ç¡®å®šè¯¥å¯¹è±¡çš„ç§»åŠ¨æ„é€ å‡½æ•°ä¸ä¼šæŠ›å‡ºå¼‚å¸¸çš„è¯ï¼Œå°±ä¼šâ€è°¨æ…â€œåœ°ä½¿ç”¨æ‹·è´æ„é€ å‡½æ•°ï¼Œè¿™æ ·å³ä¾¿è¿‡ç¨‹ä¸­å‘ç”Ÿäº†å¼‚å¸¸ä¹Ÿèƒ½ä¿è¯ä¸ç ´ååŸæ¥å®¹å™¨ä¸­çš„å¯¹è±¡ï¼ˆç§»åŠ¨ä¸€ä¸ªå¯¹è±¡ä¼šæ”¹å˜å…¶å†…å®¹ï¼‰ã€‚</p><h2 id="æ­£æ–‡"><a class="markdownIt-Anchor" href="#æ­£æ–‡"></a> æ­£æ–‡</h2><blockquote><p>ç”±äºç§»åŠ¨æ“ä½œâ€œçªƒå–â€èµ„æºï¼Œå®ƒé€šå¸¸ä¸åˆ†é…ä»»ä½•èµ„æºã€‚å› æ­¤ï¼Œç§»åŠ¨æ“ä½œé€šå¸¸ä¸ä¼šæŠ›å‡ºä»»ä½•å¼‚å¸¸ã€‚å½“ç¼–å†™ä¸€ä¸ªä¸æŠ›å‡ºå¼‚å¸¸çš„ç§»åŠ¨æ“ä½œæ—¶ï¼Œæˆ‘ä»¬åº”è¯¥å°†æ­¤äº‹é€šçŸ¥æ ‡å‡†åº“ã€‚æˆ‘ä»¬å°†çœ‹åˆ°ï¼Œé™¤éæ ‡å‡†åº“çŸ¥é“æˆ‘ä»¬çš„ç§»åŠ¨æ„é€ å‡½æ•°ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¦åˆ™å®ƒä¼šè®¤ä¸ºç§»åŠ¨æˆ‘ä»¬çš„ç±»å¯¹è±¡æ—¶å¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶ä¸”ä¸ºäº†å¤„ç†è¿™ç§å¯èƒ½æ€§è€Œåšä¸€äº›é¢å¤–çš„å·¥ä½œã€‚<br />ã€€ã€€ä¸€ç§é€šçŸ¥æ ‡å‡†åº“çš„æ–¹æ³•æ˜¯åœ¨æˆ‘ä»¬çš„æ„é€ å‡½æ•°ä¸­æŒ‡æ˜noexceptã€‚noexceptæ˜¯æ–°æ ‡å‡†å¼•å…¥çš„,æˆ‘ä»¬å°†åœ¨18.1.4èŠ‚(ç¬¬690é¡µ)ä¸­è®¨è®ºæ›´å¤šç»†èŠ‚ã€‚ç›®å‰é‡è¦çš„æ˜¯è¦çŸ¥é“, noexceptæ˜¯æˆ‘ä»¬æ‰¿è¯ºä¸€ä¸ªå‡½æ•°ä¸æŠ›å‡ºå¼‚å¸¸çš„ä¸€ç§æ–¹æ³•ã€‚æˆ‘ä»¬åœ¨ä¸€ä¸ªå‡½æ•°çš„å‚æ•°åˆ—è¡¨åæŒ‡å®šnoexceptã€‚åœ¨ä¸€ä¸ªæ„é€ å‡½æ•°ä¸­ï¼Œnoexceptå‡ºç°åœ¨å‚æ•°åˆ—è¡¨å’Œåˆå§‹åŒ–åˆ—è¡¨å¼€å§‹çš„å†’å·ä¹‹é—´ã€‚æˆ‘ä»¬å¿…é¡»åœ¨ç±»å¤´æ–‡ä»¶çš„å£°æ˜ä¸­å’Œå®šä¹‰ä¸­ï¼ˆå¦‚æœå®šä¹‰åœ¨ç±»å¤–çš„è¯ï¼‰éƒ½æŒ‡å®šnoexceptã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">StrVec</span>&#123;<br><span class="hljs-keyword">public</span>:<br>   <span class="hljs-built_in">StrVec</span>(StrVec&amp;&amp; rhs) <span class="hljs-keyword">noexcept</span>;<br>&#125;;<br><br>StrVec::<span class="hljs-built_in">StrVec</span>(StrVec&amp;&amp; rhs) <span class="hljs-keyword">noexcept</span> &#123;<br><br>&#125;<br></code></pre></td></tr></table></figure></blockquote><p>ææ¸…æ¥šä¸ºä»€ä¹ˆéœ€è¦noexceptèƒ½å¸®åŠ©æˆ‘ä»¬æ·±å…¥ç†è§£æ ‡å‡†åº“æ˜¯å¦‚ä½•ä¸æˆ‘ä»¬è‡ªå®šä¹‰çš„ç±»å‹äº¤äº’çš„ã€‚æˆ‘ä»¬éœ€è¦æŒ‡å‡ºä¸€ä¸ªç§»åŠ¨æ“ä½œä¸æŠ›å‡ºå¼‚å¸¸ï¼Œè¿™æ˜¯å› ä¸ºä¸¤ä¸ªç›¸äº’å…³è”çš„äº‹å®:é¦–å…ˆï¼Œè™½ç„¶ç§»åŠ¨æ“ä½œé€šå¸¸ä¸æŠ›å‡ºå¼‚å¸¸ï¼Œä½†æŠ›å‡ºå¼‚å¸¸ä¹Ÿæ˜¯å…è®¸çš„;å…¶æ¬¡ï¼Œæ ‡å‡†åº“å®¹å™¨èƒ½å¯¹å¼‚å¸¸å‘ç”Ÿæ—¶å…¶è‡ªèº«çš„è¡Œä¸ºæä¾›ä¿éšœã€‚ä¾‹å¦‚ï¼Œvectorä¿è¯ï¼Œå¦‚æœæˆ‘ä»¬è°ƒç”¨push_backæ—¶å‘ç”Ÿå¼‚å¸¸ï¼Œvectorè‡ªèº«ä¸ä¼šå‘ç”Ÿæ”¹å˜ã€‚<br />ã€€ã€€ç°åœ¨è®©æˆ‘ä»¬æ€è€ƒpush_backå†…éƒ¨å‘ç”Ÿäº†ä»€ä¹ˆã€‚ç±»ä¼¼å¯¹åº”çš„Strvecæ“ä½œï¼ˆå‚è§13.5èŠ‚ï¼Œç¬¬466é¡µ)ï¼Œå¯¹ä¸€ä¸ªvectorè°ƒç”¨push_backå¯èƒ½è¦æ±‚ä¸ºvectoré‡æ–°åˆ†é…å†…å­˜ç©ºé—´ã€‚å½“é‡æ–°åˆ†é…vector çš„å†…å­˜æ—¶ï¼Œvectorå°†å…ƒç´ ä»æ—§ç©ºé—´ç§»åŠ¨åˆ°æ–°å†…å­˜ä¸­ï¼Œå°±åƒæˆ‘ä»¬åœ¨reallocateä¸­æ‰€åšçš„é‚£æ ·ï¼ˆå‚è§13.5èŠ‚ï¼Œç¬¬469é¡µ)ã€‚<br />ã€€ã€€å¦‚æˆ‘ä»¬åˆšåˆšçœ‹åˆ°çš„é‚£æ ·ï¼Œç§»åŠ¨ä¸€ä¸ªå¯¹è±¡é€šå¸¸ä¼šæ”¹å˜å®ƒçš„å€¼ã€‚å¦‚æœé‡æ–°åˆ†é…è¿‡ç¨‹ä½¿ç”¨äº†ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œä¸”åœ¨ç§»åŠ¨äº†éƒ¨åˆ†è€Œä¸æ˜¯å…¨éƒ¨å…ƒç´ åæŠ›å‡ºäº†ä¸€ä¸ªå¼‚å¸¸ï¼Œå°±ä¼šäº§ç”Ÿé—®é¢˜ã€‚æ—§ç©ºé—´ä¸­çš„ç§»åŠ¨æºå…ƒç´ å·²ç»è¢«æ”¹å˜äº†ï¼Œè€Œæ–°ç©ºé—´ä¸­æœªæ„é€ çš„å…ƒç´ å¯èƒ½å°šä¸å­˜åœ¨ã€‚åœ¨æ­¤æƒ…å†µä¸‹ï¼Œvectorå°†ä¸èƒ½æ»¡è¶³è‡ªèº«ä¿æŒä¸å˜çš„è¦æ±‚ã€‚<br />ã€€ã€€å¦ä¸€æ–¹é¢ï¼Œå¦‚æœvectorä½¿ç”¨äº†æ‹·è´æ„é€ å‡½æ•°ä¸”å‘ç”Ÿäº†å¼‚å¸¸ï¼Œå®ƒå¯ä»¥å¾ˆå®¹æ˜“åœ°æ»¡è¶³è¦æ±‚ã€‚åœ¨æ­¤æƒ…å†µä¸‹ï¼Œå½“åœ¨æ–°å†…å­˜ä¸­æ„é€ å…ƒç´ æ—¶ï¼Œæ—§å…ƒç´ ä¿æŒä¸å˜ã€‚å¦‚æœæ­¤æ—¶å‘ç”Ÿäº†å¼‚å¸¸ï¼Œvectorå¯ä»¥é‡Šæ”¾æ–°åˆ†é…çš„ï¼ˆä½†è¿˜æœªæˆåŠŸæ„é€ çš„ï¼‰å†…å­˜å¹¶è¿”å›ã€‚vectoråŸæœ‰çš„å…ƒç´ ä»ç„¶å­˜åœ¨ã€‚<br />ã€€ã€€ä¸ºäº†é¿å…è¿™ç§æ½œåœ¨é—®é¢˜ï¼Œé™¤évectorçŸ¥é“å…ƒç´ ç±»å‹çš„ç§»åŠ¨æ„é€ å‡½æ•°ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¦åˆ™åœ¨é‡æ–°åˆ†é…å†…å­˜çš„è¿‡ç¨‹ä¸­ï¼Œå®ƒå°±å¿…é¡»ä½¿ç”¨æ‹·è´æ„é€ å‡½æ•°è€Œä¸æ˜¯ç§»åŠ¨æ„é€ å‡½æ•°ã€‚å¦‚æœå¸Œæœ›åœ¨vectoré‡æ–°åˆ†é…å†…å­˜è¿™ç±»æƒ…å†µä¸‹å¯¹æˆ‘ä»¬è‡ªå®šä¹‰ç±»å‹çš„å¯¹è±¡è¿›è¡Œç§»åŠ¨è€Œä¸æ˜¯æ‹·è´ï¼Œå°±å¿…é¡»æ˜¾å¼åœ°å‘Šè¯‰æ ‡å‡†åº“æˆ‘ä»¬çš„ç§»åŠ¨æ„é€ å‡½æ•°å¯ä»¥å®‰å…¨ä½¿ç”¨ã€‚æˆ‘ä»¬é€šè¿‡å°†ç§»åŠ¨æ„é€ å‡½æ•°ï¼ˆåŠç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ï¼‰æ ‡è®°ä¸ºnoexceptæ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚</p><h2 id="å‚è€ƒ"><a class="markdownIt-Anchor" href="#å‚è€ƒ"></a> å‚è€ƒ</h2><ul><li>C++ Primer ä¸­æ–‡ç‰ˆ</li></ul>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å†™ä¸€ä¸ªæ­»é”</title>
    <link href="/2021/12/12/%E5%86%99%E4%B8%80%E4%B8%AA%E6%AD%BB%E9%94%81/"/>
    <url>/2021/12/12/%E5%86%99%E4%B8%80%E4%B8%AA%E6%AD%BB%E9%94%81/</url>
    
    <content type="html"><![CDATA[<h2 id="ä»£ç è¯´æ˜"><a class="markdownIt-Anchor" href="#ä»£ç è¯´æ˜"></a> ä»£ç è¯´æ˜</h2><p><strong>è¿™æ˜¯æ¸¸åŒçš„ã€ŠLinuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹ã€‹ç¬¬ 14 ç« ç¬¬ 5 èŠ‚ä¸­çš„ä»£ç ç¤ºä¾‹ï¼Œæˆ‘ç”¨ C++11 æ”¹å†™äº†ä¸€ä¸‹ã€‚</strong></p><blockquote><p>ä¸»çº¿ç¨‹è¯•å›¾å…ˆå æœ‰äº’æ–¥é” mutex_aï¼Œç„¶åæ“ä½œè¢«è¯¥é”ä¿æŠ¤çš„å˜é‡ aï¼Œä½†æ“ä½œå®Œæ¯•ä¹‹åï¼Œä¸»çº¿ç¨‹å¹¶æ²¡æœ‰ç«‹å³é‡Šæ”¾äº’æ–¥é” mutex_aï¼Œè€Œæ˜¯åˆç”³è¯·äº’æ–¥ mutex_bï¼Œå¹¶åœ¨ä¸¤ä¸ªäº’æ–¥é”çš„ä¿æŠ¤ä¸‹ï¼Œæ“ä½œå˜é‡ a å’Œ bï¼Œæœ€åæ‰ä¸€èµ·é‡Šæ”¾è¿™ä¸¤ä¸ªäº’æ–¥é”ï¼›ä¸æ­¤åŒæ—¶ï¼Œå­çº¿ç¨‹åˆ™æŒ‰ç…§ç›¸åçš„é¡ºåºæ¥ç”³è¯·äº’æ–¥é”mutex_aï¼Œ mutex_bï¼Œå¹¶åœ¨ä¸¤ä¸ªé”çš„ä¿æŠ¤ä¸‹æ“ä½œå˜é‡ a å’Œ bã€‚æˆ‘ä»¬ç”¨sleepå‡½æ•°æ¥æ¨¡æ‹Ÿè¿ç»­ä¸¤æ¬¡è°ƒç”¨ pthread_mutex_lock ä¹‹é—´çš„æ—¶é—´å·®ï¼Œä»¥ç¡®ä¿ä»£ç çš„ä¸¤ä¸ªçº¿ç¨‹å„è‡ªå…ˆå æœ‰ä¸€ä¸ªäº’æ–¥é”ï¼ˆä¸»çº¿ç¨‹å æœ‰ mutex_aï¼Œå­çº¿ç¨‹å æœ‰ mutex_bï¼‰ï¼Œç„¶åç­‰å¾…å¦å¤–ä¸€ä¸ªäº’æ–¥é”ï¼ˆä¸»çº¿ç¨‹ç­‰å¾… mutex_bï¼Œå­çº¿ç¨‹ç­‰å¾… mutex_aï¼‰ã€‚è¿™æ ·ï¼Œä¸¤ä¸ªçº¿ç¨‹å°±åƒµæŒä½äº†ï¼Œè°éƒ½ä¸èƒ½ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œä»è€Œå½¢æˆæ­»é”ã€‚å¦‚æœä»£ç ä¸­ä¸åŠ å…¥ sleep å‡½æ•°ï¼Œåˆ™è¿™æ®µä»£ç æˆ–è®¸æ€»èƒ½æˆåŠŸåœ°è¡Œï¼Œä»è€Œä¸ºç¨‹åºç•™ä¸‹äº†ä¸€ä¸ªæ½œåœ¨çš„BUGã€‚</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;ostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thread&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br>std::mutex mtx_a;<br>std::mutex mtx_b;<br><br><span class="hljs-type">int</span> a = <span class="hljs-number">0</span>;<br><span class="hljs-type">int</span> b = <span class="hljs-number">0</span>;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">thread_work</span><span class="hljs-params">()</span> </span>&#123;<br><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;son want mutex b&quot;</span> &lt;&lt; std::endl;<br>    mtx_b.<span class="hljs-built_in">lock</span>();<br>    b++;<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;son got mutex b, now b is: &quot;</span> &lt;&lt; b &lt;&lt; std::endl;<br>    <br>    std::cout &lt;&lt; <span class="hljs-string">&quot;son want mutex a&quot;</span> &lt;&lt; std::endl;<br>    mtx_a.<span class="hljs-built_in">lock</span>();<br>    a += b;<br>    mtx_a.<span class="hljs-built_in">unlock</span>();<br>    mtx_b.<span class="hljs-built_in">unlock</span>();<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;father want mutex a&quot;</span> &lt;&lt; std::endl;<br>    mtx_a.<span class="hljs-built_in">lock</span>();<br>    a++;<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;father got mutex a, now a is: &quot;</span> &lt;&lt; a &lt;&lt; std::endl;<br><br>    <span class="hljs-function">std::thread <span class="hljs-title">son</span><span class="hljs-params">(thread_work)</span></span>;<br>    <br>    <span class="hljs-built_in">sleep</span>(<span class="hljs-number">1</span>);<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;father want mutex b&quot;</span> &lt;&lt; std::endl;<br>    mtx_b.<span class="hljs-built_in">lock</span>();<br>    b += a;<br>    mtx_b.<span class="hljs-built_in">unlock</span>();<br>    mtx_a.<span class="hljs-built_in">unlock</span>();<br><br>    son.<span class="hljs-built_in">join</span>();<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ç¼–è¯‘è¿è¡Œ"><a class="markdownIt-Anchor" href="#ç¼–è¯‘è¿è¡Œ"></a> ç¼–è¯‘è¿è¡Œ</h2><p>å› ä¸ºç”¨åˆ°äº†çº¿ç¨‹åº“ï¼Œç¼–è¯‘æ—¶éœ€è¦é“¾æ¥ pthread åº“</p><p><code>g++ -o &lt;è¾“å‡ºçš„å¯æ‰§è¡Œç¨‹åºæ–‡ä»¶å&gt; &lt;æºæ–‡ä»¶å&gt; -lpthread</code></p><h2 id="å‚è€ƒ"><a class="markdownIt-Anchor" href="#å‚è€ƒ"></a> å‚è€ƒ</h2><ul><li>ã€ŠLinuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹ã€‹</li></ul>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å…¸å‹å®ç°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>çˆ¶å­è¿›ç¨‹é€šè¿‡ pipe() ç®¡é“é€šä¿¡æ—¶ä¸€æ–¹éœ€å…³é—­è¯»ç«¯å¦ä¸€æ–¹éœ€å…³é—­å†™ç«¯</title>
    <link href="/2021/12/11/%E7%88%B6%E5%AD%90%E8%BF%9B%E7%A8%8B%E9%80%9A%E8%BF%87%20pipe()%20%E7%AE%A1%E9%81%93%E9%80%9A%E4%BF%A1%E6%97%B6%E4%B8%80%E6%96%B9%E9%9C%80%E5%85%B3%E9%97%AD%E8%AF%BB%E7%AB%AF%E5%8F%A6%E4%B8%80%E6%96%B9%E9%9C%80%E5%85%B3%E9%97%AD%E5%86%99%E7%AB%AF/"/>
    <url>/2021/12/11/%E7%88%B6%E5%AD%90%E8%BF%9B%E7%A8%8B%E9%80%9A%E8%BF%87%20pipe()%20%E7%AE%A1%E9%81%93%E9%80%9A%E4%BF%A1%E6%97%B6%E4%B8%80%E6%96%B9%E9%9C%80%E5%85%B3%E9%97%AD%E8%AF%BB%E7%AB%AF%E5%8F%A6%E4%B8%80%E6%96%B9%E9%9C%80%E5%85%B3%E9%97%AD%E5%86%99%E7%AB%AF/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h2><p>å‰ä¸¤å¤©åœ¨çœ‹æ¸¸åŒçš„ã€ŠLinuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹ã€‹æ—¶æ³¨æ„åˆ°ä¸‹é¢è¿™æ®µè¯ï¼š</p><blockquote><p>ç®¡é“èƒ½åœ¨çˆ¶ã€å­è¿›ç¨‹é—´ä¼ é€’æ•°æ®ï¼Œåˆ©ç”¨çš„æ˜¯forkè°ƒç”¨ä¹‹åä¸¤ä¸ªç®¡é“æ–‡ä»¶æè¿°ç¬¦ï¼ˆfd[0]å’Œfd[1]ï¼‰éƒ½ä¿æŒæ‰“å¼€ã€‚ä¸€å¯¹è¿™æ ·çš„æ–‡ä»¶æè¿°ç¬¦åªèƒ½ä¿è¯çˆ¶ã€å­è¿›ç¨‹é—´ä¸€ä¸ªæ–¹å‘çš„æ•°æ®ä¼ è¾“ï¼Œçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹å¿…é¡»æœ‰ä¸€ä¸ªå…³é—­fd[0]ï¼Œå¦ä¸€ä¸ªå…³é—­fd[1]ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨ç®¡é“å®ç°ä»çˆ¶è¿›ç¨‹å‘å­è¿›ç¨‹å†™æ•°æ®ï¼Œå°±åº”è¯¥æŒ‰ç…§å›¾13-1æ‰€ç¤ºæ¥æ“ä½œã€‚</p></blockquote><p><img src="/img/blog_pic/2021/%E7%88%B6%E8%BF%9B%E7%A8%8B%E9%80%9A%E8%BF%87%E7%AE%A1%E9%81%93%E5%90%91%E5%AD%90%E8%BF%9B%E7%A8%8B%E5%86%99%E6%95%B0%E6%8D%AE.png" alt="çˆ¶è¿›ç¨‹é€šè¿‡ç®¡é“å‘å­è¿›ç¨‹å†™æ•°æ®" /></p><p>æœ‰ä¸€äº›æ€è€ƒï¼š</p><ul><li><p><strong>Q1: ä¸ºä»€ä¹ˆä¸€æ–¹éœ€å…³é—­è¯»ç«¯å¦ä¸€æ–¹éœ€å…³é—­å†™ç«¯ï¼Ÿä¸å…³é—­ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</strong></p></li><li><p><strong>Q2: åŒæ–¹éƒ½è®©è¯»å†™ç«¯åŒæ—¶æ‰“å¼€ï¼Œèƒ½å¦å®ç°åŒå‘é€šä¿¡ï¼Ÿ</strong></p></li></ul><h2 id="æ–‡ä»¶åœ¨å†…æ ¸ä¸­çš„è¡¨ç¤º"><a class="markdownIt-Anchor" href="#æ–‡ä»¶åœ¨å†…æ ¸ä¸­çš„è¡¨ç¤º"></a> æ–‡ä»¶åœ¨å†…æ ¸ä¸­çš„è¡¨ç¤º</h2><p>æ–‡ä»¶åœ¨å†…æ ¸ä¸­ç”±ä¸€äº›æ•°æ®ç»“æ„è¡¨ç¤ºï¼Œä¸»è¦æ˜¯ä»¥ä¸‹ä¸‰ä¸ªè¡¨ï¼š</p><ul><li>æè¿°ç¬¦è¡¨(descriptor table)ã€‚æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰å®ƒç‹¬ç«‹çš„æè¿°ç¬¦è¡¨ï¼Œå®ƒçš„è¡¨é¡¹æ˜¯ç”±è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æ¥ç´¢å¼•çš„ã€‚æ¯ä¸ªæ‰“å¼€çš„æè¿°ç¬¦è¡¨é¡¹æŒ‡å‘æ–‡ä»¶è¡¨ä¸­çš„ä¸€ä¸ªè¡¨é¡¹ã€‚</li><li>æ–‡ä»¶è¡¨(file table)ã€‚æ‰“å¼€æ–‡ä»¶çš„é›†åˆæ˜¯ç”±ä¸€å¼ æ–‡ä»¶è¡¨æ¥è¡¨ç¤ºçš„ï¼Œæ‰€æœ‰çš„è¿›ç¨‹å…±äº«è¿™å¼ è¡¨ã€‚æ¯ä¸ªæ–‡ä»¶è¡¨çš„è¡¨é¡¹ç»„æˆ(é’ˆå¯¹æˆ‘ä»¬çš„ç›®çš„)åŒ…æ‹¬å½“å‰çš„æ–‡ä»¶ä½ç½®ã€å¼•ç”¨è®¡æ•°(reference count)(å³å½“å‰æŒ‡å‘è¯¥è¡¨é¡¹çš„æè¿°ç¬¦è¡¨é¡¹æ•°)ï¼Œä»¥åŠä¸€ä¸ªæŒ‡å‘v-nodeè¡¨ä¸­å¯¹åº”è¡¨é¡¹çš„æŒ‡é’ˆã€‚å…³é—­ä¸€ä¸ªæè¿°ç¬¦ä¼šå‡å°‘ç›¸åº”çš„æ–‡ä»¶è¡¨è¡¨é¡¹ä¸­çš„å¼•ç”¨è®¡æ•°ã€‚å†…æ ¸ä¸ä¼šåˆ é™¤è¿™ä¸ªæ–‡ä»¶è¡¨è¡¨é¡¹ï¼Œç›´åˆ°å®ƒçš„å¼•ç”¨è®¡æ•°ä¸ºé›¶ã€‚</li><li>v-nodeè¡¨(v-node table)ã€‚åŒæ–‡ä»¶è¡¨ä¸€æ ·ï¼Œæ‰€æœ‰çš„è¿›ç¨‹å…±äº«è¿™å¼ v-nodeè¡¨ã€‚æ¯ä¸ªè¡¨é¡¹åŒ…å«statç»“æ„ä¸­çš„å¤§å¤šæ•°ä¿¡æ¯ï¼ŒåŒ…æ‹¬st_modeå’Œ st_sizeæˆå‘˜ã€‚</li></ul><p><img src="/img/blog_pic/2021/%E6%89%93%E5%BC%80%E6%96%87%E4%BB%B6%E7%9A%84%E5%86%85%E6%A0%B8%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E8%A1%A8%E7%A4%BA.png" alt="æ‰“å¼€æ–‡ä»¶çš„å†…æ ¸æ•°æ®ç»“æ„è¡¨ç¤º" /></p><h2 id="pipe"><a class="markdownIt-Anchor" href="#pipe"></a> pipe()</h2><p>pipeåœ¨å†…æ ¸ä¸­åˆ›å»ºä¸€ä¸ªåŒ¿åç®¡é“(å†…æ ¸å†…å­˜ä¸­ç»´æŠ¤çš„ç¼“å†²å™¨)ï¼Œå€ŸåŠ©è¿™ä¸ªåŒ¿åç®¡é“è¯»å†™æ•°æ®å®ç°ä¸¤ä¸ªè¿›ç¨‹é€šä¿¡ã€‚</p><p><strong>å…³äºåŒ¿åç®¡é“ä¸æœ‰åç®¡é“ï¼š</strong></p><blockquote><ul><li>åŒ¿åç®¡é“æ²¡æœ‰æ–‡ä»¶å®ä½“ï¼Œæ²¡æœ‰åå­—ï¼Œåˆ›å»ºååªèƒ½è®©æœ‰è¡€ç¼˜å…³ç³»è¿›ç¨‹è·å¾—ï¼›æœ‰åç®¡é“(FIFO)æœ‰æ–‡ä»¶å®ä½“ï¼Œä½†ä¸å­˜å‚¨æ•°æ®ã€‚å¯ä»¥æŒ‰ç…§æ“ä½œæ–‡ä»¶çš„æ–¹å¼å¯¹ç®¡é“è¿›è¡Œæ“ä½œã€‚</li><li>FIFO åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ä½œä¸ºä¸€ä¸ªç‰¹æ®Šæ–‡ä»¶å­˜åœ¨ï¼Œä½† FIFO ä¸­çš„å†…å®¹å´å­˜æ”¾åœ¨å†…å­˜ä¸­ã€‚æœ‰åç®¡é“ï¼ˆFIFOï¼‰ä¸åŒäºåŒ¿åç®¡é“ä¹‹å¤„åœ¨äºå®ƒæä¾›äº†ä¸€ä¸ªè·¯å¾„åä¸ä¹‹å…³è”ï¼Œä»¥ FIFO çš„æ–‡ä»¶å½¢å¼å­˜åœ¨äºæ–‡ä»¶ç³»ç»Ÿä¸­ã€‚FIFO æœ‰åå­—ï¼Œä¸ç›¸å…³çš„è¿›ç¨‹å¯ä»¥é€šè¿‡æ‰“å¼€æœ‰åç®¡é“è¿›è¡Œé€šä¿¡ã€‚</li></ul></blockquote><p>çˆ¶è¿›ç¨‹é€šè¿‡ pipe() å¼€è¾Ÿå‡ºåŒ¿åç®¡é“åè°ƒç”¨ fork() åˆ›å»ºå‡ºå­è¿›ç¨‹ï¼Œç”±äºå­è¿›ç¨‹å…±äº«çˆ¶è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶æ‰€ä»¥å­è¿›ç¨‹ä¹ŸæŒæœ‰è¿™æ¡ç®¡é“ã€‚</p><p><img src="/img/blog_pic/2021/%E5%AD%90%E8%BF%9B%E7%A8%8B%E5%A6%82%E4%BD%95%E7%BB%A7%E6%89%BF%E7%88%B6%E8%BF%9B%E7%A8%8B%E6%89%93%E5%BC%80%E7%9A%84%E6%96%87%E4%BB%B6.png" alt="å­è¿›ç¨‹å¦‚ä½•ç»§æ‰¿çˆ¶è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶" /></p><p><img src="/img/blog_pic/2021/%E7%88%B6%E5%AD%90%E8%BF%9B%E7%A8%8B%E5%85%B1%E4%BA%AB%E5%8C%BF%E5%90%8D%E7%AE%A1%E9%81%93.png" alt="çˆ¶å­è¿›ç¨‹å…±äº«åŒ¿åç®¡é“" /></p><h2 id="ä¸å…³é—­ä¼šæœ‰ä»€ä¹ˆé—®é¢˜"><a class="markdownIt-Anchor" href="#ä¸å…³é—­ä¼šæœ‰ä»€ä¹ˆé—®é¢˜"></a> ä¸å…³é—­ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h2><blockquote><p>ç®¡é“çš„è¯»å†™æ˜¯æ˜¯ç¬¦åˆç”Ÿäº§è€…â€“æ¶ˆè´¹è€…æ¨¡å‹ã€‚å†™å…¥å†…å®¹å¯¹åº”äºç”Ÿäº§å†…å®¹ï¼›è¯»å–ç®¡é“å¯¹åº”äºæ¶ˆè´¹å†…å®¹ã€‚å½“æ‰€æœ‰çš„ç”Ÿäº§è€…éƒ½é€€åœºä»¥åï¼Œæ¶ˆè´¹è€…åº”å½“æœ‰æ–¹æ³•åˆ¤æ–­è¿™ç§æƒ…å†µï¼Œè€Œä¸æ˜¯å‚»å‚»ç­‰å¾…å·²ç»ä¸å­˜åœ¨çš„ç”Ÿäº§è€…ç»§ç»­ç”Ÿäº§ï¼Œä»¥è‡³äºé™·å…¥æ°¸ä¹…çš„é˜»å¡ã€‚</p></blockquote><blockquote><p>å½“å¯¹ç®¡é“çš„è¯»å–ç«¯è°ƒç”¨readå‡½æ•°(é»˜è®¤æ˜¯é˜»å¡çš„)è¿”å›0 æ—¶ï¼Œå°±æ„å‘³ç€æ‰€æœ‰çš„ç”Ÿäº§è€…éƒ½å·²ç»é€€åœºäº†ï¼Œä½œä¸ºæ¶ˆè´¹è€…çš„è¯»å–è¿›ç¨‹ï¼Œå°±ä¸éœ€è¦ç»§ç»­ç­‰å¾…æ–°çš„å†…å®¹äº†ã€‚ä»€ä¹ˆæƒ…å†µä¸‹å¯¹ç®¡é“è¯»å–ç«¯çš„æè¿°ç¬¦è°ƒç”¨readä¼šè¿”å›0å‘¢ï¼ŸåŒæ—¶æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶ï¼Œå¯¹ç®¡é“è¯»å–ç«¯æè¿°ç¬¦è°ƒç”¨readè¿”å›å€¼å°±æ˜¯0</p><ol><li>æ‰€æœ‰çš„ç›¸å…³è¿›ç¨‹éƒ½å·²ç»å…³é—­äº†ç®¡é“çš„å†™å…¥ç«¯æè¿°ç¬¦</li><li>ç®¡é“ä¸­çš„å·²æœ‰å†…å®¹å·²ç»è¢«å…¨éƒ¨è¯»å–</li></ol></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cerrno&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdlib&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;ostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/socket.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/wait.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><br><span class="hljs-keyword">using</span> std::cout;<br><span class="hljs-keyword">using</span> std::endl;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span> <span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> fd[<span class="hljs-number">2</span>];<br>    <span class="hljs-type">int</span> r = <span class="hljs-built_in">pipe</span>(fd);<br>    <span class="hljs-keyword">if</span> (r == <span class="hljs-number">-1</span>)&#123;<br>        <span class="hljs-built_in">perror</span>(<span class="hljs-string">&quot;åˆ›å»ºç®¡é“å¤±è´¥&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (fork())&#123; <span class="hljs-comment">// çˆ¶è¿›ç¨‹</span><br>        <span class="hljs-type">int</span> val = <span class="hljs-number">0</span>;<br>        <span class="hljs-built_in">close</span>(fd[<span class="hljs-number">0</span>]); <span class="hljs-comment">// å…³é—­è¯»ç«¯</span><br>        <span class="hljs-type">int</span> times = <span class="hljs-number">3</span>;<br>        <span class="hljs-keyword">while</span> (times--)&#123;<br>            <span class="hljs-built_in">sleep</span>(<span class="hljs-number">1</span>);<br>            ++val;<br>            <span class="hljs-built_in">write</span>(fd[<span class="hljs-number">1</span>], &amp;val, <span class="hljs-built_in">sizeof</span>(val));<br>            cout &lt;&lt; <span class="hljs-string">&quot;çˆ¶è¿›ç¨‹å‘é€æ•°æ®: &quot;</span> &lt;&lt; val &lt;&lt; endl;<br>        &#125;<br>        <span class="hljs-built_in">close</span>(fd[<span class="hljs-number">1</span>]); <span class="hljs-comment">// å…³é—­å†™ç«¯</span><br>        <span class="hljs-built_in">wait</span>(<span class="hljs-literal">nullptr</span>); <span class="hljs-comment">// é˜»å¡ç­‰å¾…å­è¿›ç¨‹é€€å‡º</span><br>        cout &lt;&lt; <span class="hljs-string">&quot;çˆ¶è¿›ç¨‹ç»“æŸ&quot;</span> &lt;&lt; endl;<br>    &#125; <span class="hljs-keyword">else</span> &#123; <span class="hljs-comment">// å­è¿›ç¨‹</span><br>        <span class="hljs-type">int</span> val;<br>        <span class="hljs-built_in">close</span>(fd[<span class="hljs-number">1</span>]); <span class="hljs-comment">// å…³é—­å†™ç«¯</span><br>        <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)&#123;<br>            cout &lt;&lt; <span class="hljs-string">&quot;å­è¿›ç¨‹é˜»å¡åœ¨ read() ç­‰å¾…æ¥æ”¶æ•°æ®&quot;</span> &lt;&lt; endl;<br>            <span class="hljs-type">int</span> result = <span class="hljs-built_in">read</span>(fd[<span class="hljs-number">0</span>], &amp;val, <span class="hljs-built_in">sizeof</span>(val));<br>            <span class="hljs-keyword">if</span> (result == <span class="hljs-number">0</span>) &#123;<br>                cout &lt;&lt; <span class="hljs-string">&quot;å­è¿›ç¨‹å‘ç°æ— æ•°æ®å¯è¯»ä¸”æ²¡æœ‰è¿›ç¨‹æŒæœ‰å†™ç«¯çš„ fdï¼Œé€€å‡º read&quot;</span> &lt;&lt; endl;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>            <span class="hljs-keyword">else</span> cout &lt;&lt; <span class="hljs-string">&quot;å­è¿›ç¨‹æˆåŠŸæ¥æ”¶&quot;</span> &lt;&lt; result &lt;&lt; <span class="hljs-string">&quot;å­—èŠ‚æ•°æ®: &quot;</span> &lt;&lt; val &lt;&lt; endl; <br>        &#125;<br>        cout &lt;&lt; <span class="hljs-string">&quot;å­è¿›ç¨‹é€€å‡ºå¾ªç¯&quot;</span> &lt;&lt; endl;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨é‡Šæ‰ç¬¬ 39 è¡Œï¼Œç¨‹åºè¿è¡Œç»“æœï¼šçœ‹åˆ°å­è¿›ç¨‹ä¸€ç›´é˜»å¡åœ¨ read ()ï¼Œçˆ¶è¿›ç¨‹çš„ wait() ç”±äºå­è¿›ç¨‹ä¸€ç›´é˜»å¡ä¹Ÿä¸èƒ½å®Œæˆã€‚æœ€åéœ€è¦ ctrl + c æ‰‹åŠ¨å…³é—­</p><p><img src="/img/blog_pic/2021/read%E9%98%BB%E5%A1%9E.png" alt="" /></p><p>æ‰“å¼€ç¬¬ 39 è¡Œï¼Œç¨‹åºè¿è¡Œç»“æœï¼šå­è¿›ç¨‹å‘ç°æ— æ•°æ®å¯è¯»ä¸”æ²¡æœ‰è¿›ç¨‹æŒæœ‰å†™ç«¯çš„ fdï¼Œé€€å‡º read()ï¼Œçˆ¶è¿›ç¨‹çš„ wait() æˆåŠŸå›æ”¶å­è¿›ç¨‹åé€€å‡º</p><p><img src="/img/blog_pic/2021/read%E8%BF%94%E5%9B%9E.png" alt="" /></p><h2 id="çˆ¶å­è¿›ç¨‹åŒæ—¶æ‰“å¼€è¯»å†™ç«¯èƒ½å¦å®ç°åŒå‘é€šä¿¡"><a class="markdownIt-Anchor" href="#çˆ¶å­è¿›ç¨‹åŒæ—¶æ‰“å¼€è¯»å†™ç«¯èƒ½å¦å®ç°åŒå‘é€šä¿¡"></a> çˆ¶å­è¿›ç¨‹åŒæ—¶æ‰“å¼€è¯»å†™ç«¯ï¼Œèƒ½å¦å®ç°åŒå‘é€šä¿¡ï¼Ÿ</h2><p>ä¸èƒ½ï¼Œä¼šæœ‰æŠ¢æ•°æ®é—®é¢˜ã€‚è¿›ç¨‹è¢«è°ƒåº¦æ˜¯æ— è§„å¾‹çš„ï¼ŒåŒæ–¹éƒ½è¯»å†™çš„è¯æ— æ³•ä¿è¯ä¸€ä¸ªå†™è¿›ç¨‹å†™å®Œæ•°æ®åç«‹å³è°ƒåº¦è¯»è¿›ç¨‹æ¥æ¥æ”¶ï¼Œæ‰€ä»¥è‡ªå·±å†™çš„æ•°æ®å¾ˆå¯èƒ½ä¼šè¢«è‡ªå·±è¯»å–ã€‚</p><h2 id="å‚è€ƒ"><a class="markdownIt-Anchor" href="#å‚è€ƒ"></a> å‚è€ƒ</h2><ul><li><p>ã€ŠLinuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹ã€‹</p></li><li><p>ã€Šæ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿã€‹</p></li><li><p><a href="https://www.cnblogs.com/whiteHome/p/4863516.html">å…³äºpipeç®¡é“çš„è¯»å†™ç«¯å…³é—­é—®é¢˜</a></p></li><li><p><a href="https://www.colourso.top/linux-pipefifo/">Linux è¿›ç¨‹é—´é€šä¿¡â€”â€”åŒ¿åç®¡é“å’Œæœ‰åç®¡é“</a></p></li><li><p><a href="https://blog.csdn.net/m0_50668851/article/details/111565373">linux ç®¡é“å…³é—­æ— ç”¨çš„å†™å…¥ç«¯</a></p></li></ul>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>IPC</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å°†ä¸€ä¸ª makefile é¡¹ç›®è½¬åŒ–ä¸º CMake é¡¹ç›®</title>
    <link href="/2021/12/05/%E5%B0%86%E4%B8%80%E4%B8%AA%20makefile%20%E9%A1%B9%E7%9B%AE%E8%BD%AC%E5%8C%96%E4%B8%BA%20CMake%20%E9%A1%B9%E7%9B%AE/"/>
    <url>/2021/12/05/%E5%B0%86%E4%B8%80%E4%B8%AA%20makefile%20%E9%A1%B9%E7%9B%AE%E8%BD%AC%E5%8C%96%E4%B8%BA%20CMake%20%E9%A1%B9%E7%9B%AE/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h2><p>åœ¨ GitHub çœ‹åˆ°ä¸€ä¸ª <a href="https://github.com/qinguoyi/TinyWebServer">Web æœåŠ¡å™¨é¡¹ç›®</a>ï¼Œæƒ³ç”¨æ¥å›é¡¾ä¸€ä¸‹ç½‘ç»œç¼–ç¨‹æ–¹é¢çš„çŸ¥è¯†ã€‚å‘ç°è¿™æ˜¯ä¸€ä¸ªç”± makefile æ„å»ºçš„é¡¹ç›®ï¼Œè€Œç°åœ¨ä¸»æµçš„æ„å»ºæ–¹å¼æ˜¯ CMakeï¼Œæ‰€ä»¥æƒ³å…ˆæŠŠå®ƒè½¬åŒ–ä¸ºä¸€ä¸ª  CMake é¡¹ç›®ã€‚ä¸»è¦æ˜¯æ ¹æ®é¡¹ç›®ç»“æ„ä»¥åŠ makefile æ–‡ä»¶ç¼–å†™ CMakeLists.txtã€‚</p><h2 id="å‡†å¤‡å·¥ä½œ"><a class="markdownIt-Anchor" href="#å‡†å¤‡å·¥ä½œ"></a> å‡†å¤‡å·¥ä½œ</h2><ul><li>åœ¨ Linux ä¸­å®‰è£… MySQLï¼Œæ¨èåœ¨ docker ä¸­å®‰è£…ã€‚ï¼ˆè¸©å‘ï¼šä¸€å¼€å§‹æ˜¯ç›´æ¥åœ¨ Linux ä¸­å®‰è£…ï¼Œåæ¥æƒ³æ”¹æˆ docker å®‰è£…ï¼Œåœ¨ docker ä¸­å®‰è£…åå¯åŠ¨æ—¶æŠ¥é”™ç«¯å£è¢«å ç”¨å’Œä¸€ä¸ªåˆ«çš„é”™è¯¯ï¼Œæœ€åå‘ç°æ˜¯ä¸€å¼€å§‹ç›´æ¥å®‰è£…çš„ MySQL å’Œ docker ä¸­çš„å†²çªçš„ï¼ŒåŸæ¥çš„ mysqld è¿›ç¨‹ä¸€ç›´å ç”¨ç€ 3306 ç«¯å£ï¼Œ kill -9 ä¹Ÿæ€ä¸æ‰ï¼Œæœ€åæŠŠç›´æ¥å®‰è£…çš„ MySQL å¸è½½å¹²å‡€äº†æ‰èƒ½é¡ºåˆ©å¯åŠ¨ docker ä¸­çš„ MySQLï¼‰</li><li>å®‰è£… mysql å¼€å‘åº“ï¼šsudo apt-get install libmysqlclient-dev ï¼ˆå®‰è£…åœ¨ /usr/include/mysql ç›®å½•ä¸‹ï¼‰</li></ul><h2 id="é¡¹ç›®ç»“æ„"><a class="markdownIt-Anchor" href="#é¡¹ç›®ç»“æ„"></a> é¡¹ç›®ç»“æ„</h2><p>è¿™ä¸ªé¡¹ç›®æœ‰ä¸‰ä¸ªåˆ†æ”¯ï¼Œæˆ‘é€‰æ‹©ä» raw_version åˆ†æ”¯å…¥æ‰‹ã€‚è¯¥åˆ†æ”¯çš„é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="/img/blog_pic/2021/makefile%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84.png" alt="" /></p><p>æœ‰äº›æ¨¡å—çš„æ¥å£å®šä¹‰ï¼ˆ.hï¼‰å’Œå®ç°ï¼ˆ.cppï¼‰åˆ†ç¦»äº†è€Œæœ‰äº›æ¨¡å—æ²¡æœ‰ï¼Œä¸ªäººè§‰å¾—è¿™æ˜¯ä¸€ä¸ªä¸å¤Ÿè§„èŒƒçš„åœ°æ–¹ã€‚makefile æ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">server: main.c \</span><br>./threadpool/threadpool.h \<br>./http/http_conn.cpp ./http/http_conn.h \<br>./lock/locker.h ./log/log.cpp ./log/log.h ./log/block_queue.h \<br>./CGImysql/sql_connection_pool.cpp ./CGImysql/sql_connection_pool.h<br><br>g++ -o server \<br>main.c \<br>./threadpool/threadpool.h \<br>./http/http_conn.cpp ./http/http_conn.h \<br>./lock/locker.h ./log/log.cpp ./log/log.h \<br>./CGImysql/sql_connection_pool.cpp ./CGImysql/sql_connection_pool.h \<br>-lpthread -lmysqlclient<br><br><br><span class="hljs-section">clean:</span><br>rm  -r server<br></code></pre></td></tr></table></figure><p>æ€»ä½“æ¥è¯´æ˜¯æ¯”è¾ƒç®€å•çš„ã€‚è¿™é‡Œå°†ä¸€äº›å¤´æ–‡ä»¶ï¼ˆ.hï¼‰ä¹Ÿä¸€å¹¶åŠ å…¥ï¼Œæˆ‘å°è¯•è¿‡å»æ‰è¿™äº›å¤´æ–‡ä»¶ååŒæ ·èƒ½æ­£å¸¸ç¼–è¯‘è¿è¡Œã€‚</p><h2 id="ç¼–å†™-cmakeliststxt"><a class="markdownIt-Anchor" href="#ç¼–å†™-cmakeliststxt"></a> ç¼–å†™ CMakeLists.txt</h2><p>é¦–å…ˆæ–°å»ºäº† <code>include</code> æ–‡ä»¶å¤¹ï¼Œåœ¨å…¶ä¸­æ”¾ç½®å„ä¸ªæ¨¡å—çš„å¤´æ–‡ä»¶ï¼Œå®šä¹‰å’Œå®ç°æ²¡æœ‰åˆ†ç¦»çš„ä¹Ÿä¸€å¹¶æ”¾å…¥å…¶ä¸­ã€‚æ­¤æ—¶é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="/img/blog_pic/2021/cmake%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84.png" alt="" /></p><p>æ ¹æ®æ­¤æ—¶çš„é¡¹ç›®ç»“æ„ï¼Œç»“åˆå·²æœ‰çš„ makefile æ–‡ä»¶ç¼–å†™ CMakeLists.txt å¦‚ä¸‹ï¼š</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">cmake_minimum_required</span>(VERSION <span class="hljs-number">3.0</span>) <br><br><span class="hljs-keyword">project</span>(WebServerCmake)<br><br><span class="hljs-keyword">set</span>(CMAKE_BUILD_TYPE Debug)<br><span class="hljs-keyword">set</span>(CMAKE_CXX_FLAGS <span class="hljs-string">&quot;$&#123;CMAKE_CXX_FLAGS&#125; -g&quot;</span>)<br><br><span class="hljs-keyword">set</span>(path <span class="hljs-variable">$&#123;CMAKE_SOURCE_DIR&#125;</span>)<br><br><span class="hljs-comment"># å¼•å…¥å¤´æ–‡ä»¶æœç´¢ç›®å½•</span><br><span class="hljs-keyword">include_directories</span>(<span class="hljs-variable">$&#123;path&#125;</span>/<span class="hljs-keyword">include</span>)<br><br><span class="hljs-comment"># ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆæ¯”èµ·åŸæ¥çš„ makefile å°‘äº†ä¸€äº› .h å¤´æ–‡ä»¶ï¼‰</span><br><span class="hljs-keyword">add_executable</span>(WebServerCmake<br>        main.cpp<br>        CGImysql/sql_connection_pool.cpp<br>        log/log.cpp<br>        http/http_conn.cpp)<br><br><span class="hljs-comment"># é“¾æ¥åŠ¨æ€åº“ï¼Œå¯¹åº”äºåŸ makefile ä¸­çš„ -lpthread -lmysqlclient</span><br><span class="hljs-keyword">target_link_libraries</span>(WebServerCmake libmysqlclient.so)<br><span class="hljs-keyword">target_link_libraries</span>(WebServerCmake libpthread.so)<br></code></pre></td></tr></table></figure><p>è¿˜éœ€è¦ä¿®æ”¹ä¸€ä¸‹ä¿®æ”¹åæ–‡ä»¶çš„ #include è·¯å¾„ï¼›ä¹‹åè¿è¡Œä¸‹é¢çš„å‘½ä»¤åå°±å¯ä»¥æ„å»ºå¹¶è¿è¡Œé¡¹ç›®äº†ï¼š</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">mkdir build &amp;&amp; <span class="hljs-keyword">cd</span> build<br>cmake <span class="hljs-string">..</span><br>make<br><span class="hljs-string">./WebServerCmake</span> 1256<br></code></pre></td></tr></table></figure><h2 id="åœ¨-vscode-ä¸­è¿è¡Œå¹¶è°ƒè¯•é¡¹ç›®"><a class="markdownIt-Anchor" href="#åœ¨-vscode-ä¸­è¿è¡Œå¹¶è°ƒè¯•é¡¹ç›®"></a> åœ¨ vscode ä¸­è¿è¡Œå¹¶è°ƒè¯•é¡¹ç›®</h2><p>ä¸»è¦æ˜¯é…ç½® .vscode æ–‡ä»¶å¤¹ä¸­çš„ launch.json å’Œ tasks.jsonã€‚åœ¨ vscode ä¸­å¯åŠ¨ c++ é¡¹ç›®è°ƒè¯•ä¾¿æ˜¯ä¾é è¿™ä¸¤ä¸ªæ–‡ä»¶çš„é…ç½®</p><p>tasks.json ä¸­çš„å‘½ä»¤ä¼šåœ¨ launch.json ä¸­çš„ å‘½ä»¤ä¹‹å‰å‰æ‰§è¡Œï¼Œå³å¯¹åº”<code>preLaunchTask</code>ï¼Œå¯ä»¥åœ¨ tasks.json ä¸­é…ç½®æ‰§è¡Œ cd build &amp;&amp; cmake â€¦ &amp;&amp; make è¿™äº›å‘½ä»¤</p><p>tasks.json</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span>   <br>    <span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2.0.0&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;options&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;cwd&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;$&#123;workspaceFolder&#125;/build&quot;</span> <span class="hljs-comment">// è¿›å…¥ build æ–‡ä»¶å¤¹</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;tasks&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-comment">// è¿è¡Œ cmake .. å‘½ä»¤</span><br>            <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;shell&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;label&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;cmake&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;command&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;cmake&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;args&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                <span class="hljs-string">&quot;..&quot;</span><br>            <span class="hljs-punctuation">]</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-comment">// è¿è¡Œ make å‘½ä»¤</span><br>            <span class="hljs-attr">&quot;label&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;make&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;group&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;kind&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;build&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;isDefault&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;command&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;make&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;args&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><br>            <span class="hljs-punctuation">]</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;label&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Build&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;dependsOrder&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sequence&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// æŒ‰åˆ—å‡ºçš„é¡ºåºæ‰§è¡Œä»»åŠ¡ä¾èµ–é¡¹</span><br>            <span class="hljs-attr">&quot;dependsOn&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>                <span class="hljs-string">&quot;cmake&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-string">&quot;make&quot;</span><br>            <span class="hljs-punctuation">]</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>launch.json</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs jso">&#123;<br>    &quot;version&quot;: &quot;0.2.0&quot;,<br>    &quot;configurations&quot;: [<br>        &#123;<br>            &quot;name&quot;: &quot;g++ - ç”Ÿæˆå’Œè°ƒè¯•æ´»åŠ¨æ–‡ä»¶&quot;,<br>            &quot;type&quot;: &quot;cppdbg&quot;,<br>            &quot;request&quot;: &quot;launch&quot;,<br>            &quot;program&quot;: &quot;$&#123;workspaceFolder&#125;/build/WebServerCmake&quot;, // å¯æ‰§è¡Œæ–‡ä»¶çš„ä½ç½®<br>            &quot;args&quot;: [<br>                &quot;1256&quot; // å‘½ä»¤è¡Œå¯åŠ¨æ—¶çš„å‚æ•° ./WebServerCmake 1256<br>            ],<br>            &quot;stopAtEntry&quot;: false,<br>            &quot;cwd&quot;: &quot;$&#123;fileDirname&#125;&quot;,<br>            &quot;environment&quot;: [],<br>            &quot;externalConsole&quot;: false,<br>            &quot;MIMode&quot;: &quot;gdb&quot;,<br>            &quot;setupCommands&quot;: [<br>                &#123;<br>                    &quot;description&quot;: &quot;ä¸º gdb å¯ç”¨æ•´é½æ‰“å°&quot;,<br>                    &quot;text&quot;: &quot;-enable-pretty-printing&quot;,<br>                    &quot;ignoreFailures&quot;: true<br>                &#125;<br>            ],<br>            &quot;preLaunchTask&quot;: &quot;Build&quot;, // è¿™é‡Œè¦å’Œ task.json ä¸­ çš„ Build ä¸€è‡´<br>            &quot;miDebuggerPath&quot;: &quot;/usr/bin/gdb&quot;<br>        &#125;<br>    ]<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a class="markdownIt-Anchor" href="#å‚è€ƒ"></a> å‚è€ƒ</h2><ul><li><p><a href="https://www.runoob.com/docker/docker-install-mysql.html">Docker å®‰è£… MySQL</a></p></li><li><p><a href="https://blog.csdn.net/qq_40861091/article/details/89345860">Linuxä¸‹å®‰è£…å®ŒMySQLä¹‹åï¼Œincludeæ–‡ä»¶å¤¹ä¸‹æ²¡æœ‰åŒ…å«mysql.hå¤´æ–‡ä»¶çš„è§£å†³åŠæ³•</a></p></li><li><p><a href="https://blog.csdn.net/zhizhengguan/article/details/107068970">C/C++ç¼–ç¨‹ï¼šCMakeListé“¾æ¥mysqlå‡ºç°/usr/bin/ld: æ‰¾ä¸åˆ° -lmysqlclient</a></p></li><li><p><a href="https://www.bilibili.com/video/BV13K411M78v?from=search&amp;seid=16549448524734942123&amp;spm_id_from=333.337.0.0">æ‰‹æŠŠæ‰‹æ•™ä¼šVSCodeçš„C++ç¯å¢ƒæ­å»ºï¼Œå¤šæ–‡ä»¶ç¼–è¯‘ï¼ŒCmakeï¼Œjsonè°ƒè¯•é…ç½®ï¼ˆ Windowsç¯‡ï¼‰</a></p></li></ul>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CMake</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>nebula-jdbc æ–‡æ¡£</title>
    <link href="/2021/11/19/nebula-jdbc%20%E6%96%87%E6%A1%A3/"/>
    <url>/2021/11/19/nebula-jdbc%20%E6%96%87%E6%A1%A3/</url>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h1><p>è¿™æ˜¯æˆ‘åœ¨å¼€æºä¹‹å¤ Summer 2021 ä¸­è´Ÿè´£çš„<a href="https://summer.iscas.ac.cn/#/org/prodetail/210360225?lang=en">é¡¹ç›®</a>çš„æ–‡æ¡£ï¼Œç›®å‰è¿™ä¸ªé¡¹ç›®å·²ç»é€šè¿‡å¯¼å¸ˆå’Œä¸»åŠæ–¹å®¡æ ¸é¡ºåˆ©ç»“é¡¹å•¦å“ˆå“ˆå“ˆå“ˆå“ˆã€‚ä¸­æœŸæŠ¥å‘Šåœ¨æˆ‘å‰é¢çš„åšå®¢ä¸­ï¼Œä»£ç å·²ç»åˆå¹¶åˆ° <a href="https://www.vesoft.com/cn/">vesoft</a> çš„ Github ä»“åº“ä¸­ï¼Œæºç åŠæ–‡æ¡£è§<a href="https://github.com/vesoft-inc/nebula-jdbc">æ­¤å¤„</a>ã€‚</p><h1 id="nebula-jdbc-æ–‡æ¡£"><a class="markdownIt-Anchor" href="#nebula-jdbc-æ–‡æ¡£"></a> nebula-jdbc æ–‡æ¡£</h1><h2 id="introduction"><a class="markdownIt-Anchor" href="#introduction"></a> Introduction</h2><p>nebula-jdbc æ˜¯åŸºäº <a href="https://github.com/vesoft-inc/nebula-java">nebula-java</a> å°è£…çš„ï¼Œåœ¨å…¶åŸºç¡€ä¸Šå¯¹æ¥äº† JDBC åè®®ï¼Œå®ç° JDBC çš„ç›¸å…³æ¥å£ã€‚æ¯”èµ·  <a href="https://github.com/vesoft-inc/nebula-java">nebula-java</a> ä½ å¯èƒ½æ›´åŠ ç†Ÿæ‚‰  JDBC  çš„ APIï¼Œä½¿ç”¨ nebula-jdbc ä½ å¯ä»¥ä¸å¿…ç†Ÿæ‚‰ <a href="https://github.com/vesoft-inc/nebula-java">nebula-java</a> çš„ API(ç†Ÿæ‚‰çš„è¯ä¼šæ›´å¥½ï¼Œè¿™æ ·ä½ ä¼šç†è§£ä¸ºä»€ä¹ˆæˆ‘ä»¬è¿æ¥å­—ç¬¦ä¸²çš„æ ¼å¼æ˜¯ä¸ºä»€ä¹ˆä¸ä¼ ç»Ÿçš„ JDBC è¿æ¥å­—ç¬¦ä¸²ä¸åŒ)ï¼Œåƒåœ¨ java ç¨‹åºä¸­æ“ä½œå…³ç³»å‹æ•°æ®åº“ä¸€æ ·æ“ä½œ Nebula æœåŠ¡</p><h2 id="architecture"><a class="markdownIt-Anchor" href="#architecture"></a> Architecture</h2><p>nebula-jdbc ä¸»è¦çš„ä¸€äº›ç±»å’Œæ¥å£çš„å…³ç³»å¦‚ä¸‹ï¼š(è“è‰²å®çº¿æ˜¯ç±»ä¹‹é—´çš„ extends å…³ç³»ï¼Œç»¿è‰²å®çº¿æ˜¯æ¥å£ä¹‹é—´çš„ implements å…³ç³»ï¼Œç»¿è‰²è™šçº¿æ˜¯æŠ½è±¡ç±»ä¸æ¥å£ä¹‹é—´çš„ implements å…³ç³»)</p><p><img src="/img/blog_pic/2021/nebula-jdbc%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84.png" alt="nebula-jdbcé¡¹ç›®æ¶æ„" /></p><p>ç”¨æˆ·é¦–å…ˆé€šè¿‡ <code>NebulaDriver</code> æ³¨å†Œé©±åŠ¨ï¼Œå…¶ä¸­æœ‰ <code>NebulaPool</code> å±æ€§ï¼Œç”¨äºè·å– <code>Session</code> ä¸æ•°æ®åº“é€šä¿¡ã€‚<code>NebulaDriver</code> ä¸­æä¾›ä¸‰ä¸ªæ„é€ å‡½æ•°ï¼Œæ— å‚æ„é€ å‡½æ•°æŒ‰ç…§é»˜è®¤å‚æ•°é…ç½® <code>NebulaPool</code>ï¼Œæ¥æ”¶ä¸€ä¸ª <code>Properties</code> ç±»å‹å‚æ•°çš„æ„é€ å‡½æ•°å¯ä»¥è‡ªå®šä¹‰ <code>NebulaPool</code> é…ç½®ï¼Œæ¥æ”¶ä¸€ä¸ª <code>String</code> ç±»å‹å‚æ•°çš„æ„é€ å‡½æ•°å¯ä»¥åªæŒ‡å®šè¿æ¥åœ°å€ï¼Œå…¶ä½™å‚æ•°æŒ‰ç…§é»˜è®¤é…ç½®ã€‚</p><p>æ³¨å†Œé©±åŠ¨åç”¨æˆ·å¯ä»¥é€šè¿‡ <code>DriverManager::getConnection(String url)</code> è·å– <code>Connection</code>ã€‚åœ¨ <code>NebulaConnection</code> çš„æ„é€ å‡½æ•°ä¸­ä¼šé€šè¿‡ <code>NebulaDriver</code> ä¸­çš„ <code>NebulaPool</code> è·å– <code>Session</code> æ¥ç€è¿æ¥åˆ°åœ¨ url ä¸­æŒ‡å®šçš„å›¾ç©ºé—´(graphSpace)ã€‚</p><p>è·å–åˆ° <code>Connection</code> åç”¨æˆ·å¯ä»¥é€šè¿‡ <code>Connection::createStatement</code> å’Œ <code>Connection::prepareStatement</code> æ‹¿åˆ° <code>Statement</code> æˆ–è€… <code>PreparedStatement</code> å¯¹è±¡ï¼Œè°ƒç”¨å…¶ä¸­çš„ <code>executeQueryã€executeUpdateã€execute</code> æ–¹æ³•å‘æ•°æ®åº“å‘é€å‘½ä»¤ï¼Œæ•°æ®åº“æ‰§è¡Œæ­¤å‘½ä»¤åçš„ç»“æœä¼šå°è£…åœ¨ <code>NebulaResult</code> ä¸­ï¼Œå†è°ƒç”¨å…¶ä¸­å„ç§è·å–æ•°æ®çš„æ–¹æ³•å¯ä»¥å¾—åˆ°ä¸åŒæ•°æ®ç±»å‹çš„æ•°æ®ã€‚</p><h2 id="usage"><a class="markdownIt-Anchor" href="#usage"></a> Usage</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è·å–å¹¶æ³¨å†Œé»˜è®¤çš„ NebulaDriverï¼Œé»˜è®¤çš„è¿æ¥åœ°å€æ˜¯ 127.0.0.1ï¼š9669ï¼Œå…¶ä½™çš„é»˜è®¤å‚æ•°å¯ä»¥æŸ¥çœ‹ NebulaDriver::setDefaultPoolProperties()</span><br><span class="hljs-type">NebulaDriver</span> <span class="hljs-variable">defaultDriver</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NebulaDriver</span>();<br><br><span class="hljs-comment">// å¦‚æœåªæƒ³è®¾ç½®è¿æ¥åœ°ï¼Œå…¶ä½™å‚æ•°æŒ‰ç…§é»˜è®¤é…ç½®ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ NebulaDriver (String address)</span><br><span class="hljs-type">NebulaDriver</span> <span class="hljs-variable">customizedUrlDriver</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NebulaDriver</span>(<span class="hljs-string">&quot;192.168.66.116:9669&quot;</span>);<br><br><span class="hljs-comment">// å¦‚æœè¦è¿æ¥ç‰¹å®šçš„æœåŠ¡åœ°å€ä»¥åŠè‡ªå®šä¹‰è¿æ¥é…ç½®ï¼Œå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰ NebulaDriverï¼šå°†é…ç½®å‚æ•°å°è£…åœ¨ä¸€ä¸ª Properties å¯¹è±¡ä¸­ï¼Œç„¶åè°ƒç”¨ NebulaDriver::NebulaDriver(Properties poolProperties)</span><br><span class="hljs-type">Properties</span> <span class="hljs-variable">poolProperties</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();<br>ArrayList&lt;HostAddress&gt; addressList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>addressList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HostAddress</span>(<span class="hljs-string">&quot;192.168.66.226&quot;</span>, <span class="hljs-number">9669</span>));<br>addressList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HostAddress</span>(<span class="hljs-string">&quot;192.168.66.222&quot;</span>, <span class="hljs-number">9670</span>));<br><br>poolProperties.put(<span class="hljs-string">&quot;addressList&quot;</span>, addressList);<br>poolProperties.put(<span class="hljs-string">&quot;minConnsSize&quot;</span>, <span class="hljs-number">2</span>);<br>poolProperties.put(<span class="hljs-string">&quot;maxConnsSize&quot;</span>, <span class="hljs-number">12</span>);<br>poolProperties.put(<span class="hljs-string">&quot;timeout&quot;</span>, <span class="hljs-number">1015</span>);<br>poolProperties.put(<span class="hljs-string">&quot;idleTime&quot;</span>, <span class="hljs-number">727</span>);<br>poolProperties.put(<span class="hljs-string">&quot;intervalIdle&quot;</span>, <span class="hljs-number">1256</span>);<br>poolProperties.put(<span class="hljs-string">&quot;waitTime&quot;</span>, <span class="hljs-number">1256</span>);<br><br><span class="hljs-type">NebulaDriver</span> <span class="hljs-variable">customizedDriver</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NebulaDriver</span>(poolProperties);<br><br><span class="hljs-comment">// è·å– Connection</span><br><span class="hljs-type">Connection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> DriverManager.getConnection(<span class="hljs-string">&quot;jdbc:nebula://JDBC_TEST_SPACE&quot;</span>, <span class="hljs-string">&quot;root&quot;</span>, <span class="hljs-string">&quot;nebula123&quot;</span>);<br><br><span class="hljs-comment">// è·å– Statement å¹¶æ‰§è¡Œ</span><br><span class="hljs-type">Statement</span> <span class="hljs-variable">statement</span> <span class="hljs-operator">=</span> connection.createStatement();<br><br><span class="hljs-type">String</span> <span class="hljs-variable">queryStatementNgql</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;match (v:testNode) return v.theString as theString, v.theInt as theInt&quot;</span>;<br><span class="hljs-type">ResultSet</span> <span class="hljs-variable">queryStatementResult</span> <span class="hljs-operator">=</span> statement.executeQuery(queryStatementNgql);<br><br><span class="hljs-comment">// è·å–ç»“æœ</span><br><span class="hljs-keyword">while</span> (queryStatementResult.next())&#123;<br><span class="hljs-type">String</span> <span class="hljs-variable">theString</span> <span class="hljs-operator">=</span> queryStatementResult.getString(<span class="hljs-string">&quot;theString&quot;</span>);<br><span class="hljs-type">int</span> <span class="hljs-variable">theInt</span> <span class="hljs-operator">=</span> queryStatementResult.getInt(<span class="hljs-number">2</span>);<br>&#125;<br><br><span class="hljs-type">String</span> <span class="hljs-variable">insertTestNode</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;INSERT VERTEX testNode (theString, theInt, theDouble, theTrueBool, theFalseBool, theDate, theTime, theDatetime) VALUES &quot;</span> +<br>    <span class="hljs-string">&quot;\&quot;testNode_7\&quot;:(\&quot;Young\&quot;, 20, , 12.56, true, false, date(\&quot;1949-10-01\&quot;), time(\&quot;15:00:00.000\&quot;), datetime(\&quot;1949-10-01T15:00:00.000\&quot;)); &quot;</span>;<br>statement.executeUpdate(insertTestNode);<br><br><span class="hljs-comment">// è·å– PreparedStatementï¼Œè®¾ç½®å‚æ•°å¹¶æ‰§è¡Œ</span><br><span class="hljs-type">String</span> <span class="hljs-variable">insertPreparedStatementNgql</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;INSERT VERTEX testNode (theString, theInt, theDouble, theTrueBool, theFalseBool, theDate, theTime, theDatetime) VALUES &quot;</span> +<br>    <span class="hljs-string">&quot;\&quot;testNode_8\&quot;:(?, ?, ?, ?, ?, ?, ?, ?); &quot;</span>;<br><span class="hljs-type">PreparedStatement</span> <span class="hljs-variable">insertPreparedStatement</span> <span class="hljs-operator">=</span> connection.prepareStatement(insertPreparedStatementNgql);<br><br>insertPreparedStatement.setString(<span class="hljs-number">1</span>, <span class="hljs-string">&quot;YYDS&quot;</span>);<br>insertPreparedStatement.setInt(<span class="hljs-number">2</span>, <span class="hljs-number">98</span>);<br>insertPreparedStatement.setDouble(<span class="hljs-number">3</span>, <span class="hljs-number">12.56</span>);<br>insertPreparedStatement.setBoolean(<span class="hljs-number">4</span>, <span class="hljs-literal">true</span>);<br>insertPreparedStatement.setBoolean(<span class="hljs-number">5</span>, <span class="hljs-literal">false</span>);<br>insertPreparedStatement.setDate(<span class="hljs-number">6</span>, Date.valueOf(<span class="hljs-string">&quot;1949-10-01&quot;</span>));<br>insertPreparedStatement.setTime(<span class="hljs-number">7</span>, Time.valueOf(<span class="hljs-string">&quot;15:00:00&quot;</span>));<br><span class="hljs-comment">// ç±»å‹è½¬æ¢åå†è°ƒç”¨ setDatetime</span><br><span class="hljs-type">NebulaPreparedStatement</span> <span class="hljs-variable">nebulaPreparedStatement</span> <span class="hljs-operator">=</span> (NebulaPreparedStatement) insertPreparedStatement;<br>nebulaPreparedStatement.setDatetime(<span class="hljs-number">8</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.util.Date());<br><br>insertPreparedStatement.execute();<br><br><span class="hljs-comment">// å…³é—­è¿æ¥</span><br>connection.close();<br></code></pre></td></tr></table></figure><h2 id="q-a"><a class="markdownIt-Anchor" href="#q-a"></a> Q &amp; A</h2><ul><li>è¿æ¥å­—ç¬¦ä¸²&quot;jdbc:nebula://graphSpace&quot;ä¸­ä¸ç”¨æŒ‡å®šè¿æ¥åœ°å€å—ï¼Ÿ</li></ul><p>ç”±äºåœ°å€åˆ—è¡¨å·²ç»åœ¨ <code>NebulaDriver</code> ä¸­é…ç½®(é»˜è®¤æˆ–è‡ªå®šä¹‰)ï¼Œæ‰€ä»¥è¿æ¥å­—ç¬¦ä¸²ä¸éœ€è¦æŒ‡å®šåœ°å€ï¼Œåªéœ€è¦æŒ‡å®šå›¾ç©ºé—´ã€‚</p><ul><li><code>PreparedStatement</code> æ˜¯å¦æœ‰é¢„ç¼–è¯‘åŠŸèƒ½ï¼Ÿ</li></ul><p>æœåŠ¡ç«¯æš‚ä¸æ”¯æŒã€‚</p><ul><li><code>executeQuery</code>ã€<code>executeUpdate</code>ã€<code>execute</code> çš„ä½¿ç”¨åœºæ™¯ï¼Ÿ</li></ul><p><code>executeQuery</code> ä¸“é—¨ç”¨äºæŸ¥è¯¢ Nebula ä¸­çš„æ•°æ®ï¼Œæ­¤æ—¶ nGql éœ€åŒ…å«æŸ¥è¯¢å…³é”®å­— [â€œmatchâ€, â€œlookupâ€, â€œgoâ€, â€œfetchâ€, â€œfindâ€, â€œsubgraphâ€]ï¼Œè¿”å›æŸ¥è¯¢ç»“æœ <code>ResultSet</code>ï¼›<code>executeUpdate</code> ç”¨äºä¿®æ”¹æ•°æ®ï¼ŒnGql éœ€åŒ…å«ä¿®æ”¹å…³é”®å­— [â€œupdateâ€, â€œdeleteâ€, â€œinsertâ€, â€œupsertâ€, â€œcreateâ€, â€œdropâ€, â€œalterâ€, â€œrebuildâ€]ï¼Œè¿”å›æŸ¥è¯¢ç»“æœ <code>0</code>ï¼›<code>execute</code> ç”¨äºå…¶ä»– admin æ“ä½œï¼Œæ‰§è¡ŒæˆåŠŸåˆ™è¿”å›æŸ¥è¯¢ <code>true</code>ã€‚</p><ul><li><code>executeUpdate</code> çš„è¿”å›ç»“æœæ˜¯0ï¼Œä¸ºä»€ä¹ˆä¸æ˜¯å—åˆ°è¯¥è¯­å¥å½±å“çš„æ•°æ®é‡ï¼Ÿ</li></ul><p>ç›®å‰æœåŠ¡ç«¯æ²¡æœ‰ updateCount ç»Ÿè®¡è¿”å›ç»™ç”¨æˆ·ã€‚å‡å¦‚ç”¨æˆ·ä¸€æ¡æ’å…¥è¯­å¥é‡Œé¢åŒæ—¶æ’å…¥å¤šä¸ªç‚¹æˆ–è€…å¤šæ¡è¾¹ï¼Œè¿™é‡Œé¢å¯èƒ½æœ‰éƒ¨åˆ†æˆåŠŸï¼Œä½†æœåŠ¡ç«¯åªä¼šè¿”å›å‘Šè¯‰ç”¨æˆ·å¤±è´¥äº†ï¼Œä½†æ˜¯å…¶å®ç”¨æˆ·å¯èƒ½èƒ½æŸ¥åˆ°éƒ¨åˆ†æ•°æ®ã€‚ç»Ÿä¸€è¿”å›0ç»™ç”¨æˆ·ã€‚</p><ul><li>æŸ¥è¯¢è¯­å¥ä¸­è¿”å›ç‚¹ã€è¾¹ã€è·¯å¾„ååœ¨ Result ä¸­åº”è¯¥å¦‚ä½•è·å¾—ï¼Ÿ</li></ul><p>å°† <code>ResultSet</code> è½¬ä¸º <code>NebulaResultSet</code>ï¼Œç„¶åè°ƒç”¨ <code>getNode</code>ã€<code>getEdge</code>ã€<code>getPath</code>ï¼›å¯¹äºåˆ—è¡¨ã€é›†åˆã€æ˜ å°„ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¼€æº</tag>
      
      <tag>å¼€æºä¹‹å¤</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å®ç°ä¸€ä¸ªç®€å•çš„ shared_ptr</title>
    <link href="/2021/10/26/%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%20shared_ptr/"/>
    <url>/2021/10/26/%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%20shared_ptr/</url>
    
    <content type="html"><![CDATA[<h2 id="raii"><a class="markdownIt-Anchor" href="#raii"></a> RAII</h2><p>Resource Acquisition Is Initializationï¼Œèµ„æºè·å–å³åˆå§‹åŒ–ã€‚ä»¥ç±»å¯¹è±¡çš„å½¢å¼ç®¡ç†èµ„æºï¼Œç»“åˆç±»å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸæ§åˆ¶èµ„æºçš„è·å–å’Œé‡Šæ”¾ï¼Œæ„é€ æ—¶è·å–èµ„æºææ„æ—¶é‡Šæ”¾èµ„æºã€‚C++ ä¿è¯æ ˆå¯¹è±¡ç¦»å¼€ä½œç”¨åŸŸæ—¶æ€»ä¼šè¢«æ­£ç¡®ææ„ï¼Œæ‰€ä»¥åœ¨æ„é€ æ—¶è·å–çš„èµ„æºæ€»èƒ½è¢«æ­£ç¡®é‡Šæ”¾ã€‚</p><h2 id="ä»£ç "><a class="markdownIt-Anchor" href="#ä»£ç "></a> ä»£ç </h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MySharedPtr</span> &#123;<br><br><span class="hljs-keyword">public</span>:<br><br>    <span class="hljs-comment">// æ³¨æ„è¿™é‡Œçš„å‚æ•°ä¸èƒ½ä¸º const T*ï¼Œå› ä¸º rawPtr æ˜¯é constï¼Œä¸èƒ½æ¥æ”¶ä¸€ä¸ª const çš„èµ‹å€¼</span><br>    <span class="hljs-built_in">MySharedPtr</span>(T* _rawPtr = <span class="hljs-literal">nullptr</span>) : <span class="hljs-built_in">rawPtr</span>(_rawPtr), <span class="hljs-built_in">counter</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">1</span>)) &#123;&#125;<br><br>    <span class="hljs-built_in">MySharedPtr</span>(<span class="hljs-type">const</span> MySharedPtr&lt;T&gt;&amp; source) : <span class="hljs-built_in">rawPtr</span>(source.rawPtr), <span class="hljs-built_in">counter</span>(source.counter) &#123;<br>        <span class="hljs-built_in">increase</span>();<br>    &#125;<br><br>    ~<span class="hljs-built_in">MySharedPtr</span>() &#123;<br>        <span class="hljs-built_in">decrease</span>();<br>    &#125;<br><br>    MySharedPtr&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> MySharedPtr&lt;T&gt;&amp; source) &#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span> == &amp;source) <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;<br>        <span class="hljs-built_in">decrease</span>(); <span class="hljs-comment">// è‡ªå·±ç°åœ¨è¦æ›´æ”¹æŒ‡å‘äº†, é‡Šæ”¾ç®¡ç†çš„æ—§èµ„æº</span><br>        rawPtr = source.rawPtr;<br>        counter = source.counter;<br>        <span class="hljs-built_in">increase</span>();<br>        <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;<br>    &#125;<br><br>    T&amp; <span class="hljs-keyword">operator</span>*() &#123;<br>        <span class="hljs-keyword">return</span> *rawPtr;<br>    &#125;<br><br>    T* <span class="hljs-keyword">operator</span>-&gt;() &#123;<br>        <span class="hljs-keyword">return</span> rawPtr;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">getCount</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> *counter;<br>    &#125;<br><br><span class="hljs-keyword">private</span>:<br><br>    T*   rawPtr;<br>    <span class="hljs-type">int</span>* counter; <span class="hljs-comment">// æ‰€æœ‰æŒ‡å‘ rawPtr çš„æ™ºèƒ½æŒ‡é’ˆå…±äº«ä¸€ä»½ counter</span><br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">increase</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">if</span>(counter) ++(*counter);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">decrease</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">if</span>(--(*counter) == <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">delete</span> rawPtr;<br>            <span class="hljs-keyword">delete</span> counter;<br>        &#125;<br>    &#125;<br><br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="å¾…å®Œå–„-å¢åŠ è‡ªå®šä¹‰é‡Šæ”¾"><a class="markdownIt-Anchor" href="#å¾…å®Œå–„-å¢åŠ è‡ªå®šä¹‰é‡Šæ”¾"></a> <s>å¾…å®Œå–„</s> å¢åŠ è‡ªå®šä¹‰é‡Šæ”¾</h2><p>C++ ä¸­çš„ shared_ptr æ”¯æŒåœ¨åˆå§‹åŒ–æ—¶æŒ‡å®šææ„æ–¹å¼ï¼ˆé»˜è®¤æ˜¯é‡Šæ”¾æŒ‡é’ˆï¼‰ï¼Œshared_ptr ä¹Ÿå¯ä»¥ç”¨æ¥ç®¡ç†å…¶ä»–èµ„æºæ¯”å¦‚ä¸€ä¸ªæ•°æ®åº“è¿æ¥ï¼Œææ„å‡½æ•°ä¸­åº”è¯¥é‡Šæ”¾æ­¤è¿æ¥ï¼Œæ­¤æ—¶å°±åº”è¯¥è‡ªå®šä¹‰è¯¥ shared_ptr çš„ææ„æ–¹å¼</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MySharedPtr</span> &#123;<br><br><span class="hljs-keyword">public</span>:<br><br>    <span class="hljs-comment">// é‡Šæ”¾å™¨çš„é»˜è®¤å€¼æ˜¯ delete æŒ‡é’ˆ</span><br>    <span class="hljs-built_in">MySharedPtr</span>(T* _rawPtr = <span class="hljs-literal">nullptr</span>, <span class="hljs-built_in">void</span> (*_release)(T* pointer) = [](T* pointer)&#123;<span class="hljs-keyword">delete</span> pointer;&#125;) : <span class="hljs-built_in">rawPtr</span>(_rawPtr), <span class="hljs-built_in">counter</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">1</span>)) &#123;<br>        release = _release;<br>    &#125;<br><br>    <span class="hljs-built_in">MySharedPtr</span>(<span class="hljs-type">const</span> MySharedPtr&lt;T&gt;&amp; source) : <span class="hljs-built_in">rawPtr</span>(source.rawPtr), <span class="hljs-built_in">counter</span>(source.counter) &#123;<br>        <span class="hljs-built_in">increase</span>();<br>    &#125;<br><br>    ~<span class="hljs-built_in">MySharedPtr</span>() &#123;<br>        <span class="hljs-built_in">decrease</span>();<br>    &#125;<br><br>    MySharedPtr&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> MySharedPtr&lt;T&gt;&amp; source) &#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span> == &amp;source) <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;<br>        <span class="hljs-built_in">decrease</span>(); <span class="hljs-comment">// è‡ªå·±ç°åœ¨è¦æ›´æ”¹æŒ‡å‘äº†, é‡Šæ”¾ç®¡ç†çš„æ—§èµ„æº</span><br>        rawPtr = source.rawPtr;<br>        counter = source.counter;<br>        <span class="hljs-built_in">increase</span>();<br>        <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;<br>    &#125;<br><br>    T&amp; <span class="hljs-keyword">operator</span>*() &#123;<br>        <span class="hljs-keyword">return</span> *rawPtr;<br>    &#125;<br><br>    T* <span class="hljs-keyword">operator</span>-&gt;() &#123;<br>        <span class="hljs-keyword">return</span> rawPtr;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">getCount</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> *counter;<br>    &#125;<br><br><span class="hljs-keyword">private</span>:<br><br>    T*   rawPtr;<br>    <span class="hljs-type">int</span>* counter; <span class="hljs-comment">// æ‰€æœ‰æŒ‡å‘ rawPtr çš„æ™ºèƒ½æŒ‡é’ˆå…±äº«ä¸€ä»½ counter</span><br>    <span class="hljs-built_in">void</span> (*release)(T* pointer); <span class="hljs-comment">// ä¿å­˜æ„é€ æ—¶ä¼ å…¥çš„é‡Šæ”¾æ–¹å¼</span><br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">increase</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">if</span>(counter) ++(*counter);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">decrease</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">if</span>(--(*counter) == <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-built_in">release</span>(rawPtr); <span class="hljs-comment">// è°ƒç”¨ç”¨æˆ·è‡ªå®šä¹‰çš„é‡Šæ”¾å™¨</span><br>            <span class="hljs-keyword">delete</span> counter;<br>        &#125;<br>    &#125;<br><br>&#125;;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
      <tag>å…¸å‹å®ç°</tag>
      
      <tag>RAII</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>C++ç±»ä¸­çš„ç‰¹æ®Šå‡½æ•° </title>
    <link href="/2021/10/11/C++%E7%B1%BB%E4%B8%AD%E7%9A%84%E7%89%B9%E6%AE%8A%E5%87%BD%E6%95%B0/"/>
    <url>/2021/10/11/C++%E7%B1%BB%E4%B8%AD%E7%9A%84%E7%89%B9%E6%AE%8A%E5%87%BD%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<h2 id="ä»£ç "><a class="markdownIt-Anchor" href="#ä»£ç "></a> ä»£ç </h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">String</span>&#123;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-type">char</span>* str;<br>    <span class="hljs-type">int</span> len;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-comment">// é»˜è®¤æ„é€ å‡½æ•°</span><br>    <span class="hljs-built_in">String</span> () &#123;<br>        len = <span class="hljs-number">0</span>;<br>        str = <span class="hljs-literal">nullptr</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// æ„é€ å‡½æ•°</span><br>    <span class="hljs-built_in">String</span> (<span class="hljs-type">const</span> <span class="hljs-type">char</span>* s) &#123;<br>        len = std::<span class="hljs-built_in">strlen</span>(s);<br>        str = <span class="hljs-keyword">new</span> <span class="hljs-type">char</span>[len + <span class="hljs-number">1</span>];<br>        std::<span class="hljs-built_in">strcpy</span>(str, s);<br>    &#125;<br><br>    <span class="hljs-comment">// æ‹·è´æ„é€ å‡½æ•°</span><br>    <span class="hljs-built_in">String</span> (<span class="hljs-type">const</span> String&amp; st) &#123;<br>        <span class="hljs-comment">// æ‹·è´æ„é€ å‡½æ•°çš„å‚æ•°å¿…é¡»æ˜¯å¼•ç”¨ç±»å‹è€Œä¸èƒ½æ˜¯ç±»ç±»å‹ï¼Œç±»ç±»å‹å±äºä¼ å€¼ï¼Œè€Œä¼ å€¼çš„æ–¹å¼ä¼šè°ƒç”¨è¯¥ç±»çš„æ‹·è´æ„é€ å‡½æ•°ï¼Œä»è€Œé€ æˆæ— ç©·é€’å½’åœ°è°ƒç”¨æ‹·è´æ„é€ å‡½æ•°</span><br>        <span class="hljs-comment">// constï¼Œé˜²æ­¢å¯¹å®å‚çš„æ„å¤–ä¿®æ”¹ï¼›èƒ½å¤Ÿæ¥å— const å’Œ é const ç±»å‹ï¼›ä½¿å‡½æ•°èƒ½å¤Ÿæ­£ç¡®ç”Ÿæˆå¹¶ä½¿ç”¨ä¸´æ—¶å¯¹è±¡</span><br>        len = st.len;<br>        str = <span class="hljs-keyword">new</span> <span class="hljs-type">char</span>[len + <span class="hljs-number">1</span>];<br>        std::<span class="hljs-built_in">strcpy</span>(str, st.str);<br>    &#125;<br>    <span class="hljs-comment">// ç§»åŠ¨æ„é€ å‡½æ•°</span><br>    <span class="hljs-built_in">String</span> (String&amp;&amp; st) <span class="hljs-keyword">noexcept</span> &#123;<br>        len = st.len;<br>        str = st.str;<br>        <span class="hljs-comment">// ä¸Šé¢çš„è¯­å¥æ‹¿äº† st çš„èµ„æºï¼Œæ‰€ä»¥è¦ä¸‹é¢è¦ç½®ç©ºï¼Œå¦åˆ™ä¼šæœ‰å¤šä¸ªæŒ‡é’ˆæŒ‡å‘åŒä¸€å—å†…å­˜çš„å±é™©</span><br>        st.str = <span class="hljs-literal">nullptr</span>; st.len = <span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// èµ‹å€¼è¿ç®—ç¬¦</span><br>    String&amp; <span class="hljs-keyword">operator</span>= (<span class="hljs-type">const</span> String&amp; st) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> == &amp;st) <span class="hljs-keyword">return</span>  *<span class="hljs-keyword">this</span>;<br>        <span class="hljs-keyword">delete</span>[] str; <span class="hljs-comment">// æ³¨æ„è¿™é‡Œæ˜¯èµ‹å€¼ï¼ŒåŸæ¥çš„å¯¹è±¡æœ¬èº«æœ‰å†…å®¹ï¼Œæ‰€ä»¥è¦é‡Šæ”¾æ‰</span><br>        len = st.len;<br>        str = <span class="hljs-keyword">new</span> <span class="hljs-type">char</span>[len + <span class="hljs-number">1</span>];<br>        std::<span class="hljs-built_in">strcpy</span>(str, st.str);<br>        <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;<br>    &#125;<br>    <span class="hljs-comment">// ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦</span><br>    String&amp; <span class="hljs-keyword">operator</span>= (String&amp;&amp; st) <span class="hljs-keyword">noexcept</span> &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> == &amp;st) <span class="hljs-keyword">return</span>  *<span class="hljs-keyword">this</span>;<br>        <span class="hljs-keyword">delete</span>[] str; <span class="hljs-comment">// æ³¨æ„è¿™é‡Œæ˜¯èµ‹å€¼ï¼ŒåŸæ¥çš„å¯¹è±¡æœ¬èº«æœ‰å†…å®¹ï¼Œæ‰€ä»¥è¦é‡Šæ”¾æ‰</span><br>        len = st.len;<br>        str = st.str;<br>        <span class="hljs-comment">// ä¸Šé¢çš„è¯­å¥æ‹¿äº† st çš„èµ„æºï¼Œæ‰€ä»¥è¦ä¸‹é¢è¦ç½®ç©ºï¼Œå¦åˆ™ä¼šæœ‰å¤šä¸ªæŒ‡é’ˆæŒ‡å‘åŒä¸€å—å†…å­˜çš„å±é™©</span><br>        st.str = <span class="hljs-literal">nullptr</span>; st.len = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// è¯»å†™é const çš„å¯¹è±¡</span><br>    <span class="hljs-type">char</span>&amp; <span class="hljs-keyword">operator</span>[] (<span class="hljs-type">int</span> i) &#123;<br>        <span class="hljs-keyword">return</span> str[i];<br>    &#125;<br>    <span class="hljs-comment">// è¯» const çš„ç±»å¯¹è±¡</span><br>    <span class="hljs-type">const</span> <span class="hljs-type">char</span>&amp; <span class="hljs-keyword">operator</span>[] (<span class="hljs-type">int</span> i) <span class="hljs-type">const</span>&#123;<br>        <span class="hljs-keyword">return</span> str[i];<br>    &#125;<br><br>    <span class="hljs-comment">// é‡è½½ &lt;&lt; è¿ç®—ç¬¦ï¼›å†™æˆå‹å…ƒæ˜¯ä¸ºäº†å¯ä»¥è¿™æ ·ä½¿ç”¨ï¼ˆcout &lt;&lt; objectï¼‰å¦åˆ™åªèƒ½ï¼ˆobject &lt;&lt; coutï¼Œå› ä¸ºäºŒå…ƒè¿ç®—ç¬¦é‡è½½ä¸ºæˆå‘˜å‡½æ•°çš„è¯åªèƒ½è®¾ç½®ä¸€ä¸ªå‚æ•°ä½œä¸ºå³ä¾§è¿ç®—é‡ï¼Œè€Œå·¦ä¾§è¿ç®—é‡å°±æ˜¯å¯¹è±¡æœ¬èº«ï¼‰</span><br>    <span class="hljs-keyword">friend</span> ostream&amp; <span class="hljs-keyword">operator</span>&lt;&lt; (ostream&amp; os, <span class="hljs-type">const</span> String&amp; st) &#123;<br>        os &lt;&lt; st.str;<br>        <span class="hljs-keyword">return</span> os; <span class="hljs-comment">// è¿”å› ostream&amp; æ˜¯ä¸ºäº†é“¾å¼è°ƒç”¨</span><br>    &#125;<br><br>    ~<span class="hljs-built_in">String</span>() &#123;<br>        <span class="hljs-keyword">delete</span>[] str; len = <span class="hljs-number">0</span>;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a class="markdownIt-Anchor" href="#å‚è€ƒ"></a> å‚è€ƒ</h2><ul><li>ã€ŠC++ Primer Plus ä¸­æ–‡ç‰ˆã€‹ chapter 12</li></ul>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å®ç° LRU ç¼“å­˜</title>
    <link href="/2021/10/04/%E5%AE%9E%E7%8E%B0%20LRU%20%E7%BC%93%E5%AD%98/"/>
    <url>/2021/10/04/%E5%AE%9E%E7%8E%B0%20LRU%20%E7%BC%93%E5%AD%98/</url>
    
    <content type="html"><![CDATA[<h2 id="æè¿°"><a class="markdownIt-Anchor" href="#æè¿°"></a> æè¿°</h2><p><a href="https://leetcode-cn.com/problems/lru-cache/"><strong>LRU ç¼“å­˜æœºåˆ¶</strong></a></p><ul><li>LRUCache(int capacity) ä»¥æ­£æ•´æ•°ä½œä¸ºå®¹é‡ capacity åˆå§‹åŒ– LRU ç¼“å­˜</li><li>int get(int key) å¦‚æœå…³é”®å­— key å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œåˆ™è¿”å›å…³é”®å­—çš„å€¼ï¼Œå¦åˆ™è¿”å› -1 ã€‚</li><li>void put(int key, int value) å¦‚æœå…³é”®å­—å·²ç»å­˜åœ¨ï¼Œåˆ™å˜æ›´å…¶æ•°æ®å€¼ï¼›å¦‚æœå…³é”®å­—ä¸å­˜åœ¨ï¼Œåˆ™æ’å…¥è¯¥ç»„ã€Œå…³é”®å­—-å€¼ã€ã€‚å½“ç¼“å­˜å®¹é‡è¾¾åˆ°ä¸Šé™æ—¶ï¼Œå®ƒåº”è¯¥åœ¨å†™å…¥æ–°æ•°æ®ä¹‹å‰åˆ é™¤æœ€ä¹…æœªä½¿ç”¨çš„æ•°æ®å€¼ï¼Œä»è€Œä¸ºæ–°çš„æ•°æ®å€¼ç•™å‡ºç©ºé—´ã€‚</li></ul><p><code>è¾“å…¥</code><br />[â€œLRUCacheâ€, â€œputâ€, â€œputâ€, â€œgetâ€, â€œputâ€, â€œgetâ€, â€œputâ€, â€œgetâ€, â€œgetâ€, â€œgetâ€]<br />[[2], [1, 1], [2, 2], [1], [3, 3], [2], [4, 4], [1], [3], [4]]<br /><code>è¾“å‡º</code><br />[null, null, null, 1, null, -1, null, -1, 3, 4]</p><h2 id="ç»†èŠ‚"><a class="markdownIt-Anchor" href="#ç»†èŠ‚"></a> ç»†èŠ‚</h2><ul><li>æ’å‡ºèŠ‚ç‚¹æ—¶æ²¡æœ‰æŠŠ tail çš„ pre ç½®ä¸ºæ’å‡ºç‚¹çš„ pre</li><li>è®¾è®¡çš„ Node èŠ‚ç‚¹åªæœ‰ val æ²¡æœ‰ä¿å­˜ key</li><li>åˆ é™¤ map ä¸­çš„é”®å€¼å¯¹æ—¶åˆ é”™</li><li>unordered_map åŸåœ°æ„é€ æ’å…¥çš„æ–¹æ³•ä¸º .emplace(key, value)ï¼›</li><li>head, tail æˆå‘˜å£°æ˜æ—¶æ²¡æœ‰åˆå§‹åŒ–</li></ul><h2 id="å®ç°"><a class="markdownIt-Anchor" href="#å®ç°"></a> å®ç°</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LRUCache</span> &#123;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span>&#123;<br>        <span class="hljs-keyword">public</span>: <span class="hljs-comment">// æ³¨æ„æ˜¯ publicï¼Œæˆ–è€…æ”¹æˆ struct</span><br>            <span class="hljs-type">int</span> key; <span class="hljs-type">int</span> value;<br>            Node* pre; Node* next;<br>            <span class="hljs-built_in">Node</span>(<span class="hljs-type">int</span> _key = <span class="hljs-number">0</span>, <span class="hljs-type">int</span> _value = <span class="hljs-number">0</span>, Node* _pre = <span class="hljs-literal">nullptr</span>, Node* _next = <span class="hljs-literal">nullptr</span>) : <span class="hljs-built_in">value</span>(_value), <span class="hljs-built_in">key</span>(_key), <span class="hljs-built_in">pre</span>(_pre), <span class="hljs-built_in">next</span>(_next) &#123;&#125;<br>    &#125;;<br>    unordered_map&lt;<span class="hljs-type">int</span>, Node*&gt; map; <span class="hljs-comment">// å¿«é€ŸæŸ¥æ‰¾</span><br>    <span class="hljs-type">int</span> capacity; <span class="hljs-comment">// ç¼“å­˜çš„æœ€å¤§å®¹é‡</span><br>    <span class="hljs-type">int</span> size; <span class="hljs-comment">// å½“å‰ç¼“å­˜å¤§å°</span><br>    <span class="hljs-comment">// åŒé“¾è¡¨çš„å¤´å°¾ï¼Œç»Ÿä¸€æ“ä½œï¼ˆè®°å¾—åˆå§‹åŒ–ï¼‰</span><br>    Node* head = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Node</span>();<br>    Node* tail = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Node</span>();<br>    <span class="hljs-comment">// ä¸‹é¢ä¸¤ä¸ªæŒ‡é’ˆç”¨äºä¿å­˜è¦è°ƒæ•´åˆ°æœ€å‰é¢çš„èŠ‚ç‚¹çš„å‰åèŠ‚ç‚¹</span><br>    Node* pre;<br>    Node* next;<br>    unordered_map&lt;<span class="hljs-type">int</span>, Node*&gt;::iterator iter; <span class="hljs-comment">// ä¿å­˜æ¯æ¬¡æ ¹æ® key æ‰¾åˆ°çš„ value çš„è¿­ä»£å™¨</span><br><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">LRUCache</span>(<span class="hljs-type">int</span> _capacity) &#123;<br>        capacity = _capacity; size = <span class="hljs-number">0</span>;<br>        head-&gt;next = tail; tail-&gt;pre = head;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">get</span><span class="hljs-params">(<span class="hljs-type">int</span> key)</span> </span>&#123;<br>        iter = map.<span class="hljs-built_in">find</span>(key);<br>        <span class="hljs-keyword">if</span>(iter != map.<span class="hljs-built_in">end</span>())&#123;<br>            <span class="hljs-built_in">adjust</span>(iter-&gt;second);<br>            <span class="hljs-keyword">return</span> iter-&gt;second-&gt;value;<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">put</span><span class="hljs-params">(<span class="hljs-type">int</span> key, <span class="hljs-type">int</span> value)</span> </span>&#123;<br>        <span class="hljs-type">int</span> index = <span class="hljs-built_in">get</span>(key);<br>        <span class="hljs-keyword">if</span>(index == <span class="hljs-number">-1</span>)&#123; <span class="hljs-comment">// ä¸å­˜åœ¨</span><br>            Node* temp = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Node</span>(key, value);<br>            <span class="hljs-keyword">if</span>(size == capacity)&#123; <span class="hljs-comment">// å®¹é‡ä¸å¤Ÿ</span><br>                Node* end = tail-&gt;pre;<br>                end-&gt;pre-&gt;next = tail;<br>                tail-&gt;pre = end-&gt;pre;<br>                map.<span class="hljs-built_in">erase</span>(end-&gt;key); <span class="hljs-comment">// æ³¨æ„è¿™é‡Œæ“¦å»çš„æ˜¯ end-&gt;key è€Œä¸æ˜¯ key</span><br>                <span class="hljs-keyword">delete</span> end; <span class="hljs-comment">// æ³¨æ„è¿™å¥ä¸€å®šè¦åœ¨æ“¦å» key ä¹‹åï¼Œå¦åˆ™å°±æ˜¯å¼•ç”¨æ‚¬ç©ºæŒ‡é’ˆäº†(å…¶å®ä¸ delete ä¹Ÿèƒ½é€šè¿‡æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹)</span><br>                --size;<br>            &#125;<br>            temp-&gt;next = head-&gt;next;<br>            head-&gt;next-&gt;pre = temp;<br>            temp-&gt;pre = head;<br>            head-&gt;next = temp;<br>            ++size;<br>            map.<span class="hljs-built_in">emplace</span>(key, temp);<br>        &#125;<span class="hljs-keyword">else</span>&#123; <span class="hljs-comment">// å­˜åœ¨</span><br>            iter-&gt;second-&gt;value = value;<br>            <span class="hljs-built_in">adjust</span>(iter-&gt;second);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">adjust</span><span class="hljs-params">(Node* item)</span></span>&#123;<br>        pre = item-&gt;pre;<br>        next = item-&gt;next;<br>        pre-&gt;next = next;<br>        next-&gt;pre = pre;<br><br>        item-&gt;next = head-&gt;next;<br>        head-&gt;next-&gt;pre = item;<br>        item-&gt;pre = head;<br>        head-&gt;next = item;<br>    &#125;<br><br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a class="markdownIt-Anchor" href="#å‚è€ƒ"></a> å‚è€ƒ</h2><ul><li><a href="https://leetcode-cn.com/problems/lru-cache/solution/gong-shui-san-xie-she-ji-shu-ju-jie-gou-68hv2/">è®¾è®¡æ•°æ®ç»“æ„ï¼šå®ç°ä¸€ä¸ª LRUCache</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å…¸å‹å®ç°</tag>
      
      <tag>LeetCode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸ºå›¾æ•°æ®åº“ Nebula Graph å¯¹æ¥ JDBC åè®®ä¸­æœŸæŠ¥å‘Š</title>
    <link href="/2021/08/09/%E4%B8%BA%E5%9B%BE%E6%95%B0%E6%8D%AE%E5%BA%93%20Nebula%20Graph%20%E5%AF%B9%E6%8E%A5%20JDBC%20%E5%8D%8F%E8%AE%AE%E4%B8%AD%E6%9C%9F%E6%8A%A5%E5%91%8A/"/>
    <url>/2021/08/09/%E4%B8%BA%E5%9B%BE%E6%95%B0%E6%8D%AE%E5%BA%93%20Nebula%20Graph%20%E5%AF%B9%E6%8E%A5%20JDBC%20%E5%8D%8F%E8%AE%AE%E4%B8%AD%E6%9C%9F%E6%8A%A5%E5%91%8A/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h2><p>æ–‡ç« æ”¶å½•äº <a href="https://mp.weixin.qq.com/s/wUPfZgzZSRR-C6JLP8mAxg">å¼€æºä¹‹å¤å®˜æ–¹å…¬ä¼—å·</a> åŠ <a href="https://nebula-graph.com.cn/posts/what-is-nebula-jdbc/">Nebula Graph åšå®¢æ ç›®</a></p><p><a href="https://summer.iscas.ac.cn/#/homepage?lang=en">å¼€æºä¹‹å¤</a>ï¼š<strong>å¼€æºè½¯ä»¶ä¾›åº”é“¾ç‚¹äº®è®¡åˆ’ - æš‘æœŸ 2021</strong> æ˜¯ç”±ä¸­å›½ç§‘å­¦é™¢è½¯ä»¶ç ”ç©¶æ‰€ä¸ openEuler ç¤¾åŒºå…±åŒä¸¾åŠçš„ä¸€é¡¹é¢å‘é«˜æ ¡å­¦ç”Ÿçš„æš‘æœŸæ´»åŠ¨ï¼Œæ—¨åœ¨é¼“åŠ±åœ¨æ ¡å­¦ç”Ÿç§¯æå‚ä¸å¼€æºè½¯ä»¶çš„å¼€å‘ç»´æŠ¤ï¼Œä¿ƒè¿›ä¼˜ç§€å¼€æºè½¯ä»¶ç¤¾åŒºçš„è“¬å‹ƒå‘å±•ã€‚ä¸­ç§‘é™¢è”åˆåŒ…æ‹¬ Nebula Graph åœ¨å†…çš„å›½å†…å„å¤§å¼€æºç¤¾åŒºï¼Œé’ˆå¯¹é‡è¦å¼€æºè½¯ä»¶çš„å¼€å‘ä¸ç»´æŠ¤æä¾›é¡¹ç›®ï¼Œå¹¶å‘å…¨çƒé«˜æ ¡å­¦ç”Ÿå¼€æ”¾æŠ¥åã€‚å­¦ç”Ÿåœ¨è‡ªç”±é€‰æ‹©é¡¹ç›®åï¼Œä¸ç¤¾åŒºå¯¼å¸ˆæ²Ÿé€šå®ç°æ–¹æ¡ˆå¹¶æ’°å†™é¡¹ç›®è®¡åˆ’ä¹¦ã€‚è¢«é€‰ä¸­çš„å­¦ç”Ÿå°†åœ¨ç¤¾åŒºå¯¼å¸ˆæŒ‡å¯¼ä¸‹ï¼ŒæŒ‰è®¡åˆ’å®Œæˆå¼€å‘å·¥ä½œï¼Œå¹¶å°†æˆæœè´¡çŒ®ç»™ç¤¾åŒºã€‚</p><h2 id="1-é¡¹ç›®ä¿¡æ¯"><a class="markdownIt-Anchor" href="#1-é¡¹ç›®ä¿¡æ¯"></a> 1. <strong>é¡¹ç›®ä¿¡æ¯</strong></h2><h3 id="11-é¡¹ç›®ç¼–å·"><a class="markdownIt-Anchor" href="#11-é¡¹ç›®ç¼–å·"></a> 1.1. é¡¹ç›®ç¼–å·</h3><pre><code>210360225</code></pre><h3 id="12-é¡¹ç›®è¯¦æƒ…"><a class="markdownIt-Anchor" href="#12-é¡¹ç›®è¯¦æƒ…"></a> 1.2. é¡¹ç›®è¯¦æƒ…</h3><p>å›¾æ•°æ®åº“ Nebula Graph æ”¯æŒ JDBC åè®®ï¼šè®© Nebula Graph å¯ä»¥å¯¹æ¥ JDBC åè®®ï¼Œå®ç° Nebula JDBC driverï¼Œå®ç° JDBC çš„ç›¸å…³æ¥å£ã€‚è¦æ±‚ï¼šç”¨æˆ·å¯ç›´æ¥ä½¿ç”¨ JDBC é©±åŠ¨æ“ä½œ Nebula æœåŠ¡ï¼Œé¡¹ç›® repo æœ‰è‡ªåŠ¨è¿è¡Œçš„å•å…ƒæµ‹è¯•ã€‚</p><h3 id="13-nebula-graph-ç®€ä»‹"><a class="markdownIt-Anchor" href="#13-nebula-graph-ç®€ä»‹"></a> 1.3. Nebula Graph ç®€ä»‹</h3><p>ä¸€ä¸ªå¯é çš„åˆ†å¸ƒå¼ã€çº¿æ€§æ‰©å®¹ã€æ€§èƒ½é«˜æ•ˆçš„å›¾æ•°æ®åº“ï¼›ä¸–ç•Œä¸Šå”¯ä¸€èƒ½å¤Ÿå®¹çº³åƒäº¿ä¸ªé¡¶ç‚¹å’Œä¸‡äº¿æ¡è¾¹ï¼Œå¹¶æä¾›æ¯«ç§’çº§æŸ¥è¯¢å»¶æ—¶çš„å›¾æ•°æ®åº“è§£å†³æ–¹æ¡ˆã€‚</p><p>Nebula Graph ç‰¹æ€§ï¼š</p><ul><li><strong>å¼€æº</strong>ï¼šè‡´åŠ›äºä¸ <a href="https://discuss.nebula-graph.com.cn/">ç¤¾åŒºåˆä½œ</a> æ™®åŠåŠä¿ƒè¿›å›¾æ•°æ®åº“çš„å‘å±•;</li><li><strong>å®‰å…¨</strong>ï¼šå…·æœ‰åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ <a href="https://nebula-graph.com.cn/posts/access-control-design-code-nebula-graph/">æƒé™æ§åˆ¶</a> ï¼Œæˆæƒæ‰èƒ½è®¿é—®;</li><li><strong>æ‰©å±•æ€§</strong>ï¼šNebula Graph æ”¯æŒå¤šç§ç±»å‹ <a href="https://nebula-graph.io/cn/posts/nebula-graph-storage-engine-overview/">å­˜å‚¨å¼•æ“</a> æŸ¥è¯¢è¯­è¨€ä¹Ÿå¯ä»¥æ‹“å±•æ”¯æŒæ–°çš„ç®—æ³•;</li><li><strong>é«˜æ€§èƒ½</strong>ï¼šNebula Graph åœ¨ç»´æŒé«˜ååé‡çš„åŒæ—¶ä¾æ—§èƒ½åšåˆ° <a href="https://discuss.nebula-graph.com.cn/t/topic/782/5">ä½æ—¶å»¶çš„è¯»å†™</a>;</li><li><strong>æ‰©å®¹</strong>ï¼šåŸºäºshared-nothing <a href="https://nebula-graph.io/cn/posts/nebula-graph-architecture-overview/">åˆ†å¸ƒå¼æ¶</a> Nebula Graph æ”¯æŒçº¿æ€§æ‰©å®¹;</li><li><strong>å…¼å®¹</strong>: openCypherï¼šé€æ­¥å…¼å®¹ <a href="https://docs.nebula-graph.com.cn/2.0/2.quick-start/0.FAQ/#opencypher">openCypher9</a> ï¼ŒCypher ç”¨æˆ·å¯è½»æ¾ä¸Šæ‰‹ Nebula Graph;</li><li><strong>é«˜å¯ç”¨</strong>:Nebula Graph æ”¯æŒå¤šç§ç±»å‹<a href="https://nebula-graph.io/cn/posts/introduction-to-snapshot-in-nebula-graph/">å¿«ç…§</a>æ–¹å¼å®ç°æ•°æ®æ¢å¤ï¼Œä¿è¯åœ¨å±€éƒ¨å¤±è´¥çš„æƒ…å†µä¸‹æœåŠ¡çš„é«˜å¯ç”¨æ€§;</li><li><strong>2.0 GA</strong>ï¼šä¸€çº¿äº’è”ç½‘å¤§å‚è¯¸å¦‚äº¬ä¸œã€ç¾å›¢ã€å°çº¢ä¹¦åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ Nebula Graphï¼Œ<a href="https://space.bilibili.com/472621355/channel/detail?cid=175657">åº”ç”¨çš„åœºæ™¯</a>.</li></ul><p>Nebula Graph å…·æœ‰æ´»è·ƒçš„ç¤¾åŒºä¸åŠæ—¶çš„æŠ€æœ¯æ”¯æŒï¼Œè¿™æ˜¯<a href="https://nebula-graph.com.cn/">å®˜ç½‘</a>å’Œ<a href="https://github.com/vesoft-inc/nebula-graph">Githubä»“åº“</a>ï¼Œæ¬¢è¿å…³æ³¨åŠä½¿ç”¨ Nebula Graphï¼Œä¸€èµ·æˆä¸º Nebula Graph çš„ contributorï¼Œä¸ºå›¾æ•°æ®åº“çš„å‘å±•è´¡çŒ®åŠ›é‡ï¼ï¼ï¼</p><h2 id="2-é¡¹ç›®è½åœ°"><a class="markdownIt-Anchor" href="#2-é¡¹ç›®è½åœ°"></a> 2. <strong>é¡¹ç›®è½åœ°</strong></h2><h3 id="21-æ–¹æ¡ˆæè¿°"><a class="markdownIt-Anchor" href="#21-æ–¹æ¡ˆæè¿°"></a> 2.1. æ–¹æ¡ˆæè¿°ï¼š</h3><p><strong>å‰æœŸ</strong>äº†è§£ Nebula Graph ç›¸å…³åŠŸèƒ½ï¼ŒæŒæ¡å…¶åŸºæœ¬ä½¿ç”¨ï¼›è°ƒç ”JDBCçš„é©±åŠ¨å¼€å‘ï¼Œ é˜…è¯»JDBCè§„èŒƒæ–‡æ¡£ï¼Œäº†è§£ä¸€äº›éœ€è¦å®ç°çš„æ¥å£ï¼›<strong>ä¸­æœŸ</strong>å‚è€ƒ Neo4j çš„ <a href="https://github.com/neo4j-contrib/neo4j-jdbc">neo4j-jdbc</a> å®ç°ï¼Œå…‹éš† <a href="https://github.com/vesoft-inc/nebula-java">nebula-java</a> é¡¹ç›®, å­¦ä¹ æºç ï¼Œäº†è§£é¡¹ç›®ä»£ç çš„ä¸»è¦é€»è¾‘å’Œä»£ç é£æ ¼ï¼›<strong>åæœŸ</strong>åˆ©ç”¨å·²æœ‰çš„è½®å­ <a href="https://github.com/vesoft-inc/nebula-java">nebula-java</a> å®ç°ä¸æ•°æ®åº“çš„é€šä¿¡ï¼Œç¼–å†™ä»£ç ä¸º Nebula Graph å®ç° JDBC çš„ç›¸å…³æ¥å£ï¼Œ ç¼–å†™å•å…ƒæµ‹è¯•ã€‚</p><h3 id="22-å®ç°æè¿°"><a class="markdownIt-Anchor" href="#22-å®ç°æè¿°"></a> 2.2. å®ç°æè¿°</h3><p>è¿™ä¸ªé¡¹ç›®å®ç°çš„æ€è·¯å¾ˆæ¸…æ™°ï¼šimplements JDBC è§„èŒƒä¸­çš„ä¸€ç³»åˆ—æ¥å£ (ä¸»è¦ä½äº java.sql åŒ…ä¸­)ï¼Œå®ç°æ¥å£ä¸­çš„æ–¹æ³•ã€‚JDBC è§„èŒƒä¸­æ‰€æœ‰çš„ç±»åŠ èµ·æ¥éœ€è¦å®ç°çš„æ–¹æ³•æœ‰å¥½å‡ ç™¾ä¸ªã€‚JDBC ä¸»è¦é¢å‘çš„æ•°æ®åº“æ˜¯ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“ (RDB)ï¼Œè€Œ Nebula Graph ä½œä¸ºæ–°ä¸€ä»£çš„å›¾æ•°æ®åº“ï¼Œæ¯”èµ·ä¹…ç»å‘å±•çš„å…³ç³»å‹æ•°æ®åº“æ¥è¯´æ²¡æœ‰å®ƒé‚£ä¹ˆå®Œå¤‡çš„åŠŸèƒ½ç‰¹æ€§ï¼Œä½†æ˜¯åˆæ¯”å…³ç³»å‹æ•°æ®åº“å¤šå‡ºè®¸å¤šæ–°çš„ç‰¹ç‚¹ï¼Œæ‰€ä»¥ JDBC è§„èŒƒä¸­çš„æ–¹æ³•å¯¹äº Nebula Graph è€Œè¨€æ—¢æœ‰å¤šä½™(ä¸éœ€è¦çœŸæ­£å®ç°)ä¹Ÿæœ‰ä¸è¶³(éœ€è¦å®ç°ä½†æ˜¯æ²¡æœ‰åœ¨ç›¸å…³æ¥å£ä¸­å®šä¹‰)</p><p>åœ¨å…·ä½“çš„å®ç°ä¸­ï¼Œå®šä¹‰å‡ºä¸€äº›æŠ½è±¡ç±»ç›´æ¥ implements  è§„èŒƒä¸­çš„ä¸»è¦æ¥å£ï¼Œå†å®šä¹‰å‡ºå…·ä½“çš„å®ç°ç±»å®ç°æ¥å£ä¸­ä¸€äº›é‡è¦çš„æ–¹æ³•ï¼Œè¿™æ ·ä¸€æ¥å®ç°ç±»ä¸­çš„æ–¹æ³•åœ¨é˜…è¯»æ—¶ä¸ä¼šæ˜¾å¾—å¾ˆæ‚å¾ˆä¹±ã€‚å¯¹äºæ¥å£ä¸­éœ€è¦å®ç°çš„æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">for</span>( method :  æ¥å£çš„æ–¹æ³• )&#123;<br>    <span class="hljs-keyword">if</span>(method BELONG_TO  ä¸éœ€è¦å…·ä½“å®ç°çš„æ–¹æ³•)&#123;<br>        <span class="hljs-comment">// æ¯”å¦‚ Statement::getGeneratedKeys()</span><br>        åœ¨è¯¥æŠ½è±¡ç±»ä¸­ Overrideï¼Œæ–¹æ³•ä½“ä¸­æŠ›å‡ºä¸€ä¸ªSQLFeatureNotSupportedException;<br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(method BELONG_TO éœ€è¦å®ç°ä½†æ˜¯ä¸æ˜¯æ ¸å¿ƒæ–¹æ³•)&#123;<br>        <span class="hljs-comment">// æ¯”å¦‚ Statement::isClosed()</span><br>        åœ¨è¯¥æŠ½è±¡ç±»ä¸­ Overrideï¼›<br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(method BELONG_TO éœ€è¦å®ç°ä¸”æ˜¯æ ¸å¿ƒæ–¹æ³•)&#123;<br>        <span class="hljs-comment">// æ¯”å¦‚ Statement::execute(String nGql)</span><br>        åœ¨å…·ä½“å®ç°ç±»ä¸­ Override<br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(method BELONG_TO åœ¨æ¥å£ä¸­æ²¡æœ‰å®šä¹‰ä½†æ˜¯éœ€è¦å®ç°)&#123;<br>        <span class="hljs-comment">// æ¯”å¦‚ NebulaResult::getNode getEdge getPath (ç‚¹,è¾¹,è·¯å¾„æ˜¯å›¾æ•°æ®åº“ç‰¹æœ‰æ¦‚å¿µ)</span><br>        åœ¨å…·ä½“å®ç°ç±»ä¸­å®ç°<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é¡¹ç›®ä¸­ä¸»è¦çš„ä¸€äº› implements  å’Œ extends å…³ç³»å¦‚ä¸‹ï¼š(è“è‰²å®çº¿æ˜¯ç±»ä¹‹é—´çš„ extends å…³ç³»ï¼Œç»¿è‰²å®çº¿æ˜¯æ¥å£ä¹‹é—´çš„ implements å…³ç³»ï¼Œç»¿è‰²è™šçº¿æ˜¯æŠ½è±¡ç±»ä¸æ¥å£ä¹‹é—´çš„ implements å…³ç³»)</p><p><img src="/img/blog_pic/2021/nebula-jdbc%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84.png" alt="nebula-jdbcé¡¹ç›®æ¶æ„" /></p><p><strong>å·¥ä½œæµç¨‹åŠç±»ä¸­ä¸»è¦æ–¹æ³•åˆ†æ</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ç”¨æˆ·é¦–å…ˆé€šè¿‡ NebulaDriver æ³¨å†Œé©±åŠ¨ï¼Œå…¶ä¸­æœ‰ NebulaPool å±æ€§ï¼Œç”¨äºè·å– Session ä¸æ•°æ®åº“é€šä¿¡</span><br><span class="hljs-comment">// NebulaDriver ä¸­æä¾›ä¸¤ä¸ªæ„é€ å‡½æ•°ï¼Œæ— å‚æ„é€ å‡½æ•°é…ç½®é»˜è®¤çš„ NebulaPoolï¼Œæ¥æ”¶ä¸€ä¸ª Properties ç±»å‹å‚æ•°çš„æ„é€ å‡½æ•°å¯ä»¥è‡ªå®šä¹‰ NebulaPool é…ç½®</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">NebulaDriver</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException &#123;<br>    <span class="hljs-built_in">this</span>.setDefaultPoolProperties();<br>    <span class="hljs-built_in">this</span>.initNebulaPool();<br>    <span class="hljs-comment">// å°†è‡ªèº«æ³¨å†Œåˆ° DriverManager</span><br>    DriverManager.registerDriver(<span class="hljs-built_in">this</span>);<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">NebulaDriver</span><span class="hljs-params">(Properties poolProperties)</span> <span class="hljs-keyword">throws</span> SQLException &#123;<br>    <span class="hljs-built_in">this</span>.poolProperties = poolProperties;<br>    <span class="hljs-built_in">this</span>.initNebulaPool();<br>    <span class="hljs-comment">// å°†è‡ªèº«æ³¨å†Œåˆ° DriverManager</span><br>    DriverManager.registerDriver(<span class="hljs-built_in">this</span>);<br>&#125;<br><br><span class="hljs-comment">// æ³¨å†Œé©±åŠ¨åç”¨æˆ·å¯ä»¥ DriverManager::getConnection(String url) è·å–è¿æ¥ã€‚åœ¨ NebulaConnection çš„æ„é€ å‡½æ•°ä¸­ä¼šé€šè¿‡ NebulaDriver ä¸­çš„ NebulaPool è·å– Session æ¥ç€è¿æ¥è®¿é—®åœ¨ url ä¸­æŒ‡å®šçš„å›¾ç©ºé—´</span><br><br><span class="hljs-comment">// è·å–åˆ° Connection åç”¨æˆ·å¯ä»¥ç”¨ Connection::createStatement å’Œ Connection::prepareStatement æ‹¿åˆ° Statement æˆ–è€… PreparedStatement å¯¹è±¡ï¼Œè°ƒç”¨å…¶ä¸­çš„ execute æ–¹æ³•å‘æ•°æ®åº“å‘é€å‘½ä»¤ï¼Œæ•°æ®åº“æ‰§è¡Œæ­¤å‘½ä»¤åçš„ç»“æœä¼šå°è£…åœ¨ NebulaResult ä¸­ï¼Œå†è°ƒç”¨å…¶ä¸­å„ç§è·å–æ•°æ®çš„æ–¹æ³•å¯ä»¥å¾—åˆ°ä¸åŒæ•°æ®ç±»å‹çš„æ•°æ®</span><br><br><span class="hljs-comment">// ç›®å‰ NebulaResult ä¸­å®ç°çš„è·å–æ•°æ®æ–¹æ³•æœ‰ä»¥ä¸‹è¿™äº›ï¼ŒNebula Graph ä¸­ä¸åŒçš„æ•°æ®ç±»å‹éƒ½æœ‰å¯¹åº”å®ç°</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">getString</span><span class="hljs-params">()</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getInt</span><span class="hljs-params">()</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getLong</span><span class="hljs-params">()</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">getBoolean</span><span class="hljs-params">()</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">getDouble</span><span class="hljs-params">()</span>;<br><span class="hljs-keyword">public</span> java.sql.Date <span class="hljs-title function_">getDate</span><span class="hljs-params">()</span>;<br><span class="hljs-keyword">public</span> java.sql.Time <span class="hljs-title function_">getTime</span><span class="hljs-params">()</span>;<br><span class="hljs-keyword">public</span> DateTimeWrapper <span class="hljs-title function_">getDateTime</span><span class="hljs-params">()</span>;<br><span class="hljs-keyword">public</span> Node <span class="hljs-title function_">getNode</span><span class="hljs-params">()</span>;<br><span class="hljs-keyword">public</span> Relationship <span class="hljs-title function_">getEdge</span><span class="hljs-params">()</span>;<br><span class="hljs-keyword">public</span> PathWrapper <span class="hljs-title function_">getPath</span><span class="hljs-params">()</span>;<br><span class="hljs-keyword">public</span> List <span class="hljs-title function_">getList</span><span class="hljs-params">()</span>;<br><span class="hljs-keyword">public</span> Set <span class="hljs-title function_">getSet</span><span class="hljs-params">()</span>;<br><span class="hljs-keyword">public</span> Map <span class="hljs-title function_">getMap</span><span class="hljs-params">()</span>;<br></code></pre></td></tr></table></figure><h2 id="3-é¡¹ç›®è¿›åº¦"><a class="markdownIt-Anchor" href="#3-é¡¹ç›®è¿›åº¦"></a> 3. <strong>é¡¹ç›®è¿›åº¦</strong></h2><h3 id="31-å·²å®Œæˆå·¥ä½œ"><a class="markdownIt-Anchor" href="#31-å·²å®Œæˆå·¥ä½œ"></a> 3.1. å·²å®Œæˆå·¥ä½œï¼š</h3><ul><li>éƒ¨ç½² Nebula Graph å¹¶æŒæ¡å…¶åŸºæœ¬ä½¿ç”¨ï¼›</li><li>é˜…è¯» <a href="https://download.oracle.com/otn-pub/jcp/jdbc-4_2-mrel2-spec/jdbc4.2-fr-spec.pdf">JDBC è§„èŒƒæ–‡æ¡£</a> , æ˜ç¡®å®ç°è¦æ±‚ï¼›</li><li>å­¦ä¹   <a href="https://github.com/vesoft-inc/nebula-java">nebula-java</a> æºç ï¼›</li><li>ï¼ˆè¾ƒè®¡åˆ’æå‰ï¼‰å®Œæˆä»¥ä¸‹å®ç°ï¼š</li></ul><p><img src="/img/blog_pic/2021/%E5%B7%B2%E5%AE%8C%E6%88%90.png" alt="" /></p><h3 id="32-é‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ"><a class="markdownIt-Anchor" href="#32-é‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ"></a> 3.2. é‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ¡ˆï¼š</h3><ul><li>å¦‚ä½•ä¸æ•°æ®åº“é€šä¿¡çš„é—®é¢˜ï¼š</li></ul><p>é¡¹ç›®å‰æœŸè¿‡ç¨‹ä¸­ä¸çŸ¥é“å¦‚ä½•ä¸æ•°æ®åº“é€šä¿¡ï¼Œåœ¨ç ”ç©¶å‹å•† Neo4j çš„  <a href="https://github.com/neo4j-contrib/neo4j-jdbc">neo4j-jdbc</a> å®ç°ååˆ©ç”¨ Http æ¡†æ¶é€šè¿‡ Nebula Graph çš„ api ï¼ˆç²—ç³™åœ°ï¼‰å®ç°äº†ä¸æ•°æ®åº“çš„é€šä¿¡ï¼›å®Œæˆåä¸å¯¼å¸ˆè”ç³»è¯¢é—®è¯¥æƒ³æ³•æ˜¯å¦å¯è¡Œï¼Œå¯¼å¸ˆå‘Šè¯‰æˆ‘å¯ä»¥ç”¨å·²æœ‰çš„è½®å­  <a href="https://github.com/vesoft-inc/nebula-java">nebula-java</a>ï¼Œé€šè¿‡ rpc ä¸ Nebula Graph é€šä¿¡ã€‚</p><ul><li>å…³äºè·å– Connection çš„é—®é¢˜ï¼š</li></ul><p>NebulaPoolConfig ç±»ä¸­çš„ä¸€äº›å‚æ•°æ˜¯å¯é…ç½®çš„ï¼Œæˆ‘çš„æƒ³æ³•æ˜¯ä»¥åœ¨è¿æ¥å­—ç¬¦ä¸²ä¸­æŒ‡å®šçš„å½¢å¼è¿›è¡Œé…ç½®ï¼Œå¦‚ï¼šâ€œjdbc:nebula://ip:port/graphSpace?maxConnsSize=10&amp;reconnect=trueâ€ã€‚å’¨è¯¢å¯¼å¸ˆåå¯¼å¸ˆå»ºè®®å¯ä»¥è®©ç”¨æˆ·è·å–è¿æ¥çš„æ—¶å€™ï¼Œæ”¯æŒä¸¤ç§æ¥å£ï¼Œä¸€ç§æ˜¯ç”¨é»˜è®¤é…ç½®ï¼Œä¸€ç§æ˜¯è®©ç”¨æˆ·æŒ‡å®šé…ç½®ï¼Œå¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// default configuration</span><br>DriverManager.getConnection(url, username, password);<br><br><span class="hljs-comment">// customized configuration</span><br>DriverManager.getConnection(url,config);<br></code></pre></td></tr></table></figure><ul><li>å…³äº PreparedStatement çš„é—®é¢˜ï¼š</li></ul><p>å…³ç³»å‹æ•°æ®åº“æ”¯æŒæŸ¥è¯¢è¯­å¥é¢„ç¼–è¯‘çš„åŠŸèƒ½ï¼ŒPreparedStatement  å¯ä»¥å‘ DBMS å‘é€ SQL è®©å…¶é¢„ç¼–è¯‘ç„¶åå†ä¼ å‚æ•°ï¼Œæé«˜äº†æ€§èƒ½ä¸”èƒ½é˜²æ­¢ SQLã€€æ³¨å…¥æ”»å‡»ï¼›ç›®å‰ Nebula Graph æš‚æ— æ­¤åŠŸèƒ½ï¼Œ æ‰€ä»¥åœ¨æœ¬åœ°è§£æ nGql ä¸­çš„å ä½ç¬¦å†å°†å‚æ•°å¡«å……è¿›å»ï¼Œæœ¬è´¨ä¸Šä¸ Statement ç›¸åŒã€‚</p><ul><li>nebula-java ç‰ˆæœ¬é—®é¢˜ï¼š</li></ul><p>ä¸€å¼€å§‹åœ¨é¡¹ç›®ä¸­å¼•å…¥çš„ä¾èµ–çš„ 2.0.0 ç‰ˆæœ¬ï¼Œåœ¨ä¸€æ¬¡æŸ¥è¯¢ä¸­å‘ç°å…¶è·¯å¾„è¿”å›ç»“æœä¸æ§åˆ¶å°è¿”å›ç»“æœä¸ä¸€è‡´ï¼Œå’¨è¯¢å¯¼å¸ˆåå‘ç°è¿™æ˜¯è¿™ä¸ªç‰ˆæœ¬ä¸­çš„ bugï¼Œæ”¹ç”¨æœ€æ–°çš„ 2.0.0-SNAPSHOT ç‰ˆæœ¬ã€‚</p><ul><li>updateCount é—®é¢˜ï¼š</li></ul><p>JDBC æ¥å£ä¸­ä¸€äº›æ–¹æ³•è¦æ±‚è¿”å›å€¼æ˜¯æ”¶åˆ°æ­¤æ–¹æ³•å½±å“çš„æ•°æ®é‡ (updateCount) ï¼Œä½†ç›®å‰æœåŠ¡ç«¯æ²¡æœ‰ updateCount ç»Ÿè®¡è¿”å›ç»™ç”¨æˆ·ã€‚å‡å¦‚ç”¨æˆ·ä¸€æ¡æ’å…¥è¯­å¥é‡Œé¢åŒæ—¶æ’å…¥å¤šä¸ªç‚¹æˆ–è€…å¤šæ¡è¾¹ï¼Œè¿™é‡Œé¢å¯èƒ½æœ‰éƒ¨åˆ†æˆåŠŸï¼Œä½†æœåŠ¡ç«¯åªä¼šè¿”å›å‘Šè¯‰ç”¨æˆ·å¤±è´¥äº†ï¼Œä½†æ˜¯å…¶å®ç”¨æˆ·å¯èƒ½èƒ½æŸ¥åˆ°éƒ¨åˆ†æ•°æ®ã€‚è¿™ä¸ª updateCount æŒ‰ç…§0è¿”å›ï¼Œç„¶ååœ¨æ¥å£æ·»åŠ æ³¨é‡Šè¯´æ˜ä¸æ”¯æŒã€‚</p><ul><li>NebulaPool åˆå§‹åŒ–é—®é¢˜ï¼š</li></ul><p>ä¸€å¼€å§‹æˆ‘æ˜¯åœ¨åˆå§‹åŒ– NebulaConnection æ—¶åˆå§‹åŒ– NebulaPool å†è·å– Sessionï¼Œè€Œä¸”ææ··äº†å¯¹äº NebulaPool çš„é…ç½®å’Œå¯¹äº Session çš„é…ç½®ã€‚è¿™æ ·çš„è¯ç”¨æˆ·æ¯æ¬¡è·å– Connection æ—¶éƒ½ä¼šé‡æ–°åˆå§‹åŒ– NebulaPoolï¼Œæ˜¯ä¸åˆç†çš„ï¼Œæˆ‘æäº¤ä»£ç åˆ° Gitlab å¯¼å¸ˆ review åæŒ‡å‡ºäº†æˆ‘çš„é”™è¯¯ï¼Œå»ºè®®æˆ‘å°† NebulaPool çš„ åˆå§‹åŒ–å’Œå…³é—­ç§»åˆ° NebulaDriver ä¸­ï¼Œå†æé«˜é»˜è®¤é…ç½®å’Œè‡ªå®šä¹‰é…ç½®ä¸¤ç§æ–¹å¼åˆå§‹åŒ– NebulaPoolã€‚</p><h3 id="33-åç»­å·¥ä½œå®‰æ’"><a class="markdownIt-Anchor" href="#33-åç»­å·¥ä½œå®‰æ’"></a> 3.3. åç»­å·¥ä½œå®‰æ’ï¼š</h3><ul><li>å®Œæˆæ¥å£ä¸­åº”è¯¥å®ç°ä½†æœªå®ç°çš„æ–¹æ³•ï¼›</li><li>å®Œæˆå•å…ƒæµ‹è¯•ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¼€æº</tag>
      
      <tag>å¼€æºä¹‹å¤</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windows 10 ä½¿ç”¨ Docker å®‰è£… Nebula Graph</title>
    <link href="/2021/06/10/Windows%2010%20%E4%BD%BF%E7%94%A8%20Docker%20%E5%AE%89%E8%A3%85%20Nebula%20Graph/"/>
    <url>/2021/06/10/Windows%2010%20%E4%BD%BF%E7%94%A8%20Docker%20%E5%AE%89%E8%A3%85%20Nebula%20Graph/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h2><p>è¿™ç¯‡æ–‡ç« è®°å½•äº†æˆ‘æ˜¯å¦‚ä½•åœ¨ Windows ä¸Šé€šè¿‡ Docker å®‰è£… NG çš„ï¼Œæ„Ÿè§‰ NG çš„å®‰è£…æ¯”å…¶ä»–æ•°æ®åº“éº»çƒ¦ä¸€äº›ï¼Œæ‰€ä»¥è®°å½•ä¸€ä¸‹ã€‚å¯ä»¥ç»“åˆè¿™ç¯‡æ–‡ç« å’Œå®˜ç½‘çš„<a href="https://docs.nebula-graph.com.cn/2.0.1/2.quick-start/2.deploy-nebula-graph-with-docker-compose/">æ•™ç¨‹</a>è¿›è¡Œå®‰è£…ã€‚</p><h2 id="å®‰è£…-docker"><a class="markdownIt-Anchor" href="#å®‰è£…-docker"></a> å®‰è£… Docker</h2><p>Docker å®˜ç½‘ä¸‹è½½å¯¹åº”çš„å®‰è£…åŒ… <a href="https://docs.docker.com/engine/install/">Install Docker Engine</a>ï¼ŒWindows çš„ Docker Desktop è‡ªå¸¦äº† Docker Compose æ‰€ä»¥ä¸éœ€è¦é¢å¤–å®‰è£…ã€‚å…·ä½“çš„å®‰è£…å¯ä»¥å‚è€ƒ</p><ol><li><a href="https://www.jianshu.com/p/736984429364">å®‰è£… Hyper-V</a></li><li><a href="https://jingyan.baidu.com/article/ac6a9a5e1f164a2b653eac33.html">å¼€å¯ Hyper-V</a></li><li><a href="https://www.jianshu.com/p/74291add4ee5">å®‰è£… Docker</a></li></ol><h2 id="clone-ä»“åº“"><a class="markdownIt-Anchor" href="#clone-ä»“åº“"></a> clone ä»“åº“</h2><ol><li><a href="https://github.com/vesoft-inc/nebula-docker-compose">nebula-docker-compose</a> æ•°æ®åº“çš„åç«¯ï¼ˆæ¨èv2.0.0åˆ†æ”¯ï¼‰</li><li><a href="https://github.com/vesoft-inc/nebula-graph-studio">nebula-graph-studio</a> ï¼ˆå‰ç«¯ï¼Œmaster åˆ†æ”¯ï¼‰</li></ol><h2 id="å®‰è£…å¹¶å¼€å¯-nebula-docker-composeåç«¯"><a class="markdownIt-Anchor" href="#å®‰è£…å¹¶å¼€å¯-nebula-docker-composeåç«¯"></a> å®‰è£…å¹¶å¼€å¯ nebula-docker-composeï¼ˆåç«¯ï¼‰</h2><ul><li>æ¥åˆ° nebula-docker-compose æ‰€åœ¨æ–‡ä»¶å¤¹ï¼ŒæŒ‰ shift åŒæ—¶å³é”®ï¼Œé€‰æ‹©æ‰“å¼€ powershell</li><li>è¾“å…¥å‘½ä»¤ <code>docker-compose up -d</code> (ç”±äºç½‘ç»œåŸå› å¯èƒ½æœ‰äº›èµ„æºä¸‹è½½å¤±è´¥, å¤šè¯•å‡ æ¬¡å°±å¥½ï¼‰ï¼ŒæˆåŠŸä¹‹ååœ¨ Docker ä¸­ä¼šå¤šå‡ºä¸€äº›é•œåƒ</li></ul><p><img src="/img/blog_pic/2022/NG%E5%AE%89%E8%A3%85-1.png" alt="" /></p><p><img src="/img/blog_pic/2022/NG%E5%AE%89%E8%A3%85-2.png" alt="" /></p><ul><li>ä¸Šä¸€æ­¥å®Œæˆä¹‹åè¾“å…¥å‘½ä»¤ <code>docker run --rm -ti --network nebula-docker-compose_nebula-net --entrypoint=/bin/sh vesoft/nebula-console:v2-nightly</code> ï¼ˆè¿™é‡Œçš„<code>nebula-docker-compose_nebula-net</code>æ˜¯ç½‘ç»œçš„åå­—ï¼Œå¯ä»¥åœ¨å‘½ä»¤è¡Œä½¿ç”¨ <code>docker network ls</code> æŸ¥çœ‹ç½‘ç»œï¼‰</li></ul><p><img src="/img/blog_pic/2022/NG%E5%AE%89%E8%A3%85-3.png" alt="" /></p><ul><li>è¾“å…¥ <code>nebula-console -u user -p password --address=graphd --port=9669</code> ï¼ˆgraphdä¸ç”¨æ”¹ï¼‰ï¼ŒæˆåŠŸä¹‹åè¾“å…¥ <code>show hosts</code> æ£€æŸ¥ <code>nebula-storaged</code> è¿›ç¨‹çŠ¶æ€</li></ul><p><img src="/img/blog_pic/2022/NG%E5%AE%89%E8%A3%85-4.png" alt="" /></p><ul><li>è¿™æ—¶å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­æ¥åˆ° nebula-docker-compose æ‰€åœ¨æ–‡ä»¶å¤¹, è¾“å…¥ <code>docker-compose ps</code> åˆ—å‡º Nebula Graph æœåŠ¡çš„çŠ¶æ€å’Œç«¯å£</li></ul><p><img src="/img/blog_pic/2022/NG%E5%AE%89%E8%A3%85-5.png" alt="" /></p><ul><li>æ­¤æ—¶åç«¯ç®—æ˜¯æˆåŠŸéƒ¨ç½²å¹¶ä¸”å¼€å¯äº†ï¼Œåœæ­¢æœåŠ¡å¯ä»¥ä½¿ç”¨ <code>docker-compose down</code></li></ul><h2 id="å®‰è£…å¹¶å¼€å¯-nebula-graph-studioå‰ç«¯"><a class="markdownIt-Anchor" href="#å®‰è£…å¹¶å¼€å¯-nebula-graph-studioå‰ç«¯"></a> å®‰è£…å¹¶å¼€å¯ nebula-graph-studioï¼ˆå‰ç«¯ï¼‰</h2><ul><li>æ¥åˆ° nebula-graph-studio æ‰€åœ¨æ–‡ä»¶å¤¹ï¼ŒåŒæ ·åœ¨æ­¤æ‰“å¼€ powershellï¼Œdocker-compose pull æ‹‰å–é•œåƒï¼ˆä¸€æ¬¡æ‹‰å–ä¸æˆåŠŸå°±å¤šè¯•å‡ æ¬¡ï¼Œæ‹‰å®Œä¹‹å Docker ä¸­åŒæ ·ä¼šå‡ºç°è¿™äº›é•œåƒï¼‰</li></ul><p><img src="/img/blog_pic/2022/NG%E5%AE%89%E8%A3%85-6.png" alt="" /></p><p><img src="/img/blog_pic/2022/NG%E5%AE%89%E8%A3%85-7.png" alt="" /></p><ul><li>ç»§ç»­è¾“å…¥å‘½ä»¤ <code>docker-compose up -d</code> å¼€å¯ Studio æœåŠ¡</li></ul><p><img src="/img/blog_pic/2022/NG%E5%AE%89%E8%A3%85-8.png" alt="" /></p><ul><li>å¯åŠ¨æˆåŠŸåï¼Œåœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥ <code>http://ip address:7001</code>ï¼Œåœ¨æµè§ˆå™¨çª—å£ä¸­èƒ½çœ‹åˆ°ä»¥ä¸‹ç™»å½•ç•Œé¢ï¼Œè¡¨ç¤ºå·²ç»æˆåŠŸéƒ¨ç½²å¹¶å¯åŠ¨ Studioã€‚</li></ul><p><img src="/img/blog_pic/2022/NG%E5%AE%89%E8%A3%85-9.png" alt="" /></p><ul><li>host å¡«ä½ çš„ ip åœ°å€:9669 (å‘½ä»¤è¡Œä¸­ç”¨ ipconfig å¯ä»¥å¸¸çœ‹ï¼Œå¥½åƒä¸èƒ½å¡«127.0.0.1)ï¼Œç”¨æˆ·å user, å¯†ç  password</li></ul><p><img src="/img/blog_pic/2022/NG%E5%AE%89%E8%A3%85-10.png" alt="" /></p><ul><li>æ¥ä¸‹æ¥å¯ä»¥æŒ‰ç…§å®˜ç½‘çš„<a href="https://docs.nebula-graph.com.cn/2.0.1/2.quick-start/4.nebula-graph-crud/">æ•™ç¨‹</a>ç»ƒä¹  CRUD</li></ul>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¼€æº</tag>
      
      <tag>ç¯å¢ƒæ­å»º</tag>
      
      <tag>å¼€æºä¹‹å¤</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åœ¨ IDEA ä¸­é…ç½®å¹¶è¿è¡Œä¸»ç«™ä»£ç </title>
    <link href="/2021/04/02/%E5%9C%A8%20IDEA%E4%B8%AD%E9%85%8D%E7%BD%AE%E5%B9%B6%E8%BF%90%E8%A1%8C%E4%B8%BB%E7%AB%99%E4%BB%A3%E7%A0%81/"/>
    <url>/2021/04/02/%E5%9C%A8%20IDEA%E4%B8%AD%E9%85%8D%E7%BD%AE%E5%B9%B6%E8%BF%90%E8%A1%8C%E4%B8%BB%E7%AB%99%E4%BB%A3%E7%A0%81/</url>
    
    <content type="html"><![CDATA[<h2 id="1-å‰è¨€"><a class="markdownIt-Anchor" href="#1-å‰è¨€"></a> 1. å‰è¨€</h2><p>MyEclipse 8.5 åˆä¸‘åˆéš¾ç”¨ï¼Œæ®è¯´åªèƒ½ç”¨å®ƒæ”¹ä¸»ç«™ä»£ç ï¼Œæˆ‘åšä¿¡ MyEclipse èƒ½åšåˆ°çš„ IntelliJ IDEA ç»å¯¹èƒ½åšåˆ°å¹¶ä¸”åšå¾—æ›´å¥½</p><h2 id="2-ç›¸å…³å·¥ä½œ"><a class="markdownIt-Anchor" href="#2-ç›¸å…³å·¥ä½œ"></a> 2. ç›¸å…³å·¥ä½œ</h2><p>ä¸çŸ¥é“è°å†™çš„ SSH å¼€å‘æ•™ç¨‹</p><h2 id="3-è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#3-è¿‡ç¨‹"></a> 3. è¿‡ç¨‹</h2><p>æ–‡ä¸­æåˆ°çš„å®‰è£…åŒ…éƒ½æ”¾åœ¨å°é¾™çš„å±€åŸŸç½‘é‡Œ</p><h3 id="31-å®‰è£…-tortoisesvn"><a class="markdownIt-Anchor" href="#31-å®‰è£…-tortoisesvn"></a> 3.1 å®‰è£… TortoiseSVN</h3><p><a href="https://blog.csdn.net/u010758410/article/details/80532992">https://blog.csdn.net/u010758410/article/details/80532992</a></p><p>å®‰è£…å®Œåå¯ä»¥åœ¨ SVN (åœ°å€ï¼š<a href="http://192.168.66.2:89/svn/repo/trunk/scholat">http://192.168.66.2:89/svn/repo/trunk/scholat</a>) é‡Œæ‹‰å–ä¸»ç«™ä»£ç ï¼Œç”¨æˆ·åå’Œå¯†ç é—®åå“¥è¦</p><p><img src="/img/blog_pic/2021/%E9%85%8D%E7%BD%AE1.png" alt="" /></p><p>å³é”® checkout åˆ°æŒ‡å®šç›®å½•</p><h3 id="32-é…ç½®tomcat"><a class="markdownIt-Anchor" href="#32-é…ç½®tomcat"></a> 3.2 é…ç½®Tomcat</h3><p>tomcat 7 åŒæ ·æ”¾åœ¨å±€åŸŸç½‘é‡Œ</p><p><img src="/img/blog_pic/2021/%E9%85%8D%E7%BD%AE2.png" alt="" /></p><p>é…ç½®é¡¹ç›®å‘å¸ƒ</p><p><img src="/img/blog_pic/2021/%E9%85%8D%E7%BD%AE3.png" alt="" /></p><h3 id="33-æ›´æ”¹ç¼–ç æ–¹å¼"><a class="markdownIt-Anchor" href="#33-æ›´æ”¹ç¼–ç æ–¹å¼"></a> 3.3 æ›´æ”¹ç¼–ç æ–¹å¼</h3><p>å°è¯•è¿è¡Œä¸€ä¸‹ï¼Œä¼šæŠ¥ä¸€å¡æˆé”™ã€‚è¿™æ—¶å°†é¡¹ç›®ç¼–ç æ–¹å¼æ”¹ä¸º UTF-8ï¼Œæœ‰äº›æ–‡ä»¶ä¼šæç¤ºä¸æ˜¯ UTF-8 ç¼–ç å«ä½ æ¢æˆ GBK ï¼Œåˆ«å¬å®ƒçš„ã€‚<img src="/img/blog_pic/2021/%E9%85%8D%E7%BD%AE4.png" alt="" /></p><p>å¹¶ä¸”æŒ‡å®šé¡¹ç›®ç¯å¢ƒä¸ºJDK 6</p><p><img src="/img/blog_pic/2021/%E9%85%8D%E7%BD%AE5.png" alt="" /></p><p><img src="/img/blog_pic/2021/%E9%85%8D%E7%BD%AE6.png" alt="" /></p><p><img src="/img/blog_pic/2021/%E9%85%8D%E7%BD%AE7.png" alt="" /></p><p>åšå®Œä¸Šé¢è¿™äº›åº”è¯¥å¯ä»¥äº†ï¼Œ</p><p><img src="/img/blog_pic/2021/%E9%85%8D%E7%BD%AE8.png" alt="" /></p>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç¯å¢ƒæ­å»º</tag>
      
      <tag>IDE</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>redis ç¼“å­˜åœ¨è¯¾ç¨‹å¹³å°ä¸­çš„ä½¿ç”¨</title>
    <link href="/2020/11/09/redis%E7%BC%93%E5%AD%98%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <url>/2020/11/09/redis%E7%BC%93%E5%AD%98%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h3 id="redisç¼“å­˜åœ¨é¡¹ç›®ä¸­çš„ä½¿ç”¨"><a class="markdownIt-Anchor" href="#redisç¼“å­˜åœ¨é¡¹ç›®ä¸­çš„ä½¿ç”¨"></a> redisç¼“å­˜åœ¨é¡¹ç›®ä¸­çš„ä½¿ç”¨</h3><h4 id="1-ç¯å¢ƒæ­å»º"><a class="markdownIt-Anchor" href="#1-ç¯å¢ƒæ­å»º"></a> 1ã€ç¯å¢ƒæ­å»º</h4><p>redisæ•°æ®åº“(Redis-x64-5.0.10.zip)å’Œæ¡Œé¢å¯è§†åŒ–å·¥å…·(RedisDesktopManager_42636.zip)æ”¾åœ¨å°é¾™å±€åŸŸç½‘ä¸‹çš„toShareæ–‡ä»¶å¤¹ä¸­ã€‚é¡¹ç›®ç›®å‰ç”¨çš„æ˜¯åœ¨æˆ‘çš„ä¸»æœºä¸Šé…ç½®å¥½çš„redisæ•°æ®åº“ï¼Œå¦‚æœåªæ˜¯çœ‹ä½¿ç”¨è¿‡ç¨‹ä¸­ç¼“å­˜ç”Ÿå­˜çš„è¿‡ç¨‹å¯ä»¥åªå®‰è£…å¯è§†åŒ–å·¥å…·ï¼Œè¿æ¥æˆ‘çš„æ•°æ®åº“å°±å¯ä»¥ï¼ˆè¿æ¥åè‡ªå®šä¹‰ï¼Œåœ°å€ï¼š192.168.66.116ï¼Œæ²¡æœ‰å¯†ç ï¼‰ã€‚å¦‚æœæƒ³æ­å»ºè‡ªå·±çš„redisæ•°æ®åº“ï¼Œç”¨ä¸Šé¢çš„å®‰è£…åŒ…ï¼Œè‡ªå·±æŸ¥ä¸€ä¸‹å®‰è£…æ­¥éª¤å³å¯ã€‚</p><h4 id="2-å…·ä½“ä½¿ç”¨"><a class="markdownIt-Anchor" href="#2-å…·ä½“ä½¿ç”¨"></a> 2ã€å…·ä½“ä½¿ç”¨</h4><p>å‚è€ƒåšå®¢ï¼š<a href="https://www.cnblogs.com/coding-one/p/12402543.html">https://www.cnblogs.com/coding-one/p/12402543.html</a></p><p>ç¼“å­˜ä¸€èˆ¬ç”¨åœ¨æŸ¥è¯¢æ–¹æ³•ï¼Œåœ¨ServiceImplç±»ä¸­çš„æŸä¸ªæŸ¥è¯¢æ–¹æ³•ä¸ŠåŠ ä¸Š @Cacheable æ³¨è§£å³å¯ã€‚æ³¨è§£ä¸­éœ€è¦å¡«å†™ç¼“å­˜åå’Œkeyã€‚</p><ul><li><p>ç¼“å­˜åï¼šæœ‰ä¸¤ä¸ªå‚æ•°æ¥æŒ‡å®šï¼švalueã€cacheNamesï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯cacheNamesï¼Œå¹¶ä¸”é‡å†™äº†æ„é€ æ–¹æ³•ï¼Œåœ¨ç¼“å­˜åæœ€ååŠ ä¸Š#å†åŠ ä¸Šæ•°å­—ï¼Œè¡¨ç¤ºè¿™æ¡ç¼“å­˜çš„æœ‰æ•ˆæ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰ã€‚ç¤ºä¾‹ï¼š@Cacheable( cacheNames = â€œscholat#60â€ ,  keyGenerator = â€œkeyGeneratorâ€)ï¼Œè¡¨ç¤ºè¿™ä¸ªæ–¹æ³•ç”Ÿæˆçš„ç¼“å­˜åä¸ºscholatï¼Œæœ‰æ•ˆæ—¶é—´ä¸º60ç§’ï¼Œè¿‡æœŸåredisä¼šè‡ªåŠ¨åˆ é™¤ç¼“å­˜ã€‚</p></li><li><p>keyï¼šredisæ˜¯é”®å€¼æ•°æ®åº“ï¼Œæ¯ä¸€æ¡è®°å½•éƒ½æœ‰å”¯ä¸€çš„keyä¸ä¹‹å¯¹åº”ï¼ˆä¸Šé¢çš„ç¼“å­˜åå¯ä»¥è§†ä¸ºä¸€ä¸ªç¼“å­˜åˆ†ç»„ï¼Œæ”¹åˆ†ç»„ä¸‹æœ‰å¯¹åº”ä¸åŒkeyçš„ç¼“å­˜ï¼‰ã€‚å»ºè®®è‡ªå·±åœ¨æ³¨è§£ä¸­æŒ‡å®škeyï¼Œä¸è¦ç”¨é»˜è®¤ç”Ÿæˆçš„ã€‚keyå¯ä»¥ç”¨springè¡¨è¾¾å¼ï¼ˆSpElï¼‰æè¿°ï¼Œä¹Ÿå¯ä»¥åœ¨redisé…ç½®ç±»ä¸­è‡ªå®šä¹‰ keyGenerator(å¦‚æœä¸æŒ‡å®škeyçš„è¯ä¼šä½¿ç”¨é»˜è®¤çš„SimpleKeyGenerator)ã€‚æˆ‘åœ¨configåŒ…ä¸‹çš„RedisConfigä¸­è‡ªå®šä¹‰äº†ä¸€ä¸ªkeyGeneratorï¼Œæœ‰éœ€è¦çš„å¯ä»¥è‡ªå·±çš„æƒ…å†µå†å®šä¹‰å…¶ä»–keyGeneratorã€‚å‡è®¾ä½ å®šä¹‰çš„keyGeneratorå†™æ³•å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"> <span class="hljs-keyword">public</span> KeyGenerator <span class="hljs-title function_">mykeyGenerator</span><span class="hljs-params">()</span> &#123;<br>     <span class="hljs-keyword">return</span> (o, method, objects) -&gt; &#123;<br><span class="hljs-comment">// ***</span><br>     &#125;;<br> &#125;<br></code></pre></td></tr></table></figure><p>ç”¨æ³•ä¸º@Cacheable( cacheNames =  ,  keyGenerator = â€œmykeyGeneratorâ€)</p></li><li><p>æ³¨æ„ï¼šä½¿ç”¨ç¼“å­˜åï¼Œå¦‚æœå…¶ä»–æ–¹æ³•ï¼ˆå¢åˆ æ”¹æ–¹æ³•ï¼‰ä¼šæ”¹å˜è¿™ä¸ªæŸ¥è¯¢æ–¹æ³•çš„è¿”å›å€¼ï¼Œè®°å¾—è¦æ¸…é™¤åŸæ¥çš„ç¼“å­˜ã€‚æ¯”å¦‚åœ¨æŸ¥è¯¢æŸè¯¾ç¨‹çš„æ‰€æœ‰ç­çº§æ–¹æ³•å’Œä¿®æ”¹ç­çº§æ–¹æ³•ï¼Œå‰ç«¯åœ¨ä¿®æ”¹ç­çº§åä¼šåˆ·æ–°ï¼Œå¦‚æœä¸æ¸…é™¤ç¼“å­˜çš„è¯åˆ·æ–°åçš„ç»“æœè¿˜æ˜¯æ²¡æœ‰å˜åŒ–ï¼ˆå°½ç®¡å®é™…ä¸Šæ›´æ”¹å·²ç»å†™åˆ°æ•°æ®åº“ä¸­äº†ï¼‰ã€‚å¯ä»¥è€ƒè™‘æ›´æ–°ç¼“å­˜@CachePutæˆ–è€…åˆ é™¤ç¼“å­˜@CacheEvictï¼Œä¸è¿‡è¿™ä¸¤ä¸ªæ³¨è§£æˆ‘è¿˜æ²¡ç”¨ä¸Šï¼Œæˆ‘æ˜¯è‡ªå·±å†™çš„æ‰‹åŠ¨åˆ é™¤ç¼“å­˜ï¼ˆstringRedisTemplate.delete(keys); å…·ä½“å¯è§CourseDiscussReplyServiceImplç±»ä¸­çš„addReplyå’ŒdeleteReplyæ–¹æ³•ï¼‰ï¼Œè¿™äº›å¯æ§åˆ¶æ€§æ›´å¼ºï¼Œç¼ºç‚¹æ˜¯éœ€è¦åœ¨æ–¹æ³•ä½“å†…è‡ªå·±å†™ä»£ç ï¼Œæ²¡æœ‰æ³¨è§£é‚£ä¹ˆä¼˜é›…ã€‚</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æœ‰ç±»IPåœ°å€ã€å­ç½‘æ©ç ï¼ˆåˆ’åˆ†å­ç½‘ï¼‰ã€æ— ç±»åŸŸé—´è·¯ç”±ï¼ˆCIDRï¼‰</title>
    <link href="/2020/05/06/%E6%9C%89%E7%B1%BBIP%E5%9C%B0%E5%9D%80%E3%80%81%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81%EF%BC%88%E5%88%92%E5%88%86%E5%AD%90%E7%BD%91%EF%BC%89%E3%80%81%E6%97%A0%E7%B1%BB%E5%9F%9F%E9%97%B4%E8%B7%AF%E7%94%B1%EF%BC%88CIDR%EF%BC%89/"/>
    <url>/2020/05/06/%E6%9C%89%E7%B1%BBIP%E5%9C%B0%E5%9D%80%E3%80%81%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81%EF%BC%88%E5%88%92%E5%88%86%E5%AD%90%E7%BD%91%EF%BC%89%E3%80%81%E6%97%A0%E7%B1%BB%E5%9F%9F%E9%97%B4%E8%B7%AF%E7%94%B1%EF%BC%88CIDR%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<p>IPåè®®æ˜¯ç½‘ç»œå±‚ä¸­çš„æ ¸å¿ƒåè®®ï¼Œå¯¹äºIPåœ°å€çš„ç®¡ç†ä¸åˆ’åˆ†åˆ™æ˜¯IPåè®®çš„é‡ç‚¹ã€‚å¯¹äºIPåœ°å€çš„ç®¡ç†åˆ’åˆ†æœ‰ä¸‰ç§æ–¹å¼ï¼š</p><ol><li>æœ‰ç±»IPåœ°å€</li><li>å­ç½‘æ©ç ï¼ˆåˆ’åˆ†å­ç½‘ï¼‰</li><li>æ— ç±»åŸŸé—´è·¯ç”±ï¼ˆCIDRï¼‰</li></ol><p>è¿™ä¸‰ç§æ–¹å¼ç”±ä½•è€Œæ¥ã€æœ‰ä»€ä¹ˆä½œç”¨ã€ä»¥åŠå½¼æ­¤ä¹‹é—´æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ</p><h2 id="1-æœ‰ç±»ipåœ°å€"><a class="markdownIt-Anchor" href="#1-æœ‰ç±»ipåœ°å€"></a> 1ã€æœ‰ç±»IPåœ°å€ï¼š</h2><p>è¿™æ˜¯æœ€æ—©çš„å¯¹IPåœ°å€è¿›è¡Œåˆ†é…å’Œç®¡ç†çš„æ–¹å¼ï¼Œå°†å…¶åˆ†ä¸ºAã€ã€Bã€Cã€Dã€Eï¼Œæ€»å…±5ç±»ã€‚<strong>IPåœ°å€ = ç½‘ç»œå· + ä¸»æœºå·</strong>ã€‚Aã€Bã€C ç±»æ˜¯æˆ‘ä»¬ç”¨äºåˆ†é…ç»™ä¸€èˆ¬ä¸»æœºä½¿ç”¨çš„ï¼›Dã€E åˆ™ä¸ä½œä¸€èˆ¬ç”¨é€”ï¼šDç±»ç”¨åšç»„æ’­åœ°å€ï¼ˆIPæ•°æ®æŠ¥ä¸‰ç§ä¼ è¾“æ–¹å¼ï¼šå•æ’­ã€å¹¿æ’­ã€ç»„æ’­ï¼‰ï¼ŒEç±»ä½œä¸ºç§‘ç ”ä¿ç•™ç½‘ç»œã€‚<br />Aã€Bã€Cç±»ç½‘ç»œå¯¹ç½‘ç»œæ•°å’Œä¸»æœºæ•°éƒ½æœ‰å›ºå®šçš„é™åˆ¶ï¼š<img src="/img/blog_pic/2020/%E6%9C%89%E7%B1%BBIP%E5%9C%B0%E5%9D%80.png" alt="" /><br />å› ä¸ºè¿™ä¸ªå›ºå®šé™åˆ¶ï¼Œä½¿å¾—åæ¥é¢å¯¹æˆ‘ä»¬æ—¥ç›Šå¢å¤§çš„ç½‘ç»œè§„æ¨¡æ—¶ç»™IPåœ°å€çš„ç®¡ç†ä¸åˆ†é…å¸¦æ¥è¯¸å¤šä¸ä¾¿ã€‚æ¯”å¦‚ç°åœ¨æœ‰ä¸€ä¸ªæœºæ„éœ€è¦äº’è”1000å°ä¸»æœºï¼Œä¸ºå…¶åˆ†é…ä¸€ä¸ªCç±»ç½‘ç»œåˆ™ä¸»æœºæ•°ï¼ˆ254ï¼‰ä¸è¶³ï¼Œåˆ†é…ä¸€ä¸ªBç±»ç½‘ç»œåˆ™ä¸»æœºæ•°ï¼ˆ65534ï¼‰æµªè´¹ã€‚</p><h2 id="2-å­ç½‘æ©ç åˆ’åˆ†å­ç½‘"><a class="markdownIt-Anchor" href="#2-å­ç½‘æ©ç åˆ’åˆ†å­ç½‘"></a> 2ã€å­ç½‘æ©ç ï¼ˆåˆ’åˆ†å­ç½‘ï¼‰ï¼š</h2><ul><li>æœ‰ç±»IPåœ°å€ä½¿ç”¨ä¹‹åˆæ˜¯æ»¡è¶³ç½‘ç»œéœ€æ±‚çš„ï¼Œåœ¨è®¾è®¡çš„æ—¶å€™å¹¶æœªè€ƒè™‘åˆ°åæ¥çš„ç½‘ç»œè§„æ¨¡å˜åŒ–å¦‚æ­¤ä¹‹å¤§ï¼Œä»¥è‡³äº40å¤šäº¿çš„ IPv4<br />åœ°å€ä¸å¤Ÿä½¿ç”¨ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ç§æ›´å¥½çš„æ–¹å¼æ¥ç®¡ç†å’Œåˆ†é…ç½‘ç»œï¼Œä½¿å¾—IPåœ°å€èƒ½å¤Ÿè¢«å……åˆ†åˆ©ç”¨ä¸è‡³äºæµªè´¹ã€‚</li><li>å­ç½‘æ©ç ï¼ˆsubnet maskï¼‰å°±æ˜¯è¿™æ ·äº§ç”Ÿçš„ã€‚é€šè¿‡å‘ä¸»æœºå·å€Ÿä½äº§ç”Ÿå­ç½‘å·ï¼Œä½¿å¾—IPåœ°å€çš„ç»“æ„å˜æˆäº†<strong>ç½‘ç»œå·+å­ç½‘å·+ä¸»æœºå·</strong>ã€‚å³<strong>ç”±åŸæ¥çš„ä¸¤å±‚å˜æˆäº†ä¸‰å±‚</strong>ã€‚å³å­ç½‘è§„åˆ’çš„ä»»åŠ¡å°±æ˜¯é€šè¿‡å‘ä¸»æœºä½å€Ÿä½æ¥åˆ›å»ºå­ç½‘ï¼ŒæŠŠå¤§ç½‘ç»œåˆ’åˆ†ä¸ºå°ç½‘ç»œã€‚</li><li>å°†IPåˆ†ç»„ä¸­çš„ç›®çš„IPåœ°å€ä¸å­ç½‘æ©ç æŒ‰ä½ä¸è¿ç®—ï¼Œ æå–å­ç½‘åœ°å€ã€‚å­ç½‘æ©ç ï¼šç½‘ç»œå·ã€å­ç½‘å·å…¨å–1ï¼›ä¸»æœºå·å…¨å–0ã€‚æ˜¯å­ç½‘æ©ç ç¡®å®šäº†ç½‘ç»œå·å’Œä¸»æœºå·ï¼Œè€Œä¸æ˜¯ç½‘ç»œå·å’Œä¸»æœºå·ç¡®å®šäº†å­ç½‘æ©ç ã€‚</li></ul><h2 id="3-æ— ç±»åŸŸé—´è·¯ç”±classless-interdomain-routing"><a class="markdownIt-Anchor" href="#3-æ— ç±»åŸŸé—´è·¯ç”±classless-interdomain-routing"></a> 3ã€æ— ç±»åŸŸé—´è·¯ç”±ï¼ˆClassless Interdomain Routingï¼‰ï¼š</h2><ul><li>å­ç½‘æ©ç è¿˜æ˜¯åœ¨ä¼ ç»Ÿçš„ABCDEç±»ç½‘ä¸‹åˆ’åˆ†çš„ï¼Œå°†åŸæ¥çš„ä¸¤å±‚åˆ’ä¸ºä¸‰å±‚ï¼Œè€ŒCIDRæ¶ˆé™¤äº†æœ‰ç±»çš„ç•Œé™ï¼Œè®©å­ç½‘æ©ç çš„ä¸‰å±‚ç»“æ„å›åˆ°ä¸¤å±‚ï¼Œåˆ†é…IPåœ°å€çš„æ—¶å€™ä¸å†ä»¥ç±»åˆ«æ¥åˆ†ï¼Œè€Œæ˜¯æŒ‰ç…§å¯å˜é•¿çš„åœ°å€å—æ¥åˆ†é…ï¼Œæé«˜ IPv4 åœ°å€ç©ºé—´åˆ†é…æ•ˆç‡ã€‚</li><li>æ— ç±»åœ°å€æ ¼å¼: a.b.c.d / x, å…¶ä¸­xä¸ºå‰ç¼€é•¿åº¦ï¼Œè¡¨ç¤ºç½‘ç»œå·çš„ä½æ•°ã€‚</li><li>CIDRè¿˜å¯ä»¥æé«˜è·¯ç”±æ•ˆç‡ï¼šå°†å¤šä¸ªå­ç½‘èšåˆä¸ºä¸€ä¸ªè¾ƒå¤§çš„å­ç½‘ï¼Œæ„é€ è¶…ç½‘ï¼ˆsupernettingï¼‰ã€‚æœ‰æ•ˆå‡å°‘äº†è·¯ç”±å™¨ä¸­è·¯ç”±è¡¨é¡¹ï¼Œç”±æ­¤æé«˜äº†è·¯ç”±æ•ˆç‡ã€‚ï¼ˆè¿™é‡Œçš„è·¯ç”±èšåˆä¸å‰é¢çš„å­ç½‘åˆ’åˆ†ç›¸åã€‚å‰è€…æ˜¯å°†å°ç½‘ç»œèšåˆæˆå¤§ç½‘ç»œå‡å°‘è·¯ç”±è¡¨é¡¹ä»¥æé«˜è·¯ç”±æ•ˆç‡ï¼›åè€…æ˜¯ä¸ºäº†å°†å¤§ç½‘ç»œåˆ’ä¸ºå°ç½‘ç»œä»¥å……åˆ†ä½¿ç”¨æ¯ä¸€ä¸ªIPåœ°å€ï¼‰</li></ul><h2 id="4-æ€»ç»“"><a class="markdownIt-Anchor" href="#4-æ€»ç»“"></a> 4ã€æ€»ç»“ï¼š</h2><p>ä»æœ‰ç±»IPåœ°å€ åˆ° å­ç½‘æ©ç ï¼ˆåˆ’åˆ†å­ç½‘ï¼‰ å†åˆ° æ— ç±»åŸŸé—´è·¯ç”±ï¼ˆCIDRï¼‰ï¼Œåæ¥è€…è§£å†³äº†å‰è€…åœ¨è®¾è®¡ä¹‹åˆæœªè€ƒè™‘åˆ°è€Œåœ¨å®é™…åº”ç”¨ä¸­å……åˆ†æš´éœ²å‡ºæ¥çš„é—®é¢˜ï¼Œæ˜¯å¯¹IPåœ°å€ç®¡ç†ä¸åˆ†é…çš„å‡çº§ã€‚</p><h2 id="5-å‚è€ƒ"><a class="markdownIt-Anchor" href="#5-å‚è€ƒ"></a> 5ã€å‚è€ƒï¼š</h2><ul><li><a href="https://www.icourse163.org/course/HIT-154005?tid=1206679208">MOOC å“ˆå·¥å¤§ è®¡ç®—æœºç½‘ç»œ</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è®¡ç®—æœºç½‘ç»œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>selenium + pytesseract å®ç°è‡ªåŠ¨è¯†åˆ«éªŒè¯ç å®ç°è‡ªåŠ¨æ‰“å¡</title>
    <link href="/2020/05/02/selenium%20+%20pytesseract%20%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E8%AF%86%E5%88%AB%E9%AA%8C%E8%AF%81%E7%A0%81%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E6%89%93%E5%8D%A1/"/>
    <url>/2020/05/02/selenium%20+%20pytesseract%20%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E8%AF%86%E5%88%AB%E9%AA%8C%E8%AF%81%E7%A0%81%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E6%89%93%E5%8D%A1/</url>
    
    <content type="html"><![CDATA[<h2 id="1-æ­¥éª¤"><a class="markdownIt-Anchor" href="#1-æ­¥éª¤"></a> 1ã€æ­¥éª¤ï¼š</h2><p>åˆ©ç”¨ chromedriver æ‰“å¼€æµè§ˆå™¨ --&gt; ç™»é™†ç½‘ç«™ï¼ˆè¯†åˆ«éªŒè¯ç ï¼‰â€“&gt; è‡ªåŠ¨åŒ–æ“ä½œ</p><h2 id="2-éš¾ç‚¹"><a class="markdownIt-Anchor" href="#2-éš¾ç‚¹"></a> 2ã€éš¾ç‚¹ï¼š</h2><p><strong>2.1ã€ç™»é™†ç½‘ç«™ï¼š</strong></p><p>æœ¬æ¥æƒ³ç”¨ cookieï¼Œä½†æ˜¯æˆ‘ä»¬å­¦æ ¡çš„ç½‘ç«™çš„ cookie ä¸­ httponly = Falseï¼Œä¸èƒ½ç”¨è¿™ç§æ–¹å¼ç»•è¿‡ç™»é™†ã€‚åªèƒ½è¯†åˆ«å‡ºéªŒè¯ç åç™»é™†ï¼Œè¿‡äº†ç™»é™†è¿™å…³åä¾¿æ˜¯ä¸€é©¬å¹³å·ã€‚</p><p><strong>2.2ã€ç½‘ç«™å…ƒç´ çš„è¯†åˆ«ï¼š</strong></p><p>ä¸–ç•Œä¸Šæœ€é¥è¿œçš„è·ç¦»ï¼Œä¸æ˜¯ç”Ÿä¸æ­»ï¼Œè€Œæ˜¯ä½ åœ¨æˆ‘çœ¼å‰ï¼Œæˆ‘å´è¯†åˆ«ä¸äº†ä½ ã€‚<br />selenium æä¾›å¤šç§å…ƒç´ è¯†åˆ«æ–¹å¼ï¼Œå¸¸ç”¨çš„æœ‰ idã€nameã€classã€xpath ç­‰ï¼Œä¸€ç§æ–¹å¼è¯†åˆ«ä¸äº†å°±æ¢å¦ä¸€ç§ï¼Œé’ˆå¯¹ä¸åŒå…ƒç´ ï¼ˆä¸åŒç½‘é¡µï¼‰è¯†åˆ«çš„æ–¹å¼ä¹Ÿä¸åŒï¼Œå¯å‚è€ƒ<a href="https://blog.csdn.net/qq_32897143/article/details/80383502">https://blog.csdn.net/qq_32897143/article/details/80383502</a></p><h2 id="3-ç¯å¢ƒè¦æ±‚"><a class="markdownIt-Anchor" href="#3-ç¯å¢ƒè¦æ±‚"></a> 3ã€ç¯å¢ƒè¦æ±‚ï¼š</h2><ul><li>selenium</li><li>pytesseract</li><li>pillow</li></ul><p>åœ¨å‘½ä»¤è¡Œä½¿ç”¨pipå‘½ä»¤å®‰è£…ä»¥ä¸Šç¬¬ä¸‰æ–¹åº“ï¼Œé»˜è®¤çš„å®‰è£…æ–¹å¼å¾ˆæ…¢ï¼Œä½¿ç”¨é•œåƒç½‘ç«™å®‰è£…ä¼šå¿«å¾ˆå¤šï¼Œç›´æ¥å¤åˆ¶ä¸‹é¢è¿™è¡Œåˆ° cmd<br />pip install --index <a href="https://pypi.mirrors.ustc.edu.cn/simple/">https://pypi.mirrors.ustc.edu.cn/simple/</a> selenium</p><p>å®‰è£…å®Œä»¥ä¸Šåº“åï¼Œè¿˜éœ€å®‰è£…chromedriverï¼ˆseleniumçš„æµè§ˆå™¨é©±åŠ¨ï¼Œedgeæˆ–firefoxä¹Ÿå¯ï¼‰å’Œ tesseractï¼ˆç”¨äºè¯†åˆ«å‡ºéªŒè¯ç ï¼‰</p><p>å®‰è£… chromedriverï¼šæ‰“å¼€<a href="http://npm.taobao.org/mirrors/chromedriver/">ç½‘ç«™</a>ï¼Œæ‰¾åˆ°å¯¹åº”è‡ªå·±çš„ç‰ˆæœ¬åä¸‹è½½ï¼Œå°† chromedriver.exe æ–‡ä»¶å¤åˆ¶åˆ°pythonçš„Scriptsæ–‡ä»¶å¤¹ä¸‹ï¼ˆåœ¨cmdä¸­ç”¨where pythonå‘½ä»¤å¯æ‰¾åˆ°è‡ªå·±çš„å®‰è£…è·¯å¾„ï¼‰</p><p>å®‰è£…tesseractï¼šå‚ç…§<a href="https://blog.csdn.net/showgea/article/details/82656515">https://blog.csdn.net/showgea/article/details/82656515</a></p><h2 id="4-å®Œæ•´ä»£ç "><a class="markdownIt-Anchor" href="#4-å®Œæ•´ä»£ç "></a> 4ã€å®Œæ•´ä»£ç ï¼š</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver<br><span class="hljs-keyword">from</span> selenium.webdriver.support.select <span class="hljs-keyword">import</span> Select <span class="hljs-comment">#ä¸“é—¨ç”¨æ¥å¤„ç†ä¸‹æ‹‰æ¡†</span><br><span class="hljs-keyword">import</span> pytesseract<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys,time<br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image,ImageEnhance<br>website= <span class="hljs-string">&#x27;https://www.xxx.com&#x27;</span> <span class="hljs-comment">#æ‰“å¡çš„ç½‘ç«™</span><br>img_address = <span class="hljs-string">&#x27;C:\\Users\\HP--\\Pictures\\å–œæ¬¢çš„ç…§ç‰‡\\image1.png&#x27;</span> <span class="hljs-comment">#å°†éªŒè¯ç å›¾ç‰‡ä¸‹è½½ä¸‹æ¥åå­˜æ”¾çš„åœ°å€ï¼Œ</span><br> <br>driver = webdriver.Chrome()<br>driver.maximize_window()d<br>cnt = <span class="hljs-number">0</span> <span class="hljs-comment">#è®¡æ•°å¤šå°‘æ¬¡è¯†åˆ«éªŒè¯ç æ‰æˆåŠŸ</span><br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>: <span class="hljs-comment">#å¾ªç¯è¯†åˆ«éªŒè¯ç ç›´åˆ°æˆåŠŸ</span><br>driver.get(website)<br>driver.get_screenshot_as_file(img_adress) <span class="hljs-comment">#å°†æ•´ä¸ªç½‘é¡µæˆªå›¾</span><br><br>img =Image.<span class="hljs-built_in">open</span>(img_address)<br>box = (<span class="hljs-number">1217</span> , <span class="hljs-number">496</span> , <span class="hljs-number">1310</span> , <span class="hljs-number">541</span>)  <span class="hljs-comment">#è®¾ç½®è¦è£å‰ªçš„åŒºåŸŸ</span><br>img = img.crop(box) <span class="hljs-comment">#è£å‰ªå‡ºåªæœ‰éªŒè¯ç çš„å›¾ç‰‡(ç”¨ã€ç”»å›¾ã€‘æ‰“å¼€æˆªä¸‹çš„å›¾ç‰‡ï¼Œé¼ æ ‡æ»‘åˆ°éªŒè¯ç çš„å·¦ä¸Šå’Œå³ä¸‹ï¼Œä¸¤ä¸ªåæ ‡å°±æ˜¯è¦è£å‰ªçš„åŒºåŸŸã€‚é¡ºåºï¼šå·¦ä¸Šæ¨ªåæ ‡ï¼Œå·¦ä¸Šçºµåæ ‡ï¼Œå³ä¸‹æ¨ªåæ ‡ï¼Œå³ä¸‹çºµåæ ‡)</span><br>img.save(img_address) <span class="hljs-comment">#å°†å›¾ç‰‡æ›´æ–°ä¸ºæˆªä¸‹çš„åªæœ‰éªŒè¯ç çš„å›¾</span><br><br>vc = pytesseract.image_to_string(img_address) <span class="hljs-comment">#ä¿å­˜éªŒè¯ç </span><br>account = <span class="hljs-string">&#x27;xxxxx&#x27;</span><br>password = <span class="hljs-string">&#x27;xxxxx&#x27;</span><br><br><span class="hljs-keyword">try</span>:<br>driver.find_element_by_name(<span class="hljs-string">&quot;account&quot;</span>).send_keys(account)<br>driver.find_element_by_name(<span class="hljs-string">&quot;password&quot;</span>).send_keys(password)<br>driver.find_element_by_name(<span class="hljs-string">&quot;rancode&quot;</span>).send_keys(verfication_code)<br>driver.find_element_by_class_name(<span class="hljs-string">&quot;login&quot;</span>).click()<br><br><span class="hljs-keyword">if</span>(driver.find_element_by_id(<span class="hljs-string">&quot;rancode-tips&quot;</span>)): <span class="hljs-comment">#è¿™é‡Œæ˜¯éªŒè¯ç è¯†åˆ«ä¸æ­£ç¡®ç‚¹å‡»ç™»é™†åå‡ºç°çš„é”™è¯¯ä¿¡æ¯</span><br>cnt += <span class="hljs-number">1</span><br><span class="hljs-keyword">continue</span><br><span class="hljs-keyword">except</span>: <span class="hljs-comment">#æ­£ç¡®è¯†åˆ«åæˆåŠŸç™»é™†ï¼Œé€€å‡ºwhileå¾ªç¯</span><br><span class="hljs-keyword">break</span> <br><br><span class="hljs-keyword">try</span>: <span class="hljs-comment">#ä¼šå‡ºç°ä¸€äº›æˆ‘ä¸çŸ¥é“åŸå› çš„é”™è¯¯ï¼Œæ‰€ä»¥è¿˜æ˜¯ç”¨å¼‚å¸¸æ•è·å§</span><br>driver.find_element_by_class_name(<span class="hljs-string">&quot;bdorange.bg_health&quot;</span>).click()<br>driver.find_element_by_link_text(<span class="hljs-string">&quot;å¥åº·æ‰“å¡&quot;</span>).click()<br>driver.find_element_by_id(<span class="hljs-string">&quot;cph_right_ok_submit&quot;</span>).click()<br><br>opt = driver.find_element_by_id(<span class="hljs-string">&quot;cph_right_e_area&quot;</span>)<br>s = Select(opt)<br>s.select_by_visible_text(<span class="hljs-string">&#x27;XXçœ&#x27;</span>) <br><span class="hljs-comment">#ä»¥ä¸Šä¸‰å¥ç”¨selectæ–¹æ³•å¤„ç†ä¸‹æ‹‰æ¡†</span><br><br>driver.find_element_by_id(<span class="hljs-string">&#x27;cph_right_e_location&#x27;</span>).send_keys(<span class="hljs-string">&#x27;XXå¸‚&#x27;</span>)<br>driver.find_element_by_id(<span class="hljs-string">&#x27;cph_right_e_observation_0&#x27;</span>).click()<br>driver.find_element_by_id(<span class="hljs-string">&#x27;cph_right_e_health_0&#x27;</span>).click()<br>driver.find_element_by_id(<span class="hljs-string">&#x27;cph_right_e_temp&#x27;</span>).send_keys(<span class="hljs-string">&#x27;36.6&#x27;</span>)<br>driver.find_element_by_id(<span class="hljs-string">&#x27;cph_right_e_survey01_0&#x27;</span>).click()<br>driver.find_element_by_id(<span class="hljs-string">&#x27;cph_right_e_submit&#x27;</span>).click()<br><span class="hljs-keyword">except</span>:<br><span class="hljs-keyword">pass</span><br><br>driver.quit()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ç»è¿‡&#123;&#125;æ¬¡å°è¯•ï¼Œè‡ªåŠ¨å¥åº·æ‰“å¡å®Œæˆï¼&#x27;</span>.<span class="hljs-built_in">format</span>(cnt))<br></code></pre></td></tr></table></figure><h2 id="5-è¯´æ˜"><a class="markdownIt-Anchor" href="#5-è¯´æ˜"></a> 5ã€è¯´æ˜ï¼š</h2><p>ä»¥ä¸Šç¨‹åºä¸å…·æœ‰è®¾å¤‡æ— å…³æ€§ï¼Œå› ä¸ºæ˜¯ç›´æ¥æˆªå›¾ä¸‹æ¥åä¿å­˜å†æˆªä¸‹éªŒè¯ç æ‰€åœ¨åŒºåŸŸé‚£å—ï¼Œä¸åŒè®¡ç®—æœºçš„å±å¹•ä¸ä¸€æ ·ï¼Œæ‰€ä»¥éªŒè¯ç çš„åæ ‡å€¼åº”è¯¥ä¹Ÿä¸ä¸€æ ·ã€‚å¦‚æœå†™å®Œç¨‹åºæƒ³å‘ç»™åŒå­¦è¯•è¯•<strong>è®°å¾—è¦åšä¸€äº›ä¿®æ”¹</strong>ï¼Œä¸ç„¶Taä¼šä»¥ä¸ºä½ ä¸è¡Œï¼ï¼ï¼selenium æ˜¯ç”¨æ¥æ¨¡ä»¿äººåœ¨æµè§ˆå™¨ä¸Šçš„æ“ä½œçš„ï¼Œè‹¥æ˜¯æƒ³æ›´å¥½çš„åœ°æ¨¡ä»¿ï¼Œåº”è¯¥åœ¨æ¯ä¸‹æ“ä½œåç”¨ time.sleep() åœé¡¿ä¸€ä¸¤ç§’ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>çæ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mess</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
